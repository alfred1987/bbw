{% if section.blocks.size > 0 %}
<section class="featured_products_threeways">
  <div class="clearfix">
    <ul>
      {% for block in section.blocks %}
      {%- assign product = all_products[block.settings.featured_product] -%}
      {%- assign collection_handles = product.collections | map: 'handle' -%}
      {% if collection_handles contains 'new' %}<div class="new_banner_product">{{ 'collections.general.new' | t }}</div>{% endif %}
      {% if collection_handles contains 'pre-order' %}<div class="preorder_banner_product">{{ 'collections.general.pre_order' | t }}</div>{% endif %}
      <li>
        {% assign featured_image = product.selected_or_first_available_variant.featured_image | default: product.featured_image %}
        {% capture list %}
        {% for image in product.images %}
        {{ image.id }}`~`{{ image.alt }}`~`{{ image | product_img_url: '100x' }}`~`{{ image | product_img_url: '200x' }}`~`{{ image | product_img_url: '400x' }}`~`{{ image | product_img_url: '600x' }}`~`{{ image | product_img_url: '800x' }}`~`{{ image | product_img_url: '1200x' }}`~`{{ image | product_img_url: '2000x' }}`~`{{-image.width-}}px`~`{{-image.height-}}px{% if forloop.last == false %}^{% endif %}
        {% endfor %}
        {% endcapture %}
        {% assign image_list = list | split: "^" %}
        {% for image_item in image_list %}
        {% assign image = image_item | split: "`~`" %}
        <a href="{{ product.url }}"><div class="image__container" style="background: url('{{ image[7] }}');"></div></a>
        {% endfor %}
        <h1 class="product_name" itemprop="name"><a href="{{ product.url }}">{{ product.title | truncate: 35 }}</a></h1>
        <div class="description">{{ product.description | truncate: 150 }}</div>
        {% assign variant = product.selected_or_first_available_variant %}
        <p class="modal_price" itemprop="offers" itemscope itemtype="http://schema.org/Offer">
          <meta itemprop="priceCurrency" content="{{ shop.currency }}" />
          <meta itemprop="seller" content="{{ shop.name | escape }}" />
          <link itemprop="availability" href="http://schema.org/{% if product.available %}InStock{% else %}OutOfStock{% endif %}">
          <meta itemprop="itemCondition" content="New" />
          <span class="sold_out">{% if variant.available == false %}{{ 'products.product.sold_out' | t }}{% endif %}</span>
          <span itemprop="price" content="{{ variant.price | money_without_currency }}" class="{% if variant.compare_at_price > variant.price %}sale{% endif %}">
            <span class="current_price {% if product.available == false %}hidden{% endif %}">
              {% if variant.price > 0 %}<span class="money">{{ variant.price | money }}</span>{% else %}{{ settings.free_price_text }}{% endif %}
            </span>
          </span>
          <span class="was_price">{% if variant.price < variant.compare_at_price and variant.available %}<span class="money">{{ variant.compare_at_price | money }}</span>{% endif %}</span>
          {% if section.settings.display_savings %}
          <span class="sale savings">
            {% if variant.price < variant.compare_at_price and variant.available %}
            {{ 'products.product.savings' | t }}  {{ variant.compare_at_price | minus: variant.price | times: 100 | divided_by: variant.compare_at_price }}% (<span class="money">{{ variant.compare_at_price | minus: variant.price | money }}</span>)
            {% endif %}
          </span>
          {% endif %}
        </p>
        {% unless collection_handles contains 'coming-soon' %}<div class="js-product_section product_section">{% include 'product-form' with 'product' %}</div>{% endunless %}
      </li>
      {% endfor %}
    </ul>
  </div>
</section>
{% endif %}
{% schema %}
{
  "name": "Featured products 3 ways",
  "class": "featured-products-3-ways-section",
  "max_blocks": 3,
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "settings": [
        {
          "type": "product",
          "id": "featured_product",
          "label": "Product"
        }
      ]
    }
  ],
  "presets": [{
    "name": "Featured products 3 ways",
    "category": "Product",
    "settings": {
    },
    "blocks": [
      {
        "type": "product"
      },
      {
        "type": "product"
      }
    ]
  }]
}
{% endschema %}