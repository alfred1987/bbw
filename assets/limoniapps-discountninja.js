/* Discount Ninja v4 - production */
//! Discount Ninja price rule engine
//! COPYRIGHT (c) 2017-2019 ALL RIGHTS RESERVED
//! See terms and conditions at https://support.discountninja.io/terms-and-conditions/conditions/terms-and-conditions
var discountNinja_Script_Polyfill={CustomEvent:function(){try{if("function"==typeof window.CustomEvent)return!1;function t(t,i){i=i||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,i.bubbles,i.cancelable,i.detail),n}t.prototype=window.Event.prototype,window.CustomEvent=t}catch(t){discountNinja.Logging.LogError("Polyfill.CustomEvent",t)}},RegisterAll:function(){discountNinja_Script_Polyfill.CustomEvent()}};if("undefined"!=typeof Shopify&&!0===Shopify.designMode)throw new Error("Limoni Apps DiscountNinja has detected it is running in the Shopify Admin theme editor. Aborting script.");var LimoniAppsJQuery=void 0!==LimoniAppsJQuery?LimoniAppsJQuery:null;
/*! jQuery v3.5.1 | (c) JS Foundation and other contributors | jquery.org/license */function LimoniAppsLoadJQuery(t,i){function n(){"function"==typeof jQuery&&"function"!=typeof LimoniAppsJQuery&&(LimoniAppsJQuery=jQuery),t&&t()}var e="function"==typeof LimoniAppsJQuery||"function"==typeof jQuery;if(!e||!function(){try{var t="function"==typeof LimoniAppsJQuery?LimoniAppsJQuery.fn.jquery.split("."):"function"==typeof jQuery?jQuery.fn.jquery.split("."):$.fn.jquery.split("."),i=parseInt(t[0]),n=parseInt(t[1]);return i>1||1===i&&n>=9}catch(t){return!1}}()){var o="object"==typeof discountNinjaContext&&"object"==typeof discountNinjaContext.Flags&&!0===discountNinjaContext.Flags.SkipWaitForJQuery;if((i=i||1)<20&&!0!==o)setTimeout((function(){LimoniAppsLoadJQuery(t,i+1)}),50);else{try{e?console.warn("Discount Ninja - Detected incompatible version of jQuery (v"+jQuery.fn.jquery+"). Loading version v"+"3.5.1."):console.warn("Discount Ninja - jQuery unavailable. "+(o?"":"Performance can be optimized by setting the SkipWaitForJQuery flag to true in the limoniapps-discountninja-context-flags.liquid asset of your theme. ")+"Loading version "+"3.5.1.")}catch(t){}!function(t,i,n){try{if(null===document.getElementById(t)){var e=document.createElement("script");e.type="text/javascript",e.onload=e.onreadystatechange=n,e.src=i,e.id=t,document.head.appendChild(e)}}catch(t){console.error("Discount Ninja cannot load dependency from "+i,t)}}("limoniapps-discountninja-dependency-jquery","//ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js",n)}}else n()}
/*! Ouibounce by Carl Sednaoui - https://github.com/carlsednaoui/ouibounce | Licensed under MIT License (https://github.com/carlsednaoui/ouibounce/blob/master/license.md) */function LimoniAppsLoadOuiBounce(t){var i,n;"function"!=typeof ouibounce&&(i=this,n=function(t,i,n){return function(t,i){function n(t,i){return void 0===t?i:t}function e(t){var i=24*t*60*60*1e3,n=new Date;return n.setTime(n.getTime()+i),"; expires="+n.toUTCString()}function o(t){t.clientY>p||(y=setTimeout(u,N))}function r(){y&&(clearTimeout(y),y=null)}function a(t){v||t.metaKey&&76===t.keyCode&&(v=!0,y=setTimeout(u,N))}function c(t,i){return function(){for(var t=document.cookie.split("; "),i={},n=t.length-1;n>=0;n--){var e=t[n].split("=");i[e[0]]=e[1]}return i}()[t]===i}function s(){return c(C,"true")&&!g}function u(){s()||(t&&(t.style.display="block"),j(),d())}function d(t){var i=t||{};void 0!==i.cookieExpire&&(m=e(i.cookieExpire)),!0===i.sitewide&&(S=";path=/"),void 0!==i.cookieDomain&&(h=";domain="+i.cookieDomain),void 0!==i.cookieName&&(C=i.cookieName),document.cookie=C+"=true"+m+h+S,_.removeEventListener("mouseleave",o),_.removeEventListener("mouseenter",r),_.removeEventListener("keydown",a)}var l=i||{},g=l.aggressive||!1,p=n(l.sensitivity,20),f=n(l.timer,1e3),N=n(l.delay,0),j=l.callback||function(){},m=e(l.cookieExpire)||"",h=l.cookieDomain?";domain="+l.cookieDomain:"",C=l.cookieName?l.cookieName:"viewedOuibounceModal",S=!0===l.sitewide?";path=/":"",y=null,_=document.documentElement;setTimeout((function(){s()||(_.addEventListener("mouseleave",o),_.addEventListener("mouseenter",r),_.addEventListener("keydown",a))}),f);var v=!1;return{fire:u,disable:d,isDisabled:s}}},"function"==typeof define&&define.amd?define(n):"object"==typeof exports?module.exports=n(require,exports,module):i.ouibounce=n()),t&&t()}function LimoniAppsLoadDayJs(t){var i,n;
/*! day.js | version : 1.10.4 | authors : iamkun | license : MIT | day.js.org */
"function"!=typeof dayjs&&(i=this,n=function(){var t="millisecond",i="second",n="minute",e="hour",o="day",r="week",a="month",c="quarter",s="year",u="date",d=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,l=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},p=function(t,i,n){var e=String(t);return!e||e.length>=i?t:""+Array(i+1-e.length).join(n)+t},f={s:p,z:function(t){var i=-t.utcOffset(),n=Math.abs(i),e=Math.floor(n/60),o=n%60;return(i<=0?"+":"-")+p(e,2,"0")+":"+p(o,2,"0")},m:function t(i,n){if(i.date()<n.date())return-t(n,i);var e=12*(n.year()-i.year())+(n.month()-i.month()),o=i.clone().add(e,a),r=n-o<0,c=i.clone().add(e+(r?-1:1),a);return+(-(e+(n-o)/(r?o-c:c-o))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(d){return{M:a,y:s,w:r,d:o,D:u,h:e,m:n,s:i,ms:t,Q:c}[d]||String(d||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},N="en",j={};j[N]=g;var m=function(t){return t instanceof y},h=function(t,i,n){var e;if(!t)return N;if("string"==typeof t)j[t]&&(e=t),i&&(j[t]=i,e=t);else{var o=t.name;j[o]=t,e=o}return!n&&e&&(N=e),e||!n&&N},C=function(t,i){if(m(t))return t.clone();var n="object"==typeof i?i:{};return n.date=t,n.args=arguments,new y(n)},S=f;S.l=h,S.i=m,S.w=function(t,i){return C(t,{locale:i.$L,utc:i.$u,x:i.$x,$offset:i.$offset})};var y=function(){function g(t){this.$L=h(t.locale,null,!0),this.parse(t)}var p=g.prototype;return p.parse=function(t){this.$d=function(t){var i=t.date,n=t.utc;if(null===i)return new Date(NaN);if(S.u(i))return new Date;if(i instanceof Date)return new Date(i);if("string"==typeof i&&!/Z$/i.test(i)){var e=i.match(d);if(e){var o=e[2]-1||0,r=(e[7]||"0").substring(0,3);return n?new Date(Date.UTC(e[1],o,e[3]||1,e[4]||0,e[5]||0,e[6]||0,r)):new Date(e[1],o,e[3]||1,e[4]||0,e[5]||0,e[6]||0,r)}}return new Date(i)}(t),this.$x=t.x||{},this.init()},p.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},p.$utils=function(){return S},p.isValid=function(){return!("Invalid Date"===this.$d.toString())},p.isSame=function(t,i){var n=C(t);return this.startOf(i)<=n&&n<=this.endOf(i)},p.isAfter=function(t,i){return C(t)<this.startOf(i)},p.isBefore=function(t,i){return this.endOf(i)<C(t)},p.$g=function(t,i,n){return S.u(t)?this[i]:this.set(n,t)},p.unix=function(){return Math.floor(this.valueOf()/1e3)},p.valueOf=function(){return this.$d.getTime()},p.startOf=function(t,c){var d=this,l=!!S.u(c)||c,g=S.p(t),p=function(t,i){var n=S.w(d.$u?Date.UTC(d.$y,i,t):new Date(d.$y,i,t),d);return l?n:n.endOf(o)},f=function(t,i){return S.w(d.toDate()[t].apply(d.toDate("s"),(l?[0,0,0,0]:[23,59,59,999]).slice(i)),d)},N=this.$W,j=this.$M,m=this.$D,h="set"+(this.$u?"UTC":"");switch(g){case s:return l?p(1,0):p(31,11);case a:return l?p(1,j):p(0,j+1);case r:var C=this.$locale().weekStart||0,y=(N<C?N+7:N)-C;return p(l?m-y:m+(6-y),j);case o:case u:return f(h+"Hours",0);case e:return f(h+"Minutes",1);case n:return f(h+"Seconds",2);case i:return f(h+"Milliseconds",3);default:return this.clone()}},p.endOf=function(t){return this.startOf(t,!1)},p.$set=function(r,c){var d,l=S.p(r),g="set"+(this.$u?"UTC":""),p=(d={},d[o]=g+"Date",d[u]=g+"Date",d[a]=g+"Month",d[s]=g+"FullYear",d[e]=g+"Hours",d[n]=g+"Minutes",d[i]=g+"Seconds",d[t]=g+"Milliseconds",d)[l],f=l===o?this.$D+(c-this.$W):c;if(l===a||l===s){var N=this.clone().set(u,1);N.$d[p](f),N.init(),this.$d=N.set(u,Math.min(this.$D,N.daysInMonth())).$d}else p&&this.$d[p](f);return this.init(),this},p.set=function(t,i){return this.clone().$set(t,i)},p.get=function(t){return this[S.p(t)]()},p.add=function(t,c){var u,d=this;t=Number(t);var l=S.p(c),g=function(i){var n=C(d);return S.w(n.date(n.date()+Math.round(i*t)),d)};if(l===a)return this.set(a,this.$M+t);if(l===s)return this.set(s,this.$y+t);if(l===o)return g(1);if(l===r)return g(7);var p=(u={},u[n]=6e4,u[e]=36e5,u[i]=1e3,u)[l]||1,f=this.$d.getTime()+t*p;return S.w(f,this)},p.subtract=function(t,i){return this.add(-1*t,i)},p.format=function(t){var i=this;if(!this.isValid())return"Invalid Date";var n=t||"YYYY-MM-DDTHH:mm:ssZ",e=S.z(this),o=this.$locale(),r=this.$H,a=this.$m,c=this.$M,s=o.weekdays,u=o.months,d=function(t,e,o,r){return t&&(t[e]||t(i,n))||o[e].substr(0,r)},g=function(t){return S.s(r%12||12,t,"0")},p=o.meridiem||function(t,i,n){var e=t<12?"AM":"PM";return n?e.toLowerCase():e},f={YY:String(this.$y).slice(-2),YYYY:this.$y,M:c+1,MM:S.s(c+1,2,"0"),MMM:d(o.monthsShort,c,u,3),MMMM:d(u,c),D:this.$D,DD:S.s(this.$D,2,"0"),d:String(this.$W),dd:d(o.weekdaysMin,this.$W,s,2),ddd:d(o.weekdaysShort,this.$W,s,3),dddd:s[this.$W],H:String(r),HH:S.s(r,2,"0"),h:g(1),hh:g(2),a:p(r,a,!0),A:p(r,a,!1),m:String(a),mm:S.s(a,2,"0"),s:String(this.$s),ss:S.s(this.$s,2,"0"),SSS:S.s(this.$ms,3,"0"),Z:e};return n.replace(l,(function(t,i){return i||f[t]||e.replace(":","")}))},p.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},p.diff=function(t,u,d){var l,g=S.p(u),p=C(t),f=6e4*(p.utcOffset()-this.utcOffset()),N=this-p,j=S.m(this,p);return j=(l={},l[s]=j/12,l[a]=j,l[c]=j/3,l[r]=(N-f)/6048e5,l[o]=(N-f)/864e5,l[e]=N/36e5,l[n]=N/6e4,l[i]=N/1e3,l)[g]||N,d?j:S.a(j)},p.daysInMonth=function(){return this.endOf(a).$D},p.$locale=function(){return j[this.$L]},p.locale=function(t,i){if(!t)return this.$L;var n=this.clone(),e=h(t,i,!0);return e&&(n.$L=e),n},p.clone=function(){return S.w(this.$d,this)},p.toDate=function(){return new Date(this.valueOf())},p.toJSON=function(){return this.isValid()?this.toISOString():null},p.toISOString=function(){return this.$d.toISOString()},p.toString=function(){return this.$d.toUTCString()},g}(),_=y.prototype;return C.prototype=_,[["$ms",t],["$s",i],["$m",n],["$H",e],["$W",o],["$M",a],["$y",s],["$D",u]].forEach((function(t){_[t[1]]=function(i){return this.$g(i,t[0],t[1])}})),C.extend=function(t,i){return t.$i||(t(i,y,C),t.$i=!0),C},C.locale=h,C.isDayjs=m,C.unix=function(t){return C(1e3*t)},C.en=j[N],C.Ls=j,C.p={},C},"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):i.dayjs=n()),function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.dayjs_plugin_utc=i()}(this,(function(){return function(t,i,n){var e=(new Date).getTimezoneOffset(),o=i.prototype;n.utc=function(t){return new i({date:t,utc:!0,args:arguments})},o.utc=function(){return n(this.toDate(),{locale:this.$L,utc:!0})},o.local=function(){return n(this.toDate(),{locale:this.$L,utc:!1})};var r=o.parse;o.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),r.call(this,t)};var a=o.init;o.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else a.call(this)};var c=o.utcOffset;o.utcOffset=function(t){var i=this.$utils().u;if(i(t))return this.$u?0:i(this.$offset)?c.call(this):this.$offset;var n,o=Math.abs(t)<=16?60*t:t;return 0!==t?(n=this.local().add(o+e,"minute")).$offset=o:n=this.utc(),n};var s=o.format;o.format=function(t){var i=t||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return s.call(this,i)},o.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+e;return this.$d.valueOf()-6e4*t},o.isUTC=function(){return!!this.$u},o.toISOString=function(){return this.toDate().toISOString()},o.toString=function(){return this.toDate().toUTCString()};var u=o.toDate;o.toDate=function(t){return"s"===t&&this.$offset?n(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():u.call(this)}}})),function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.dayjs_plugin_duration=i()}(this,(function(){var t,i,n=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,e={years:31536e6,months:2592e6,days:864e5,hours:36e5,minutes:6e4,seconds:1e3,weeks:6048e5},o=function(t){return t instanceof c},r=function(t,i,n){return new c(t,n,i.$l)},a=function(t){return i.p(t)+"s"},c=function(){function i(t,i,o){var c=this;if(this.$d={},this.$l=o||"en",i)return r(t*e[a(i)],this);if("number"==typeof t)return this.$ms=t,this.parseFromMilliseconds(),this;if("object"==typeof t)return Object.keys(t).forEach((function(i){c.$d[a(i)]=t[i]})),this.calMilliseconds(),this;if("string"==typeof t){var s=t.match(n);if(s)return this.$d.years=s[2],this.$d.months=s[3],this.$d.days=s[5],this.$d.hours=s[6],this.$d.minutes=s[7],this.$d.seconds=s[8],this.calMilliseconds(),this}return this}var c=i.prototype;return c.calMilliseconds=function(){var t=this;this.$ms=Object.keys(this.$d).reduce((function(i,n){return i+(t.$d[n]||0)*(e[n]||1)}),0)},c.parseFromMilliseconds=function(){var t=this.$ms;this.$d.years=Math.floor(t/31536e6),t%=31536e6,this.$d.months=Math.floor(t/2592e6),t%=2592e6,this.$d.days=Math.floor(t/864e5),t%=864e5,this.$d.hours=Math.floor(t/36e5),t%=36e5,this.$d.minutes=Math.floor(t/6e4),t%=6e4,this.$d.seconds=Math.floor(t/1e3),t%=1e3,this.$d.milliseconds=t},c.toISOString=function(){var t=this.$d.years?this.$d.years+"Y":"",i=this.$d.months?this.$d.months+"M":"",n=this.$d.days||0;this.$d.weeks&&(n+=7*this.$d.weeks);var e=n?n+"D":"",o=this.$d.hours?this.$d.hours+"H":"",r=this.$d.minutes?this.$d.minutes+"M":"",a=this.$d.seconds||0;this.$d.milliseconds&&(a+=this.$d.milliseconds/1e3);var c=a?a+"S":"",s="P"+t+i+e+(o||r||c?"T":"")+o+r+c;return"P"===s?"P0D":s},c.toJSON=function(){return this.toISOString()},c.as=function(t){return this.$ms/(e[a(t)]||1)},c.get=function(t){var i=this.$ms,n=a(t);return"milliseconds"===n?i%=1e3:i="weeks"===n?Math.floor(i/e[n]):this.$d[n],i},c.add=function(t,i,n){var c;return c=i?t*e[a(i)]:o(t)?t.$ms:r(t,this).$ms,r(this.$ms+c*(n?-1:1),this)},c.subtract=function(t,i){return this.add(t,i,!0)},c.locale=function(t){var i=this.clone();return i.$l=t,i},c.clone=function(){return r(this.$ms,this)},c.humanize=function(i){return t().add(this.$ms,"ms").locale(this.$l).fromNow(!i)},c.milliseconds=function(){return this.get("milliseconds")},c.asMilliseconds=function(){return this.as("milliseconds")},c.seconds=function(){return this.get("seconds")},c.asSeconds=function(){return this.as("seconds")},c.minutes=function(){return this.get("minutes")},c.asMinutes=function(){return this.as("minutes")},c.hours=function(){return this.get("hours")},c.asHours=function(){return this.as("hours")},c.days=function(){return this.get("days")},c.asDays=function(){return this.as("days")},c.weeks=function(){return this.get("weeks")},c.asWeeks=function(){return this.as("weeks")},c.months=function(){return this.get("months")},c.asMonths=function(){return this.as("months")},c.years=function(){return this.get("years")},c.asYears=function(){return this.as("years")},i}();return function(n,e,a){t=a,i=a().$utils(),a.duration=function(t,i){return r(t,{},i)},a.isDuration=o}})),dayjs.extend(window.dayjs_plugin_utc),dayjs.extend(window.dayjs_plugin_duration),t&&t()}try{var discountNinjaStopLoading=void 0!==discountNinja||void 0!==discountNinja_Script_Loading}catch(t){var x=0}if(discountNinjaStopLoading)console.warn("Discount Ninja - Aborting load of script because it is already loaded");else{try{if(null==EventTarget.prototype.original_limoniAppsDiscountNinja_addEventListener){function addEventListener_hook(t,i,n){this.limoniAppsDiscountNinjaAllHandlers=this.limoniAppsDiscountNinjaAllHandlers||[],this.limoniAppsDiscountNinjaAllHandlers.push({typ:t,fn:i,opt:n}),this.original_limoniAppsDiscountNinja_addEventListener(t,i,n)}EventTarget.prototype.original_limoniAppsDiscountNinja_addEventListener=EventTarget.prototype.addEventListener,EventTarget.prototype.addEventListener=addEventListener_hook}}catch(t){console.error("InterceptAddEventListener failed",t)}discountNinja_Script_Polyfill.RegisterAll();var discountNinja_Script_Loading=!0,discountNinja_Script_Core={Shop:"",Environment:"prod",Version:"7.5.5.4",ApiVersion:"4",SubscribedToDrawerCartOpened:!1,SubscribedToCollectionProductsAdded:!1,SubscribedToQuickViewProductDisplayed:!1,Navigating:!1,TriggerPromotion:function(t){try{var i=discountNinja.Utilities.jQuery()(t).attr("data-limoniapps-discountninja-token");discountNinja_Script_Core.TriggerPromotionViaToken(i)}catch(t){discountNinja.Logging.LogError("Core.Exception in TriggerPromotion",t)}},TriggerPromotionViaToken:function(t){try{null!=t&&""!==t&&(discountNinja.Logging.LogVerbose("Triggering offer with token "+t),discountNinja.Token.SetTokenInLocalStorage(t),discountNinja.Token.SetCartTokenInLocalStorage(t),discountNinja.Token.SetNonAutomaticTokenToCache(t),discountNinja_Script_Core.Start())}catch(t){discountNinja.Logging.LogError("Core.Exception in TriggerPromotion",t)}},ExecuteOnLoadCallback:function(){try{var callback=discountNinja.Cache.SessionGet("CallbackAfterReloadPageAddingFreeGift");callback&&""!==callback&&(discountNinja.Cache.SessionSet("CallbackAfterReloadPageAddingFreeGift",""),setTimeout((function(){try{eval(callback)}catch(t){discountNinja.Logging.LogError("PromotionFlow.ExecuteCallback.Eval",t)}}),500))}catch(t){discountNinja.Logging.LogError("PromotionFlow.ExecuteCallback",t)}},Start:function(t){function i(){try{discountNinja.LogSession.PrintPerformance("StartInternal"),void 0===discountNinjaContext.AccessToken&&(discountNinjaContext.AccessToken=discountNinja.Settings.GetFlag("AccessToken")),void 0!==discountNinjaContext.ApiVersion&&(discountNinja_Script_Core.ApiVersion=discountNinjaContext.ApiVersion),discountNinja.LeakyBucket.Initialize(discountNinja.LeakyBucket.Buckets.ProductLiquid,5e3,30),discountNinja.LeakyBucket.Initialize(discountNinja.LeakyBucket.Buckets.ProductApi,5e3,100),discountNinja_Script_Core.Shop=discountNinja.Environment.Shopify.MyShopifyDomain(),!0===discountNinja.Settings.GetFlag("ForceDevelopmentEnvironment")&&"dev"!==discountNinja_Script_Core.Environment&&(discountNinja.Logging.LogWarning("Changing environment to dev"),discountNinja_Script_Core.Environment="dev"),function(){function t(t){return t.replace(/\\{/g,"{").replace(/\\}/g,"}")}function i(i){return i&&(i.Format&&(i.Format=t(i.Format)),i.PrefixText&&(i.PrefixText=t(i.PrefixText)),i.SuffixText&&(i.SuffixText=t(i.SuffixText))),i}discountNinja.Settings.Settings=window.discountNinjaContext.Settings;var n=discountNinja.Settings.Settings;if(n.Currency){n.Currency.MoneyFormat&&(n.Currency.MoneyFormat=n.Currency.MoneyFormat.replace(/\\{/g,"{").replace(/\\}/g,"}"));var e=n.PriceUpdate;e.ProductPagePriceFormat&&(e.ProductPagePriceFormat=i(e.ProductPagePriceFormat)),e.OtherPagePriceFormat&&(e.OtherPagePriceFormat=i(e.OtherPagePriceFormat)),e.CartProductPriceFormat&&(e.CartProductPriceFormat=i(e.CartProductPriceFormat)),e.CartLinePriceFormat&&(e.CartLinePriceFormat=i(e.CartLinePriceFormat)),e.CartSubtotalPriceFormat&&(e.CartSubtotalPriceFormat=i(e.CartSubtotalPriceFormat)),e.DrawerCartProductPriceFormat&&(e.DrawerCartProductPriceFormat=i(e.DrawerCartProductPriceFormat)),e.DrawerCartLinePriceFormat&&(e.DrawerCartLinePriceFormat=i(e.DrawerCartLinePriceFormat)),e.DrawerCartSubtotalPriceFormat&&(e.DrawerCartSubtotalPriceFormat=i(e.DrawerCartSubtotalPriceFormat))}}();var t=discountNinja.Settings.Settings;if(!t||!t.Currency||!t.Currency.BaseCurrency)return void discountNinja.Logging.LogErrorMessage("Core.LoadSettings","No settings available");if("undefined"!==window.discountNinjaContextAdditionalProduct&&window.discountNinjaContextAdditionalProduct&&"object"==typeof window.discountNinjaContextAdditionalProduct.CollectionProducts)for(var i=0;i<window.discountNinjaContextAdditionalProduct.CollectionProducts.length;i++)window.discountNinjaContext.CollectionProducts.push(window.discountNinjaContextAdditionalProduct.CollectionProducts[i]);discountNinja.Checkout.Shopify.RegisterEventHandlerForCheckout(),!0===discountNinja.Settings.Settings.Checkout.BlockCheckoutButton&&discountNinja.DynamicPricing.BlockCheckoutButtons();var n=discountNinja.DiscountCode;n.EnableDiscountCodeField(),n.LockDiscountCodeFieldIfRequired(),discountNinja_Script_Core.SubscribedToDrawerCartOpened||(discountNinja.Cart.Shopify.SubscribeDrawerCartOpened(),discountNinja_Script_Core.SubscribedToDrawerCartOpened=!0),discountNinja_Script_Core.SubscribedToCollectionProductsAdded||(discountNinja.Events.Subscribe("CollectionProductsAdded",discountNinja.DynamicPricing.OnCollectionPageProductsAdded),discountNinja.Events.Subscribe("collection:productsadded",discountNinja.DynamicPricing.OnCollectionPageProductsAdded),discountNinja_Script_Core.SubscribedToCollectionProductsAdded=!0),discountNinja_Script_Core.SubscribedToQuickViewProductDisplayed||(discountNinja.Events.Subscribe("QuickViewProductDisplayed",discountNinja.DynamicPricing.OnQuickViewProductDisplayed),discountNinja.Events.Subscribe("quickview:productdisplayed",discountNinja.DynamicPricing.OnQuickViewProductDisplayed),discountNinja_Script_Core.SubscribedToQuickViewProductDisplayed=!0),window.addEventListener("beforeunload",(function(){discountNinja_Script_Core.Navigating=!0,discountNinja.Cache.SessionSet(discountNinja_Script_CartAdjustments.StatusKey,"aborted")})),discountNinja.Trigger.IntializeTimeOnPageCounter(),discountNinja.Trigger.TrackScrollPercentage(),discountNinja.Offer.PrimaryOffer=null,discountNinja_Script_Core.RegisterDiscountButtonClickEvents(),discountNinja.Events.Subscribe("app:disable",(function(){!function(){try{discountNinja.Cache.SessionSet("AppIsDisabled",!0),discountNinja.Logging.LogWarning("Discount Ninja was manually disabled for the remainder of this session",!0),discountNinja.Offer.ReEvaluate()}catch(t){discountNinja.Logging.LogError("Core.DisableApp",t)}}()})),discountNinja.Events.Subscribe("app:enable",(function(){!function(){try{discountNinja.Cache.SessionRemove("AppIsDisabled"),discountNinja.Logging.LogInformation("Discount Ninja was manually re-enabled for the remainder of this session"),discountNinja.Offer.ReEvaluate()}catch(t){discountNinja.Logging.LogError("Core.EnableApp",t)}}()})),discountNinja_Script_Core.ResetObsoleteStorage(),null==discountNinja.Cache.SessionGet("OriginalReferrer")&&discountNinja.Cache.SessionSet("OriginalReferrer",document.referrer),discountNinja.LogSession.Start(),discountNinja.Offer.LoadApplicableOffers((function(){discountNinja.LogSession.PrintPerformance("Applicable offers loaded"),discountNinja.Cart.Shopify.UpdateCart((function(){discountNinja.LogSession.PrintPerformance("Cart available"),discountNinja.Trigger.EnsureInitialPromotionsTriggered((function(){discountNinja.LogSession.PrintPerformance("Initial promotions triggered"),discountNinja.DiscountedCart.BuildDiscountedCart((function(){discountNinja.LogSession.PrintPerformance("DiscountedCart built"),function(t){try{var i=0,n=null,e=function(){i++,void 0!==discountNinja.Utilities.jQuery()&&"boolean"==typeof discountNinja.Utilities.jQuery().isReady&&(discountNinja_Script_Core.DOMHasLoaded=discountNinja_Script_Core.DOMHasLoaded||discountNinja.Utilities.jQuery().isReady),discountNinja_Script_Core.DOMHasLoaded||100===i?(null!==n&&clearTimeout(n),100===i&&discountNinja.Logging.LogErrorMessage("Core.Start.WaitForDom","Timed out"),"function"==typeof t&&null!==t&&t()):n=setTimeout((function(){try{e()}catch(t){discountNinja.Logging.LogError("Core.WaitForDom",t)}}),50)};e()}catch(t){discountNinja.Logging.LogError("Core.WaitForDom",t)}}((function(){discountNinja.LogSession.PrintPerformance("WaitForDom complete"),discountNinja.Checkout.Shopify.InjectLoadingCheckoutPopUp(),discountNinja.PromotionFlow.StartFlow(),discountNinja.ProductData.Save()}))}))}))}))}),discountNinja.PromotionFlow.StopFlow),discountNinja.PromotionEvent.ProcessQueue()}catch(t){discountNinja.Logging.LogError("Core.StartInternal",t)}}function n(){discountNinja.Events.Publish("internal:start")}try{discountNinja.LogSession.RegisterTimeToLoad(),discountNinja_Script_Core.CurrentLocation=discountNinja.QueryParameter.RemoveFromUrl(window.location.href,"discountninjatestmode",1),discountNinja_Script_Core.CurrentLocation=discountNinja.QueryParameter.RemoveFromUrl(discountNinja_Script_Core.CurrentLocation,"discountninjalog",1),discountNinja_Script_Core.Shop=discountNinja.Environment.Shopify.MyShopifyDomain(!0),function(){try{discountNinja.TestMode.HandleQueryParameter(),discountNinja.Logging.HandleQueryParameter()}catch(t){discountNinja.Logging.LogError("Core.HandleDiscountNinjaQueryParameters",t)}}(),t&&discountNinja.Logging.LogToConsole("information","\n\n"+discountNinja.Utilities.GetEmoji(128640)+" Discount Ninja v"+discountNinja_Script_Core.Version+" ("+discountNinja_Script_Core.Environment+") --\x3e Discount Ninja adds rich discount stacking and special deals capabilities to Shopify.\nLearn more at https://apps.shopify.com/discount-url?ref="+discountNinja_Script_Core.Shop+"\nThis script uses third-party open source software. Read more here: http://support.discountninja.io/en/articles/3534630-legal-notices\n\n","green",!0,!0),function(){try{discountNinja.XmlHttpRequest.SendIntercepted?discountNinja.Logging.LogVerbose("Send handler already registered"):"undefined"!=typeof XMLHttpRequest?XMLHttpRequest.prototype.send=discountNinja.XmlHttpRequest.CreateSendInterceptor("readystatechange",discountNinja.XmlHttpRequest.HandleSend,XMLHttpRequest.prototype.send):discountNinja.Logging.LogErrorMessage("Core","XMLHttpRequest not available"),discountNinja.XmlHttpRequest.FetchIntercepted?discountNinja.Logging.LogVerbose("Fetch handler already registered"):discountNinja.XmlHttpRequest.CreateFetchInterceptor(discountNinja.XmlHttpRequest.HandleFetch)}catch(t){discountNinja.Logging.LogError("Core.InterceptNetworkTraffic",t)}}(),discountNinja.Logging.LogVerbose("Dependency -- Loading dependencies"),LimoniAppsLoadJQuery((function(){discountNinja.Events.Subscribe("internal:start",(function(){i()})),discountNinja.Logging.LogVerbose("Dependency -- jQuery loaded"),discountNinja.Utilities.jQuery()(document).ready((function(t){discountNinja.DOMHasLoaded=!0,discountNinja.Logging.LogVerbose("JQuery Document Ready"),discountNinja.XmlHttpRequest.RegisterToAjaxEvents()})),LimoniAppsLoadOuiBounce((function(){discountNinja.Logging.LogVerbose("Dependency -- Oui Bounce loaded"),LimoniAppsLoadDayJs((function(){discountNinja.Logging.LogVerbose("Dependency -- Day JS loaded");discountNinja.LiquidData.WaitForLiquidAsset(n)}))}))}))}catch(t){discountNinja.Logging.LogError("Core.Start",t)}},ResetObsoleteStorage:function(){function t(t){try{var i=t.split(".");return i[0]+"."+i[1]}catch(i){return t}}try{var i=t(discountNinja.Cache.LocalGet("version")),n=t(discountNinja_Script_Core.Version);i!==n&&(localStorage.clear(),discountNinja.Cache.LocalSet("version",n))}catch(t){discountNinja.Logging.LogError("Core.Start",t)}},RegisterDiscountButtonClickEvents:function(){try{!function(){try{discountNinja.Utilities.jQuery()("body").find(".limoniapps-discountninja-discountbutton").each((function(){discountNinja.Utilities.jQuery()(this).off("click")}))}catch(t){discountNinja.Logging.LogError("Core.UnRegisterDiscountButtonClickEvents",t)}}(),discountNinja.Utilities.jQuery()("body").find(".limoniapps-discountninja-discountbutton").each((function(){discountNinja.Utilities.jQuery()(this).on("click",(function(t){discountNinja_Script_Core.TriggerPromotion(t.currentTarget)}))}))}catch(t){discountNinja.Logging.LogError("Core.RegisterDiscountButtonClickEvents",t)}},CheckoutCurrentVariant:function(){try{if(discountNinja.Environment.Shopify.IsProductPage()){var t=discountNinja.Environment.Shopify.VariantId(),i=discountNinja.DiscountCode.GetDiscountCode(),n=discountNinja.Utilities.jQuery()('form input[name="quantity"]'),e=1;null!==n&&1===n.length&&(e=n.val()),(void 0===e||"undefined"===e||null===e||isNaN(e))&&(e=1);var o=null==i||""===i?"":"?discount="+i,r=discountNinja.QueryParameter.Get("locale"),a=void 0===r?"":""===o?"?locale="+r:"&locale="+r;window.location.assign("    /"+t+":"+e+o+a)}}catch(t){discountNinja.Logging.LogError("Core.CheckoutCurrentVariant",t)}}},discountNinja_Script_Badge={WrapperClass:"limoniapps-discountninja-badge-wrapper",BadgeClass:"limoniapps-discountninja-badge",Add:function(t,i,n,e){try{if(t.Badge){var o=function(t,i,n){try{if(!t)return"";var e=t.Badge,o=discountNinja.ShortCode.ReplaceAllPlaceHolders(t,discountNinja.TextSettings.GetText(!0===n?e.PrerequisiteText:e.Text,t),i);if(""===o||null===o)return null;var r=discountNinja.Utilities.jQuery()("#limoniapps-discountninja-badge-template").html();return r=discountNinja.TemplateParameter.Replace(r,"TEXT",o),r=discountNinja.TemplateParameter.Replace(r,"TOKEN",t.Token),r=discountNinja.TemplateParameter.Replace(r,"STYLE",e.Style),r=discountNinja.TemplateParameter.Replace(r,"POSITION",e.Position),r=discountNinja.TemplateParameter.Replace(r,"SIZE",e.Size)}catch(t){return discountNinja.Logging.LogError("Badge.GetHtml",t),""}}(t,i,e);if(null===o)return;var r=discountNinja.Utilities.jQuery()(n).find("."+discountNinja_Script_Badge.BadgeClass+"[data-token="+t.Token+"]");if(r.length>0)discountNinja.Utilities.jQuery()(r).parent().html(o);else{var a='<div class="'+discountNinja_Script_Badge.WrapperClass+'">'+o+"</div>";discountNinja.Utilities.jQuery()(n).append(a)}}else discountNinja.Logging.LogVerbose("Not showing badge, not enabled for offer with token "+t.Token)}catch(t){return discountNinja.Logging.LogError("Badge.Add",t),""}}},discountNinja_Script_Notification={AnimateOnReminderIntervalHandle:-1,DelayIntervalHandle:-1,Template:null,GetTemplate:function(){return null===discountNinja_Script_Notification.Template&&(discountNinja_Script_Notification.Template=discountNinja.Utilities.jQuery()("#limoniapps-discountninja-notification-template").html()),discountNinja_Script_Notification.Template},GetClass:function(){return"limoniapps-notification.active"},GetStyle:function(t){try{return t?t.Notification.Style:""}catch(t){return discountNinja.Logging.LogError("Notification.GetStyle",t),""}},GetText:function(t,i,n){try{return discountNinja.ShortCode.ReplaceAllPlaceHolders(i,discountNinja.TextSettings.GetText(t,i),n)}catch(t){return discountNinja.Logging.LogError("Notification.GetText",t),""}},GetTextForOffer:function(t){var i=discountNinja.DiscountTier.GetCurrentDiscountTier(t),n=discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(i),e=t.Notification;return{Header:discountNinja.TextSettings.WrapInColor(e.HeaderTextColor,discountNinja_Script_Notification.GetText(e.Header,t,n)),Footer:discountNinja.TextSettings.WrapInColor(e.FooterTextColor,discountNinja_Script_Notification.GetText(e.Footer,t,n)),TimerFooter:discountNinja.TextSettings.WrapInColor(e.TimerFooterTextColor,discountNinja.Timer.IsTimerStarted()?discountNinja_Script_Notification.GetText(e.TimerFooter,t,n):""),MinimizedText:discountNinja.TextSettings.WrapInColor(e.MinimizedTextColor,discountNinja_Script_Notification.GetText(e.MinimizedText,t,n))}},GetHtml:function(t,i){function n(t,i){""!==t&&i.push(t)}try{var e=i.Notification,o=discountNinja_Script_Notification.AppSettings(),r=discountNinja_Script_Notification.GetTextForOffer(i),a=discountNinja.Utilities.IsMobilePhone(),c=a&&e.PlacementVerticalMobile?e.PlacementVerticalMobile:e.PlacementVertical,s=[];n(o.MinimizeButton?"limoniapps-minimizable maximized":"",s),n(o.CloseButton?"closeable":"",s),n(o.OfferCounter?"limoniapps-hasoffercount":"",s),n("active",s),a&&n("limoniapps-mobile",s),n(c+"-"+e.PlacementHorizontal,s),n(e.HasImage?"":"limoniapps-noimage",s),n(e.HasImagePerItem?"limoniapps-imageperitem":"",s);var u=s.join(" "),d=discountNinja_Script_Notification.GetTemplate();return d=discountNinja.TemplateParameter.Replace(d,"HEADER",r.Header),d=discountNinja.TemplateParameter.Replace(d,"MINIMIZED",r.MinimizedText),d=discountNinja.TemplateParameter.Replace(d,"BODY",t),d=discountNinja.TemplateParameter.Replace(d,"FOOTER",r.Footer),d=discountNinja.TemplateParameter.Replace(d,"TIMER_FOOTER",r.TimerFooter),d=discountNinja.TemplateParameter.Replace(d,"TOKEN",i.Token),d=discountNinja.TemplateParameter.Replace(d,"FLAGS",u),d=discountNinja.TemplateParameter.Replace(d,"OFFERCOUNT_FLAGS","active")}catch(t){return discountNinja.Logging.LogError("Notification.GetHtml",t),""}},Hiding:!1,Hide:function(t){try{var i=discountNinja.Utilities.jQuery()("."+discountNinja_Script_Notification.GetClass());i&&(discountNinja_Script_Notification.Hiding=!0,discountNinja_Script_Notification.ApplyAnimation(i,discountNinja_Script_Notification.AppSettings().AnimationExit),setTimeout((function(){try{discountNinja_Script_Notification.Hiding&&i.hide()}catch(t){discountNinja.Logging.LogError("Notification.Hide",t)}}),800)),t&&discountNinja_Script_Notification.SetHiddenInSession(!0)}catch(t){discountNinja.Logging.LogError("Notification.Hide",t)}},ToggleMinMaximize:function(){try{discountNinja_Script_Notification.IsMinimized()?discountNinja_Script_Notification.Maximize():discountNinja_Script_Notification.Minimize()}catch(t){discountNinja.Logging.LogError("Notification.ToggleMinMaximize",t)}},Minimize:function(){try{if("minimized"===discountNinja_Script_Notification.IsMinimized())return;discountNinja.Utilities.jQuery()("."+discountNinja_Script_Notification.GetClass()).removeClass("maximized").addClass("minimized"),discountNinja.Utilities.jQuery()(".limoniapps-offercount-minimized.active").removeClass("maximized").addClass("minimized"),discountNinja.Events.Publish("notification:minimized")}catch(t){discountNinja.Logging.LogError("Notification.Minimize",t)}},AppSettings:function(){try{return null===discountNinja.Settings.Settings?null:discountNinja.Settings.Settings.Notification}catch(t){discountNinja.Logging.LogError("Notification.AppSettings",t)}},DefaultOffer:function(){try{if(null===discountNinja.Offer.Offers||0===discountNinja.Offer.Offers.length)return null;if(discountNinja.Offer.PrimaryOffer&&discountNinja.Offer.PrimaryOffer.Notification&&discountNinja.Offer.PrimaryOffer.Notification.PlacementVertical)return discountNinja.Offer.PrimaryOffer;for(var t=0;t<discountNinja.Offer.Offers.length;t++){var i=discountNinja.Offer.Offers[t];if(discountNinja.Offer.IsOfferAccepted(i.Token,i.Frequency)&&i.Notification&&i.Notification.PlacementVertical)return i}return null}catch(t){discountNinja.Logging.LogError("Notification.DefaultOffer",t)}},Maximize:function(){try{if(!discountNinja_Script_Notification.IsMinimized())return;var t=discountNinja.Utilities.jQuery()("."+discountNinja_Script_Notification.GetClass());t&&(discountNinja_Script_Notification.ActAfterDelay(),t.css("transition","unset"),t.removeClass("minimized").addClass("maximized"),discountNinja.Utilities.jQuery()(".limoniapps-offercount-minimized.active").removeClass("minimized").addClass("maximized"),t.css("transition","all 0.5s ease -in -out 0s"),discountNinja.Events.Publish("notification:maximized"))}catch(t){discountNinja.Logging.LogError("Notification.Maximize",t)}},Clear:function(){discountNinja.Cache.SessionRemove("notificationinfo-data")},Remove:function(t){try{for(var i=discountNinja_Script_Notification.GetFromCache(),n=[],e=0;e<i.length;e++)i[e].Token!==t&&n.push(i[e]);0===n.length&&discountNinja_Script_Notification.Hide(),discountNinja_Script_Notification.SaveToCache(n),discountNinja_Script_Notification.UpdateOfferCounter(n.length)}catch(t){discountNinja.Logging.LogError("Notification.Remove",t)}},GetOfferCounterElement:function(){try{return discountNinja.Utilities.jQuery()("."+discountNinja_Script_Notification.GetClass()+" .limoniapps-offercount,.limoniapps-offercount-minimized.active")}catch(t){discountNinja.Logging.LogError("Notification.UpdateOfferCounter",t)}},UpdateOfferCounter:function(t){try{discountNinja_Script_Notification.GetOfferCounterElement().text(t.length)}catch(t){discountNinja.Logging.LogError("Notification.UpdateOfferCounter",t)}},GetFromCache:function(){try{var t=discountNinja.Cache.SessionGet("notificationinfo-data");return null===(t="undefined"===t?[]:JSON.parse(t))?[]:t}catch(t){return discountNinja.Logging.LogError("Notification.GetFromCache",t),[]}},SaveToCache:function(t){try{discountNinja.Cache.SessionSet("notificationinfo-data",JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("Notification.SaveToCache",t)}},Add:function(t){try{t||discountNinja.Logging.LogErrorMessage("Notification.Add","Expected token");for(var i=discountNinja_Script_Notification.GetFromCache(),n=0;n<i.length;n++)if(i[n]&&i[n].Token===t)return;i.push({Token:t,Animated:!1}),discountNinja_Script_Notification.SaveToCache(i),discountNinja_Script_Notification.UpdateOfferCounter(i)}catch(t){discountNinja.Logging.LogError("Notification.Add",t)}},ClearAnimation:function(t){try{var i=discountNinja_Script_Notification.AppSettings();t.removeClass(i.AnimationEnter),t.removeClass(i.AnimationEnterMobile),t.removeClass(i.AnimationOnReminder),t.removeClass(i.AnimationExit),t.removeClass("animated shake flash bounce rotateIn")}catch(t){discountNinja.Logging.LogError("Notification.ClearAnimation",t)}},ApplyAnimation:function(t,i,n){try{discountNinja_Script_Notification.ClearAnimation(t),t.addClass(i),n&&t.css("animation-iteration-count",n)}catch(t){discountNinja.Logging.LogError("Notification.ApplyAnimation",t)}},ActAfterDelay:function(){try{var t=discountNinja_Script_Notification.AppSettings();t.Delay&&t.Delay>0&&(clearInterval(discountNinja_Script_Notification.DelayIntervalHandle),discountNinja_Script_Notification.DelayIntervalHandle=setTimeout((function(){try{discountNinja_Script_Notification.GetUserToggledMinMaximize()||("hide"===t.HideMode?discountNinja_Script_Notification.Hide(!0):"minimize"===t.HideMode&&discountNinja_Script_Notification.Minimize())}catch(t){discountNinja.Logging.LogError("Notification.ActAfterDelay",t)}}),t.Delay))}catch(t){discountNinja.Logging.LogError("Notification.ActAfterDelay",t)}},HighlightNewOffers:function(t){try{setTimeout((function(){try{!function(t){try{if(!discountNinja_Script_Notification.AppSettings().AnimationOnReminder)return;setTimeout((function(){try{for(var i=0;i<t.length;i++){var n=discountNinja.Utilities.jQuery()("."+discountNinja_Script_Notification.GetClass()+' span[data-offer-token="'+t[i]+'"]');discountNinja_Script_Notification.ApplyAnimation(n,"animated shake",1)}}catch(t){discountNinja.Logging.LogError("Notification.AnimateNewPromotionNotifications",t)}}),500),setTimeout((function(){try{for(var i=0;i<t.length;i++){var n=discountNinja.Utilities.jQuery()("."+discountNinja_Script_Notification.GetClass()+' span[data-offer-token="'+t[i]+'"]');discountNinja_Script_Notification.ApplyAnimation(n,"animated flash",3)}}catch(t){discountNinja.Logging.LogError("Notification.AnimateNewPromotionNotifications",t)}}),1500)}catch(t){discountNinja.Logging.LogError("Notification.HighlightNewOffers.HighlightNewOffers",t)}}(t),function(t){try{var i=discountNinja_Script_Notification.AppSettings();if(!i)return;i.OfferCounterAnimate&&t.length>0&&(discountNinja_Script_Notification.GetShownInSession()||discountNinja_Script_Notification.Maximize(),setTimeout((function(){try{discountNinja_Script_Notification.ApplyAnimation(discountNinja_Script_Notification.GetOfferCounterElement(),"animated bounce",2)}catch(t){discountNinja.Logging.LogError("Notification.HighlightNewOffers.AnimateCounter",t)}}),500))}catch(t){discountNinja.Logging.LogError("Notification.HighlightNewOffers.AnimateCounter",t)}}(t)}catch(t){discountNinja.Logging.LogError("Notification.HighlightNewOffers",t)}}),500)}catch(t){discountNinja.Logging.LogError("Notification.HighlightNewOffers",t)}},Show:function(){function t(i,n){discountNinja_Script_Notification.AnimateOnReminderIntervalHandle=setTimeout((function(){try{!function(){var t=discountNinja.Utilities.jQuery()("."+discountNinja_Script_Notification.GetClass());discountNinja_Script_Notification.ApplyAnimation(t,i)}(),t(i,n)}catch(t){discountNinja.Logging.LogError("Notification.AnimateOnReminder",t)}}),n)}function i(i,n,e,o){try{if(null===i||"<ul></ul>"===i)return;if(discountNinja_Script_Notification.GetDismissedInSession())return;if(discountNinja.Utilities.jQuery()("."+discountNinja_Script_Notification.GetClass()).length>0){discountNinja.Utilities.jQuery()(".limoniapps-notification .limoniapps-message-body .text-wrapper").html(n);var r=discountNinja.Utilities.jQuery()("."+discountNinja_Script_Notification.GetClass());discountNinja.Utilities.jQuery()(r).find("[data-offer-token]").each((function(){var t=discountNinja.Utilities.jQuery()(this).attr("data-offer-token"),i=discountNinja.Offer.GetOfferByToken(t),n=discountNinja.DiscountTier.GetCurrentDiscountTier(i),e=discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(n);discountNinja.ShortCode.RefreshResolvedPlaceholders(this,i,e)})),r.attr("data-token",o.Token);var a=discountNinja_Script_Notification.GetTextForOffer(o);r.find(".limoniapps-title.maximized .text-wrapper").html(a.Header),r.find(".limoniapps-title.minimized .text-wrapper").html(a.MinimizedText),r.find(".limoniapps-message-footer").html(a.Footer),r.find(".limoniapps-message-timerfooter").html(a.TimerFooter),discountNinja_Script_Notification.ClearAnimation(r),discountNinja_Script_Notification.Hiding=!1,discountNinja.Utilities.jQuery()(r).show(),discountNinja_Script_Notification.IsMinimized()||discountNinja_Script_Notification.Maximize(),discountNinja_Script_Notification.HighlightNewOffers(e)}else!function(i,n,e){try{if(!e)return;var o=discountNinja_Script_Notification.AppSettings(),r=e.Notification,a=discountNinja_Script_Notification.GetShownInSession(),c=i.trim().replace(/'/g,"&#39;"),s=discountNinja.Utilities.jQuery()(c),u=s.filter(".limoniapps-offercount-minimized.active"),d=s.filter("."+discountNinja_Script_Notification.GetClass()),l=discountNinja.Utilities.IsMobilePhone(),g=l&&o.AnimationEnterMobile?o.AnimationEnterMobile:o.AnimationEnter,p=a||!g?null:g;p&&d.addClass(p);var f=((l&&r.PlacementVerticalMobile?r.PlacementVerticalMobile:r.PlacementVertical)||"bottom")+"-"+(r.PlacementHorizontal||"left");d.attr("data-notify-position",f),u.attr("data-notify-position",f),e&&d.attr("data-token",e.Token);var N=discountNinja.Utilities.jQuery()("body");N.prepend(u),N.prepend(d);var j=discountNinja.Utilities.jQuery()("."+discountNinja_Script_Notification.GetClass()+",.limoniapps-offercount-minimized.active");discountNinja.Utilities.jQuery()(j).click((function(){discountNinja_Script_Notification.SetUserToggledMinMaximize(!0),discountNinja_Script_Notification.ToggleMinMaximize()})),discountNinja.Utilities.jQuery()(j).find(".limoniapps-close").click((function(){discountNinja_Script_Notification.SetUserToggledMinMaximize(!0),discountNinja.Utilities.jQuery()(j).hide(),discountNinja.Events.Publish("notification:closed")}));var m=discountNinja.Utilities.jQuery()(j).html();if(m){var h='"',C=new RegExp("'\"","g"),S=new RegExp("\"'","g"),y=m.replace(C,h).replace(S,h);y!==m&&discountNinja.Utilities.jQuery()(j).html(y)}a&&o.MinimizeAfterFirstView&&discountNinja_Script_Notification.Minimize(),discountNinja_Script_Notification.ActAfterDelay(),discountNinja.Settings.Settings.General.ShowPoweredBy?discountNinja.Utilities.jQuery()(".limoniapps-poweredby").removeClass("limoniapps-poweredby-hidden"):discountNinja.Utilities.jQuery()(".limoniapps-poweredby").addClass("limoniapps-poweredby-hidden"),discountNinja_Script_Notification.SetShownInSession(!0),o.AnimationOnReminder&&(clearInterval(discountNinja_Script_Notification.AnimateOnReminderIntervalHandle),t(o.AnimationOnReminder,o.ReminderDuration)),discountNinja.Utilities.jQuery()(j).find("svg").show(),discountNinja_Script_Notification.HighlightNewOffers(n)}catch(t){return discountNinja.Logging.LogError("Notification.ShowInternalAfterEnsuringDependencies",t),!1}}(i,e,o)}catch(t){return discountNinja.Logging.LogError("Notification.ShowInternal",t),!1}}try{if(discountNinja_Script_Notification.GetHiddenInSession())return;var n=discountNinja_Script_Notification.GetFromCache();if(!n||0===n.length)return;for(var e=null,o=n.length>1?"<ul>":"",r=[],a=[],c=null,s=0;s<n.length;s++){e=n[s];var u=discountNinja.Offer.GetOfferByToken(e.Token);if(u){var d=discountNinja.DiscountTier.GetCurrentDiscountTier(u),l=!!d&&d.IsMaxTier,g=discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(d),p='data-offer-token="'+e.Token+'"',f='style="order:'+(u.Notification.Order||1)+'"',N=discountNinja_Script_Notification.GetText(u.Notification.Body,u,g);if(discountNinja.TextSettings.IsEmpty(N))continue;for(var j=!1,m=0;m<a.length;m++)if(a[m]===N){j=!0;break}if(j)continue;a.push(o),o=n.length>1?o+"<li "+p+" "+f+">"+N+"</li>":o+'<span style="display:block;" '+p+">"+N+"</span>",null===c&&(c=u),!1===e.Animated&&l&&r.push(e.Token)}}if(n.length>1&&(o+="</ul>"),a.length<1)return void discountNinja_Script_Notification.Hide(!1);setTimeout((function(){i(discountNinja_Script_Notification.GetHtml(o,c),o,r,c),function(t){try{for(var i=discountNinja_Script_Notification.GetFromCache(),n=0;n<i.length;n++){var e=i[n];e.Animated=!1;for(var o=0;o<t.length;o++)if(e.Token===t[o]){e.Animated=!0;break}}discountNinja_Script_Notification.SaveToCache(i)}catch(t){discountNinja.Logging.LogError("Notification.MarkNotificationsAsAnimated",t)}}(r),discountNinja_Script_Notification.UpdateOfferCounter(a)}),500)}catch(t){discountNinja.Logging.LogError("Notification.Show",t)}},GetUserToggledMinMaximize:function(){var t=discountNinja.Cache.SessionGet("notification-usertoggled");return"true"===t||!0===t},SetUserToggledMinMaximize:function(t){discountNinja.Cache.SessionSet("notification-usertoggled",t)},IsMinimized:function(){return discountNinja.Utilities.jQuery()(".limoniapps-notification.active").hasClass("minimized")},GetShownInSession:function(){var t=discountNinja.Cache.SessionGet("notification-displayed-insession");return"true"===t||!0===t},SetShownInSession:function(t){discountNinja.Cache.SessionSet("notification-displayed-insession",t)},GetDismissedInSession:function(){var t=discountNinja.Cache.SessionGet("notification-dismissed-insession");return"true"===t||!0===t},SetDismissedInSession:function(t){discountNinja.Cache.SessionSet("notification-dismissed",t)},GetHiddenInSession:function(){var t=discountNinja.Cache.SessionGet("notification-hidden-insession");return"true"===t||!0===t},SetHiddenInSession:function(t){discountNinja.Cache.SessionSet("notification-hidden-insession",t)}},discountNinja_Script_PopUp={GetElement:function(t){return discountNinja.Utilities.jQuery()(".limoniapps-popup[data-token='"+t+"']")},Hide:function(t){try{discountNinja_Script_PopUp.GetElement(t).hide()}catch(t){discountNinja.Logging.LogError("PopUp.Hide",t)}},InjectHtml:function(t,i){try{if(discountNinja_Script_PopUp.GetElement(t.Token).length>0)return void discountNinja.ShortCode.RefreshResolvedPlaceholders(discountNinja_Script_PopUp.GetElement(t.Token),t,i);var n=discountNinja.Utilities.IsMobilePhone()?t.PopUp.MobileSize:t.PopUp.Size,e=discountNinja.Utilities.jQuery()("#limoniapps-discountninja-popup-template").html();e=discountNinja.TemplateParameter.Replace(e,"HEADER",discountNinja.TextSettings.GetText(t.PopUp.Header,t)),e=discountNinja.TemplateParameter.Replace(e,"BODY",discountNinja.TextSettings.GetText(t.PopUp.Body,t)),e=discountNinja.TemplateParameter.Replace(e,"FOOTER",discountNinja.TextSettings.GetText(t.PopUp.Footer,t)),e=discountNinja.TemplateParameter.Replace(e,"NOTHANKSBUTTONLABEL",t.PopUp.NoThanksButtonLabel),e=discountNinja.TemplateParameter.Replace(e,"SIZE",n),e=discountNinja.TemplateParameter.Replace(e,"ACTIONBUTTON1LABEL",t.PopUp.ActionButton1Label),e=discountNinja.TemplateParameter.Replace(e,"ACTIONBUTTON1STYLE",t.PopUp.ActionButton1Style),e=discountNinja.TemplateParameter.Replace(e,"ACTIONBUTTON1SIZE",t.PopUp.ActionButton1Size),e=discountNinja.TemplateParameter.Replace(e,"ACTIONBUTTON2LABEL",t.PopUp.ActionButton2Label),e=discountNinja.TemplateParameter.Replace(e,"ACTIONBUTTON2STYLE",t.PopUp.ActionButton2Style),e=discountNinja.TemplateParameter.Replace(e,"ACTIONBUTTON2SIZE",t.PopUp.ActionButton2Size),e=discountNinja.TemplateParameter.Replace(e,"BUTTONPLACEMENT","fullscreen"===n?"inside":t.PopUp.ButtonPlacement),e=discountNinja.TemplateParameter.Replace(e,"BACKGROUNDOVERLAY",t.PopUp.BackgroundOverlay),e=discountNinja.TemplateParameter.Replace(e,"SHAPE",t.PopUp.Shape),e=discountNinja.TemplateParameter.Replace(e,"CONTENTALIGNMENTHORIZONTAL",t.PopUp.ContentAlignmentHorizontal),e=discountNinja.TemplateParameter.Replace(e,"CONTENTALIGNMENTVERTICAL",t.PopUp.ContentAlignmentVertical),e=discountNinja.TemplateParameter.Replace(e,"BACKGROUNDTOPCOLORHEIGHT",t.PopUp.ContentAlignmentVertical),e=discountNinja.TemplateParameter.Replace(e,"BACKGROUNDTOPCOLORRADIUS",t.PopUp.BackgroundColorTopHeight),e=discountNinja.TemplateParameter.Replace(e,"BACKGROUNDTOPCOLORRADIUS",t.PopUp.BackgroundColorTopRadius),e=discountNinja.TemplateParameter.Replace(e,"TOKEN",t.Token);var o=function(t){var i=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)i.appendChild(n.firstChild);return i}(e=discountNinja.ShortCode.ReplaceAllPlaceHolders(t,e,i));document.body.insertBefore(o,document.body.childNodes[0])}catch(t){discountNinja.Logging.LogError("PopUp.InjectPopUpHtml",t)}},Show:function(t,i){function n(t,i){try{discountNinja.Offer.SetPromotionAccepted(t.Token,t.Frequency,"false"),discountNinja_Script_PopUp.Hide(t.Token),discountNinja.Offer.Stop()}catch(t){discountNinja.Logging.LogError("PopUp.Cancel",t)}}function e(t,i){discountNinja.Cache.LocalSet("popup-displayed-"+t,i)}try{discountNinja_Script_PopUp.InjectHtml(t,i);var o=t.Token;discountNinja.Logging.LogVerbose("Showing pop-up"),discountNinja.DiscountCode.Remove(o),discountNinja.Offer.RemoveFromCache(t);var r=discountNinja_Script_PopUp.GetElement(o);r.find('.limoniapps-close[data-notify="dismiss"]').click((function(){n(t)})),r.find(".limoniapps-lnk-dismiss").click((function(){n(t)})),r.find('.limoniapps-action-btn[data-action="apply"]').click((function(){!function(t,i){try{discountNinja_Script_PopUp.Hide(t.Token),discountNinja.PromotionFlow.AcceptPromotion(t,i),discountNinja.PromotionFlow.StopFlow()}catch(t){discountNinja.Logging.LogError("PopUp.Accept",t)}}(t,i)})),discountNinja.Settings.Settings.General.ShowPoweredBy?discountNinja.Utilities.jQuery()(".limoniapps-poweredby").removeClass("limoniapps-poweredby-hidden"):discountNinja.Utilities.jQuery()(".limoniapps-poweredby").addClass("limoniapps-poweredby-hidden"),a=r.find(".limoniapps-content"),c=t.PopUp.Animation,s=t.PopUp,discountNinja.Utilities.jQuery()(a).removeClass(s.Animation),discountNinja.Utilities.jQuery()(a).addClass(c),r.show(),function(t){"onceperdevice"===t.PopUp.Frequency?e(t.Token,"shown"):(e(t.Token,""),function(t,i){discountNinja.Cache.SessionSet("popup-displayed-"+t,i)}(t.Token,"shown"))}(t),discountNinja_Script_PopUp.PopUpDisplayed=!0}catch(t){discountNinja.Logging.LogError("PopUp.Show",t)}var a,c,s}},discountNinja_Script_StickyBar={AnimateOnReminderIntervalHandle:-1,CycleIntervalHandle:-1,CurrentLevelForPromotion:[],WrapperId:"limoniapps-discountninja-stickybar-wrapper",PusherId:"limoniapps-discountninja-stickybar-pusher",TopMarginClass:"limoniapps-discountninja-stickybar-topmargin",Template:null,GetTemplate:function(){return null===discountNinja_Script_StickyBar.Template&&(discountNinja_Script_StickyBar.Template=discountNinja.Utilities.jQuery()("#limoniapps-discountninja-stickybar-template").html()),discountNinja_Script_StickyBar.Template},GetPusherElement:function(){return discountNinja.Utilities.jQuery()("#"+discountNinja_Script_StickyBar.PusherId)},GetWrapperElement:function(){return discountNinja.Utilities.jQuery()("#"+discountNinja_Script_StickyBar.WrapperId)},AppSettings:function(){try{return null===discountNinja.Settings.Settings?null:discountNinja.Settings.Settings.StickyBar}catch(t){return discountNinja.Logging.LogError("StickyBar.AppSettings",t),null}},ActiveStickyBar:function(){try{var t=discountNinja_Script_StickyBar.GetFromCache();discountNinja_Script_StickyBar.CurrentMessageIndex>=t.length&&(discountNinja_Script_StickyBar.CurrentMessageIndex=0);var i=discountNinja_Script_StickyBar.CurrentMessageIndex||0,n=t[i];return n||(discountNinja.Logging.LogErrorMessage("StickyBar.ActiveStickyBar","Sticky bar "+i+" not found"),null)}catch(t){return discountNinja.Logging.LogError("StickyBar.ActiveStickyBar",t),null}},DefaultOffer:function(){try{if(null===discountNinja.Offer.Offers||0===discountNinja.Offer.Offers.length)return null;if(discountNinja.Offer.PrimaryOffer&&discountNinja.Offer.PrimaryOffer.StickyBar&&discountNinja.Offer.PrimaryOffer.StickyBar.PlacementVertical)return discountNinja.Offer.PrimaryOffer;for(var t=0;t<discountNinja.Offer.Offers.length;t++){var i=discountNinja.Offer.Offers[t];if(i.StickyBar&&i.StickyBar.PlacementVertical&&(discountNinja.Offer.IsOfferAccepted(i.Token,i.Frequency)||i.StickyBar.ActionButton1&&"applydiscount"===i.StickyBar.ActionButton1.Action||i.StickyBar.ActionButton2&&"applydiscount"===i.StickyBar.ActionButton2.Action))return i}return null}catch(t){discountNinja.Logging.LogError("StickyBar.DefaultOffer",t)}},ShouldRequestNotification:function(){try{return!!pushowl&&!pushowl.browserHandler.isPermissionGranted}catch(t){return discountNinja.Logging.LogError("StickyBar.ShouldRequestNotification",t),!1}},RequestNotification:function(){try{if(!pushowl)return!1;pushowl.subscribeIfNotAlready()}catch(t){discountNinja.Logging.LogError("StickyBar.RequestNotification",t)}},SlideBodyDownLastExecuted:null,SlideBodyDown:function(){function t(t,i){try{var n=[],e=discountNinjaContext.Flags[t];if(e&&""!==e&&n.push(e),discountNinja.Settings&&discountNinja.Settings.Settings){var o=discountNinja.Settings.Settings.PriceUpdate.Mode[i];o&&""!==o&&n.push(o)}return n}catch(t){return discountNinja.Logging.LogError("StickyBar.TopMarginElementsInner",t),[]}}function i(i){try{var n=discountNinja_Script_StickyBar.TopMarginClass;document.body.classList.add(n);for(var e=function(){try{var i=[];return(i=(i=i.concat(t("StickyBarShouldPushSelectors","StickyBarShouldPushSelectors"))).concat(t("StickyBarShouldPushSelectorsMobile","StickyBarShouldPushSelectorsMobile"))).concat(t("StickyBarShouldPushSelectorsDesktop","StickyBarShouldPushSelectorsDesktop"))}catch(t){return discountNinja.Logging.LogError("StickyBar.TopMarginElements",t),[]}}(),o="{ margin-top: "+i.toString()+"px !important;background-position: 0% "+i.toString()+"px !important; }",r="limoniapps-discountninja-topmargin",a="."+n+":not(."+n+"-ignore),."+n+":not(."+r+"-ignore),."+r+":not(."+r+"-ignore), .limoniapps-discountninja-header, .limoniapps-discounturl-header"+o,c=".limoniapps-discountninja-stickybar-topmargin [[SELECTOR]] "+o,s=0;s<e.length;s++)for(var u=e[s].split(","),d=0;d<u.length;d++)a+=c.replace("[[SELECTOR]]",u[d]);discountNinja.Utilities.AddInlineCssToDocument(a,"limoniapps-stickybar-topmargin")}catch(t){discountNinja.Logging.LogError("StickyBar.AddTopMarginToElements",t)}}try{if(r=discountNinja_Script_StickyBar.SlideBodyDownLastExecuted,a=!0,null!==r&&new Date-r<50&&(a=!1),discountNinja_Script_StickyBar.SlideBodyDownLastExecuted=new Date,!a)return;if(discountNinja_Script_StickyBar.GetHiddenInSession())return;var n=discountNinja_Script_StickyBar.DefaultOffer(),e=n?n.StickyBar:null;if(null===e)return;if("top_page_sticky"===e.PlacementVertical||"top_page"===e.PlacementVertical){var o=discountNinja.Settings.GetFlag("StickyBarRenderingDelay")||0;o<50&&(o=50),setTimeout((function(){var t=discountNinja_Script_StickyBar.GetWrapperElement().outerHeight()||50;discountNinja_Script_StickyBar.GetPusherElement().height(t),i(t)}),o)}}catch(t){discountNinja.Logging.LogError("StickyBar.SlideBodyDown",t)}var r,a},RemoveTopMarginFromElements:function(){document.body.classList.remove(discountNinja_Script_StickyBar.TopMarginClass)},OnAction:function(t,i,n){try{var e=1===t?i.StickyBar.ActionButton1:i.StickyBar.ActionButton2;discountNinja.ActionButton.HandleAction(e,i,n)}catch(t){discountNinja.Logging.LogError("StickyBar.OnAction",t)}},Hide:function(t){function i(t){try{discountNinja_Script_StickyBar.GetWrapperElement().hide();var i=discountNinja_Script_StickyBar.DefaultOffer(),n=i?i.StickyBar:null;!n||"top_page_sticky"!==n.PlacementVertical&&"top_page"!==n.PlacementVertical||discountNinja_Script_StickyBar.RemoveTopMarginFromElements(),t&&discountNinja_Script_StickyBar.SetHiddenInSession(!0),discountNinja.Events.Publish("stickybar:closed")}catch(t){discountNinja.Logging.LogError("StickyBar.HideInner",t)}}try{var n=discountNinja_Script_StickyBar.AppSettings();n.AnimationExit?(discountNinja_Script_StickyBar.ApplyAnimation(discountNinja_Script_StickyBar.GetWrapperElement(),n.AnimationExit),i(t)):i(t)}catch(t){discountNinja.Logging.LogError("StickyBar.Hide",t)}},Remove:function(t){try{discountNinja.Logging.LogInformation("StickyBar.Remove for token "+t);for(var i=discountNinja_Script_StickyBar.GetFromCache(),n=[],e=0;e<i.length;e++)i[e].Token!==t&&n.push(i[e]);discountNinja_Script_StickyBar.MessageCount=n.length,discountNinja_Script_StickyBar.SaveToCache(n),setTimeout((function(){try{discountNinja_Script_StickyBar.Show()}catch(t){discountNinja.Logging.LogError("StickyBar.Remove",t)}}),500)}catch(t){discountNinja.Logging.LogError("StickyBar.Remove",t)}},Clear:function(){discountNinja.Logging.LogInformation("StickyBar.Clear called "),discountNinja_Script_StickyBar.MessageCount=0,discountNinja.Cache.SessionRemove("stickybar-data")},GetFromCache:function(){try{var t=discountNinja.Cache.SessionGet("stickybar-data"),i=null===(t="undefined"===t?[]:JSON.parse(t))?[]:t;return discountNinja_Script_StickyBar.MessageCount=i.length,i}catch(t){return discountNinja.Logging.LogError("StickyBar.GetFromCache",t),[]}},SaveToCache:function(t){try{discountNinja.Cache.SessionSet("stickybar-data",JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("StickyBar.SaveToCache",t)}},Add:function(t,i){try{discountNinja.Logging.LogInformation("StickyBar.Add for token "+t),t||discountNinja.Logging.LogErrorMessage("StickyBar.Add","Expected token");for(var n=discountNinja_Script_StickyBar.GetFromCache(),e=0;e<n.length;e++)if(n[e]&&n[e].Token===t)return;n.push({Token:t,PlacementVertical:i}),discountNinja_Script_StickyBar.MessageCount=n.length,discountNinja_Script_StickyBar.AllCyclesFailed=!1,discountNinja_Script_StickyBar.FirstFailedCycle=null,discountNinja_Script_StickyBar.SaveToCache(n)}catch(t){discountNinja.Logging.LogError("StickyBar.Add",t)}},CurrentMessageIndex:0,MessageCount:0,FirstFailedCycle:null,AllCyclesFailed:!1,CycleMessage:function(t){function i(t,n){try{if(discountNinja_Script_StickyBar.MessageCount<=1||discountNinja_Script_StickyBar.AllCyclesFailed)return;if(discountNinja_Script_StickyBar.CurrentMessageIndex=discountNinja_Script_StickyBar.CurrentMessageIndex+1,n&&discountNinja_Script_StickyBar.CurrentMessageIndex===discountNinja_Script_StickyBar.FirstFailedCycle)return discountNinja_Script_StickyBar.AllCyclesFailed=!0,void discountNinja_Script_StickyBar.Hide(!1);if(!discountNinja_Script_StickyBar.ShowMessage(t))return null===discountNinja_Script_StickyBar.FirstFailedCycle&&(discountNinja_Script_StickyBar.FirstFailedCycle=discountNinja_Script_StickyBar.CurrentMessageIndex),i(t,!0);discountNinja_Script_StickyBar.FirstFailedCycle=null,discountNinja_Script_StickyBar.AllCyclesFailed=!1,t=!0}catch(t){discountNinja.Logging.LogError("StickyBar.CycleMessage.CycleMessageInner",t)}}try{var n=discountNinja_Script_StickyBar.AppSettings(),e=n.Cycle.DurationMilliseconds>0?n.Cycle.DurationMilliseconds:6e3;discountNinja_Script_StickyBar.CycleIntervalHandle>0&&clearInterval(discountNinja_Script_StickyBar.CycleIntervalHandle),i(t),discountNinja_Script_StickyBar.CycleIntervalHandle=setInterval((function(){i(t)}),e)}catch(t){discountNinja.Logging.LogError("StickyBar.CycleMessage",t)}},ClearAnimation:function(t){try{var i=discountNinja_Script_StickyBar.AppSettings();discountNinja.Utilities.jQuery()(t).removeClass(i.AnimationEnter),discountNinja.Utilities.jQuery()(t).removeClass(i.AnimationOnGoal),discountNinja.Utilities.jQuery()(t).removeClass(i.AnimationOnReminder),discountNinja.Utilities.jQuery()(t).removeClass(i.AnimationExit),discountNinja.Utilities.jQuery()(t).removeClass(i.Cycle.AnimationOnCyle)}catch(t){discountNinja.Logging.LogError("StickyBar.ClearAnimation",t)}},ApplyAnimation:function(t,i){try{if(!i)return;discountNinja_Script_StickyBar.ClearAnimation(t),discountNinja.Utilities.jQuery()(t).addClass(i)}catch(t){discountNinja.Logging.LogError("StickyBar.ApplyAnimation",t)}},ShowMessage:function(t){function i(t,i){try{return discountNinja.Timer.IsTimerStarted()?discountNinja.TextSettings.WrapInColor(t.StickyBar.TimerFooterTextColor,discountNinja.ShortCode.ReplaceAllPlaceHolders(t,discountNinja.TextSettings.GetText(t.StickyBar.TimerFooter,t),i)):""}catch(t){return discountNinja.Logging.LogError("StickyBar.GetTimerFooterMessage",t),""}}function n(t){if(t.StickyBar.AnimationOnGoal){var i=discountNinja.DiscountTier.GetCurrentDiscountTier(t),n=discountNinja_Script_StickyBar.CurrentLevelForPromotion[t.Token];(void 0!==n?n<i:i>0)&&(discountNinja_Script_StickyBar.CurrentLevelForPromotion[t.Token]=i,e=discountNinja_Script_StickyBar.AppSettings.AnimationOnGoal,o=discountNinja.Utilities.jQuery()(".limoniapps-sticky-bar .limoniapps-content"),discountNinja_Script_StickyBar.ApplyAnimation(o,e))}var e,o}function e(t,n){var e=discountNinja_Script_StickyBar.GetWrapperElement(),o=discountNinja.Utilities.jQuery()(e).find(".limoniapps-message.limoniapps-message-body"),r=discountNinja.Utilities.jQuery()(e).find(".limoniapps-message.limoniapps-message-timerfooter"),a=function(t,i){try{return discountNinja.TextSettings.WrapInColor(t.StickyBar.BodyTextColor,discountNinja.ShortCode.ReplaceAllPlaceHolders(t,discountNinja.TextSettings.GetText(t.StickyBar.Body,t),i))}catch(t){return discountNinja.Logging.LogError("StickyBar.GetBodyMessage",t),""}}(t,n),c=i(t,n);return(!discountNinja.TextSettings.IsEmpty(a)||!discountNinja.TextSettings.IsEmpty(c))&&(discountNinja.Utilities.jQuery()(o).html(a,n),discountNinja.Utilities.jQuery()(r).html(c),!0)}try{var o=discountNinja_Script_StickyBar.ActiveStickyBar();if(null===o)return;var r=discountNinja.Offer.GetOfferByToken(o.Token);if(!r)return;var a=discountNinja.DiscountTier.GetCurrentDiscountTier(r),c=discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(a),s=r.StickyBar,u=discountNinja_Script_StickyBar.AppSettings(),d=discountNinja_Script_StickyBar.GetWrapperElement(),l=discountNinja.Utilities.jQuery()(d).find(".limoniapps-col-info");discountNinja.Utilities.jQuery()(d).find(".limoniapps-sticky-bar-wrapper").attr("data-token",r.Token),s.ActionButton1&&(discountNinja.ActionButton.HideIfNecessary(s.ActionButton1,r,1),d.find(".limoniapps-action.button1 .limoniapps-action-btn").click((function(){try{discountNinja_Script_StickyBar.OnAction(1,r,c)}catch(t){return discountNinja.Logging.LogError("StickyBar.Show.ActionButton1Click",t),!1}}))),s.ActionButton2&&(discountNinja.ActionButton.HideIfNecessary(s.ActionButton2,r,2),d.find(".limoniapps-action.button2 .limoniapps-action-btn").click((function(){try{discountNinja_Script_StickyBar.OnAction(2,r,c)}catch(t){return discountNinja.Logging.LogError("StickyBar.Show.ActionButton2Click",t),!1}})));var g=u.Cycle.AnimationOnCyle;if(t&&g&&stickybars.length>0){var p=function(t){var i=t.split(" ");return 3===i.length?i[0]+" "+i[2]:i[0]+" "+i[1]}(g),f=function(t){var i=t.split(" ");return i[0]+" "+i[1]}(g);if(f!==p)discountNinja_Script_StickyBar.ApplyAnimation(l,f),setTimeout((function(){try{if(timerFooterMessage=i(r),!e(r,c))return!1;discountNinja.Utilities.jQuery()(l).hide(),setTimeout((function(){try{discountNinja.Utilities.jQuery()(l).show(),discountNinja_Script_StickyBar.ApplyAnimation(l,p)}catch(t){discountNinja.Logging.LogError("StickyBar.Show",t)}}),50),n(r)}catch(t){discountNinja.Logging.LogError("StickyBar.Show",t)}}),500);else{if(!e(r,c))return!1;discountNinja_Script_StickyBar.ApplyAnimation(l,p)}}else if(!e(r,c))return!1;return setTimeout((function(){discountNinja_Script_StickyBar.SlideBodyDown()}),50),n(r),!0}catch(t){return discountNinja.Logging.LogError("StickyBar.ShowMessage",t),!1}},Show:function(){try{if(discountNinja_Script_StickyBar.GetHiddenInSession())return;if(discountNinja_Script_StickyBar.MessageCount<=0)return void discountNinja_Script_StickyBar.Hide();var t=discountNinja_Script_StickyBar.ActiveStickyBar(),i=null===t?discountNinja_Script_StickyBar.DefaultOffer():discountNinja.Offer.GetOfferByToken(t.Token);if(!i)return;var n=i.StickyBar,e=discountNinja_Script_StickyBar.AppSettings(),o=discountNinja_Script_StickyBar.GetWrapperElement(),r=discountNinja.Utilities.jQuery()(o).is(":visible"),a="true"===discountNinja.Cache.SessionGet("stickybar-displayed-insession");if(!r){var c="limoniapps-stick-to-"+n.PlacementVertical;f=!0,discountNinja.Cache.SessionSet("stickybar-displayed-insession",f);var s=function(t){function i(t,i){""!==t&&i.push(t)}try{var n=t.StickyBar,e=discountNinja_Script_StickyBar.GetTemplate(),o=discountNinja.DiscountTier.GetCurrentDiscountTier(t),r=discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(o),a=discountNinja_Script_Notification.GetText(n.Body,t,r),c=discountNinja.TextSettings.WrapInColor(n.BodyTextColor,a),s=discountNinja.TextSettings.WrapInColor(n.TimerFooterTextColor,discountNinja.Timer.IsTimerStarted()?discountNinja_Script_Notification.GetText(n.TimerFooter,t,r):""),u=[];i(n.CloseButton?"closeable":"",u),i(n.ActionButton1?"hasaction1":"",u),i(n.ActionButton2?"hasaction2":"",u),i(n.HasImage?"hasimage":"",u);var d=u.join(" ");return e=discountNinja.TemplateParameter.Replace(e,"BODY",c),e=discountNinja.TemplateParameter.Replace(e,"TIMERFOOTER",s),e=discountNinja.TemplateParameter.Replace(e,"TIMER_FOOTER",s),e=discountNinja.TemplateParameter.Replace(e,"HEIGHT",discountNinja.Utilities.IsMobilePhone()?n.MobileHeight:n.Height),e=discountNinja.TemplateParameter.Replace(e,"FLAGS",d),e=discountNinja.TemplateParameter.Replace(e,"TOKEN",t.Token),e=discountNinja.TemplateParameter.Replace(e,"WIDTH",n.Width?n.Width:""),e=discountNinja.ActionButton.ReplacePlaceHoldersForButton(e,t,r,1,n.ActionButton1),e=discountNinja.ActionButton.ReplacePlaceHoldersForButton(e,t,r,2,n.ActionButton2)}catch(t){return discountNinja.Logging.LogError("StickyBar.GetHtml",t),null}}(i);if(null===s)return;var u=(0===discountNinja_Script_StickyBar.GetPusherElement().length?'<div id="limoniapps-discountninja-stickybar-pusher" class="limoniapps-sticky-bar-pusher"></div>':"")+'<div id="'+discountNinja_Script_StickyBar.WrapperId+'" class="'+c+'" style="display:none;">'+s+"</div>";if("top_header"===n.PlacementVertical){var d=discountNinja.Utilities.jQuery()(".limoniapps-discountninja-headersection");0===d.length&&(d=discountNinja.Utilities.jQuery()("#shopify-section-header")),d.append(u)}else discountNinja.Utilities.jQuery()("body").prepend(u);o=discountNinja_Script_StickyBar.GetWrapperElement(),n.CloseButton&&o.find('.limoniapps-close[data-notify="dismiss"]').click((function(){try{discountNinja_Script_StickyBar.Hide(!0)}catch(t){return discountNinja.Logging.LogError("StickyBar.Show.Dismiss",t),!1}})),i.StickyBar&&discountNinja.Utilities.jQuery()(o).css("background-color",i.StickyBar.BackgroundColor);var l=e.Delay;l&&l>0&&setTimeout((function(){discountNinja_Script_StickyBar.Hide(!0)}),l),discountNinja.Settings.Settings.General.ShowPoweredBy?discountNinja.Utilities.jQuery()(".limoniapps-poweredby").removeClass("limoniapps-poweredby-hidden"):discountNinja.Utilities.jQuery()(".limoniapps-poweredby").addClass("limoniapps-poweredby-hidden")}if(discountNinja_Script_StickyBar.CurrentMessageIndex=0,"cycle"===e.Cycle.Mode&&discountNinja_Script_StickyBar.MessageCount>1)clearInterval(discountNinja_Script_StickyBar.CycleIntervalHandle),discountNinja_Script_StickyBar.CycleMessage(!1);else if(!discountNinja_Script_StickyBar.ShowMessage(!1))return void discountNinja_Script_StickyBar.Hide(!1);setTimeout((function(){discountNinja_Script_StickyBar.AllCyclesFailed||discountNinja_Script_StickyBar.SlideBodyDown()}),50),e.AnimationOnReminder&&(clearInterval(discountNinja_Script_StickyBar.AnimateOnReminderIntervalHandle),function t(i,n){setTimeout((function(){try{discountNinja_Script_StickyBar.ApplyAnimation(discountNinja.Utilities.jQuery()(".limoniapps-sticky-bar .limoniapps-col-info"),i),t(i,n)}catch(t){discountNinja.Logging.LogError("StickyBar.AnimateOnReminder",t)}}),n)}(e.AnimationOnReminder,e.ReminderDuration)),discountNinja.Utilities.jQuery()(window).on("resize",(function(){discountNinja_Script_StickyBar.SlideBodyDown()}));var g=discountNinja.Utilities.IsMobilePhone()&&e.AnimationEnterMobile?e.AnimationEnterMobile:e.AnimationEnter,p=r||a||!g?"":g;""!==p&&discountNinja_Script_StickyBar.ApplyAnimation("#"+discountNinja_Script_StickyBar.WrapperId,p),o.show()}catch(t){return discountNinja.Logging.LogError("StickyBar.Show",t),!1}var f},GetHiddenInSession:function(){var t=discountNinja.Cache.SessionGet("stickybar-hidden-insession");return"true"===t||!0===t},SetHiddenInSession:function(t){discountNinja.Cache.SessionSet("stickybar-hidden-insession",t)}},discountNinja_Script_Timer={TimeZone:null,TimerIntervalId:null,Start:function(t){function i(t,i){try{return discountNinja_Script_Timer.TimerLabels[t][i]}catch(t){return discountNinja.Logging.LogError("Timer.GetTimeLabel",t),""}}function n(t,n,e){try{var o=discountNinja.DateTime.GetDuration(n,"seconds"),r=function(t,i){try{return 1===i?t.CountdownClock.FormattingTemplateIn_Style1:2===i?t.CountdownClock.FormattingTemplateIn_Style2:3===i?t.CountdownClock.FormattingTemplateIn_Style3:4===i?t.CountdownClock.FormattingTemplateIn_Style4:5===i?t.CountdownClock.FormattingTemplateIn_Style5:t.CountdownClock.FormattingTemplateIn_Style1}catch(t){return discountNinja.Logging.LogError("Timer.GetFormattingForStyle",t),""}}(t,e);if(null===r)return"";for(var a=r,c="d,h,m,s".split(","),s=0;s<c.length;s++){var u=c[s];if(Math.floor(o.as(u))>0)a=a.replace("{"+u+"}","").replace("{\\"+u+"}","");else{var d="{"+u+"}(.)*{\\\\"+u+"}";a=a.replace(new RegExp(d),"")}}for(s=0;s<c.length;s++){u=c[s];a=a.replace("["+u+"]",o.get(u))}for(s=0;s<5;s++)for(var l=0;l<2;l++)a=a.replace("["+s+","+l+"]",i(s,l));return a}catch(t){return discountNinja.Logging.LogError("Timer.TimeFormattingInternal",t),""}}function e(t){var i=discountNinja.DateTime,n=i.GetUtc(t);return i.DiffInSeconds(i.GetUtc(n),i.UtcNow())}function o(t,i){try{var o=e(i);if(o>0){if("function"!=typeof dayjs||"function"!=typeof dayjs.duration||"object"!=typeof dayjs.duration(10,"seconds"))return discountNinja.Logging.LogVerbose("Timer dependencies not ready, skipping update"),void LimoniAppsLoadDayJs((function(){discountNinja.Logging.LogVerbose("Loading timer dependencies")}));discountNinja.Utilities.jQuery()(".limoniapps-discountninja-timer").each((function(){var i=discountNinja.Utilities.jQuery()(this).attr("data-style"),e=n(t,o,i);e=e.replace(/(\d)/g,'<div class="limoniapps-discountninja-countdownclock-digit-wrapper"><div class="limoniapps-discountninja-countdownclock-digit">$1</div></div>'),discountNinja.Utilities.jQuery()(this).html('<div class="limoniapps-discountninja-countdownclock-container style'+i+'">'+e+"</div>")}))}else!function(){try{discountNinja.Logging.LogVerbose("Expiring timer"),discountNinja_Script_Timer.IsTimerStarted()&&(discountNinja_Script_Timer.SetTimerStarted(!1),null!==discountNinja_Script_Timer.TimerIntervalId&&0!==discountNinja_Script_Timer.TimerIntervalId&&clearInterval(discountNinja_Script_Timer.TimerIntervalId),location.reload())}catch(t){discountNinja.Logging.LogError("Timer.Expire",t)}}()}catch(t){discountNinja.Logging.LogError("Timer.UpdateTimer",t)}}try{var r=t?t.TriggeredByTrigger.CountdownClock.EndsAt:null;if(!r)return;if(e(r)<=0)return;var a=discountNinja.Settings.Settings;if(!a||!a.CountdownClock)return;!function(t){function i(t){try{return t&&""!==t?[t,t,t]:null}catch(t){return discountNinja.Logging.LogError("Timer.ProcessCustomTimeLabels",t),null}}try{var n=i(t.CustomDaysLabel)||["days","days","d"],e=i(t.CustomHoursLabel)||["hours","hrs","h"],o=i(t.CustomMinutesLabel)||["minutes","min","m"],r=i(t.CustomSecondsLabel)||["seconds","sec","s"],a=i(t.CustomAndLabel)||["and","&","&"];discountNinja_Script_Timer.TimerLabels=[n,e,o,r,a]}catch(t){discountNinja.Logging.LogError("Timer.ProcessCountdownClock",t)}}(a.CountdownClock),null!==discountNinja_Script_Timer.TimerIntervalId&&0!==discountNinja_Script_Timer.TimerIntervalId&&clearInterval(discountNinja_Script_Timer.TimerIntervalId),discountNinja_Script_Timer.TimerIntervalId=window.setInterval((function(){o(a,r)}),1e3),o(a,r),discountNinja_Script_Timer.SetTimerStarted(!0)}catch(t){discountNinja.Logging.LogError("Timer.Start",t)}},Stop:function(){discountNinja_Script_Timer.SetTimerStarted(!1)},ShouldStartOn:function(t,i){return!!(t&&t.TriggeredByTrigger&&t.TriggeredByTrigger.CountdownClock)&&t.TriggeredByTrigger.CountdownClock.Trigger===i},ShouldStartOnDisplay:function(t){return discountNinja_Script_Timer.ShouldStartOn(t,"displayed")},ShouldStartOnAccept:function(t){return discountNinja_Script_Timer.ShouldStartOn(t,"accepted")},ShouldStartOnGoalAchieved:function(t){return discountNinja_Script_Timer.ShouldStartOn(t,"goalachieved")},ShouldNotStart:function(t){return!!(t&&t.TriggeredByTrigger&&t.TriggeredByTrigger.CountdownClock)&&!t.TriggeredByTrigger.CountdownClock.Trigger},IsTimerStarted:function(){return"true"===discountNinja.Cache.SessionGet("timer-started")},SetTimerStarted:function(t){discountNinja.Cache.SessionSet("timer-started",t)}},discountNinja_Script_Cache={_SupportsCacheLocal:null,_SupportsCacheSession:null,Fallback:{},SupportsCacheLocal:function(){try{return null===discountNinja_Script_Cache._SupportsCacheLocal&&(localStorage.setItem("testSupportsCacheLocal","testSupportsCacheLocal"),localStorage.removeItem("testSupportsCacheLocal"),discountNinja_Script_Cache._SupportsCacheLocal=!0),discountNinja_Script_Cache._SupportsCacheLocal}catch(t){return discountNinja_Script_Cache._SupportsCacheLocal=!1,!1}},SupportsCacheSession:function(){try{return null===discountNinja_Script_Cache._SupportsCacheSession&&(sessionStorage.setItem("testSupportsCacheSession","testSupportsCacheSession"),sessionStorage.removeItem("testSupportsCacheSession"),discountNinja_Script_Cache._SupportsCacheSession=!0),discountNinja_Script_Cache._SupportsCacheSession}catch(t){return discountNinja_Script_Cache._SupportsCacheSession=!1,!1}},LocalRemove:function(t){try{discountNinja_Script_Cache.SupportsCacheLocal()?localStorage.removeItem("limoniapps-discountninja-"+t):discountNinja_Script_Cache.SessionRemove(t)}catch(i){discountNinja.Logging.LogError("Cache.LocalRemove",i),discountNinja_Script_Cache.SessionRemove(t)}},LocalGet:function(t){try{return discountNinja_Script_Cache.SupportsCacheLocal()?localStorage.getItem("limoniapps-discountninja-"+t):discountNinja_Script_Cache.SessionGet(t)}catch(i){return discountNinja.Logging.LogError("Cache.LocalGet",i),discountNinja_Script_Cache.SessionGet(t)}},LocalSet:function(t,i){try{discountNinja_Script_Cache.SupportsCacheLocal()?(discountNinja_Script_Cache.LocalRemove(t),localStorage.setItem("limoniapps-discountninja-"+t,i)):discountNinja_Script_Cache.SessionSet(t,i)}catch(n){discountNinja.Logging.LogError("Cache.LocalSet",n),discountNinja_Script_Cache.SessionSet(t,i)}},SessionRemove:function(t){try{discountNinja_Script_Cache.SupportsCacheSession()?sessionStorage.removeItem("limoniapps-discountninja-"+t):discountNinja_Script_Cache.FallbackRemove(t)}catch(i){discountNinja.Logging.LogError("Cache.SessionRemove",i),discountNinja_Script_Cache.FallbackRemove(t)}},SessionGet:function(t){try{return discountNinja_Script_Cache.SupportsCacheSession()?sessionStorage.getItem("limoniapps-discountninja-"+t):discountNinja_Script_Cache.FallbackGet(t)}catch(i){return discountNinja.Logging.LogError("Cache.SessionGet",i),discountNinja_Script_Cache.FallbackGet(t)}},SessionSet:function(t,i){try{discountNinja_Script_Cache.SupportsCacheSession()?(discountNinja_Script_Cache.SessionRemove(t),sessionStorage.setItem("limoniapps-discountninja-"+t,i)):discountNinja_Script_Cache.FallbackSet(t,i)}catch(n){discountNinja.Logging.LogError("Cache.SessionSet",n),discountNinja_Script_Cache.FallbackSet(t,i)}},FallbackRemove:function(t){try{delete discountNinja_Script_Cache.Fallback[t]}catch(t){discountNinja.Logging.LogError("Cache.FallbackRemove",t)}},FallbackGet:function(t){try{return discountNinja_Script_Cache.Fallback.hasOwnProperty(t)?discountNinja_Script_Cache.Fallback[t]:null}catch(t){return discountNinja.Logging.LogError("Cache.FallbackGet",t),null}},FallbackSet:function(t,i){try{discountNinja_Script_Cache.Fallback[t]=String(i)}catch(t){discountNinja.Logging.LogError("Cache.FallbackSet",t)}},FallbackClear:function(){try{discountNinja_Script_Cache.Fallback={}}catch(t){discountNinja.Logging.LogError("Cache.FallbackClear",t)}},LocalClear:function(){try{discountNinja_Script_Cache.SupportsCacheLocal()&&localStorage.clear()}catch(t){discountNinja.Logging.LogError("Cache.LocalClear",t)}},SessionClear:function(){try{discountNinja_Script_Cache.SupportsCacheSession()&&sessionStorage.clear()}catch(t){discountNinja.Logging.LogError("Cache.SessionClear",t)}},Clear:function(){try{discountNinja_Script_Cache.LocalClear(),discountNinja_Script_Cache.SessionClear(),discountNinja_Script_Cache.FallbackClear()}catch(t){discountNinja.Logging.LogError("Cache.ClearCache",t)}}},discountNinja_Script_Cookie={GetCookie:function(t){return(document.cookie.match("(^|; )"+t+"=([^;]*)")||0)[2]},GetDiscountCodeCookie:function(){try{var t=discountNinja_Script_Cookie.GetCookie("discount_code");if(null!=t){var i=decodeURIComponent(t).trim();return""!==i?i:null}return null}catch(t){return null}},AppendDiscountCodeToCookie:function(t){discountNinja_Script_Cookie.RemoveDiscountCodesFromCookie();var i="discount_code="+encodeURI(t)+"; path=/";discountNinja.Logging.LogVerbose("Adding/updating cookie: "+i,!1),document.cookie=i},RemoveDiscountCodesFromCookie:function(){document.cookie="discount_code=;expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie="discount_code=;expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"}},discountNinja_Script_Events={GetFullQualifiedEventName:function(t){return"limoniapps:discountninja:"+t.toLowerCase()},Publish:function(t,i){try{var n=discountNinja_Script_Events.GetFullQualifiedEventName(t);document.dispatchEvent(new CustomEvent(n,{detail:{data:i}}))}catch(t){discountNinja.Logging.LogError("Events.Publish",t)}},Subscribe:function(t,i,n){try{null==n&&(n=!0);var e=discountNinja_Script_Events.GetFullQualifiedEventName(t),o="limoniApps:discountNinja:"+t;n&&document.removeEventListener(e,document,!1),discountNinja.Logging.LogVerbose("Subscribing to event "+e),document.addEventListener(e,(function(t){i&&i.apply(this,t.detail?t.detail.data:null)})),n&&discountNinja.Utilities.jQuery()(document).off(o),discountNinja.Logging.LogVerbose("Subscribing to event "+o),discountNinja.Utilities.jQuery()(document).on(o,(function(){i&&i.apply(this,arguments)}))}catch(t){discountNinja.Logging.LogError("Events.Subscribe",t)}}},discountNinja_Script_Logging={WriteToConsole:!1,LogTimeElapsed:!1,LogPerformance:!1,LogWarningToServer:!0,LogMessageHeader:"Discount Ninja - ",Tracing:!1,LogErrorMessage:function(t,i){try{message=null==i?t:"Error occurred in "+t+".\r\nError message: '"+i+"'",discountNinja_Script_Logging.LogToConsole("error",message),discountNinja_Script_Logging.TrackMessage(message,"error")}catch(t){}},LogError:function(t,i,n){try{n=n||"error",message="Error occurred in "+t+".\r\nError message: '"+i.message+"'.\r\nStack: '"+i.stack+"'",discountNinja_Script_Logging.LogToConsole(n,message),discountNinja_Script_Logging.TrackMessage(message,n)}catch(t){}},LogWarning:function(t,i){try{i&&discountNinja_Script_Logging.LogToConsole("warning",t),discountNinja_Script_Logging.TrackMessage(t,"warning")}catch(t){}},LogInformation:function(t){try{discountNinja_Script_Logging.WriteToConsole&&discountNinja_Script_Logging.LogToConsole("information",t,"blue"),discountNinja_Script_Logging.TrackMessage(t,"information")}catch(t){}},LogVerbose:function(t){try{discountNinja_Script_Logging.WriteToConsole&&discountNinja_Script_Logging.LogToConsole("debug","DEBUG - "+t,"gray"),discountNinja_Script_Logging.TrackMessage(t,"verbose")}catch(t){}},TrackMessage:function(t,i){try{"error"===i&&discountNinja.LogSession.LogError(t)}catch(t){}},LogToConsole:function(t,i,n,e,o){try{!discountNinja_Script_Logging.Tracing||"error"!==t&&"critical"!==t&&"warning"!==t||alert(i),o||(i=discountNinja_Script_Logging.LogMessageHeader+i);var r="error"===t||"critical"===t?Function.prototype.bind.call(console.error,console):"warn"===t||"warning"===t?Function.prototype.bind.call(console.warn,console):"debug"===t||"verbose"===t?Function.prototype.bind.call(console.debug,console):Function.prototype.bind.call(console.log,console);n=n||"black";var a="";!0===(e=e||!1)&&(a="font-weight: bold;"),r.apply(console,["%c"+i,"color: "+n+";"+a])}catch(t){try{console&&console.log(i)}catch(t){}}},HandleQueryParameter:function(){var t="discountninja";discountNinja_Script_Logging.Tracing=discountNinja.QueryParameter.GetFlag(t+"tracing",!0,!0,!1,!0),discountNinja_Script_Logging.WriteToConsole=discountNinja.QueryParameter.GetFlag(t+"log",!0,!0,!1,!0),discountNinja_Script_Logging.LogPerformance=discountNinja.QueryParameter.GetFlag(t+"logperformance",!0,!0,!1,!0)}},discountNinja_Script_Currency={EscapeDollarSignForRegEx:function(t){try{return t.toString().replace(/\$/g,"$$$")}catch(i){return discountNinja.Logging.LogError("Currency.EscapeDollarSignForRegEx",i),t}},GetCurrencyFormat:function(){try{var t=discountNinja.Settings.Settings.Currency,i=discountNinjaContext.PresentmentCurrency,n=discountNinjaContext.ShopCurrency,e=void 0===t.MoneyFormat||null===t.MoneyFormat||""===t.MoneyFormat.trim()?'<span class="money">'+(discountNinjaContext.MoneyFormat||"{{amount}}")+"</span>":t.MoneyFormat;if(i===n)return e;var o=t.BaseCurrencySymbol;return presentmentCurrencySymbol=discountNinja_Script_Currency.GetCurrencySymbol(i),e.replace(new RegExp(n.replace("$","\\$"),"g"),discountNinja.Currency.EscapeDollarSignForRegEx(i)).replace(new RegExp(o.replace("$","\\$"),"g"),discountNinja.Currency.EscapeDollarSignForRegEx(presentmentCurrencySymbol))}catch(t){return discountNinja.Logging.LogError("Currency.GetCurrencyFormat",t),""}},GetCurrencySymbol:function(t){try{if(discountNinjaContext&&discountNinjaContext.EnabledCurrencies)for(var i=0;i<discountNinjaContext.EnabledCurrencies.length;i++){var n=discountNinjaContext.EnabledCurrencies[i];if(n.IsoCode===t)return n.Symbol}return""}catch(t){return discountNinja.Logging.LogError("Currency.GetCurrencySymbol",t),""}},Convert:function(t,i,n){try{var e=function(t){var i=discountNinja.Settings.Settings.Currency,n=null;if(window.Shopify&&window.Shopify.currency&&void 0!==window.Shopify.currency.rate&&null!==window.Shopify.currency.rate&&""!==window.Shopify.currency.rate)try{n=parseFloat(window.Shopify.currency.rate)}catch(t){discountNinja.Logging.LogError("Currency.Convert",t)}if(null===n)try{void 0===(n=JSON.parse(i.ConversionRates)[t])&&(n=null)}catch(t){discountNinja.Logging.LogError("Currency.Convert",t)}return n}(i);if(null===e)return t;var o=t*e,r=discountNinja.Settings.Settings.Currency,a=n||r.RoundingAlgorithm||discountNinja.Settings.GetFlag("CurrencyConversionRoundingAlgorithm");return"exact"===a?o:"ceiling"===a?Math.ceil(o):"floor"===a?Math.floor(o):"round"===a?Math.round(o):"roundtofive"===a?5*Math.round(o/5):"floortofive"===a?5*Math.floor(o/5):"ceiltofive"===a?5*Math.ceil(o/5):Math.round(o)}catch(i){return discountNinja.Logging.LogError("Currency.Convert",i),t}}},discountNinja_Script_MultiCurrency={UpdateCurrency:function(){try{"object"==typeof window.DoublyGlobalCurrency?function(){try{var t=discountNinja.Settings.Settings.Currency,i=t.BaseCurrency;window.DoublyGlobalCurrency&&void 0!==window.DoublyGlobalCurrency.currentCurrency&&null!==window.DoublyGlobalCurrency.currentCurrency&&""!==window.DoublyGlobalCurrency.currentCurrency&&(i=window.DoublyGlobalCurrency.currentCurrency),window.DoublyGlobalCurrency&&"function"==typeof window.DoublyGlobalCurrency.convertAll&&(i!==t.BaseCurrency&&(discountNinja.Logging.LogVerbose("Updating currency - Doubly - Back to base currency: "+t.BaseCurrency),window.DoublyGlobalCurrency.convertAll(t.BaseCurrency,".money")),discountNinja.Logging.LogVerbose("Updating currency - Doubly - To current currency: "+i),window.DoublyGlobalCurrency.convertAll(i,".money"))}catch(t){discountNinja.Logging.LogError("UpdateCurrencyDoubly",t,"warning")}}():"object"==typeof window.Geolizr?function(){try{if("object"==typeof window.Geolizr){var t=discountNinja.Settings.Settings.Currency.BaseCurrency,i=window.Geolizr.getCurrency();discountNinja.Logging.LogVerbose("Updating currency - Switching to "+i),window.Geolizr.moneyFormats[t]&&window.Geolizr.moneyFormats[i]?(window.Geolizr.switchCurrency(t),window.Geolizr.switchCurrency(i)):discountNinja.Logging.LogVerbose("Currency unavailable "+t+" or "+i)}}catch(t){discountNinja.Logging.LogError("UpdateCurrencyGeolizr",t,"warning")}}():"function"==typeof window.convertCurrencies&&"object"==typeof window.Currency?function(){try{"function"==typeof window.convertCurrencies&&(discountNinja.Logging.LogVerbose("Updating currency - convertCurrencies"),window.convertCurrencies())}catch(t){discountNinja.Logging.LogError("UpdateCurrencyStandardConvertCurrencies",t,"warning")}}():"object"==typeof window.Currency&&"function"==typeof window.Currency.convertAll&&!1!==discountNinja.Settings.GetFlag("AllowCurrencyConversionUsingCurrencyConvertAll")&&function(){try{var t=discountNinja.Settings.Settings.Currency,i=t.BaseCurrency,n=t.BaseCurrency;window.Currency&&void 0!==window.Currency.shopCurrency&&null!==window.Currency.shopCurrency&&""!==window.Currency.shopCurrency&&(i=window.Currency.shopCurrency),window.Shopify&&window.Shopify.currency&&void 0!==window.Shopify.currency.active&&null!==window.Shopify.currency.active&&""!==window.Shopify.currency.active&&(n=window.Shopify.currency.active),window.Currency&&void 0!==window.Currency.currentCurrency&&null!==window.Currency.currentCurrency&&""!==window.Currency.currentCurrency&&(n=window.Currency.currentCurrency),i!==n&&"object"==typeof window.Currency&&"function"==typeof window.Currency.convertAll&&(discountNinja.Logging.LogVerbose("Updating currency - convertAll - from: "+i+" - to: "+n),window.Currency.convertAll(i,n))}catch(t){discountNinja.Logging.LogError("UpdateCurrencyStandardConvertAll",t,"warning")}}();try{document.dispatchEvent(new CustomEvent("switch-currency")),discountNinja.Events.Publish("convertmoneyfields",discountNinjaContext.PresentmentCurrency)}catch(t){discountNinja.Logging.LogError("UpdateCurrency Switch currency",t,"warning")}}catch(t){discountNinja.Logging.LogError("UpdateCurrency",t,"warning")}}},discountNinja_Script_QueryParameter={GetQueryParameters:function(t){try{var i=null==t?window.location.href.replace(window.location.hash,""):t;i&&(i=i.indexOf("#")>-1?i.substring(0,i.indexOf("#")):i);for(var n,e=[],o=i.slice(i.indexOf("?")+1).split("&"),r=0;r<o.length;r++)n=o[r].split("="),e.push(n[0]),e[n[0]]=n[1];return e}catch(t){return discountNinja.Logging.LogError("QueryParameter.GetQueryParameters",t),[]}},Get:function(t,i){try{var n=discountNinja_Script_QueryParameter.GetQueryParameters(i)[t];return void 0===n||"undefined"===n||"null"===n||"UNDEFINED"===n||"NULL"===n||null===n?null:n}catch(t){return discountNinja.Logging.LogError("QueryParameter.Get",t),null}},Remove:function(t){try{var i=discountNinja_Script_QueryParameter.GetQueryParameters(),n=[];for(var e in Object.keys(i)){var o=i[e],r=i[o];null!=o&&null!=r&&o!==t&&n.push(o+"="+r)}var a=n.length<1?"":"?"+n.join("&");window.history&&window.history.replaceState?window.history.replaceState({},document.title,location.origin+location.pathname+a):document.location.search=a}catch(t){discountNinja.Logging.LogError("QueryParameter.Remove",t)}},RemoveFromUrl:function(t,i,n){try{var e=t.replace(i+"="+n,""),o=(e=(e=e.replace("?&","?")).replace("&&","&")).slice(-1);return"&"!==o&&"?"!==o||(e=e.slice(0,-1)),e}catch(t){discountNinja.Logging.LogError("QueryParameter.RemoveFromUrl",t)}},AppendToUrl:function(t,i,n,e,o){try{n=discountNinja.Utilities.EncodeUriComponentForQueryString(n),i=discountNinja.Utilities.EncodeUriComponentForQueryString(i);var r=discountNinja_Script_QueryParameter.GetQueryParameters(t)[i];if(void 0!==r&&r===n)return t;e&&void 0!==r&&(t=discountNinja_Script_QueryParameter.RemoveFromUrl(t,i,r));return(o?t+(0===t.length?"":"&")+i+"="+n:t.indexOf("?")>0?t+"&"+i+"="+n:t+"?"+i+"="+n).replace("?&","?")}catch(t){discountNinja.Logging.LogError("QueryParameter.AppendToUrl",t)}},GetFlag:function(t,i,n,e,o){var r=discountNinja_Script_QueryParameter.Get(t);if(null!==r)return o&&(r=1==r),i&&discountNinja.Cache.SessionSet(t,r),n&&discountNinja_Script_QueryParameter.Remove(t),r;var a=discountNinja.Cache.SessionGet(t);return null!==a?a:e}},discountNinja_Script_TextSettings={WrapInColor:function(t,i){return t?'<span style="color:'+t+'">'+i+"</span>":i},GetText:function(t,i,n){function e(t){return t.replace(/\\{/g,"{").replace(/\\}/g,"}").replace(/_{_{/g,"{{").replace(/_}_}/g,"}}")}if(!t)return"";t=function(t){return t&&(t.MobileText&&(t.MobileText=e(t.MobileText)),t.MobileTextAfterGoal&&(t.MobileTextAfterGoal=e(t.MobileTextAfterGoal)),t.MobileTextDuringGoal&&(t.MobileTextDuringGoal=e(t.MobileTextDuringGoal)),t.MobileTextOnCart&&(t.MobileTextOnCart=e(t.MobileTextOnCart)),t.MobileTextOnCartAfterGoal&&(t.MobileTextOnCartAfterGoal=e(t.MobileTextOnCartAfterGoal)),t.MobileTextOnCartDuringGoal&&(t.MobileTextOnCartDuringGoal=e(t.MobileTextOnCartDuringGoal)),t.Text&&(t.Text=e(t.Text)),t.TextAfterGoal&&(t.TextAfterGoal=e(t.TextAfterGoal)),t.TextDuringGoal&&(t.TextDuringGoal=e(t.TextDuringGoal)),t.TextOnCart&&(t.TextOnCart=e(t.TextOnCart)),t.TextOnCartAfterGoal&&(t.TextOnCartAfterGoal=e(t.TextOnCartAfterGoal)),t.TextOnCartDuringGoal&&(t.TextOnCartDuringGoal=e(t.TextOnCartDuringGoal))),t}(t);var o=discountNinja.Environment.Shopify.IsCartPage(),r=discountNinja.Utilities.IsMobilePhone(),a=i&&i.Tiers[0]&&i.Tiers[0].Prerequisite&&(i.Tiers[0].Prerequisite.MaximumItems>0||i.Tiers[0].Prerequisite.MinimumItems>0||i.Tiers[0].Prerequisite.MinimumAmount>0||i.Tiers[0].Prerequisite.MaximumAmount>0),c=null!==i&&("spendx_gety"===i.OfferType||a),s="-";if(c){var u=discountNinja.Offer.PrerequisiteItemsCartValue(i),d=null===i?0:discountNinja.DiscountTier.GetCurrentDiscountTierNumber(i,u);d===(null===i?0:discountNinja.DiscountTier.GetMaxDiscountTierNumber(i))?s="after":d>0?s="duringandafter":d>-1&&(s="during")}var l,g,p=t.TextOnCartDuringGoal,f=t.TextOnCartAfterGoal,N=t.TextOnCart,j=t.TextDuringGoal,m=t.TextAfterGoal,h=t.Text;r&&(p=t.MobileTextOnCartDuringGoal||p,f=t.MobileTextOnCartAfterGoal||f,N=t.MobileTextOnCart||N,j=t.MobileTextDuringGoal||j,m=t.MobileTextAfterGoal||m,h=t.MobileText||h),o&&(j=p||j,m=f||m,h=N||h),l=j||h||"",g=m||h||"";var C="";return"duringandafter"===s?C=g===l?g:g+l:"during"===s?C=l:"after"===s?C=g:(C=h||"",c||""!==C||(C=g)),discountNinja.TextScaling.ReplacePxWithRem(C,.9)},IsEmpty:function(t){try{return"string"!=typeof t||null===t||""===t.replace(/<(?:!|\/?[a-zA-Z]+).*?\/?>/g,"").trim()}catch(t){return!1}}},discountNinja_Script_Utilities={jQuery:function(){return LimoniAppsJQuery||jQuery},ObjectIsEmpty:function(t){return null==t||0===Object.keys(t).length&&t.constructor===Object},NewGuid:function(){try{var t=(new Date).getTime(),i=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){var e=16*Math.random();return t>0?(e=(t+e)%16|0,t=Math.floor(t/16)):(e=(i+e)%16|0,i=Math.floor(i/16)),("x"===n?e:3&e|8).toString(16)}))}catch(t){return discountNinja.Logging.LogError("Utilities.NewGuid",t),null}},RepeatWithIntervals:function(t,i,n){!function t(e,o){try{o<n&&(o>0?setTimeout((function(){e()}),i):e(),t(e,o+1))}catch(t){discountNinja.Logging.LogError("Utilities.RepeatWithIntervals",t)}}(t,0)},CreateFragment:function(t){try{var i=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)i.appendChild(n.firstChild);return i}catch(t){return discountNinja.Logging.LogError("Utilities.CreateFragment",t),null}},AddInlineCssToDocument:function(t,i){try{var n=document.createElement("style");n.type="text/css",n.id=i,n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t));var e=document.getElementsByTagName("head")[0];discountNinja.Utilities.jQuery()("#"+i).length>0&&e.removeChild(document.getElementById(i)),e.appendChild(n)}catch(t){discountNinja.Logging.LogError("Utilities.AddInlineCssToDocument",t)}},NumberOfFractionalDigits:function(t){try{return Math.floor(t).toString()===t.toString()?0:t.toString().split(".")[1].length||0}catch(i){return discountNinja.Logging.LogError("Utilities.NumberOfFractionalDigits, number was: "+t,i),t}},FixedMultipliedAmount:function(t,i){try{var n=Math.pow(10,i),e=discountNinja_Script_Utilities.NumberOfFractionalDigits(t);return(t*n).toFixed(Math.max(0,e-i))}catch(i){return discountNinja.Logging.LogError("Utilities.FixedMultipliedAmount",i),t}},RoundToNumberOfDigits:function(t,i){try{var n=Math.pow(10,i),e=discountNinja_Script_Utilities.FixedMultipliedAmount(t,i);return 0===n?0:parseFloat(Math.round(e)/n)}catch(i){return discountNinja.Logging.LogError("Utilities.RoundToNumberOfDigits",i),t}},FloorToNumberOfDigits:function(t,i){try{var n=Math.pow(10,i),e=discountNinja_Script_Utilities.FixedMultipliedAmount(t,i);return 0===n?0:parseFloat(Math.floor(e)/n)}catch(i){return discountNinja.Logging.LogError("Utilities.FloorToNumberOfDigits",i),t}},Debounce:function(t,i,n){var e;return function(){try{var o=this,r=arguments,a=function(){try{e=null,n||t.apply(o,r)}catch(t){discountNinja.Logging.LogError("Utilities.Debounce",t)}},c=n&&!e;clearTimeout(e),e=setTimeout(a,i),c&&t.apply(o,r)}catch(t){discountNinja.Logging.LogError("Utilities.Debounce",t)}}},EncodeUriComponent:function(t){try{if(!t||"string"!=typeof t)return t;var i=t;try{i=decodeURIComponent(t)}catch(t){}var n=i;try{n=encodeURIComponent(i)}catch(i){discountNinja.Logging.LogWarning("Could not encode: "+t,!0,!1)}return n}catch(i){return discountNinja.Logging.LogWarning("Utilities.EncodeUriComponent - Could not encode: "+t,!0,!1),t}},EncodeUriComponentForQueryString:function(t){try{return t&&"string"==typeof t?(t=t.toString().replace(/\+/g," "),discountNinja_Script_Utilities.EncodeUriComponent(t).replace(/%20/g,"+").replace(/ /g,"+")):t}catch(i){return discountNinja.Logging.LogWarning("Utilities.EncodeUriComponentForQueryString - Could not encode: "+t,!0,!1),t}},GetNumberFromHtmlFragment:function(t){try{return t.match(/\d+/)[0]}catch(i){return t}},GetElementId:function(t){try{if("body"===t)return"body";var i=discountNinja.Utilities.jQuery()(t).attr("id");return i||t}catch(i){return t}},IsInViewport:function(t){try{var i=discountNinja.Utilities.jQuery()(t).offset().top,n=discountNinja.Utilities.jQuery()(t).offset().left,e=i+discountNinja.Utilities.jQuery()(t).outerHeight(),o=n+discountNinja.Utilities.jQuery()(t).outerWidth(),r=discountNinja.Utilities.jQuery()(window).scrollTop(),a=r+discountNinja.Utilities.jQuery()(window).height(),c=discountNinja.Utilities.jQuery()(window).scrollLeft(),s=c+discountNinja.Utilities.jQuery()(window).width();return e>r&&i<a&&n<s&&o>c}catch(t){return discountNinja.Logging.LogError("Utilities.IsInViewport",t),!1}},IsValidEmailAddress:function(t){try{return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t.toLowerCase())}catch(t){return discountNinja.Logging.LogError("Utilities.IsValidEmailAddress",t),!1}},GetMutationObserver:function(){try{var t=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;return void 0===t?discountNinja.Logging.LogWarning("MutationObserver not available, not supporting ListenForDynamicallyAddedElements",!0,!0):t}catch(t){return discountNinja.Logging.LogError("Utilities.GetMutationObserver",t),null}},FormatPercentage:function(t,i){try{return isNaN(t)?t:t.toFixed(i)}catch(i){return discountNinja.Logging.LogError("Utilities.FormatPercentage",i),t}},FormatMoney:function(t,i,n,e,o,r){function a(t,i,n,o){if(n=n||",",o=o||".",isNaN(t)||null===t)return 0;var r=(t=(t/100).toFixed(i)).split("."),a=r[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+n);if(0===i)return a;return a+(e?"<sup>"+(r[1]?r[1]:"")+"</sup>":r[1]?o+r[1]:"")}try{if(0===t&&!0===r)return window.discountNinjaContext.Labels.Free;e=e||!1,o=o||!1,"string"==typeof t&&(t=t.replace(".",""));var c="",s=/\{\{\s*(\w+)\s*\}\}/,u=discountNinja.Currency.GetCurrencyFormat(),d=null===i||-1===i.indexOf("{{amount")?u:i;switch(d.match(s)[1]){case"amount":c=a(t,n,",",".");break;case"amount_no_decimals":c=a(t,0,",",".");break;case"amount_with_comma_separator":c=a(t,n,".",",");break;case"amount_no_decimals_with_comma_separator":c=a(t,0,".",",");break;case"amount_with_apostrophe_separator":c=a(t,n,"'",".")}return d.replace(s,discountNinja.Currency.EscapeDollarSignForRegEx(c))}catch(i){return discountNinja.Logging.LogError("Utilities.FormatMoney",i),t}},GetNoDecimalsCurrencyFormat:function(t){try{return t&&(t=(t=t.replace("{{amount}}","{{amount_no_decimals}}")).replace("{{amount_with_comma_separator}}","{{amount_no_decimals_with_comma_separator}}")),t}catch(t){return discountNinja.Logging.LogError("Utilities.GetNoDecimalsCurrencyFormat",t),""}},GetCurrencyFormatAmountComponent:function(t){try{if(t){var i=t.match(/({{){1}(.)*(}}){1}/);if(null!==i&&i.length>0)return i[0]}return t}catch(t){return discountNinja.Logging.LogError("Utilities.GetCurrencyFormatAmountComponent",t),""}},StringIsIn:function(t,i,n){try{if(null==t||""===t||null==i||""===i)return!1;null==n&&(n=",");for(var e=t.toString().split(n),o=i.toString().split(n),r=0;r<e.length;r++)for(var a=0;a<o.length;a++){var c=e[r],s=o[a];if(null!=c&&""!==c.trim()&&null!=s&&""!==s.trim()&&c.toLowerCase().trim()===s.toLowerCase().trim())return!0}return!1}catch(t){return discountNinja.Logging.LogError("Utilities.StringIsIn",t),!1}},AppendToStyle:function(t,i,n){try{discountNinja.Utilities.jQuery()(t).attr("style",(function(t,e){"string"==typeof e&&null!=e||(e=""),""!==e&&";"!==e.substr(e.length-1)&&(e+=";");var o=new RegExp(i+"([s])*:([^;\n\r])*","g"),r=e.match(o);return null!==r&&r.length>0?e=e.replace(o,i+": "+n):e+i+": "+n+";"}))}catch(t){discountNinja.Logging.LogError("Utilities.AppendToStyle",t)}},IsMobilePhoneCached:null,IsMobilePhone:function(){try{if(null===discountNinja_Script_Utilities.IsMobilePhoneCached){var t=!1;i=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(i)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(i.substr(0,4)))&&(t=!0),discountNinja_Script_Utilities.IsMobilePhoneCached=t}return discountNinja_Script_Utilities.IsMobilePhoneCached}catch(t){return discountNinja.Logging.LogError("Utilities.IsMobilePhone",t),!1}var i},GetReferrer:function(){try{return-1===document.referrer.indexOf(document.location.hostname)&&discountNinja.Cache.SessionSet("original-referrer",document.referrer),discountNinja.Cache.SessionGet("original-referrer")}catch(t){return discountNinja.Logging.LogError("Utilities.GetReferrer",t),null}},GetEmoji:function(t){return t>65535?(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t))):String.fromCharCode(t)},GetHandleFromSelector:function(t,i,n){try{var e=t;if(i){var o=discountNinja.Utilities.jQuery()(t).closest(i).first();1===o.length&&(e=o)}var r=n.match(/\[\[HANDLE:[^\[]*\]\]/);if(null===r||1!==r.length)return void discountNinja.Logging.LogErrorMessage("GetHandleFromSelector expects [[HANDLE:some attribute]]");var a=r[0],c=a.replace(/\[/g,"").replace(/\]/g,"").split(":")[1].toLowerCase();n=n.substring(a.length);var s=!1,u="[[SELF]]";0===n.indexOf(u)&&(s=!0,(n=n.substring(u.length)).length>0&&","===n[0]&&(n=n.substring(1)));var d=null;n.length>0&&(d=discountNinja.Utilities.jQuery()(e).find(n),discountNinja.Utilities.jQuery()(d).attr(c)||(d=null)),null===d&&s&&(d=e);var l=discountNinja.Utilities.jQuery()(d).attr(c);if(!l)return discountNinja.Logging.LogWarning("Could not find collection handle tag, looking for "+n+". Missing Dynamic Pricing data tags? The price will not be updated for the product."),!1;if(!(null!==l.match(/\/products\//)))return discountNinja.Logging.LogVerbose("Href '"+l+"' is not a product page."),!1;productHandle=l.substring(l.lastIndexOf("/")+1);var g=productHandle.indexOf("?");return g>-1&&(productHandle=productHandle.substring(0,g)),decodeURIComponent(productHandle)}catch(t){return discountNinja.Logging.LogError("GetHandleFromSelector",t),null}}},discountNinja_Script_VariantChange={UnRegisterEventHandlerForVariantChange:function(){try{discountNinja.Utilities.jQuery()("body").find("form").find("select").each((function(){discountNinja.Utilities.jQuery()(this).off("change.discountninja")}))}catch(t){discountNinja.Logging.LogError("VariantChange.UnRegisterEventHandlerForVariantChange",t)}},RegisterEventHandlerForVariantChange:function(){function t(t){try{i=discountNinja.Cache.SessionGet("last-known-variant"),n=t||discountNinja.Environment.Shopify.VariantId(),i!==n&&(discountNinja.Cache.SessionSet("last-known-variant",n),discountNinja.VariantChangedEvent.Handle(null,n?n.toString():null))}catch(t){discountNinja.Logging.LogError("VariantChange.VariantChangeDetected",t)}var i,n}try{discountNinja.Logging.LogVerbose("Registering event handler for variant change"),discountNinja_Script_VariantChange.UnRegisterEventHandlerForVariantChange(),discountNinja.Utilities.jQuery()("body").find("form").find("select").each((function(){discountNinja.Utilities.jQuery()(this).on("change.discountninja",(function(i){t()}))})),discountNinja.Utilities.jQuery()(document).on("variantChanged",(function(i,n){discountNinja.Logging.LogVerbose(n.variant?n.variant.id:""),t()})),discountNinja.Utilities.jQuery()(document).on("limoniApps:discountNinja:VariantChanged",(function(i,n){void 0===n&&void 0!==i.detail&&void 0!==i.detail.data&&(n=i.detail.data),discountNinja.Logging.LogVerbose(n.variant?n.variant.id:""),t()})),document.addEventListener(discountNinja.Events.GetFullQualifiedEventName("variant:changed"),(function(i){var n=null;if(void 0===i.detail||void 0===i.detail.data&&void 0===i.detail.variant)discountNinja.Logging.LogVerbose("Received VariantChanged event, no parameter detected");else{var e=i.detail.data?i.detail.data:i.detail;n=e&&e.variant?e.variant.id?e.variant.id:e.variant:null,discountNinja.Logging.LogVerbose("Received VariantChanged event for variant: "+(n||"no parameter detected"))}t(n)}))}catch(t){discountNinja.Logging.LogError("VariantChange.RegisterEventHandlerForVariantChange",t)}}},discountNinja_Script_XmlHttpRequest={RequestsHandled:{},HandleFetch:function(t,i){try{if(discountNinja.Logging.LogVerbose("HandleFetch called "+t),"object"==typeof t)try{t=i.href}catch(t){}var n=null;try{n=i.body}catch(t){}n?discountNinja_Script_XmlHttpRequest.HandleNetworkRequest(t,n,!0):discountNinja.Logging.LogVerbose("HandleFetch received data it cannot handle: "+i+" for url "+t)}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.HandleFetch",t)}},RegisterToAjaxEvents:function(){discountNinja.Utilities.jQuery()(document).ajaxSuccess((function(t,i,n){discountNinja_Script_XmlHttpRequest.HandleAjaxSuccess(t,i,n)}))},HandleAjaxSuccess:function(t,i,n){try{if(null==i)return;if(4===i.readyState){if(!discountNinja_Script_XmlHttpRequest.CanHandleRequest(i))return;if(!discountNinja_Script_XmlHttpRequest.ShouldHandleRequest(i))return;var e=n.url;discountNinja_Script_XmlHttpRequest.HandleNetworkRequest(e,n.data)}}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.HandleAjaxSuccess",t)}},GetRequestIdHeader:function(t){var i="x-request-id";if(t.getAllResponseHeaders().indexOf(i)>=0){var n=t.getResponseHeader(i);return"string"==typeof n?n:null}return null},CanHandleRequest:function(t){try{var i=t.responseType,n="text"!==i&&""!==i&&"document"!==i&&!function(t){try{return"string"!=typeof t.responseText}catch(t){return!1}}(t);return n&&discountNinja.Logging.LogVerbose("HandleSend cannot handle response of type "+i),!n}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.HandleAjaxSuccess",t)}},ShouldHandleRequest:function(t){var i=discountNinja_Script_XmlHttpRequest,n=i.GetRequestIdHeader(t);return null===n||!0!==i.RequestsHandled[n]&&(i.RequestsHandled[n]=!0,!0)},HandleSend:function(t){try{if(4===this.readyState){if(!discountNinja_Script_XmlHttpRequest.CanHandleRequest(this))return;if(!discountNinja_Script_XmlHttpRequest.ShouldHandleRequest(this))return;var i=this.responseURL||this._url;discountNinja_Script_XmlHttpRequest.HandleNetworkRequest(i,t)}}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.HandleSend",t)}},HandleNetworkRequest:function(t,i){try{LimoniAppsLoadJQuery((function(){try{LimoniAppsLoadDayJs((function(){try{"string"==typeof t&&null!==t?t.indexOf("/cart/add")>-1?(discountNinja.Logging.LogVerbose("Handling cart add post"),discountNinja.ServerCartItemsAddedEvent.Handle(null)):t.indexOf("/cart/change")>-1?(discountNinja.Logging.LogVerbose("Handling cart change post"),discountNinja.ServerCartItemsChangedEvent.Handle()):t.indexOf("/cart/update")>-1?(discountNinja.Logging.LogVerbose("Handling cart update post"),discountNinja.ServerCartItemsUpdatedEvent.Handle()):(t.indexOf("collections")>-1||t.indexOf("search")>-1)&&(t.indexOf("?page=")>-1||t.indexOf("&page=")>-1)&&(discountNinja.Logging.LogVerbose("Handling paging request"),discountNinja.ServerCollectionProductsPageLoadedEvent.Handle()):discountNinja.Logging.LogWarning("Invalid url in HandleNetworkRequest",!0)}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.HandleNetworkRequest",t)}}))}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.HandleNetworkRequest",t)}}))}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.HandleNetworkRequest",t)}},SendIntercepted:!1,CreateSendInterceptor:function(t,i,n){return discountNinja_Script_XmlHttpRequest.SendIntercepted?(discountNinja.Logging.LogVerbose("Send handler already registered"),n):function(e){try{discountNinja_Script_XmlHttpRequest.SendIntercepted=!0,discountNinja.Logging.LogVerbose("Send interceptor called, executing custom handler"),this.addEventListener(t,i.bind(this,e)),discountNinja.Logging.LogVerbose("Send interceptor execute original request")}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.CreateSendInterceptor",t)}return n.apply(this,arguments)}},FetchIntercepted:!1,CreateFetchInterceptor:function(t){function i(t){return function(t){if(Array.isArray(t)){for(var i=0,n=new Array(t.length);i<t.length;i++)n[i]=t[i];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function n(t,i,n,e,o,r,a){try{var c=t[r](a),s=c.value}catch(t){return void n(t)}c.done?i(s):Promise.resolve(s).then(e,o)}try{discountNinja.Logging.LogVerbose("Registering fetch interceptor");var e="undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]"),o=window.fetch;if(discountNinja_Script_XmlHttpRequest.FetchIntercepted||o&&o.toString().indexOf("AsyncWindowFetchHandler")>0)return void discountNinja.Logging.LogVerbose("Fetch handler already registered");discountNinja_Script_XmlHttpRequest.FetchIntercepted=!0}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.CreateFetchInterceptor",t,!0)}if(e){var r=function(t){function i(t,i,n,o){var r=i&&i.prototype instanceof e?i:e,a=Object.create(r.prototype),c=new g(o||[]);return a._invoke=s(t,n,c),a}function n(t,i,n){try{return{type:"normal",arg:t.call(i,n)}}catch(t){return{type:"throw",arg:t}}}function e(){}function o(){}function r(){}function a(t){["next","throw","return"].forEach((function(i){t[i]=function(t){return this._invoke(i,t)}}))}function c(t){function i(e,o,r,a){var c=n(t[e],t,o);if("throw"!==c.type){var s=c.arg,u=s.value;return u&&"object"==typeof u&&j.call(u,"__await")?Promise.resolve(u.__await).then((function(t){i("next",t,r,a)}),(function(t){i("throw",t,r,a)})):Promise.resolve(u).then((function(t){s.value=t,r(s)}),(function(t){return i("throw",t,r,a)}))}a(c.arg)}var e;this._invoke=function(t,n){function o(){return new Promise((function(e,o){i(t,n,e,o)}))}return e=e?e.then(o,o):o()}}function s(t,i,e){var o="suspendedStart";return function(r,a){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===r)throw a;return{value:void 0,done:!0}}for(e.method=r,e.arg=a;;){var c=e.delegate;if(c){var s=u(c,e);if(s){if(s===y)continue;return s}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if("suspendedStart"===o)throw o="completed",e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);o="executing";var d=n(t,i,e);if("normal"===d.type){if(o=e.done?"completed":"suspendedYield",d.arg===y)continue;return{value:d.arg,done:e.done}}"throw"===d.type&&(o="completed",e.method="throw",e.arg=d.arg)}}}function u(t,i){var e=t.iterator[i.method];if(void 0===e){if(i.delegate=null,"throw"===i.method){if(t.iterator.return&&(i.method="return",i.arg=void 0,u(t,i),"throw"===i.method))return y;i.method="throw",i.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var o=n(e,t.iterator,i.arg);if("throw"===o.type)return i.method="throw",i.arg=o.arg,i.delegate=null,y;var r=o.arg;return r?r.done?(i[t.resultName]=r.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=void 0),i.delegate=null,y):r:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,y)}function d(t){var i={tryLoc:t[0]};1 in t&&(i.catchLoc=t[1]),2 in t&&(i.finallyLoc=t[2],i.afterLoc=t[3]),this.tryEntries.push(i)}function l(t){var i=t.completion||{};i.type="normal",delete i.arg,t.completion=i}function g(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(d,this),this.reset(!0)}function p(t){if(t){var i=t[h];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,e=function i(){for(;++n<t.length;)if(j.call(t,n))return i.value=t[n],i.done=!1,i;return i.value=void 0,i.done=!0,i};return e.next=e}}return{next:f}}function f(){return{value:void 0,done:!0}}var N=Object.prototype,j=N.hasOwnProperty,m="function"==typeof Symbol?Symbol:{},h=m.iterator||"@@iterator",C=m.asyncIterator||"@@asyncIterator",S=m.toStringTag||"@@toStringTag";t.wrap=i;var y={},_={};_[h]=function(){return this};var v=Object.getPrototypeOf,P=v&&v(v(p([])));P&&P!==N&&j.call(P,h)&&(_=P);var L=r.prototype=e.prototype=Object.create(_);return o.prototype=L.constructor=r,r.constructor=o,r[S]=o.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var i="function"==typeof t&&t.constructor;return!!i&&(i===o||"GeneratorFunction"===(i.displayName||i.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,r):(t.__proto__=r,!(S in t)&&(t[S]="GeneratorFunction")),t.prototype=Object.create(L),t},t.awrap=function(t){return{__await:t}},a(c.prototype),c.prototype[C]=function(){return this},t.AsyncIterator=c,t.async=function(n,e,o,r){var a=new c(i(n,e,o,r));return t.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},a(L),L[S]="Generator",L[h]=function(){return this},L.toString=function(){return"[object Generator]"},t.keys=function(t){var i=[];for(var n in t)i.push(n);return i.reverse(),function n(){for(;i.length;){var e=i.pop();if(e in t)return n.value=e,n.done=!1,n}return n.done=!0,n}},t.values=p,g.prototype={constructor:g,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(l),!t)for(var i in this)"t"===i.charAt(0)&&j.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){function i(i,e){return r.type="throw",r.arg=t,n.next=i,e&&(n.method="next",n.arg=void 0),!!e}if(this.done)throw t;for(var n=this,e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e],r=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var a=j.call(o,"catchLoc"),c=j.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,i){for(var n,e=this.tryEntries.length-1;0<=e;--e)if((n=this.tryEntries[e]).tryLoc<=this.prev&&j.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}o&&("break"===t||"continue"===t)&&o.tryLoc<=i&&i<=o.finallyLoc&&(o=null);var r=o?o.completion:{};return r.type=t,r.arg=i,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(r)},complete:function(t,i){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&i&&(this.next=i),y},finish:function(t){for(var i,n=this.tryEntries.length-1;0<=n;--n)if((i=this.tryEntries[n]).finallyLoc===t)return this.complete(i.completion,i.afterLoc),l(i),y},catch:function(t){for(var i,n=this.tryEntries.length-1;0<=n;--n)if((i=this.tryEntries[n]).tryLoc===t){var e=i.completion;if("throw"===e.type){var o=e.arg;l(i)}return o}throw new Error("illegal catch attempt")},delegateYield:function(t,i,n){return this.delegate={iterator:p(t),resultName:i,nextLoc:n},"next"===this.method&&(this.arg=void 0),y}},t}("object"==typeof module?module.exports:{});try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}AsyncWindowFetchHandler=function(){var e,r=(e=regeneratorRuntime.mark((function n(e){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return discountNinja.Logging.LogVerbose("Executing original fetch (async)"),n.prev=1,n.next=4,o.apply(void 0,i(e));case 4:r=n.sent,n.next=10;break;case 7:n.prev=7,n.t0=n.catch(1);case 10:discountNinja.Logging.LogVerbose("Calling custom fetch handler (async)");try{t.apply(void 0,i(e))}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.CreateFetchInterceptor - Custom fetch handler (async)",t,!1)}return n.abrupt("return",r);case 13:case"end":return n.stop()}}),n,null,[[1,7]])})),function(){var t=this,i=arguments;return new Promise((function(o,r){var a=e.apply(t,i);function c(t){n(a,o,r,c,s,"next",t)}function s(t){n(a,o,r,c,s,"throw",t)}c(void 0)}))});return function(t){return r.apply(this,arguments)}}(),window.fetch=function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return AsyncWindowFetchHandler(i)}}else window.fetch=function(){try{discountNinja.Logging.LogVerbose("Calling custom fetch handler (sync)");for(var i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];try{var r;(r=t).apply.apply(r,n)}catch(t){discountNinja.Logging.LogToConsole("error",t,"red",!1)}discountNinja.Logging.LogVerbose("Executing original fetch (sync)")}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.CreateFetchInterceptor",t,!0)}return o.apply(window,n)}},XmlHttpRequestObject:function(){return"undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},Send:function(t,i,n,e,o,r,a,c,s,u,d,l){function g(t,i,n){return""===t?t="?":t+="&",t=t+discountNinja.Utilities.EncodeUriComponentForQueryString(i)+"="+discountNinja.Utilities.EncodeUriComponentForQueryString(n)}try{if(null==d&&(d=5),null==u&&(u=1),u>d){var p="SendHttpRequest failed. Retry iterations ("+d+") exceeded for url "+t;return discountNinja.Logging.LogErrorMessage("XMLHttpRequest.Send",p),void("function"==typeof s&&null!==s&&s(p))}!function(t,i,e,o,r,c,s,u,d){var p=function(t){try{if("object"!=typeof t||null===t)return"";for(var i=Object.getOwnPropertyNames(t),n="",e=0;e<i.length;e++){var o=i[e],r=t[o];if("string"==typeof r&&null!==r&&""!==r)for(var a=r.split(","),c=0;c<a.length;c++)n=g(n,o,a[c]);else n=g(n,o,r)}return n}catch(t){return console.error("CreateQueryStringFromParameters failed",t),""}}(i),f=t+p;discountNinja.Logging.LogVerbose("Sending request to "+f+" from SendXMLHttpRequest",!1);var N=discountNinja_Script_XmlHttpRequest.XmlHttpRequestObject();N.open(e,f,!0),!0===l&&N.setRequestHeader("cache-control","no-cache"),!0===a&&discountNinjaContext.AccessToken&&"4"!==discountNinja.Core.ApiVersion&&(N.setRequestHeader("X-LimoniApps-AccessToken",discountNinjaContext.AccessToken),N.setRequestHeader("X-LimoniApps-Status",discountNinjaContext.Status));var j=discountNinja.LogSession.GetId();j&&N.setRequestHeader("X-LimoniApps-SessionId",j),N.onreadystatechange=function(){var l;4===N.readyState&&((l=N.status)>=200&&l<=204||l>=300&&l<=304?function(t){var i=null;try{if(null!=t){if("text"!==t.responseType&&""!==t.responseType&&"string"!=typeof t.responseText)return void discountNinja.Logging.LogVerbose("XMLHttpRequest.Send cannot handle response of type "+t.responseType);var n=t.responseText;i=o?null==n?null:JSON.parse(n):n}}catch(t){}"function"==typeof c&&null!==c&&c(i)}(N):function(l){var g="Could not "+e+" data from "+f+" on attempt "+u+". Request status: "+l+" - Parameters: "+JSON.stringify(i);discountNinja.Logging.LogWarning(g,!0,r);var p=Math.pow(2,u)*(400+100*Math.random());setTimeout((function(){discountNinja_Script_XmlHttpRequest.Send(t,i,n,e,o,r,a,c,s,u+1,d)}),p)}(l))},null===n?N.send():(N.setRequestHeader("Content-Type","application/json"),N.send(JSON.stringify(n)))}(t,i,e,o,r,c,s,u,d)}catch(i){try{discountNinja.Logging.LogToConsole("error","Error occurred in Send for url "+t+". Error: "+i)}catch(t){}try{"function"==typeof s&&null!==s&&s(i)}catch(t){}}}},discountNinja_Script_TextScaling={ReplacePxWithRem:function(t,i){for(var n,e=discountNinja.Utilities.IsMobilePhone()?i:1,o=parseFloat(getComputedStyle(document.documentElement).fontSize),r=new RegExp("font-size:(\\s)*(\\d+)(.)?(\\d+)px","g");null!==(n=r.exec(t));){var a=parseFloat(n[0].replace("px","").replace("font-size:","")),c=a/o*e,s=new RegExp("font-size:(\\s)*"+a+"px","g");t=t.replace(s,"font-size:"+c+"rem")}return t}},discountNinja_Script_DateTime={UnixTimestamp:function(){return dayjs().unix()},UtcNow:function(){return dayjs()},GetUtc:function(t){return dayjs(t)},DiffInSeconds:function(t,i){return t.diff(i,"seconds")},GetDuration:function(t,i){return dayjs.duration(t,i)},FormatDate:function(t,i){try{if(null===i||""===i)return"";var n=dayjs(t);if(i.indexOf("Do")){var e=n.format("DD");i="01"===e||"21"===e||"31"===e?i.replace("Do","D[st]"):"02"===e||"22"===e?i.replace("Do","D[nd]"):"03"===e||"23"===e?i.replace("Do","D[rd]"):i.replace("Do","D[th]")}return n.format(i)}catch(t){return discountNinja.Logging.LogError("DateTime.FormatDate",t),null}}},discountNinja_Script_LeakyBucket={Buckets:{Prefix:"bucket-",ProductLiquid:"product-liquid",ProductApi:"product-api"},Take:function(t){var i=discountNinja.Cache.SessionGet(discountNinja_Script_LeakyBucket.Buckets.Prefix+t),n=null===i||""===i?null:parseInt(i);if(null===n)return discountNinja.Logging.LogErrorMessage("LeakyBucket","Bucket "+t+" is not initialized"),!0;n=n>0?n-1:0,discountNinja.Cache.SessionSet(discountNinja_Script_LeakyBucket.Buckets.Prefix+t,n);var e=n>0;return e||discountNinja.Logging.LogInformation("LeakyBucket","Bucket "+t+" is empty"),e},Initialize:function(t,i,n){function e(t,i){discountNinja.Cache.SessionSet(discountNinja_Script_LeakyBucket.Buckets.Prefix+t,i)}e(t,n),setInterval((function(){e(t,n)}),i)}},discountNinja_Script_VariantChangedEvent={CurrentVariant:null,Handle:function(t,i){function n(){discountNinja.DynamicPricing.UpdatePrice(!0,!0),discountNinja.DiscountedProduct.CurrentVariantData&&discountNinja.Events.Publish("variant:priceavailable",{Variant:discountNinja.DiscountedProduct.CurrentVariantData})}try{if(discountNinja_Script_VariantChangedEvent.CurrentVariant==i)return;discountNinja_Script_VariantChangedEvent.CurrentVariant=i?i.toString():null,discountNinja.Logging.LogInformation("EVENT HANDLED - Variant changed - Variant: "+i),n(),discountNinja.Settings.GetFlag("VariantPriceUpdateRequiresDelay")&&(setTimeout((function(){n()}),50),setTimeout((function(){n()}),100),setTimeout((function(){n()}),500))}catch(t){discountNinja.Logging.LogError("VariantChangedEvent",t)}},Subscribe:function(){discountNinja.Events.Subscribe("VariantChanged",discountNinja_Script_VariantChangedEvent.Handle),discountNinja.Events.Subscribe("variant:changed",discountNinja_Script_VariantChangedEvent.Handle)}},discountNinja_Script_ServerCartItemsAddedEvent={Handle:function(t){try{discountNinja.Logging.LogInformation("EVENT HANDLER - Server cart items added"),discountNinja.Offer.ClearPromotionForProductCache(),discountNinja.Cart.Shopify.IsDirty=!0,discountNinja.Cart.Shopify.LockRefreshCart?discountNinja.Logging.LogInformation("EVENT HANDLER - Not processing - Cart locked"):discountNinja.Cart.Shopify.UpdateCart((function(){discountNinja.Cart.Shopify.OnUpdateCart()}))}catch(t){discountNinja.Logging.LogError("ServerCartItemsAddedEvent",t)}},Subscribe:function(){discountNinja.Events.Subscribe("ServerCartItemsAdded",discountNinja_Script_ServerCartItemsAddedEvent.Handle)}},discountNinja_Script_ServerCartItemsUpdatedEvent={Handle:function(t){try{discountNinja.Logging.LogInformation("EVENT HANDLER - Server cart items updated"),discountNinja.Offer.ClearPromotionForProductCache(),discountNinja.Cart.Shopify.IsDirty=!0,discountNinja.Cart.Shopify.LockRefreshCart?discountNinja.Logging.LogInformation("EVENT HANDLER - Not processing - Cart locked"):discountNinja.Cart.Shopify.UpdateCart((function(){discountNinja.Cart.Shopify.OnUpdateCart()}))}catch(t){discountNinja.Logging.LogError("ServerCartItemsUpdatedEvent",t)}},Subscribe:function(){discountNinja.Events.Subscribe("ServerCartItemsUpdated",discountNinja_Script_ServerCartItemsUpdatedEvent.Handle)}},discountNinja_Script_ServerCartItemsChangedEvent={Handle:function(t){try{discountNinja.Logging.LogInformation("EVENT HANDLER - Server cart items changed"),discountNinja.Offer.ClearPromotionForProductCache(),discountNinja.Cart.Shopify.IsDirty=!0,discountNinja.Cart.Shopify.LockRefreshCart?discountNinja.Logging.LogInformation("EVENT HANDLER - Not processing - Cart locked"):discountNinja.Cart.Shopify.UpdateCart((function(){discountNinja.Cart.Shopify.OnUpdateCart()}))}catch(t){discountNinja.Logging.LogError("ServerCartItemsChangedEvent",t)}},Subscribe:function(){discountNinja.Events.Subscribe("ServerCartItemsChanged",discountNinja_Script_ServerCartItemsChangedEvent.Handle)}},discountNinja_Script_ServerCollectionProductsPageLoadedEvent={Handle:function(t){try{discountNinja.Logging.LogInformation("EVENT HANDLED - Collection loaded next page of products"),setTimeout((function(){discountNinja.Events.Publish("collection:productsadded")}),500),setTimeout((function(){discountNinja.Events.Publish("collection:productsadded")}),1500)}catch(t){discountNinja.Logging.LogError("ServerCollectionProductsPageLoadedEvent",t)}},Subscribe:function(){discountNinja.Events.Subscribe("ServerCollectionProductsPageLoaded",discountNinja_Script_ServerCollectionProductsPageLoadedEvent.Handle)}},discountNinja_Script_LocalCartUpdatedEvent={Handle:function(t,i,n,e){try{if(e)return;n&&discountNinja.DiscountedCart.BuildDiscountedCart(null,!n)}catch(t){discountNinja.Logging.LogError("LocalCartUpdatedEvent",t)}},Subscribe:function(){discountNinja.Events.Subscribe("LocalCartUpdated",discountNinja_Script_LocalCartUpdatedEvent.Handle)}},discountNinja_Script_AccountLogin={CheckRedirect:function(){try{if(!discountNinja.Environment.Shopify.IsAccountPage())return;if(!(!1!==discountNinja.Settings.GetFlag("ApplyPromotionsOnRedirectLoginFromCheckout")))return;var t=window.location.href,i=discountNinja.QueryParameter.Get("checkout_url",t);if("1"===discountNinja.QueryParameter.Get("redirect_to_checkout_url",t))if("checkout"===discountNinja.Settings.GetFlag("ActionAfterRedirectLoginFromCheckout"))discountNinja.DiscountedCart.IsDirty=!0,discountNinja.DiscountedCart.BuildDiscountedCart((function(){discountNinja.Checkout.Shopify.RequiresAdvancedCheckout()?discountNinja.Events.Publish("checkout:initiate"):window.location.href=decodeURIComponent(i)}));else{var n=(o=discountNinja.Environment.Shopify.NonPrimaryLocale())?"/"+o:"";window.location.href=n+"/cart/"}else if(null!==i){var e=discountNinja.Utilities.jQuery()('form[action*="/account/login"] input[type="hidden"][name="checkout_url"]');if(e&&e.length>0){var o;n=(o=discountNinja.Environment.Shopify.NonPrimaryLocale())?"/"+o:"";e.val(n+"/account/login?redirect_to_checkout_url=1&checkout_url="+i)}}}catch(t){discountNinja.Logging.LogError("AccountLogin.Register",t)}}},discountNinja_Script_LogSession={ServerUrl:function(){return"prod"===discountNinja.Core.Environment?"5"===discountNinja.Core.ApiVersion?"https://promotioneventsapi-v5.discountninja.io":"https://promotioneventsapi-v4.discountninja.io":"https://promotioneventsapi-v4-dev.discountninja.io"},TimeToLoad:null,TimeToComplete:null,Start:function(){try{if(!0!==discountNinja.Settings.Settings.TrackSession)return;if(!discountNinja_Script_LogSession.GetId()){var t=discountNinja.Utilities.NewGuid();discountNinja.Cache.SessionSet("SessionLogId",t),discountNinja.Cache.LocalSet("SessionLogId",t);var i={SessionLogId:t,Context:{Device:discountNinja.DeviceId.Get(),Browser:function(){var t="Unknown browser";try{t=navigator.userAgent}catch(t){}return t}(),OperatingSystem:function(){var t="Unknown OS";try{t=navigator.platform}catch(t){}return t}(),PromotionToken:discountNinja.Token.GetTokenFromQueryParameter(),Host:window.host,Shop:discountNinja.Core.Shop}};discountNinja.XmlHttpRequest.Send(discountNinja_Script_LogSession.ServerUrl()+"/api/LogSessionContext",null,i,"post",!0,!1,!0,null,null,1,1)}}catch(t){discountNinja.Logging.LogError("LogSession.Start",t)}},PromotionsApplied:function(t,i,n,e){try{if(!0!==discountNinja.Settings.Settings.TrackSession)return;var o="LogSession-PromotionsApplied";if("true"===discountNinja.Cache.SessionGet(o))return;discountNinja.Cache.SessionSet(o,"true");var r="",a="";if(null!==t)for(var c=0;c<t.length;c++)r=r+t[c].Token+",";if(null!==i)for(c=0;c<i.length;c++)a=a+i[c].Token+",";var s={SessionLogId:discountNinja_Script_LogSession.GetId(),PromotionsApplied:{OfferTokens:r,TriggerTokens:a,Source:n,SourceReason:e}};discountNinja.XmlHttpRequest.Send(discountNinja_Script_LogSession.ServerUrl()+"/api/LogPromotionsApplied",null,s,"post",!0,!1,!0,null,null,1,1)}catch(t){discountNinja.Logging.LogError("LogSession.PromotionsApplied",t)}},CheckoutInitiated:function(t){try{if(!0!==discountNinja.Settings.Settings.TrackSession)return;var i={SessionLogId:discountNinja_Script_LogSession.GetId(),CheckoutInitiated:{PayLoad:JSON.stringify(t)}};discountNinja.XmlHttpRequest.Send(discountNinja_Script_LogSession.ServerUrl()+"/api/LogCheckoutInitiated",null,i,"post",!0,!1,!0,null,null,1,1)}catch(t){discountNinja.Logging.LogError("LogSession.CheckoutInitiated",t)}},CheckoutRedirect:function(t,i,n){try{if(!0!==discountNinja.Settings.Settings.TrackSession)n&&n();else{var e={SessionLogId:discountNinja_Script_LogSession.GetId(),CheckoutRedirect:{Url:t,DiscountCode:i}};discountNinja.XmlHttpRequest.Send(discountNinja_Script_LogSession.ServerUrl()+"/api/LogCheckoutRedirect",null,e,"post",!0,!1,!0,(function(){n&&n()}),(function(){n&&n()}),1,1)}}catch(t){n&&n()}},RegisterTimeToLoad:function(){try{if(null!==discountNinja_Script_LogSession.TimeToLoad)return;if(void 0===window.performance||void 0===window.performance.timing)return;discountNinja_Script_LogSession.TimeToLoad=(new Date).getTime()-window.performance.timing.navigationStart}catch(t){console.error("RegisterTimeToLoad failed",t)}},RegisterTimeToComplete:function(){try{if(null!==discountNinja_Script_LogSession.TimeToComplete)return;if(void 0===window.performance||void 0===window.performance.timing)return;discountNinja_Script_LogSession.TimeToComplete=(new Date).getTime()-window.performance.timing.navigationStart-discountNinja_Script_LogSession.TimeToLoad}catch(t){console.error("RegisterTimeToComplete failed",t)}},PrintPerformance:function(t){try{if(null!==discountNinja_Script_LogSession.TimeToComplete)return;if(void 0===window.performance||void 0===window.performance.timing)return;var i=(new Date).getTime()-window.performance.timing.navigationStart-discountNinja_Script_LogSession.TimeToLoad;discountNinja.Logging.LogPerformance&&console.log("Discount Ninja - PERFORMANCE - Time elapsed until step "+t+": "+i+"ms")}catch(t){console.error("PrintPerformance failed",t)}},LogPerformance:function(){try{if(!0!==discountNinja.Settings.Settings.TrackSession)return;if(null===discountNinja_Script_LogSession.TimeToLoad||null===discountNinja_Script_LogSession.TimeToComplete)return;var t={SessionLogId:discountNinja_Script_LogSession.GetId(),Performance:{PathName:window.location.pathname,TimeToLoad:discountNinja_Script_LogSession.TimeToLoad,TimeToComplete:discountNinja_Script_LogSession.TimeToComplete}};discountNinja.XmlHttpRequest.Send(discountNinja_Script_LogSession.ServerUrl()+"/api/LogPerformance",null,t,"post",!0,!1,!0,null,null,1,1),console.info("Discount Ninja performance: loaded after "+discountNinja_Script_LogSession.TimeToLoad+"ms and completed after another "+discountNinja_Script_LogSession.TimeToComplete+"ms")}catch(t){discountNinja.Logging.LogError("LogSession.LogPerformance",t)}},LogError:function(t){try{if(null===discountNinja.Settings.Settings||!0!==discountNinja.Settings.Settings.TrackSession)return;var i=function(){try{var t=discountNinja.Cache.SessionGet("LogError-MessagesSent");return null===t||isNaN(t)?0:parseInt(t)}catch(t){return 0}}();if(i>=5)return;!function(t){discountNinja.Cache.SessionSet("LogError-MessagesSent",t+1)}(i);var n={SessionId:discountNinja_Script_LogSession.GetId(),Exception:"Script error - "+t};discountNinja.XmlHttpRequest.Send(discountNinja_Script_LogSession.ServerUrl()+"/api/LogError",null,n,"post",!0,!1,!0,null,null,1,1)}catch(t){console.error("LogSession.LogError",t)}},GetId:function(){return discountNinja.Cache.SessionGet("SessionLogId")}},discountNinja_Script_Checkout_Shopify={RedirectingToCheckout:!1,ProcessingCheckout:!1,LoadingCheckoutPopUpId:"LimoniApps-DiscountNinja-Checkout",LoadingCheckoutPopUpMessageId:"LimoniApps-DiscountNinja-Checkout-Message",LoadingCheckoutPopUpDotsId:"LimoniApps-DiscountNinja-Checkout-Dots",FallBackEvent:null,FallbackCallback:null,FallBackTimeoutHandle:null,ProcessingPrepareAdvancedCheckout:!1,ServerUrl:function(){return"prod"===discountNinja.Core.Environment?"5"===discountNinja.Core.ApiVersion?"https://checkoutapi-v5.discountninja.io":"https://checkoutapi-v4.discountninja.io":"https://checkoutapi-v4-dev.discountninja.io"},InjectLoadingCheckoutPopUp:function(){if(null===document.getElementById(discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpId)){var t=discountNinja.Settings.Settings.Checkout,i='<div id="'+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpId+'" style="display:none;background-color:{{CHECKOUT_OVERLAY_BACKGROUND_COLOR}};" class="limoniapps-popup limoniapps-size-small limoniapps-overlay-5 limoniapps-shape-square limoniapps-align-center limoniapps-content-bottom"><div class="limoniapps-popup-vertical-alignment-helper"><div class="limoniapps-popup-vertical-align-center"><div class="limoniapps-content" style="background-color:{{CHECKOUT_BACKGROUND_COLOR}};"><div id="'+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpMessageId+'" class="limoniapps-body"></div></div></div></div></div>';i=(i=i.replace("{{CHECKOUT_BACKGROUND_COLOR}}",t.PopupBackgroundColor||"white")).replace("{{CHECKOUT_OVERLAY_BACKGROUND_COLOR}}",t.OverlayBackgroundColor||"rgba(0,0,0,0.7)");var n=discountNinja.Utilities.CreateFragment(i);document.body.insertBefore(n,document.body.childNodes[0])}},ShowLoadingCheckoutPopUp:function(t){try{if(!0===discountNinja.Settings.Settings.Checkout.HideCheckoutLoadingOverlay)return;var i=document.getElementById(discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpId);t&&function t(){try{if(discountNinja_Script_Checkout_Shopify.ProcessingCheckout){var i=document.getElementById(discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpMessageId).innerHTML,n=discountNinja.Settings.Settings.Checkout;""===i?discountNinja_Script_Checkout_Shopify.SetLoadingCheckoutPopUpMessage(n.LoadingCheckoutMessage1):i===n.LoadingCheckoutMessage1?discountNinja_Script_Checkout_Shopify.SetLoadingCheckoutPopUpMessage(n.LoadingCheckoutMessage2):i===n.LoadingCheckoutMessage2&&discountNinja_Script_Checkout_Shopify.SetLoadingCheckoutPopUpMessage(n.LoadingCheckoutMessage1),setTimeout((function(){t()}),2500)}}catch(t){discountNinja.Logging.LogError("showLoadingCheckoutMessage",t)}}(),i.style.display=t?"":"none"}catch(t){discountNinja.Logging.LogError("ShowLoadingCheckoutPopUp",t),discountNinja_Script_Checkout_Shopify.FallBack("Failure in showLoadingCheckoutPopUp")}},GetCheckoutForm:function(){return discountNinja.Utilities.jQuery()(discountNinja.Environment.Shopify.SelectorCheckoutForm())},GetCheckoutFormAction:function(){var t=discountNinja_Script_Checkout_Shopify.GetCheckoutForm();return t.length>0?t.attr("action"):null},BuildClassicCheckoutLink:function(){function t(t,i){for(var n=0;n<t.length;n++)if(t[n].Key&&t[n].Key.toLowerCase()===i.toLowerCase())return!0}var i="/checkout",n=[];try{for(var e=discountNinja_Script_Checkout_Shopify.GetCheckoutFormAction(),o=e.lastIndexOf("?"),r=e&&o>-1?e.substring(o+1).split("&"):[],a=0;a<r.length;a++)try{var c=r[a].split("=");n.push({Key:c[0],Value:c[1]})}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.FallBack","Error occurred in setting classic checkout link - cart action item "+t)}}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.FallBack","Error occurred in setting classic checkout link - cart action "+t)}try{if(!t(n,"discount")){var s=discountNinja.DiscountCode.GetFirstActiveDiscountCodeForCheckout(!0);""!==s&&n.push({Key:"discount",Value:s})}}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.FallBack","Error occurred in setting classic checkout link - discount "+t)}try{if(!t(n,"locale")){var u=discountNinja.Environment.Shopify.Locale();u&&n.push({Key:"locale",Value:u})}}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.FallBack","Error occurred in setting classic checkout link - locale "+t)}for(a=0;a<n.length;a++)i=discountNinja.QueryParameter.AppendToUrl(i,n[a].Key,n[a].Value);return i},FallBack:function(t,i){try{var n="Redirecting to standard checkout, reason: "+t;discountNinja.Logging.LogVerbose(n),discountNinja_Script_Checkout_Shopify.ShowAlert(n),function(t,i){discountNinja.Logging.LogVerbose("Redirecting to standard checkout"),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1;var n=discountNinja.Settings.Settings.Checkout;discountNinja_Script_Checkout_Shopify.SetLoadingCheckoutPopUpMessage(n.LoadingCheckoutMessage3),discountNinja_Script_Checkout_Shopify.RedirectingToCheckout=!0,setTimeout((function(){discountNinja_Script_Checkout_Shopify.ShowLoadingCheckoutPopUp(!1),discountNinja_Script_Checkout_Shopify.RedirectingToCheckout=!1,discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1}),2e3),"true"===discountNinja.Cache.SessionGet("RedirectToCheckoutOnFallBack")||!0===discountNinja.Settings.GetFlag("RedirectToCheckoutOnFallBack")?discountNinja_Script_Checkout_Shopify.RedirectToStandardCheckoutFallback(t):discountNinja_Script_Checkout_Shopify.FallbackCallback?discountNinja.LogSession.CheckoutRedirect("FallbackCallback",i,(function(){discountNinja_Script_Checkout_Shopify.FallbackCallback()})):discountNinja_Script_Checkout_Shopify.FallBackEvent?discountNinja.LogSession.CheckoutRedirect("FallBackEvent",i,(function(){var i=discountNinja_Script_Checkout_Shopify.FallBackEvent.originalEvent||discountNinja_Script_Checkout_Shopify.FallBackEvent;if(i)try{var n=new i.constructor(i.type,i);i.target.dispatchEvent(n)}catch(i){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.FallBack","Could not replay original event - "+i),discountNinja_Script_Checkout_Shopify.RedirectToStandardCheckoutFallback(t)}else discountNinja_Script_Checkout_Shopify.RedirectToStandardCheckoutFallback(t)})):discountNinja_Script_Checkout_Shopify.RedirectToStandardCheckoutFallback(t)}(discountNinja_Script_Checkout_Shopify.BuildClassicCheckoutLink(),i)}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.FallBack","Failed "+t),discountNinja_Script_Checkout_Shopify.RedirectToStandardCheckoutFallback("/checkout")}},RedirectToStandardCheckoutFallback:function(t){try{discountNinja.Logging.LogVerbose("Redirecting to standard checkout in fallback mode"),discountNinja_Script_Checkout_Shopify.ShowAlert("Redirecting to standard checkout in fallback mode"),discountNinja_Script_Checkout_Shopify.RedirectingToCheckout=!0,discountNinja.LogSession.CheckoutRedirect(t,null,(function(){window.location.href=t}))}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.RedirectToStandardCheckoutFallback","Failed "+t)}},RedirectToCheckout:function(t,i,n,e,o){try{var r=i&&""!==i,a=r&&"standard"===i,c=!r&&e&&""!==e;if((t+=1)<4)if(r&&!a||c){c?discountNinja.Logging.LogVerbose("Redirecting to standard checkout with discount code: "+e):discountNinja.Logging.LogVerbose("Redirecting to checkout url: "+i),c&&(discountNinja.Cache.SessionSet("CheckoutDiscountCode",e),discountNinja.Cache.SessionSet("CheckoutDiscountCodeCanceled",!1));var s=discountNinja.Settings.Settings.Checkout;discountNinja_Script_Checkout_Shopify.SetLoadingCheckoutPopUpMessage(s.LoadingCheckoutMessage3),setTimeout((function(){discountNinja_Script_Checkout_Shopify.ShowLoadingCheckoutPopUp(!1),discountNinja_Script_Checkout_Shopify.RedirectingToCheckout=!1,discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1}),2e3),null!==discountNinja_Script_Checkout_Shopify.FallBackTimeoutHandle&&(clearTimeout(discountNinja_Script_Checkout_Shopify.FallBackTimeoutHandle),discountNinja_Script_Checkout_Shopify.FallBackTimeoutHandle=null),discountNinja_Script_Checkout_Shopify.RedirectingToCheckout=!0,discountNinja.LogSession.CheckoutRedirect(i,e,(function(){c?(discountNinja.DiscountCode.InjectDiscountCodesInHtmlElements(e,!1),discountNinja_Script_Checkout_Shopify.FallBack("Call to checkout api determined a discount code should be used",e)):(!1!==discountNinja.Settings.GetFlag("RepairLinksAtCheckout")&&(i+="&add_links=1",window.discountNinjaContext.Labels.Cart&&(i=i+"&cart_label="+window.discountNinjaContext.Labels.Cart)),discountNinja_Script_Checkout_Shopify.ShowAlert("Redirecting to checkout: "+i),window.location.href=i)}))}else{var u=Math.pow(2,t)*(100+100*Math.random());setTimeout((function(){discountNinja_Script_Checkout_Shopify.GetCheckoutUrlFromServer(t,discountNinja_Script_Checkout_Shopify.RedirectToCheckout,!1)}),u)}else a?(!0===n&&(discountNinja.Logging.LogVerbose("Call to checkout api determined no discount is required"),discountNinja.DiscountCode.UndoInjectDiscountCodesInHtml()),discountNinja_Script_Checkout_Shopify.FallBack("Call to checkout api determined the standard checkout should be used")):discountNinja_Script_Checkout_Shopify.FallBack("Attempts exhausted. No valid checkout url received")}catch(t){discountNinja.Logging.LogErrorMessage("Checkout.Shopify.RegisterEventHandlerForCheckout.onSuccess","Could not redirect to new checkout url, attempting to redirect to standard url: "+t),discountNinja_Script_Checkout_Shopify.FallBack("Error in processing onSuccess")}},GetCheckoutUrlFromServer:function(t,i,n){function e(e){var o=e&&e.InvoiceUrl?e.InvoiceUrl:null,r=e&&e.NoDiscount?e.NoDiscount:null,a=e&&e.DiscountCode?e.DiscountCode:null,c=e&&e.CacheId?e.CacheId:null,s=e&&e.DraftOrderId?e.DraftOrderId:null;if(n){var u={CheckSum:discountNinja.DiscountedCart.CheckSum(),ExpiresOn:null===o?(new Date).getTime()+3e5:(new Date).getTime()+9e4,Url:o,DiscountCode:a,NoDiscount:r,DraftOrderId:s};discountNinja.Cache.SessionSet("discounted-cart-checkoutlink",JSON.stringify(u))}else c&&(discountNinja.Cache.LocalSet("CheckoutId",c),discountNinja.Cache.LocalSet("AccessToken",discountNinjaContext.AccessToken),discountNinja.Cache.LocalSet("Status",discountNinjaContext.Status));i&&i(t,o,r,a,c)}function o(t){n||(discountNinja.Logging.LogErrorMessage("Checkout.Shopify.RegisterEventHandlerForCheckout.onFailure","Call to DraftOrder Api failed, attempting to redirect to standard url: "+t),discountNinja_Script_Checkout_Shopify.FallBack("Call to Checkout Api failed"))}discountNinja.LogSession.CheckoutInitiated(u),discountNinja.Logging.LogVerbose("Posting to /api/GetCheckoutUrl with query parameters: "+JSON.stringify(s)+" and payload: "+JSON.stringify(u)),discountNinja.Logging.LogVerbose("Getting checkout URL, attempt "+t);var r=discountNinja_Script_Checkout_Shopify.GetCachedPreparedData(),a=null!==r&&(r.Url||r.DiscountCode);if(discountNinja.Cache.SessionRemove("discounted-cart-checkoutlink"),a&&"5"===discountNinja.Core.ApiVersion){var c=discountNinja.DiscountedCart.GetAppliedPromotions();s=function(){try{for(var t=discountNinja.DeviceId.Get(),i=[],n=0;n<c.length;n++)i.push(c[n].TriggerToken);var e={shop:discountNinja.Core.Shop,m:t+"-"+discountNinja.DateTime.UnixTimestamp(),deviceId:t,triggerTokens:i.join(","),f:"7.4"};return"undefined"!=typeof draftOrderId&&isNaN(draftOrderId)&&(e.draftOrderId=draftOrderId),e}catch(t){return discountNinja.Logging.LogError("BuildLogCheckoutInitiatedParameters",t),null}}(r.DraftOrderId);discountNinja.XmlHttpRequest.Send(discountNinja_Script_Checkout_Shopify.ServerUrl()+"/api/LogCheckoutInitiated",s,null,"get",!0,!0,!0,(function(){e({InvoiceUrl:r.Url,NoDiscount:r.NoDiscount,DiscountCode:r.DiscountCode})}),o,1,1)}else{var s=function(t){try{var i=discountNinja.DeviceId.Get(),n={shop:discountNinja.Core.Shop,m:i+"-"+discountNinja.DateTime.UnixTimestamp(),version:discountNinja.Core.Version,prepareOnly:1==t,host:window.location.host,f:"7.4"};return discountNinja.TestMode.TestMode&&(n.testMode=!0,n.testModeToken=discountNinja.TestMode.TestModeToken),n}catch(t){return discountNinja.Logging.LogError("BuildGetCheckoutUrlParameters",t),null}}(n),u=discountNinja_Script_Checkout_Shopify.BuildPayLoad();u&&u.LineItems&&u.LineItems.length>0?discountNinja.XmlHttpRequest.Send(discountNinja_Script_Checkout_Shopify.ServerUrl()+"/api/GetCheckoutUrl",s,u,"post",!0,!0,!0,e,o,1,3):(discountNinja.Logging.LogVerbose("Abandoning getting checkout URL because payload is empty"),o(null))}},ShowAlert:function(t){try{discountNinja.Logging.Tracing&&alert(t)}catch(t){}},SetLoadingCheckoutPopUpMessage:function(t){try{var i='<div id="'+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpDotsId+'"></div>';document.getElementById(discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpMessageId).innerHTML=t+i}catch(t){discountNinja.Logging.LogError("SetLoadingCheckoutPopUpMessage",t)}},RegisterEventHandlerForCheckout:function(){function t(t){try{return void 0!==t&&t&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.returnValue=!1,!1===t.defaultPrevented&&(t.preventDefault=function(){Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}})},t.preventDefault())),t}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.cancelDefaultBehaviorEvent",t)}}function i(t){try{discountNinja_Script_Checkout_Shopify.RequiresAdvancedCheckout()?(discountNinja_Script_Checkout_Shopify.ShowLoadingCheckoutPopUp(!0),discountNinja_Script_Checkout_Shopify.FallBackTimeoutHandle=setTimeout((function(){discountNinja.Logging.LogErrorMessage("Checkout.Shopify.RegisterEventHandlerForCheckout.onCheckoutViaButtonInner","Timed out, redirecting to standard checkout"),discountNinja_Script_Checkout_Shopify.FallBack("Timeout",t)}),3e4),discountNinja_Script_Checkout_Shopify.GetCheckoutUrlFromServer(1,discountNinja_Script_Checkout_Shopify.RedirectToCheckout,!1)):discountNinja_Script_Checkout_Shopify.FallBack("No advanced checkout required",t)}catch(t){discountNinja.Logging.LogErrorMessage("Checkout.Shopify.RegisterEventHandlerForCheckout.onCheckoutViaButtonInner",t),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1}}function n(t){try{return!!function(t){try{var i=null===t?null:discountNinja.Utilities.jQuery()(t.currentTarget).parents(discountNinja.Environment.Shopify.SelectorCheckoutForm());return null===i&&discountNinja.Utilities.jQuery()(discountNinja.Environment.Shopify.SelectorCheckoutForm()),!!(i&&(function(t){var i=discountNinja.Settings.Settings.PriceUpdate.Mode.MandatoryCheckboxes;null!=i&&""!==i||(i=discountNinja.Settings.GetFlag("MandatoryCheckboxes"));i&&""!==i&&discountNinja.Utilities.jQuery()(t).find(i).addClass("limoniapps-discountninja-checkout-checkbox")}(i),discountNinja.Utilities.jQuery()(i).find(".limoniapps-discountninja-checkout-checkbox:not(:checked), .my-terms-conditions-fy:not(.limoniapps-discountninja-ignore) input[required]:visible:checkbox:not(:checked), input[required].tos_agree:visible:checkbox:not(:checked), input#agree:visible:checkbox:not(:checked), input#effectiveAppsAgreeCB:visible:checkbox:not(:checked)").length>0))&&(discountNinja.Logging.LogWarning("Abandon checkout because required checkbox(es) is/are not checked",!0),!0)}catch(t){return discountNinja.Logging.LogErrorMessage("Checkout.Shopify.TermsAndConditionsCheckboxesNotChecked - Could not verify status",t),!1}}(t)||!!function(t){try{return"undefined"!=typeof Zapiet&&"object"==typeof Zapiet.Widget&&"function"==typeof Zapiet.Widget.checkoutEnabled&&!Zapiet.Widget.checkoutEnabled()}catch(t){return discountNinja.Logging.LogErrorMessage("Checkout.Shopify.ZapietNotReady - Failed",t),!1}}()}catch(t){return discountNinja.Logging.LogErrorMessage("Checkout.Shopify.MandatoryCheckoutPrerequisitesNotComplete - Could not verify status",t),!1}}function e(e,o){try{if(discountNinja_Script_Checkout_Shopify.ProcessingCheckout)return!1;if(discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!0,n(e))return discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1,null;discountNinja_Script_Checkout_Shopify.FallBackEvent=o?null:e,e=t(e);try{discountNinja.Cart.Shopify.IsDirty=!0,discountNinja.Cart.Shopify.UpdateCart((function(){try{discountNinja.Trigger.EnsureInitialPromotionsTriggered((function(){discountNinja.DiscountedCart.BuildDiscountedCart((function(){i(e)}))}))}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.onCheckoutViaButtonAfterUpdateCart",t),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1,discountNinja_Script_Checkout_Shopify.FallBack("Build discounted cart failed")}}),!0)}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.onCheckoutViaButtonAfterTimeout",t),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1,discountNinja_Script_Checkout_Shopify.FallBack("UpdateCart failed")}return e}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.onCheckoutViaButton",t),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1}}function o(t,i){try{if(null!==t&&t.currentTarget.classList.contains("limoniapps-discountninja-ignore"))return}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.HandleClickCheckoutButton",t)}if(!discountNinja_Script_Checkout_Shopify.RedirectingToCheckout&&!1===e(t,i))return!1}function r(i,n){try{if(n.hasClass("limoniapps-discountninja-ignore"))return;if(function(t){var i=discountNinja.Environment.Shopify.SelectorCheckoutButton();return discountNinja.Utilities.jQuery()(t).is(i)}(n)&&(discountNinja_Script_Checkout_Shopify.ShowAlert("Discount Ninja checkout initiated via submit on form (checkout button)"),discountNinja_Script_Checkout_Shopify.ProcessingCheckout&&!discountNinja_Script_Checkout_Shopify.RedirectingToCheckout)){if(!0===discountNinja.Settings.GetFlag("AllowCancelCheckoutByForm"))return t(i),!1;discountNinja.Logging.LogError("Checkout","Submit should be stopped, Discount Ninja checkout not processed yet. Set flag AllowCancelCheckoutByForm to true",!0)}}catch(i){}}function a(t){try{for(var i in t)i.startsWith("on")&&null!=t[i]&&(t[i]=null);for(var i of t.limoniAppsDiscountNinjaAllHandlers||[])t.removeEventListener(i.typ,i.fn,i.opt)}catch(t){discountNinja.Logging.LogError("Checkout.RemoveEventsFromElement",t)}}function c(i){var n=function(i){if(!1===function(i){try{return discountNinja.Environment.Shopify.IsProductPage()?(i=t(i),!discountNinja.BuyNow.CheckOutSelectedVariant(i)):(discountNinja.Logging.LogWarning("HandleClickBuyNowButton expects to be executed on a product page",!0),null)}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.HandleClickBuyNowButton",t),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1}}(i))return!1},e=discountNinja.Utilities.jQuery();i.each((function(t,i){e(i).on("click.discountninja",n),e(i).attr("data-limoniapps-discountninja-buynowbutton",""),e(i).attr("data-limoniapps-discountninja-info","original click event handler removed and replaced by Discount Ninja handler")}))}function s(t){if(!1===o(t))return!1}function u(){try{if(!discountNinja.Settings.Settings)return;var t=discountNinja_Script_Checkout_Shopify.GetCheckoutForm().not(".limoniapps-discountninja-ignore");if(t&&t.length>0&&(t.off(".discountNinja.checkout"),t.each((function(){!0!==this.discountNinjaClickEventBound&&(this.discountNinjaClickEventBound=!0,this.addEventListener("click",(function(t){discountNinja.Utilities.jQuery()(this).data("discountninja-clicked",discountNinja.Utilities.jQuery()(event.target))})))})),t.each((function(){!0!==this.discountNinjaSubmitEventBound&&(this.discountNinjaSubmitEventBound=!0,this.addEventListener("submit",(function(t){if(!1===r(t,discountNinja.Utilities.jQuery()(this).data("discountninja-clicked")))return!1})))}))),!0===discountNinja.Settings.GetFlag("HandleBuyNowButtons")&&discountNinja.Environment.Shopify.IsProductPage()){var i=discountNinja.Environment.Shopify.SelectorsBuyNowButton(),n=discountNinja.Utilities.jQuery()(i.join(",")).not(".limoniapps-discountninja-ignore");n&&n.length>0&&(!function(t){try{var i=discountNinja.Utilities.jQuery();t.each((function(t,n){try{void 0===i(n).attr("data-limoniapps-discountninja-buynowbutton")&&a(n)}catch(t){discountNinja.Logging.LogError("Checkout.RemoveClickEventsForBuyNowButtons",t)}}))}catch(t){discountNinja.Logging.LogError("Checkout.RemoveClickEventsForBuyNowButtons",t)}}(n),c(n=discountNinja.Utilities.jQuery()(i.join(",")).not(".limoniapps-discountninja-ignore")),discountNinja.PromotionFlow.ShowBuyNowButtons())}var e=null,u=(i=discountNinja.Environment.Shopify.SelectorCheckoutButton(),discountNinja.Utilities.jQuery()(i).not(".limoniapps-discountninja-ignore"));if(0===u.length){try{discountNinja.Environment.Shopify.IsCartPage()&&discountNinjaContext&&discountNinjaContext.Cart&&discountNinjaContext.Cart.items&&discountNinjaContext.Cart.items.length>0&&discountNinja.Logging.LogWarning('Could not find checkout button, check if a submit button with the "name" attribute set to "checkout" exists')}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckoutInner",t)}(e=discountNinja.Environment.Shopify.SelectorCheckoutButtonAlternative().not(".limoniapps-discountninja-ignore")).addClass("limoniapps-discountninja-checkoutbutton")}else e=u;e&&e.length>0&&(g=e,p=!0===discountNinja.Settings.GetFlag("RemoveThirdPartyEventsFromCheckoutButtons"),g.each((function(t,i){p&&a(i),discountNinja.Utilities.jQuery()(i).off("click.discountninja").on("click.discountninja",s)})));var d=discountNinja.Utilities.jQuery()(discountNinja.Environment.Shopify.SelectorCheckoutLink()).not(".limoniapps-discountninja-ignore");d&&d.length>0&&function(t){var i=function(t){if(!1===o(t,!0))return!1};t.each((function(){discountNinja.Utilities.jQuery()(this).off("click.discountninja").on("click.discountninja",i),this.href&&(this.href="javascript:void(0)"),this.setAttribute("data-limoniapps-discountninja-checkoutlink",""),this.setAttribute("data-limoniapps-discountninja-info","href to checkout replaced by Discount Ninja with click event")})),document.addEventListener("click",(function(t){(t.target||t.srcElement).hasAttribute("data-limoniapps-discountninja-checkoutlink")&&i(t)}))}(d);var l=discountNinja.Utilities.jQuery()(discountNinja.Environment.Shopify.SelectorCheckoutButtonViaOnClick()).not(".limoniapps-discountninja-ignore");l&&l.length>0&&function(t){t.off(".discountNinja.checkout"),t.each((function(){var t=discountNinja.Utilities.jQuery()(this)[0];t.onclick&&(discountNinja_Script_Checkout_Shopify.FallbackCallback=t.onclick,t.onclick=null),discountNinja.Utilities.jQuery()(this).off("click.discountninja").on("click.discountninja",(function(t){if(!1===o(t))return!1}))}))}(l)}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckoutInner",t)}var g,p}u(),setTimeout((function(){u()}),500),setTimeout((function(){u()}),1500),setTimeout((function(){u()}),3e3),discountNinja.Events.Subscribe("checkout:initiate",(function(){discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1,e(null,!0)}))},RequiresAdvancedCheckout:function(){try{if(null===discountNinja.Settings||null===discountNinja.Settings.Settings)return!1;var t=discountNinja.DiscountedCart.GetAppliedPromotions(),i=discountNinja.DiscountedCart.HasFreeShipping();return!discountNinja.LiquidData.HasSubscriptionProducts()&&function(t,i){var n=null===t?0:t.length;return!(0===n&&!i||1===n&&!i&&t[0].PriceRuleId>-1)}(t,i)}catch(t){discountNinja.Logging.LogError("RequiresAdvancedCheckout",t)}},BuildPayLoadLogEvent:function(){try{return function(){try{return{DiscountCodes:discountNinja.DiscountedCart.GetAppliedPromotions(),DeviceId:discountNinja.DeviceId.Get()}}catch(t){return discountNinja.Logging.LogError("BuildPayLoad.BuildPayLoadLogEvent",t),null}}()}catch(t){return discountNinja.Logging.LogError("BuildPayLoadLogEvent",t),null}},BuildPayLoad:function(){function t(){try{var t=[],i=discountNinja.DiscountedCart.DiscountedCart&&discountNinja.DiscountedCart.DiscountedCart.items?discountNinja.DiscountedCart.DiscountedCart.items:null;if(i&&i.length>0)for(var n=0;n<i.length;n++)t.push({Quantity:i[n].Line.QuantityDiscounted+i[n].Line.QuantityNotDiscounted,VariantId:i[n].Product.VariantId,ProductHandle:i[n].Product.ProductHandle,OfferToken:i[n].OfferToken,TriggerToken:i[n].TriggerToken,Properties:i[n].Properties,LineItemKey:i[n].Key,ProductId:i[n].Product.ProductId,ProductTitle:i[n].Product.Title,ProductTags:i[n].Product.Tags,ProductCollections:i[n].Product.Collections,VariantCompareAtPrice:i[n].Product.OriginalCompareAtPrice,VariantPrice:i[n].Product.OriginalPrice});return t}catch(t){return null}}function i(){try{var t=[],i=window.discountNinjaContext&&window.discountNinjaContext.Cart?window.discountNinjaContext.Cart.attributes:null;if(null===i)return null;for(var n in i)t.push({Name:n,Value:i[n]});var e=discountNinja.Utilities.jQuery()('form [name^="attributes"]');if(e)for(var o=0;o<e.length;o++){for(var r=e[o],a=discountNinja.Utilities.jQuery()(r).attr("name"),c=a.replace("attributes[","").replace("]",""),s=!1,u=0;u<t.length;u++)if(t[u].Name===c){s=!0;break}var d=null;if(d="checkbox"===discountNinja.Utilities.jQuery()(r).attr("type")?discountNinja.Utilities.jQuery()('form [name="'+a+'"]:checked').val():discountNinja.Utilities.jQuery()('form [name="'+a+'"]').val(),s){for(u=0;u<t.length;u++)if(t[u].Name===c){t[u].Value=d;break}}else t.push({Name:c,Value:d})}return t}catch(t){return null}}function n(){try{var t=discountNinja_Script_Checkout_Shopify.GetCheckoutFormAction();"string"==typeof t&&null!==t||(t=""),t=t.replace(/(.)*\/cart\?/,"").replace(/(.)*\/cart/,"");var i=function(){try{var t=[];return t=function(t,i){try{var n=t.split("=");2===n.length&&i.push({Name:n[0],Value:n[1]})}catch(t){}return i}(discountNinja.Cookie.GetCookie("_shopify_ga"),t)}catch(t){return null}}();if(i&&i.length>0)for(var n=0;n<i.length;n++){var e=i[n];t=discountNinja.QueryParameter.AppendToUrl(t,e.Name,e.Value,!1,!0)}return""===t?null:t}catch(t){return null}}function e(){try{var t=discountNinja_Script_Checkout_Shopify.GetCheckoutForm().find('[name="note"]').val();return void 0===t?null:t}catch(t){return null}}function o(){try{return discountNinjaContext.Cart.token}catch(t){return null}}try{return function(){try{return{LineItems:t(),DiscountCodes:discountNinja.DiscountedCart.GetAppliedPromotions(),NoteAttributes:i(),DeviceId:discountNinja.DeviceId.Get(),CartAction:n(),Note:e(),Currency:discountNinjaContext.PresentmentCurrency,Locale:discountNinja.Environment.Shopify.Locale(),Referrer:discountNinja.Cache.SessionGet("OriginalReferrer"),CartToken:o()}}catch(t){return discountNinja.Logging.LogError("BuildPayLoad.BuildOrderDetailsJson",t),null}}()}catch(t){return discountNinja.Logging.LogError("Checkout.BuildPayLoad",t),null}},GetCachedPreparedData:function(){try{var t=discountNinja.Cache.SessionGet("discounted-cart-checkoutlink");if(t){var i=null;try{i=JSON.parse(t)}catch(t){}if(null!==i&&i.CheckSum===discountNinja.DiscountedCart.CheckSum()&&i.ExpiresOn>(new Date).getTime())return i}return null}catch(t){return discountNinja.Logging.LogError("Checkout.CachedPreparedData",t),null}},PrepareAdvancedCheckoutDebounced:function(){try{if(discountNinja_Script_Checkout_Shopify.ProcessingPrepareAdvancedCheckout)return;discountNinja_Script_Checkout_Shopify.ProcessingPrepareAdvancedCheckout=!0,discountNinja.Cart.Shopify.UpdateCart((function(){discountNinja.Trigger.EnsureInitialPromotionsTriggered((function(){discountNinja.DiscountedCart.BuildDiscountedCart((function(){discountNinja.DiscountedCart.HasAppliedPromotions()&&function(){try{var t=null!==discountNinja_Script_Checkout_Shopify.GetCachedPreparedData(),i=!0===discountNinja.Settings.GetFlag("SkipPrepareCheckout");t||i||setTimeout((function(){discountNinja_Script_Checkout_Shopify.GetCheckoutUrlFromServer(1,null,!0)}),500),discountNinja_Script_Checkout_Shopify.ProcessingPrepareAdvancedCheckout=!1}catch(t){discountNinja.Logging.LogError("PrepareAdvancedCheckout_Inner",t)}}()}))}))}))}catch(t){discountNinja.Logging.LogError("PrepareAdvancedCheckoutDebounced",t)}},PrepareAdvancedCheckout:discountNinja_Script_Utilities.Debounce((function(){discountNinja_Script_Checkout_Shopify.PrepareAdvancedCheckoutDebounced()}),1e3,!1)},discountNinja_Script_Environment_Shopify={MyShopifyDomain:function(t){var i="";try{var n="undefined"!=typeof discountNinjaContext&&discountNinjaContext?discountNinjaContext.Shop:null,e="undefined"!=typeof Shopify&&Shopify?Shopify.shop:null;i=n||e}catch(t){discountNinja.Logging.LogError("Environment.Shopify.MyShopifyDomain",t)}try{return null!=i&&""!==i||(i=window.top.location.hostname,t||(i&&i.endsWith(".myshopify.com")?discountNinja.Logging.LogWarning("GetMyShopifyDomain could not find domain from Shopify.shop or context. Falling back to hostname",!0):discountNinja.Logging.LogErrorMessage("Environment.Shopify.MyShopifyDomain","GetMyShopifyDomain could not retrieve domain from Shopify.shop property or context. URL hostname is "+i+"."))),i}catch(t){discountNinja.Logging.LogError("Environment.Shopify.MyShopifyDomain",t)}},SelectorCartLink:function(){return'a[href^="/cart"],a[href^="/'+discountNinja_Script_Environment_Shopify.Locale()+'/cart"]'},SelectorCheckoutLink:function(){return'a[href^="/checkout"],a[href^="/'+discountNinja_Script_Environment_Shopify.Locale()+'/checkout"],a[href$="/checkout"],[data-limoniapps-discountninja-checkoutlink]'},SelectorCheckoutButton:function(){return'.limoniapps-discountninja-checkoutbutton, input[type="submit"][name="checkout"], button[type="submit"][name="checkout"], input[type="submit"][value="checkout"], input[type="submit"][value="check out"], input[type="submit"][value="Checkout"], input[type="submit"][value="CheckOut"], input[type="submit"][value="Check Out"], input[type="submit"][value="Check out"], input[type="submit"][value="CHECK OUT"], input[type="submit"][value="CHECKOUT"], button[type="submit"][value="checkout"], button[type="submit"][value="check out"], button[type="submit"][value="Checkout"], button[type="submit"][value="CheckOut"], button[type="submit"][value="Check Out"], button[type="submit"][value="Check out"], button[type="submit"][value="CHECK OUT"], button[type="submit"][value="CHECKOUT"], button[name="icartCheckout"]'},SelectorCheckoutButtonAlternative:function(){var t='input[name="checkout"], button[name="checkout"], input[type="submit"], button[type="submit"]',i=discountNinja.Utilities.jQuery()(discountNinja_Script_Environment_Shopify.SelectorCheckoutForm()).find(t);return i&&i.length>0?i:discountNinja.Utilities.jQuery()(".limoniapps-discountninja-cart-root, .limoniapps-discountninja-drawercart-root").find(t)},SelectorCheckoutButtonViaOnClick:function(){return'button[onclick*="/checkout"]'},SelectorCheckoutForm:function(){var t=discountNinja_Script_Environment_Shopify.Locale();return'form[action^="/cart"]:not([action^="/cart/"]), form[action^="/'+t+'/cart"]:not([action^="/'+t+'/cart/"]), form[action^="/checkout"], form[action^="/'+t+'/checkout"], .limoniapps-discountninja-checkoutform'},SelectorVariantIdInCartStrict:function(){for(var t=discountNinja_Script_Environment_Shopify.SelectorAddToCartForm().split(","),i=[],n=0;n<t.length;n++)i.push(t[n]+" [name^='id']");return i.join(",")},SelectorVariantIdInCart:function(){return"form [name^='id']"},SelectorAddToCartForm:function(){return"form[action^='/cart/add'],form[action^='/"+discountNinja_Script_Environment_Shopify.Locale()+"/cart/add']"},SelectorAddToCartButton:function(){return':submit[name="add"]'},SelectorQuantity:function(){return'[name="quantity"]'},SelectorsAcceleratedCheckoutButton:function(){return[".additional-checkout-buttons",".additional-checkout-button",'[data-shopify="dynamic-checkout-cart"]',".paypal-buttons",".limoniapps-discountninja-hide"]},SelectorsBuyNowButtonWrapper:function(){return[".shopify-payment-button",'[data-shopify="payment-button"]',".limoniapps-discountninja-buynowbutton"]},SelectorsBuyNowButton:function(){return[".shopify-payment-button",'[data-shopify="payment-button"]',".shopify-payment-button__more-options",".shopify-payment-button button",'[data-shopify="payment-button"] button','.shopify-payment-button [role="button"]','[data-shopify="payment-button"] [role="button"]',".limoniapps-discountninja-buynowbutton"]},IETFLocaleProperCase:function(t){try{var i=t.split("-");return i[0].toLowerCase()+(i.length>1?"-"+i[1].toUpperCase():"")}catch(t){return null}},Locale:function(t){function i(t,i){try{return!0===i?t.toLowerCase():discountNinja_Script_Environment_Shopify.IETFLocaleProperCase(t)}catch(i){return discountNinja.Logging.LogError("Environment.Shopify.returnProperCase",i),t}}try{var n="object"==typeof Shopify?Shopify.locale:null;if(n)return i(n,t);var e=discountNinja.QueryParameter.Get("locale");return e?i(e,t):null}catch(t){return null}},NonPrimaryLocale:function(){try{var t=discountNinja_Script_Environment_Shopify.Locale();return t=t===(discountNinjaContext.PrimaryLocale||"en")?"":t,discountNinja_Script_Environment_Shopify.IETFLocaleProperCase(t)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.NonPrimaryLocale",t),null}},UrlPath:function(){try{return discountNinja_Script_Environment_Shopify.TrimmedPathName().toLowerCase()}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.UrlPath",t),""}},IsSearchPage:function(){try{var t=discountNinja_Script_Environment_Shopify.UrlPath(),i=discountNinja_Script_Environment_Shopify.Locale(!0);return"/search"===t||t==="/"+i+"/search"}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.IsSearchPage",t),!1}},IsAccountPage:function(){try{return null!==discountNinja_Script_Environment_Shopify.UrlPath().match(/\/account[\/]?/)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.IsAccountPage",t),!1}},IsCartPage:function(){try{var t=discountNinja_Script_Environment_Shopify.UrlPath(),i=discountNinja_Script_Environment_Shopify.Locale(!0);return"/cart"===t||t==="/"+i+"/cart"}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.IsCartPage",t),!1}},IsProductPage:function(){try{return null!==discountNinja_Script_Environment_Shopify.UrlPath().match(/\/products\//)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.IsProductPage",t),!1}},IsCollectionPage:function(){try{return null!==discountNinja_Script_Environment_Shopify.UrlPath().match(/(\/collections[\/]?(?!.*\/products\/))/)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.IsCollectionPage",t),!1}},IsHomePage:function(){try{var t=discountNinja_Script_Environment_Shopify.UrlPath(),i=discountNinja_Script_Environment_Shopify.Locale(!0);return""===t||"/"===t||t==="/"+i}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.IsHomePage",t),!1}},IsBlogPost:function(){try{return discountNinja_Script_Environment_Shopify.UrlPath().indexOf("/blogs/")>-1}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.IsBlogPost",t),!1}},IsCustomPage:function(){var t=discountNinja_Script_Environment_Shopify;return!(t.IsBlogPost()||t.IsCartPage()||t.IsCatalogPage()||t.IsCollectionPage()||t.IsHomePage()||t.IsProductPage()||t.IsSearchPage())},IsCatalogPage:function(){try{return discountNinja_Script_Environment_Shopify.IsCollectionPage()&&"all"===discountNinja_Script_Environment_Shopify.CollectionHandle().toLowerCase()}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.IsCatalogPage",t),!1}},BlogHandle:function(){try{var t=discountNinja_Script_Environment_Shopify.TrimmedPathName(),i=t.indexOf("/blogs/");if(-1===i)return null;var n=t.indexOf("/",i+1);if(-1===n)return null;var e=t.indexOf("/",n+1);return-1===e?t.substr(n+1):t.substr(n+1,e-n-1)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.BlogHandle",t),null}},BlogPostHandle:function(){try{var t=discountNinja_Script_Environment_Shopify.TrimmedPathName(),i=t.indexOf("/blogs/");if(-1===i)return null;var n=t.indexOf("/",i+1);if(-1===n)return null;var e=t.indexOf("/",n+1);return-1===e?null:t.substr(e+1)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.BlogPostHandle",t),null}},CollectionHandle:function(){try{var t=discountNinja_Script_Environment_Shopify.UrlPath();if(t.indexOf("/collections/")<0)return"";var i=(t=t.replace("/collections/","")).indexOf("/");return i<0?t:t.substr(0,i)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.CollectionHandle",t),""}},PageType:function(){return discountNinja_Script_Environment_Shopify.IsProductPage()?"product":discountNinja_Script_Environment_Shopify.IsCollectionPage()?"collection":discountNinja_Script_Environment_Shopify.IsHomePage()?"home":discountNinja_Script_Environment_Shopify.IsCartPage()?"cart":discountNinja_Script_Environment_Shopify.IsBlogPost()?"blogpost":discountNinja_Script_Environment_Shopify.IsCustomPage()?"custom":void 0},VariantId:function(){function t(){try{var t=document.querySelector(discountNinja_Script_Environment_Shopify.SelectorVariantIdInCartStrict());null!==t&&0===t.length&&(t=document.querySelector(discountNinja_Script_Environment_Shopify.SelectorVariantIdInCart()));var i=null;if(null!==t&&"object"==typeof t.options&&"number"==typeof t.selectedIndex&&void 0!==t.options[t.selectedIndex]?i=t.options[t.selectedIndex].value:null!==t&&"string"==typeof t.value&&(i=t.value),null!=i&&""!==i&&0!==i&&!isNaN(i)){var n=discountNinja.Utilities.GetNumberFromHtmlFragment(i);if(null!==discountNinja_Script_LiquidData.VariantInfoFromLiquid(n))return discountNinja.Logging.LogVerbose("Returning variant from form: "+i),n}return null}catch(t){discountNinja.Logging.LogError("Environment.Shopify.VariantId.FindInForm",t,!1)}}function i(){try{var t=discountNinja.QueryParameter.Get("variant");if(null!=t&&""!==t){var i=t;if(null!==discountNinja_Script_LiquidData.VariantInfoFromLiquid(i))return discountNinja.Logging.LogVerbose("Returning variant from query parameter: "+t),i}return null}catch(t){discountNinja.Logging.LogError("Environment.Shopify.VariantId.FindInQuery",t,!1)}}if(!discountNinja_Script_Environment_Shopify.IsProductPage())return null;var n=!0;!0===discountNinja.Settings.GetFlag("VerifyVariantUsingQuery")&&(n=!1);var e=(n?t()||i():i()||t())||function(){try{var t=discountNinja.LiquidData.ProductDefaultVariantId();if(null!=t&&""!==t)return discountNinja.Logging.LogVerbose("Returning variant from liquid: "+t),t}catch(t){discountNinja.Logging.LogError("Environment.Shopify.VariantId.Fallback",t,!1)}}();return e||(discountNinja.Logging.LogErrorMessage("Environment.Shopify.VariantId","No variant information found"),null)},TrimmedPathName:function(){try{var t=window.location.pathname;if(null===t||""===t)return t;var i=window.location.pathname.match("(/collections|/products|/search|/pages|/blogs|/account|/cart){1}(.*)");return i&&(t=i[0]),"/"===t.slice(-1)&&(t=t.substr(0,t.length-1)),decodeURIComponent(t).toLowerCase()}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.GetLastPartOfPathName",t),null}},ProductHandle:function(){try{var t=discountNinja_Script_Environment_Shopify.TrimmedPathName();return-1===t.indexOf("/products/")?null:t.substr(t.lastIndexOf("/")+1)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.ProductHandle",t),null}},CustomPageHandle:function(){try{var t=discountNinja_Script_Environment_Shopify.TrimmedPathName();return-1===t.indexOf("/pages/")?null:t.substr(t.lastIndexOf("/")+1)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.CustomPageHandle",t),null}},IsCustomer:function(){return void 0!==window.discountNinjaContext&&null!==window.discountNinjaContext.Customer},CustomerTags:function(){return null!==window.discountNinjaContext.Customer&&null!==window.discountNinjaContext.Customer.Tags?window.discountNinjaContext.Customer.Tags:null},CustomerSpend:function(){return null!==window.discountNinjaContext.Customer&&null!==window.discountNinjaContext.Customer.TotalSpent?window.discountNinjaContext.Customer.TotalSpent:null},CustomerNumberOfOrders:function(){return null!==window.discountNinjaContext.Customer&&null!==window.discountNinjaContext.Customer.NumberOfOrders?window.discountNinjaContext.Customer.NumberOfOrders:null},CustomerLastOrderDate:function(){return null!==window.discountNinjaContext.Customer&&null!==window.discountNinjaContext.Customer.LastOrderDate?window.discountNinjaContext.Customer.LastOrderDate:null}},discountNinja_Script_DiscountCode={ClassPrefix:"limoniapps-discountninja-cartdiscountfield",DiscountCodeCacheKey:"discountcode-data",HideFeedbackTimeoutHandle:null,ServerUrl:function(){return"prod"===discountNinja.Core.Environment?"5"===discountNinja.Core.ApiVersion?"https://promotionapi-v5.discountninja.io":"https://promotionapi-v4.discountninja.io":"https://promotionapi-v4-dev.discountninja.io"},Template:null,GetTemplate:function(){return null===discountNinja_Script_DiscountCode.Template&&(discountNinja_Script_DiscountCode.Template=discountNinja.Utilities.jQuery()("."+discountNinja_Script_DiscountCode.ClassPrefix+"-discountcode-template").html()),discountNinja_Script_DiscountCode.Template},InjectDiscountCodesInHtmlElements:function(t,i){function n(t,i){try{return discountNinja.QueryParameter.RemoveFromUrl(t,"discount",i).replace(/attributes\[limoniapps\-discounturl\]\=(.)*(\&)?/g,"")}catch(t){discountNinja.Logging.LogError("DiscountCode.UndoInjectDiscountCodeInUrl",t)}}function e(t,i){try{return discountNinja.QueryParameter.AppendToUrl(t,"discount",i,!0)}catch(t){discountNinja.Logging.LogError("DiscountCode.AppendDiscountCodeToUrl",t)}}try{discountNinja.Utilities.jQuery()(discountNinja.Environment.Shopify.SelectorCheckoutLink()).each((function(){if(!discountNinja.Utilities.jQuery()(this).hasClass("discountninja-ignore")){var o=discountNinja.Utilities.jQuery()(this).attr("href"),r=i?n(o,t):e(o,t);discountNinja.Utilities.jQuery()(this).attr("href",r)}})),discountNinja.Utilities.jQuery()(discountNinja.Environment.Shopify.SelectorCheckoutForm()).each((function(){if(!discountNinja.Utilities.jQuery()(this).hasClass("discountninja-ignore")){var o=discountNinja.Utilities.jQuery()(this).attr("action"),r=i?n(o,t):e(o,t);discountNinja.Utilities.jQuery()(this).attr("action",r)}})),discountNinja.Utilities.jQuery()(discountNinja.Environment.Shopify.SelectorCheckoutButtonViaOnClick()).each((function(){try{if(discountNinja.Utilities.jQuery()(this).hasClass("discountninja-ignore"))return;var o=discountNinja.Utilities.jQuery()(this).attr("onclick"),r=o.match(/(['"]){1}(.)*(['"])/g);if(null!==r&&1===r.length){var a=r[0];if(a.length>2){var c=a.substr(1,a.length-2),s=i?n(c,t):e(c,t);discountNinja.Utilities.jQuery()(this).attr("onclick",o.replace(c,s))}}}catch(t){}})),discountNinja.Checkout.Shopify.GetCheckoutForm().each((function(){if(!discountNinja.Utilities.jQuery()(this).hasClass("discountninja-ignore")){var o=discountNinja.Utilities.jQuery()(this).attr("method");if(o&&"post"===o.toLowerCase()){var r=discountNinja.Utilities.jQuery()(this).attr("action"),a=i?n(r,t):e(r,t);discountNinja.Utilities.jQuery()(this).attr("action",a)}}})),discountNinja.Utilities.jQuery()(discountNinja.Environment.Shopify.SelectorCheckoutForm()).find(":submit").addClass("saso-ignore hulkapps-ignore"),function(t,i){try{var n=discountNinja.Checkout.Shopify.GetCheckoutForm();if(!i&&null!==n&&n.length>0){var e=0;n.each((function(){if(!discountNinja.Utilities.jQuery()(this).hasClass("discountninja-ignore")){var t=discountNinja.Utilities.jQuery()(this).find('input[name="discount"]');null!==t&&0!==t.length||(discountNinja.Utilities.jQuery()("<input>").attr("type","hidden").attr("name","discount").addClass("limoniapps-discountninja-discount-attribute").attr("id","limoniapps-discountninja-discount-attribute-"+e).appendTo(this),e++)}}))}n.find('input[name="discount"], .limoniapps-discountninja-discount-attribute').each((function(){var n=discountNinja.Utilities.jQuery()(this);n.hasClass("discountninja-ignore")||(i?n.attr("value")==t&&n.attr("value",""):n.attr("value",t))}))}catch(t){discountNinja.Logging.LogError("UpdateFormInputDiscountCode",t)}}(t,i)}catch(t){discountNinja.Logging.LogError("DiscountCode.InjectDiscountCodesInHtmlElements",t)}},UndoInjectDiscountCodesInHtml:function(){try{var t=discountNinja.Offer.Offers;if(!t)return;for(var i=0;i<t.length;i++)discountNinja_Script_DiscountCode.InjectDiscountCodesInHtmlElements(discountNinja_Script_DiscountCode.GetDiscountCode(t[i].Token),!0)}catch(t){discountNinja.Logging.LogError("DiscountCode.UndoInjectDiscountCodesInHtml",t)}},InjectDiscountCodesInHtml:function(){try{var t=discountNinja_Script_DiscountCode.GetFirstActiveDiscountCodeForCheckout(!1);if(""===t)return;discountNinja_Script_DiscountCode.InjectDiscountCodesInHtmlElements(t,!1)}catch(t){discountNinja.Logging.LogError("DiscountCode.InjectDiscountCodesInHtml",t)}},GetApplicationCounter:function(){try{var t=discountNinja.Cache.SessionGet("discountcode-applicationcounter");return t?parseInt(t):0}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetApplicationCounter",t),[]}},IncrementApplicationCounter:function(){try{var t=discountNinja_Script_DiscountCode.GetApplicationCounter();discountNinja.Cache.SessionSet("discountcode-applicationcounter",t+1)}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetApplicationCounter",t),[]}},GetFromCache:function(){try{var t=discountNinja_Script_DiscountCode.UseLocalStorage(),i=discountNinja_Script_DiscountCode.DiscountCodeCacheKey,n=t?discountNinja.Cache.LocalGet(i):discountNinja.Cache.SessionGet(i);return null===(n="undefined"===n?[]:JSON.parse(n))?[]:n}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetFromCache",t),[]}},UseLocalStorage:function(){try{return!0===discountNinja.Settings.Settings.General.StorePromotionCodes}catch(t){return discountNinja.Logging.LogError("DiscountCode.UseLocalStorage",t),!1}},SaveToCache:function(t){try{var i=discountNinja_Script_DiscountCode.UseLocalStorage(),n=discountNinja_Script_DiscountCode.DiscountCodeCacheKey;discountNinja.Cache.SessionSet(n,JSON.stringify(t)),i?discountNinja.Cache.LocalSet(n,JSON.stringify(t)):discountNinja.Cache.LocalRemove(n)}catch(t){discountNinja.Logging.LogError("DiscountCode.SaveToCache",t)}},RemoveFromCache:function(t){try{var i=discountNinja_Script_DiscountCode.GetFromCache();if(!i)return;for(var n=[],e=0;e<i.length;e++)i[e].DiscountCode!==t&&n.push(i[e]);discountNinja_Script_DiscountCode.SaveToCache(n)}catch(t){return discountNinja.Logging.LogError("DiscountCode.RemoveFromCache",t),[]}},GetExternalDiscountCodesFromCache:function(){try{var t=discountNinja.Cache.SessionGet("discountcode-external-data");return null===(t="undefined"===t?[]:JSON.parse(t))?[]:t}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetExternalDiscountCodesFromCache",t),[]}},LockDiscountCodeFieldIfRequired:function(){try{var t=discountNinja.Utilities.jQuery()("input."+discountNinja_Script_DiscountCode.ClassPrefix+"-input"),i=discountNinja.Utilities.jQuery()("."+discountNinja_Script_DiscountCode.ClassPrefix+"-apply");if(!discountNinja.Settings.Settings.Cart.AllowMultipleDiscountCodes&&!discountNinja.Settings.Settings.Cart.AllowMultipleShopifyDiscountCodes)if(discountNinja.DiscountCodeTrigger.Get().length>0)return void function(t,i){t.prop("disabled",!0),i.addClass("disabled")}(t,i);!function(t,i){t.prop("disabled",!1),i.removeClass("disabled")}(t,i)}catch(t){discountNinja.Logging.LogError("DiscountCode.LockDiscountCodeFieldIfRequired",t)}},UpdateTags:function(){try{var t="."+discountNinja_Script_DiscountCode.ClassPrefix+"-",i=discountNinja.Utilities.jQuery()(t+"discountcodes");discountNinja.Utilities.jQuery()(i).empty();var n=discountNinja_Script_DiscountCode.GetTemplate();if(n){var e=discountNinja.DiscountCodeTrigger.Get();e=e.concat([]);for(var o=0;o<e.length;o++){var r=e[o].discountCode,a=n.replace(/\[\[DISCOUNT_CODE\]\]/g,r.toUpperCase());i.append(a)}}e=discountNinja.DiscountCodeTrigger.Get();var c=discountNinja.DiscountedCart.GetAppliedPromotions(),s=!0;if(e)for(o=0;o<e.length;o++){var u=e[o].discountCode.toUpperCase(),d=!1;if(c)for(var l=0;l<c.length;l++){if(c[l].DiscountCode===u){d=!0;break}if(e[o].trigger&&e[o].trigger.Triggers)for(var g=0;g<e[o].trigger.Triggers.length;g++)if(e[o].trigger.Triggers[g].Token===c[l].TriggerToken){d=!0;break}}if(!d){var p=discountNinja.Utilities.jQuery()(".limoniapps-discountninja-cartdiscountfield-notapplied-reason").html();discountNinja_Script_DiscountCode.AddErrorMessage(p,u),discountNinja_Script_DiscountCode.ShowMessage("notApplied"),s=!1}}s&&discountNinja_Script_DiscountCode.HideMessage("notApplied")}catch(t){discountNinja.Logging.LogError("DiscountCode.UpdateTags",t)}},AddErrorMessage:function(t,i){var n=discountNinja.Utilities.jQuery()(".limoniapps-discountninja-cartdiscountfield-discountcode[data-discountcode='"+i.toUpperCase()+"']");n.addClass("limoniapps-discountninja-discountcode-invalid"),n.attr("limoniapps-discountninja-cartdiscountfield-tooltip",t)},Process:function(){try{discountNinja_Script_DiscountCode.LockDiscountCodeFieldIfRequired();var t=discountNinja_Script_Offer.CombinePromotionsFromTokenAndDiscountCode();discountNinja.Offer.AllOffers=t.Offers,discountNinja.Offer.Triggers=t.Triggers,discountNinja.Offer.ReEvaluate()}catch(t){discountNinja.Logging.LogError("DiscountCode.Process",t)}},AddDiscountCodeFromLookup:function(t,i){discountNinja_Script_DiscountCode.AddDiscountCode(t,!0,i)},GetDiscountDetailsRequests:[],HandleMessages:function(t,i){var n=discountNinja.Utilities.jQuery(),e="."+discountNinja_Script_DiscountCode.ClassPrefix+"-",o=e+"applied",r=e+"notfound",a=e+"notapplied",c=e+"notcombinable",s=n(e+"searching"),u=n(o),d=n(a),l=n(c),g=n(r);i?("searching"===t?s.show():s.hide(),"applied"===t?u.show():u.hide(),"notApplied"===t?d.show():d.hide(),"notFound"===t?g.show():g.hide(),"notCombinable"===t?l.show():l.hide()):t?("searching"===t&&s.hide(),"applied"===t&&u.hide(),"notApplied"===t&&d.hide(),"notFound"===t&&g.hide(),"notCombinable"===t&&l.hide()):(s.hide(),u.hide(),d.hide(),l.hide(),g.hide())},HideMessage:function(t){discountNinja_Script_DiscountCode.HandleMessages(t,!1)},ShowMessage:function(t){discountNinja_Script_DiscountCode.HandleMessages(t,!0)},AddDiscountCode:function(t,i,n){function e(){i&&discountNinja_Script_DynamicPricing.UnblockCheckoutButtons(),u.prop("disabled",!1),d.removeClass("disabled")}function o(){e(),discountNinja_Script_DiscountCode.ShowMessage("notFound")}function r(){discountNinja_Script_DiscountCode.ShowMessage("applied")}function a(t){var i="DiscountNinja";try{(t.Offers[0].Tiers[0].DiscountCode.PriceRuleId>-1||t.Offers[0].Tiers[0].DiscountCode.PriceRuleAppId>-1)&&(i="Shopify")}catch(t){}return i}var c="."+discountNinja_Script_DiscountCode.ClassPrefix+"-",s=c+"apply",u=discountNinja.Utilities.jQuery()("input"+c+"input"),d=discountNinja.Utilities.jQuery()(s);try{if(!t||""===t)return;if(!0===discountNinja_Script_DiscountCode.GetDiscountDetailsRequests[t])return;discountNinja_Script_DiscountCode.GetDiscountDetailsRequests[t]=!0,i&&(i&&discountNinja.DynamicPricing.BlockCheckoutButtonsLookupCode(),u.prop("disabled",!0),d.addClass("disabled"),discountNinja_Script_DiscountCode.ShowMessage("searching")),discountNinja.XmlHttpRequest.Send(discountNinja_Script_DiscountCode.ServerUrl()+"/api/GetDiscountDetails",function(t){try{var i={},n=null===discountNinja.Cache.SessionGet("discountcode-promotiondata-requested-"+t),e=discountNinja.Core.Shop,o=discountNinja.Utilities.GetReferrer();e&&(i.shop=e),t&&(i.discountCode=encodeURIComponent(t)),null!==discountNinja.TestMode.TestMode&&(i.testMode=discountNinja.TestMode.TestMode,i.matchByTokenOnly=discountNinja.TestMode.MatchByTokenOnly,discountNinja.TestMode.TestModeToken&&(i.testModeToken=discountNinja.TestMode.TestModeToken)),null!==n&&(i.firstRequest=n),o&&(i.referrer=o),i.status=discountNinjaContext.Status,i.m=discountNinja.DateTime.UnixTimestamp();var r=discountNinja.DeviceId.Get();return i.deviceId=r,i.version=discountNinja.Core.Version,i.f="7.4",i}catch(t){return discountNinja.Logging.LogError("Offer.LoadPromotionInfo.BuildParameters",t),null}}(t),null,"get",!0,!0,!0,(function(o){var s;if(i&&(s=c+"searching",discountNinja.Utilities.jQuery()(s).hide(),e(),u.val("")),o&&"false"!==o)if(discountNinja.DiscountedCart.IsDirty=!0,o.DiscountCodeDetails)i&&r(),function(t,i,n){try{null===i&&discountNinja.Logging.LogWarning("DiscountCode.AddExternal - No discountcode provided",!0,!1,!1);for(var e=discountNinja_Script_DiscountCode.GetExternalDiscountCodesFromCache(),o=e.length;o--;)e[o]&&e[o].DiscountCode===i&&e.splice(o,1);e.push({OfferToken:null,TriggerToken:null,DiscountCode:i,PriceRuleId:t,TargetType:n}),discountNinja_Script_DiscountCode.IncrementApplicationCounter(),discountNinja_Script_DiscountCode.InjectDiscountCodesInHtml(),function(t){try{discountNinja.Cache.SessionSet("discountcode-external-data",JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("DiscountCode.SaveExternalDiscountCodesToCache",t)}}(e)}catch(t){discountNinja.Logging.LogError("DiscountCode.AddExternal",t)}}(o.DiscountCodeDetails.PriceRuleId,o.DiscountCodeDetails.DiscountCode,o.DiscountCodeDetails.TargetType);else if(void 0===o.Offers||null===o.Offers||0===o.Offers.length||void 0===o.Triggers||null===o.Triggers||0===o.Triggers.length)discountNinja_Script_DiscountCode.ShowMessage("notFound");else if(function(t){try{var i=a(t),n=!1,e=!1,o=discountNinja.DiscountedCart.GetAppliedPromotions();if(o&&o.length>0)for(var r=0;r<o.length;r++){var c=discountNinja.Offer.GetOfferByToken(o[r].OfferToken),s="DiscountNinja";if((c.Tiers[0].DiscountCode.PriceRuleId>-1||c.Tiers[0].DiscountCode.PriceRuleAppId>-1)&&(s="Shopify"),"DiscountNinja"===s&&(n=!0),"Shopify"===s&&(e=!0),!1===c.Stacking.CombineWithPromotionCodes&&"DiscountNinja"===i)return!1;if(!1===c.Stacking.CombineWithShopifyDiscountCodes&&"Shopify"===i)return!1}if(t.Offers&&t.Offers.length>0)for(r=0;r<t.Offers.length;r++){if(!1===(c=t.Offers[r]).Stacking.CombineWithPromotionCodes&&"DiscountNinja"===i&&n)return!1;if(!1===c.Stacking.CombineWithShopifyDiscountCodes&&"Shopify"===i&&e)return!1}return!0}catch(t){return discountNinja.Logging.LogError("DiscountCode.IsAcceptableCode",t),!0}}(o)){i&&r();var d=a(o),l=discountNinja.Settings.Settings.Cart.AllowMultipleShopifyDiscountCodes;if("Shopify"===d&&!l){var g=discountNinja_Script_DiscountCodeTrigger.Get();filteredTriggers=[];for(var p=0;p<g.length;p++){var f=g[p];"Shopify"!==f.source&&filteredTriggers.push(f)}discountNinja_Script_DiscountCodeTrigger.Save(filteredTriggers)}discountNinja.DiscountCodeTrigger.Add(t,o,d),discountNinja.Cache.SessionSet("discountcode-promotiondata-requested-"+t,!0),discountNinja_Script_DiscountCode.Process()}else i&&discountNinja_Script_DiscountCode.ShowMessage("notCombinable");else discountNinja_Script_DiscountCode.ShowMessage("notFound");discountNinja_Script_DiscountCode.LockDiscountCodeFieldIfRequired(),discountNinja_Script_DiscountCode.RemoveSavedDiscountCode(),discountNinja_Script_QueryParameter.Remove("discountcode"),discountNinja_Script_DiscountCode.GetDiscountDetailsRequests[t]=!1,n&&n()}),(function(){i&&o()}),1,2)}catch(t){discountNinja.Logging.LogError("DiscountCode.AddExternalDiscountCode",t),i&&o()}},Add:function(t,i,n,e){try{null!==i&&null!==n||discountNinja.Logging.LogWarning("DiscountCode.Add - No discountcode or priceruleid available",!0,!1,!1);for(var o=discountNinja_Script_DiscountCode.GetFromCache(),r=o.length;r--;)o[r]&&o[r].Token===t&&o.splice(r,1);o.push({Token:t,DiscountCode:i,PriceRuleId:n,TargetType:e}),discountNinja_Script_DiscountCode.InjectDiscountCodesInHtml(),discountNinja_Script_DiscountCode.SaveToCache(o)}catch(t){discountNinja.Logging.LogError("DiscountCode.Add",t)}},Clear:function(){for(var t=discountNinja_Script_DiscountCode.GetFromCache(),i=0;i<t.length;i++){var n=t[i].DiscountCode;discountNinja.DiscountCodeTrigger.Remove(n)}var e=discountNinja_Script_DiscountCode.DiscountCodeCacheKey;discountNinja.Cache.SessionRemove(e),discountNinja.Cache.LocalRemove(e)},Remove:function(t){try{for(var i=discountNinja_Script_DiscountCode.GetFromCache(),n=[],e=0;e<i.length;e++)i[e].Token!==t&&n.push(i[e]);discountNinja_Script_DiscountCode.SaveToCache(n)}catch(t){discountNinja.Logging.LogError("DiscountCode.Remove",t)}},RemoveTag:function(t){try{discountNinja.DiscountCode.UndoInjectDiscountCodesInHtml();var i="."+discountNinja_Script_DiscountCode.ClassPrefix,n=discountNinja.Utilities.jQuery()(t).parent(i+"-discountcode").attr("data-discountcode");discountNinja_Script_DiscountCodeTrigger.Remove(n),discountNinja_Script_DiscountCode.RemoveFromCache(n),discountNinja_Script_DiscountCode.IncrementApplicationCounter(),discountNinja_Script_DiscountCode.HideMessage(),discountNinja_Script_DiscountCode.Process(),discountNinja_Script_DiscountCode.UpdateTags()}catch(t){discountNinja.Logging.LogError("DiscountCode.RemoveTag",t)}},ToggleLinkOriginalDescriptionStatus:null,ToggleLink:function(t){try{var i="."+discountNinja_Script_DiscountCode.ClassPrefix+"-",n=discountNinja.Utilities.jQuery()(t).closest(i+"placeholder"),e=n.find(i+"inputandbutton"),o=n.find(i+"description"),r=n.find(i+"footer"),a=n.find(i+"inner");if(a.is(":visible")){null===discountNinja_Script_DiscountCode.ToggleLinkOriginalDescriptionStatus&&(discountNinja_Script_DiscountCode.ToggleLinkOriginalDescriptionStatus=o.is(":visible")?"allowhide":"");var c="allowhide"===discountNinja_Script_DiscountCode.ToggleLinkOriginalDescriptionStatus;e.toggle();var s="data-limoniapps-discountninja-cartdiscountfield-",u=s+"showfooter",d=s+"showdescription",l=n.find("["+u+"]").attr(u),g=n.find("["+d+"]").attr(d);"true"===g&&(c=!0),e.is(":visible")?("false"===l?r.hide():r.show(),"false"===g?o.hide():c&&o.show()):(c&&o.hide(),r.hide())}else a.show(),e.show(),o.show(),r.show();n.find(i+"input").focus()}catch(t){discountNinja.Logging.LogError("DiscountCode.ToggleLink",t)}},ShowFooterInstructions:function(t){try{var i="."+discountNinja_Script_DiscountCode.ClassPrefix+"-";discountNinja.Utilities.jQuery()(t).closest(i+"placeholder").find(i+"footer-onhover").show()}catch(t){discountNinja.Logging.LogError("DiscountCode.ShowFooterInstructions",t)}},HideFooterInstructions:function(t){try{var i="."+discountNinja_Script_DiscountCode.ClassPrefix+"-";discountNinja.Utilities.jQuery()(t).closest(i+"placeholder").find(i+"footer-onhover").hide()}catch(t){discountNinja.Logging.LogError("DiscountCode.HideFooterInstructions",t)}},GetFirstActiveDiscountCodeForCheckout:function(t){try{var i=discountNinja.DiscountedCart.GetFirstDiscountCode();return i?t?discountNinja.Utilities.EncodeUriComponentForQueryString(i):i:""}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetFirstActiveDiscountCodeForCheckout",t),""}},GetDiscountCode:function(t){try{for(var i=discountNinja_Script_DiscountCode.GetFromCache(),n=0;n<i.length;n++)if(i[n].Token===t)return i[n].DiscountCode;return null}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetDiscountCode",t),null}},GetPromotionForDiscountCode:function(t){try{var i=discountNinja.Offer.Offers;if(!i)return null;for(var n=0;n<i.length;n++)for(var e=0;e<5;e++)if(i[n].Tiers[e]&&i[n].Tiers[e].DiscountCode.Code===t)return i[n];return null}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetPromotionForDiscountCode",t),null}},EnableDiscountCodeField:function(){function t(t){var i=discountNinja.Settings.Settings.Cart,n=t?discountNinja.Settings.Settings.DrawerCart:discountNinja.Settings.Settings.Cart;if(!n||!0!==n.CartDiscountField)return!1;var e=i.DisplayOnDevices;if(e){var o=discountNinja.Utilities.IsMobilePhone();if(o&&"desktoponly"===e)return!1;if(!o&&"mobileonly"===e)return!1}return!(!n||n.HideInCart&&!t||n.HideInDrawerCart&&t)}function i(t){var i=discountNinja.Settings.Settings.PriceUpdate.Mode,n=t?i.DrawerCartDiscountField:i.CartDiscountField,e=discountNinja_Script_DynamicPricing.InjectPlaceHolder,o=discountNinja_Script_DiscountCode.ClassPrefix+(t?"-drawercart":"-cart")+"-injected",r=discountNinja_Script_DiscountCode.ClassPrefix+"-placeholder";if(n&&"custom"!==n&&"none"!==n&&!(discountNinja.Utilities.jQuery()("."+o).length>0||discountNinja.Utilities.jQuery()("."+r).length>0)){discountNinja.Utilities.jQuery()("."+r).not("."+o).removeClass(r).addClass(r+"-disabled");var a='<div class="'+r+" "+o+'"></div>';e.Inject(n,a)}}function n(i){var n=discountNinja.Environment.Shopify.IsCartPage();if((i||n)&&t(i)){var e="."+discountNinja_Script_DiscountCode.ClassPrefix+"-",o=e+"wrapper",r=e+"placeholder",a=discountNinja.Utilities.jQuery()(r);if(a.length>0)for(var c=0;c<a.length;c++){var s=discountNinja.Utilities.jQuery()(a[c]);if(i||!(s.parents(".limoniapps-discountninja-drawercart-root").length>0)){var u=discountNinja.Utilities.jQuery()(o).html();s.html(u);var d=r+" "+e+"apply",l=e+"input",g=r+" input"+l;discountNinja.Utilities.jQuery()(d).click((function(){var t=discountNinja.Utilities.jQuery()(this).closest(r).find(l).val();discountNinja_Script_DiscountCode.AddDiscountCodeFromLookup(t)})),discountNinja.Utilities.jQuery()(g).keypress((function(t){var i=t.keyCode?t.keyCode:t.which;if("13"===i||13===i){var n=discountNinja.Utilities.jQuery()(this).val();discountNinja_Script_DiscountCode.AddDiscountCodeFromLookup(n),t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1}})),s.find(e+"inner").show(),s.find(e+"link").is(":visible")&&(s.find(e+"inputandbutton").hide(),s.find(e+"description").hide(),s.find(e+"footer").hide()),s.find("svg").show(),s.find(o).show()}}}}try{discountNinja.Environment.Shopify.IsCartPage()&&t(!1)&&i(!1),t(!0)&&i(!0),n(!0),n(!1)}catch(t){discountNinja.Logging.LogError("DiscountCode.EnableDiscountCodeField",t)}},RemoveSavedDiscountCode:function(){try{discountNinja.Cache.SessionRemove("saveddiscountcode")}catch(t){return discountNinja.Logging.LogError("DiscountCode.RemoveSavedDiscountCode",t),""}},GetDiscountCodeFromQueryParameter:function(){try{var t=discountNinja.QueryParameter.Get("discountcode");return t||(t=discountNinja.QueryParameter.Get("discount")),t?decodeURIComponent(t).toUpperCase().trim():function(){try{var t=discountNinja.Cache.SessionGet("saveddiscountcode");return t?decodeURIComponent(t).toUpperCase().trim():""}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetSavedDiscountCode",t),""}}()}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetDiscountCodeFromQueryParameter",t),""}}},discountNinja_Script_DiscountCodeTrigger={TriggersCacheKey:"triggersfromdiscountcode",UseLocalStorage:function(){try{return!0===discountNinja.Settings.Settings.General.StorePromotionCodes}catch(t){return discountNinja.Logging.LogError("DiscountCodeTrigger.UseLocalStorage",t),!1}},Get:function(){var t=discountNinja_Script_DiscountCodeTrigger.UseLocalStorage(),i=discountNinja_Script_DiscountCodeTrigger.TriggersCacheKey,n=t?discountNinja.Cache.LocalGet(i):discountNinja.Cache.SessionGet(i);return n?JSON.parse(n):[]},Save:function(t){var i=discountNinja_Script_DiscountCodeTrigger.UseLocalStorage(),n=discountNinja_Script_DiscountCodeTrigger.TriggersCacheKey;discountNinja.Cache.SessionSet(n,JSON.stringify(t)),i?discountNinja.Cache.LocalSet(n,JSON.stringify(t)):discountNinja.Cache.LocalRemove(n)},FindByDiscountCode:function(t,i){for(var n=0;n<i.length;n++)if(i[n].discountCode.toLowerCase()===t.toLowerCase())return i[n];return null},Add:function(t,i,n){var e=!1,o=discountNinja_Script_DiscountCodeTrigger.Get();if(!discountNinja_Script_DiscountCodeTrigger.FindByDiscountCode(t,o)){e=!0;var r=discountNinja.Settings.Settings.Cart.AllowMultipleDiscountCodes,a=discountNinja.Settings.Settings.Cart.AllowMultipleShopifyDiscountCodes,c=0,s=0,u=discountNinja_Script_DiscountCodeTrigger.Get();if(u)for(var d=0;d<u.length;d++){if("Shopify"===u[d].source?s++:c++,!r&&c>0&&"DiscountNinja"===n||!a&&s>0&&"Shopify"===n){e=!1;break}}o.push({discountCode:t,trigger:i,valid:e,errorMessage:"",source:n})}return discountNinja_Script_DiscountCodeTrigger.Save(o),e},Remove:function(t){for(var i=discountNinja_Script_DiscountCodeTrigger.Get(),n=[],e=0;e<i.length;e++)i[e].discountCode.toLowerCase()!==t.toLowerCase()&&n.push(i[e]);discountNinja_Script_DiscountCodeTrigger.Save(n)}},discountNinja_Script_DiscountedCart={Version:1,IsDirty:!1,DiscountedCart:null,SplitRowsInProcess:!1,FreeGiftAdjustmentInProcess:!1,SplitRowPrefix:"DiscountNinja.SplitRow.",FreeGiftPrefix:"DiscountNinja.FreeGift.",Get:function(t){try{var i=discountNinja_Script_DiscountedCart.DiscountedCart;if(!i||!i.items)return null;for(var n=0;n<i.items.length;n++){var e=i.items[n];if(e.Key===t)return e}return null}catch(t){return discountNinja.Logging.LogError("DiscountedCart.Get",t),null}},GetDiscountedAmountForOffer:function(t){try{var i=0,n=discountNinja.DiscountedCart.DiscountedCart;if(n){if(n.items)for(var e=0;e<n.items.length;e++){var o=n.items[e];o.OfferToken===t&&"line_item"===o.TargetType&&(i+=100*o.Line.EffectiveAmount)}if(n.CartLevelDiscounts)for(e=0;e<n.CartLevelDiscounts.length;e++){var r=n.CartLevelDiscounts[e];r.OfferToken===t&&(i+=100*r.Amount)}}return i}catch(t){return discountNinja.Logging.LogError("DiscountedCart.GetDiscountedAmountForOffer",t),0}},BuildDiscountedCart:function(t){var i=discountNinja.Utilities.jQuery().Deferred();function n(t){try{var i=[],n=t.properties;if(null===n)return null;for(var e in n)i.push({Name:e,Value:n[e]});return i}catch(t){return[]}}function e(t,i,e,o,r,a){var c=-1;if(i&&i.items)for(var s=0;s<i.items.length;s++)if(i.items[s].Key===t){c=s;break}var u=function(t,i,e,o,r){var a=discountNinja.LiquidData.CartItemByKey(t),c={Key:t,Product:e,Line:o,OfferToken:i?i.Token:null,TriggerToken:i?discountNinja.Offer.GetTriggerTokenForOffer(i.Token):null,TargetType:i?i.Entitlement?i.Entitlement.TargetType:null:"line_item",DiscountCode:i?discountNinja.Offer.GetPromotionDiscountCode(i):null,PriceRuleId:i?discountNinja.Offer.GetPromotionPriceRuleId(i):null,PriceRuleTitle:i?discountNinja.Offer.GetPromotionPriceRuleTitle(i):null,Properties:n(a),Tier:r};try{delete c.Product.Key,delete c.Product.OfferToken,delete c.Product.TriggerToken,delete c.Product.DiscountCode,delete c.Line.Key,delete c.Line.OfferToken,delete c.Line.TriggerToken,delete c.Line.DiscountCode}catch(t){}return c}(t,e,o,r,a);if(-1===c)i.items.push(u);else{var d=i.items[c];(void 0===d.TriggerToken||null===d.TriggerToken||u.Line.DiscountedPrice<d.Line.DiscountedPrice)&&(i.items[c]=u)}return i}function o(t,i,n,e,o,r,a){return{Key:t,VariantId:i,ProductHandle:n,OriginalPrice:e/100,OriginalCompareAtPrice:o/100,Amount:0,Percentage:0,EffectiveCompareAtPrice:o/100,DiscountedPrice:e/100,InventoryLeft:r,Collections:a,Tier:null}}function r(t,i,n){return{OriginalPrice:t/100*n,OriginalCompareAtPrice:i/100*n,Amount:0,Percentage:0,EffectiveAmount:0,EffectivePercentage:0,EffectiveCompareAtPrice:i/100*n,DiscountedPrice:t/100*n,QuantityDiscounted:0,QuantityNotDiscounted:n,Tier:null}}function a(t,i,n,a,c,s,u,d,l,g,p,f){try{discountNinja.Logging.LogVerbose("Evaluating if item with key "+n+" and handle "+a+" must be added to discounted cart");var N=n.split(":")[0],j=discountNinja.Offer.GetOfferForCartItem(t,n,a,N,l,u,c,s,!1),m=c/100,h=null,C=null,S=null;if(d>0&&j&&j.Entitlement&&"shipping_line"!==j.Entitlement.TargetType&&"each"==j.Entitlement.AllocationMethod){var y=discountNinja.DiscountTier.GetCurrentDiscountTier(j);S=y?y.Level:null;var _=discountNinja.Prerequisite.EntitledQuantityInfo(j,y),v=null===_||!1===_.HasEntitledQuantity?d:_.EntitledNotAttributed;v=Math.min(v,d);var P=Math.max(0,d-v);if(h=discountNinja.DiscountedProduct.Get(n,N,a,c,s,u,j,null,null,v,P),C=discountNinja.DiscountedProduct.Get(n,N,a,c,s,u,j,d,null,v,P),h&&C&&v>0){h.Collections=l,discountNinja.Logging.LogVerbose("Adding "+d+" item(s) with key "+n+" and handle "+a+" to discounted cart, applying offer "+j.Token+", discounted price is "+h.DiscountedPrice),j.AttributedQuantity=j.AttributedQuantity+v;var L=C.DiscountedPrice,T=discountNinja.Utilities.RoundToNumberOfDigits(L/d*v,2);T+=discountNinja.Utilities.RoundToNumberOfDigits(m*P,2),C.DiscountedPrice=T;var D=Math.min(C.Amount/d,m-L/d),E=discountNinja.Utilities.RoundToNumberOfDigits(D*v,2);C.EffectiveAmount=E,C.EffectivePercentage=Math.min(0===C.EffectiveCompareAtPrice?0:Math.abs(E/C.EffectiveCompareAtPrice*100),100),C.QuantityDiscounted=v,C.QuantityNotDiscounted=P,C.OriginalPrice=m*v,C.OriginalPriceTotal=m*d;try{delete C.VariantId,delete C.ProductHandle,delete C.InventoryLeft}catch(t){}}else j=null,h=o(n,N,a,c,s,u,l),C=r(c,s,d)}else j=null,h=o(n,N,a,c,s,u,l),C=r(c,s,d);return h.Collections=l,h.Tags=g,h.ProductId=p,h.Title=f,i=e(n,i,j,h,C,S)}catch(t){return discountNinja.Logging.LogError("DiscountedCart.AddDiscountedCartItem",t),i}}function c(){for(var t=0;t<discountNinja.Offer.Offers.length;t++)discountNinja.Offer.Offers[t].AttributedQuantity=0}function s(t,i,n,e){if(!t||0==t.length)return n;for(var o=0;o<i.length;o++){discountNinja.Logging.LogVerbose("Building discounted cart - Evaluating cart item "+o);var r=discountNinja.ProductData.GetByProductHandle(i[o].handle,!1);if(r){discountNinja.Logging.LogVerbose("Building discounted cart - Promotion data found for cart item "+o+" with key "+i[o].key+" and handle "+i[o].handle);var c=discountNinja.ProductData.GetVariantData(i[o].handle,i[o].variant_id);null!==c&&null!==c.CompareAtPrice&&(r.CompareAtPrice=c.CompareAtPrice),n=a(t,n,i[o].key,i[o].handle,i[o].original_price||r.Price,r.CompareAtPrice,r.Inventory,i[o].quantity,r.Collections,r.Tags,i[o].product_id,i[o].product_title)}else discountNinja.Logging.LogVerbose("Building discounted cart - No offer data found for cart item "+o+" with key "+i[o].key+" and handle "+i[o].handle);n=u(n)}return n}function u(t){if(!t)return null;var i=0,n=0;if(t.items)for(var e=0;e<t.items.length;e++){var o=t.items[e].Line;i+=o.OriginalPrice,n+=o.DiscountedPrice}var r=0;if(t.CartLevelDiscounts)for(e=0;e<t.CartLevelDiscounts.length;e++){r+=t.CartLevelDiscounts[e].Amount}t.total_original_price=Math.round(100*i)/100,t.total_discounted_price=Math.max(0,Math.round(100*(n-r))/100);var a=i-n+r;return t.total_discount=Math.round(100*a)/100,t}function d(t){try{var i=1;return"buyx_gety"===t.OfferType&&"fixed_amount"===t.Entitlement.ValueType&&"across"===t.Entitlement.AllocationMethod&&t.Tiers&&t.Tiers.length>0&&(i=discountNinja.Prerequisite.PrerequisiteItemsInCart(t,t.Tiers[0])),i}catch(t){return discountNinja.Logging.LogError("DiscountedCart.GetPrerequisiteUnits",t),1}}function l(t,i){for(var n=[],e=0;e<t.length;e++){var o=t[e];o.Token!==i&&n.push(o)}return n}function g(t){var i=[];if(0===t.length)return[];if(1===t.length)return[t];for(var n=0;n<t.length;n++)for(var e=t[n],o=g(l(t,e.Token)),r=0;r<o.length;r++){var a=[e].concat(o[r]);i.push(a)}return i}function p(t){for(var i=[],n=0;n<t.length;n++){var e=t[n];if(e.Entitlement&&"line_item"===e.Entitlement.TargetType&&"across"===e.Entitlement.AllocationMethod)if(discountNinja.Offer.OfferIsApplicable(e)&&!discountNinja.Offer.OfferIsExcluded(e))if(discountNinja.DiscountTier.GetCurrentDiscountTier(e)){var o=e.TriggeredByTrigger.Token.endsWith("-trigger-token"),r=!1!==discountNinja.Settings.GetFlag("AllowOrderLevelShopifyDiscountCodeToStack");o&&!r||i.push(e)}}return i}function f(t,i){if(!t||0==t.length)return i;for(var n=[],e=0;e<t.length;e++){var o=t[e];if(o.Entitlement&&"line_item"===o.Entitlement.TargetType&&"across"===o.Entitlement.AllocationMethod){if(i.CartLevelDiscounts)for(var r=0;r<i.CartLevelDiscounts.length;r++){i.CartLevelDiscounts[r].OfferToken,o.Token}if(discountNinja.Offer.OfferIsApplicable(o)&&!discountNinja.Offer.OfferIsExcluded(o)){var a=discountNinja.DiscountTier.GetCurrentDiscountTier(o);if(a){var c=discountNinja.Offer.EligibleItemsCartValue(o,"discountedcart",!0),s=c/100,l=0;l="percentage"===o.Entitlement.ValueType?Math.floor(c*a.Entitlement.Percentage/100)/100:a.Entitlement.Amount,l*=d(o);var g=Math.min(s,l);if(g>0){var p=a.DiscountCode;n.push({OfferToken:o.Token,TriggerToken:discountNinja.Offer.GetTriggerTokenForOffer(o.Token),Amount:g,DiscountCode:p.Code,PriceRuleId:p.PriceRuleId,PriceRuleAppId:p.PriceRuleAppId,PriceRuleTitle:p.PriceRuleTitle,TargetType:o.Entitlement.TargetType,Tier:a?a.Level:null,Stacks:!0===o.Stacking.Combine&&!0===o.Stacking.Stack,ValueType:o.Entitlement.ValueType,Percentage:a.Entitlement.Percentage}),N(i,n)}}}}}return u(i)}function N(t,i){if(t.CartLevelDiscounts=[],t=u(t),i.length>0){for(var n=[],e=[],o=0;o<i.length;o++){var r=i[o];n.push(r),!0===r.Stacks&&e.push(r)}var a=t.total_discounted_price,c=null;for(o=0;o<n.length;o++){r=n[o];var s=c?c.Amount:0;r.Amount>s&&(c=r)}var d=c?a-c.Amount:-1,l=-1;for(o=0;o<e.length;o++){l+=(r=e[o]).Amount}var g=null!==c,p=-1!==l;if(g||p){var f=g&&d<l?"nonstacking":"stacking";if("nonstacking"!=f||g||(f="stacking"),"stacking"!=f||p||(f="nonstacking"),"stacking"==f)for(o=0;o<e.length;o++)t.CartLevelDiscounts.push(e[o]);else"nonstacking"==f&&t.CartLevelDiscounts.push(c)}}t=u(t)}function j(){try{var n=discountNinja.Offer.Offers;if(n&&0!==n.length){var e=window.discountNinjaContext?window.discountNinjaContext.Cart:null;if(discountNinja_Script_DiscountedCart.IsDirty=!1,discountNinja_Script_DiscountedCart.ClearCartValueCache(),function(){if(discountNinja.Offer.Offers)for(var t=0;t<discountNinja.Offer.Offers.length;t++)discountNinja.Offer.Offers[t].AppliedTier=null;discountNinja.Offer.PrimaryOffer&&(discountNinja.Offer.PrimaryOffer.AppliedTier=null)}(),null!=e&&void 0!==e.items&&null!==e.items){var o={items:[]};o.token=discountNinja.LiquidData.Cart().token;var r=function(t){var i=[];if(t&&t.items){for(var n=0;n<t.items.length;n++)if(t.items[n].properties)for(var e in t.items[n].properties)if(e.indexOf("DiscountNinja.FreeGift")>-1||e.indexOf("DiscountNinja.Discounted")>-1){i.push(t.items[n]);break}for(n=0;n<t.items.length;n++){for(var o=!1,r=0;r<i.length;r++)if(t.items[n].key===i[r].key){o=!0;break}o||i.push(t.items[n])}}return i.sort((function(t,i){var n=!1,e=!1;if(t.properties)for(var o in t.properties)if(o.indexOf("DiscountNinja.SplitRow")>-1){n=!0;break}if(i.properties)for(var o in i.properties)if(o.indexOf("DiscountNinja.SplitRow")>-1){e=!0;break}return t.original_price<i.original_price?-1:t.original_price>i.original_price?1:n&&!e?-1:!n&&e?1:0})),i}(e),a=!0;o=function(t,i){for(var n=0;n<t.length;n++){var e=t[n],o=e.handle,r=discountNinja.ProductData.GetByProductHandle(o,!1);r||discountNinja.Logging.LogWarning("No product data found for handle "+o,!0);var a=e.original_line_price/100;i.items.push({Key:e.key,Product:{VariantId:e.variant_id,ProductHandle:o,OriginalCompareAtPrice:r?r.CompareAtPrice/100:0,OriginalPrice:r?r.Price/100:0,DiscountedPrice:r?r.Price/100:0,Collections:r?r.Collections:""},Line:{OriginalPrice:a,DiscountedPrice:a}})}return i}(r,o),discountNinja_Script_DiscountedCart.DiscountedCart=o;for(var u=0,d=[],l=[],N=[],j=[],m=0;m<discountNinja.Offer.Offers.length;m++){var h=(I=discountNinja.Offer.Offers[m]).Tiers&&I.Tiers.length>0?I.Tiers[0]:null,C=h?h.Prerequisite:null,S=void 0!==C.MinimumAmount,y=void 0!==C.MinimumItems;void 0!==I.Bogo?j.push(I):S?l.push(I):y?d.push(I):N.push(I)}for(;a&&u<4;){u+=1,c(),o.total_original_price=0,o.total_discounted_price=0,o.total_discount=0,o.BogoUsed="",o.CartLevelDiscounts=[],o=s(N,r,o),discountNinja_Script_DiscountedCart.DiscountedCart=o,o=s(d,r,o),discountNinja_Script_DiscountedCart.DiscountedCart=o,o=s(l,r,o),discountNinja_Script_DiscountedCart.DiscountedCart=o;var _=JSON.parse(JSON.stringify(o)),v=g(p(n));//!4
v.length>24&&(discountNinja.Logging.LogWarning("The amount of permutations of order level offers exceeds the maximum limit",!0),v=v.slice(0,24));for(var P=[],L=0;L<v.length;L++)P.push(f(v[L],o)),o=JSON.parse(JSON.stringify(_)),discountNinja_Script_DiscountedCart.DiscountedCart=o;var T=-1,D=-1;for(L=0;L<P.length;L++){var E=P[L];E.total_discount>T&&(D=L,T=E.total_discount)}D>-1&&(o=f(v[D],o),discountNinja_Script_DiscountedCart.DiscountedCart=o),o=s(j,r,o),discountNinja_Script_DiscountedCart.DiscountedCart=o,a=1===u&&j.length>0}if(o.Shipping=null,discountNinja.Offer.Offers)for(m=0;m<discountNinja.Offer.Offers.length;m++){var I;if((I=discountNinja.Offer.Offers[m]).Entitlement&&"shipping_line"===I.Entitlement.TargetType&&discountNinja.Offer.OfferIsApplicable(I)&&!discountNinja.Offer.OfferIsExcluded(I)){var k=discountNinja.DiscountTier.GetCurrentDiscountTier(I);if(k){var b=k.DiscountCode;o.Shipping={OfferToken:I.Token,TriggerToken:discountNinja.Offer.GetTriggerTokenForOffer(I.Token),DiscountCode:b.Code,PriceRuleId:b.PriceRuleId,PriceRuleTitle:b.PriceRuleTitle,PriceRuleAppId:b.PriceRuleAppId,TargetType:I.Entitlement.TargetType}}if(o.Shipping&&o.Shipping.PriceRuleId)break}}var O=(new Date).getTime();o.Version=discountNinja_Script_DiscountedCart.Version+"-"+O,discountNinja_Script_DiscountedCart.Version=discountNinja_Script_DiscountedCart.Version+1,discountNinja.Cache.SessionRemove("PrerequisiteItemsCartValue"),function(t){try{if(t.items)for(var i=0;i<t.items.length;i++)(n=t.items[i]).OfferToken&&n.Tier&&(e=discountNinja.Offer.GetOfferByToken(n.OfferToken))&&(!e.AppliedTier||1*e.AppliedTier<1*n.Tier)&&(e.AppliedTier=n.Tier);if(t.CartLevelDiscounts)for(i=0;i<t.CartLevelDiscounts.length;i++){var n;(n=t.CartLevelDiscounts[i]).OfferToken&&n.Tier&&(e=discountNinja.Offer.GetOfferByToken(n.OfferToken))&&(!e.AppliedTier||1*e.AppliedTier<1*n.Tier)&&(e.AppliedTier=n.Tier)}if(discountNinja.Offer.PrimaryOffer){var e=discountNinja.Offer.GetOfferByToken(discountNinja.Offer.PrimaryOffer.Token);discountNinja.Offer.PrimaryOffer.AppliedTier=e.AppliedTier}}catch(t){discountNinja.Logging.LogError("DiscountedCart.SaveTiersUsed",t)}}(o),function(t){try{discountNinja.Cache.LocalSet("discounted-cart",JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("DiscountedCart.SaveDiscountedCartToCache",t)}}(o),discountNinja_Script_DiscountedCart.DiscountedCart=o,discountNinja_Script_DynamicPricing.DrawerCartIsDirty=!0,discountNinja_Script_DynamicPricing.ClassicCartIsDirty=!0}}else discountNinja_Script_DiscountedCart.DiscountedCart={items:[]},discountNinja_Script_DiscountedCart.IsDirty=!1}catch(t){discountNinja.Logging.LogError("DiscountedCart.BuildDiscountedCart",t)}discountNinja.DynamicPricing.UnblockPricesAndButtons();var A=discountNinja_Script_DiscountedCart.GetAppliedPromotions();if(A&&A.length>0)for(L=0;L<A.length;L++){var w=A[L].TriggerToken;w&&discountNinja.PromotionEvent.AddToQueue(w,2)}else discountNinja.Cache.SessionGet("CheckoutDiscountCode")&&discountNinja.DiscountCode.InjectDiscountCodesInHtmlElements(" ",!1);null!=t&&"function"==typeof t&&t(),i.resolve()}if(discountNinja.Logging.LogVerbose("Building discounted cart - START"),discountNinja_Script_DiscountedCart.IsDirty){var m=discountNinja_Script_DiscountedCart.DiscountedCart;m&&(m.CheckoutLink=null),function(){var t=[],i=window.discountNinjaContext?window.discountNinjaContext.Cart:null;if(i&&i.items)for(var n=0;n<i.items.length;n++){var e=discountNinja.ProductData.GetByProductHandle(i.items[n].handle,!0);t.push(e)}t.length>0?discountNinja.Utilities.jQuery().when.apply(discountNinja.Utilities.jQuery(),t).then((function(){j()})):j()}()}else discountNinja.Logging.LogVerbose("Building discounted cart - Assumed not dirty"),discountNinja_Script_DiscountedCart.DiscountedCart||(discountNinja.Logging.LogVerbose("Building discounted cart - Rehydrating from cache"),discountNinja_Script_DiscountedCart.DiscountedCart=discountNinja_Script_DiscountedCart.GetDiscountedCartFromCache()),discountNinja_Script_DiscountedCart.DiscountedCart?(discountNinja.Logging.LogVerbose("Building discounted cart - Rehydrating from cache - SUCCESS"),null!=t&&"function"==typeof t&&t()):discountNinja.Logging.LogWarning("Building discounted cart - Rehydrating from cache - FAILED"),discountNinja.DynamicPricing.UnblockPricesAndButtons();return i.promise()},SplitRows:function(){function t(t,i){var n=discountNinja_Script_DiscountedCart.FreeGiftPrefix+t,e=discountNinja_Script_DiscountedCart.SplitRowPrefix+t;return i?n:e}var i=discountNinja_Script_DiscountedCart.DiscountedCart;return!(!i||!i.items)&&function(){for(var n=0;n<i.items.length;n++){var e=i.items[n],o=e.OfferToken,r=e.Line;if(r.QuantityDiscounted>0&&r.QuantityNotDiscounted>0){discountNinja.Logging.LogInformation("Executing split on row "+n+" with key "+e.Key);var a=t(o);discountNinja.CartAdjustments.Add("changequantity_setproperty",e.Product.VariantId,r.QuantityDiscounted,a,"",e.Key);var c=discountNinja.LiquidData.CopyPropertiesExceptSplitKeys(e.Key);return discountNinja.CartAdjustments.Add("add",e.Product.VariantId,r.QuantityNotDiscounted,null,null,null,c,e.Product.ProductHandle),!0}}return!1}()},GetDiscountedCartFromCache:function(){try{var t=discountNinja.Cache.LocalGet("discounted-cart"),i="undefined"===t?null:JSON.parse(t);return i&&!i.CartLevelDiscounts&&(i.CartLevelDiscounts=[]),i}catch(t){return discountNinja.Logging.LogError("DiscountedCart.GetDiscountedCartFromCache",t),null}},GetCartItemKeys:function(){try{discountNinja_Script_DiscountedCart.DiscountedCart=discountNinja_Script_DiscountedCart.GetDiscountedCartFromCache();var t=discountNinja_Script_DiscountedCart.DiscountedCart;if(t&&t.items){for(var i="",n=0;n<t.items.length;n++)""!==i&&(i+=","),i+=t.items[n].Key;return i}return""}catch(t){discountNinja.Logging.LogError("DiscountedCart.GetCartItemKeys",t)}},ClearCartValueCache:function(){discountNinja.Cache.SessionSet("CartValue",null)},DiscountedCartItemsByDelegate:function(t){try{var i=[],n=discountNinja_Script_DiscountedCart.DiscountedCart;if(!n||!n.items||0===n.items.length)return i;for(var e=n.items,o=0;o<e.length;o++){var r=e[o];t(r)&&i.push(r)}return i}catch(t){return discountNinja.Logging.LogError("DiscountedCart.DiscountedCartItemsByDelegate",t),0}},GetDiscountedLinePriceFromItems:function(t){try{var i=0;if(t)for(var n=0;n<t.length;n++)i+=100*t[n].Line.DiscountedPrice;return i}catch(t){return discountNinja.Logging.LogError("DiscountedCart.GetDiscountedLinePriceFromItems",t),0}},ItemIsInCollection:function(t,i){return i.indexOf("%")>-1&&t.Product.OriginalCompareAtPrice>t.Product.OriginalPrice||discountNinja.Utilities.StringIsIn(t.Product.Collections,i)},ItemsInDiscountedCartFromCollections:function(t,i,n){try{return discountNinja_Script_DiscountedCart.DiscountedCartItemsByDelegate((function(e){return discountNinja_Script_DiscountedCart.ItemIsInCollection(e,t)&&(!n||!discountNinja_Script_DiscountedCart.IsGift(e))&&(!i||!discountNinja_Script_DiscountedCart.ItemIsInCollection(e,i))}))}catch(t){return discountNinja.Logging.LogError("DiscountedCart.ItemsInDiscountedCartFromCollections",t),0}},ItemsInDiscountedCartFromProducts:function(t,i,n){try{return discountNinja_Script_DiscountedCart.DiscountedCartItemsByDelegate((function(e){return discountNinja.Utilities.StringIsIn(t,e.Product.ProductHandle)&&(!n||!discountNinja_Script_DiscountedCart.IsGift(e))&&(!i||!discountNinja_Script_DiscountedCart.ItemIsInCollection(e,i))}))}catch(t){return discountNinja.Logging.LogError("DiscountedCart.ItemsInDiscountedCartFromProducts",t),0}},ItemsInDiscountedCartFromVariants:function(t,i,n){try{return discountNinja_Script_DiscountedCart.DiscountedCartItemsByDelegate((function(e){return discountNinja.Utilities.StringIsIn(t,e.Product.VariantId)&&(!n||!discountNinja_Script_DiscountedCart.IsGift(e))&&(!i||!discountNinja_Script_DiscountedCart.ItemIsInCollection(e,i))}))}catch(t){return discountNinja.Logging.LogError("DiscountedCart.ItemsInDiscountedCartFromVariants",t),0}},ItemsInDiscountedCart:function(t,i){try{return discountNinja_Script_DiscountedCart.DiscountedCartItemsByDelegate((function(n){return!(i&&discountNinja_Script_DiscountedCart.IsGift(n)||t&&discountNinja_Script_DiscountedCart.ItemIsInCollection(n,t))}))}catch(t){return discountNinja.Logging.LogError("DiscountedCart.ItemsInDiscountedCart",t),0}},IsGift:function(t){try{var i=discountNinja.LiquidData.CartItemByKey(t.Key);return!!i&&discountNinja.LiquidData.ItemIsGift(i)}catch(t){return discountNinja.Logging.LogError("DiscountedCart.IsGift",t),!1}},ValueInDiscountedCartFromCollections:function(t,i,n){try{var e=discountNinja_Script_DiscountedCart.TotalCartLevelDiscountInCents(),o=discountNinja_Script_DiscountedCart.ItemsInDiscountedCartFromCollections(t,i,n),r=discountNinja_Script_DiscountedCart.GetDiscountedLinePriceFromItems(o);return Math.max(0,r-e)}catch(t){return discountNinja.Logging.LogError("DiscountedCart.ValueInDiscountedCartFromCollections",t),0}},ValueInDiscountedCartFromProducts:function(t,i,n){try{var e=discountNinja_Script_DiscountedCart.TotalCartLevelDiscountInCents(),o=discountNinja_Script_DiscountedCart.ItemsInDiscountedCartFromProducts(t,i,n),r=discountNinja_Script_DiscountedCart.GetDiscountedLinePriceFromItems(o);return Math.max(0,r-e)}catch(t){return discountNinja.Logging.LogError("DiscountedCart.ValueInDiscountedCartFromProducts",t),0}},ValueInDiscountedCartFromVariants:function(t,i,n){try{var e=discountNinja_Script_DiscountedCart.TotalCartLevelDiscountInCents(),o=discountNinja_Script_DiscountedCart.ItemsInDiscountedCartFromVariants(t,i,n),r=discountNinja_Script_DiscountedCart.GetDiscountedLinePriceFromItems(o);return Math.max(0,r-e)}catch(t){return discountNinja.Logging.LogError("DiscountedCart.ValueInDiscountedCartFromVariants",t),0}},ValueInDiscountedCart:function(t,i){try{var n=discountNinja_Script_DiscountedCart.TotalCartLevelDiscountInCents(),e=discountNinja_Script_DiscountedCart.ItemsInDiscountedCart(t,i),o=discountNinja_Script_DiscountedCart.GetDiscountedLinePriceFromItems(e);return Math.max(0,o-n)}catch(t){return discountNinja.Logging.LogError("DiscountedCart.ValueInDiscountedCart",t),0}},TotalCartLevelDiscountInCents:function(){try{var t=0;if(discountNinja.DiscountedCart.DiscountedCart&&discountNinja.DiscountedCart.DiscountedCart.CartLevelDiscounts)for(var i=discountNinja.DiscountedCart.DiscountedCart.CartLevelDiscounts,n=0;n<i.length;n++)t+=100*i[n].Amount;return t}catch(t){return discountNinja.Logging.LogError("DiscountedCart.TotalCartLevelDiscountInCents",t),null}},GetFirstDiscountCode:function(){try{var t=discountNinja.DiscountedCart.DiscountedCart;if(!t)return!1;if(t.Shipping&&t.Shipping.DiscountCode&&(t.Shipping.PriceRuleId||t.Shipping.PriceRuleAppId))return t.Shipping.DiscountCode;if(t.CartLevelDiscounts)for(var i=0;i<t.CartLevelDiscounts.length;i++){if((n=t.CartLevelDiscounts[i]).DiscountCode&&(n.PriceRuleId||n.PriceRuleAppId))return n.DiscountCode}if(t.items)for(i=0;i<t.items.length;i++){var n;if((n=t.items[i]).DiscountCode&&(n.PriceRuleId||n.PriceRuleAppId))return n.DiscountCode}return null}catch(t){return discountNinja.Logging.LogError("DiscountedCart.GetFirstDiscountCode",t),null}},HasFreeShipping:function(){try{var t=discountNinja.DiscountedCart.DiscountedCart;return!!t&&!(!t.Shipping||!t.Shipping.OfferToken&&!t.Shipping.DiscountCode)}catch(t){return discountNinja.Logging.LogError("DiscountedCart.HasFreeShipping",t),!1}},CountAppliedPromotions:function(){try{var t=discountNinja_Script_DiscountedCart.GetAppliedPromotions();return null===t?0:t.length}catch(t){return discountNinja.Logging.LogError("DiscountedCart.CountAppliedPromotions",t),!1}},HasAppliedPromotions:function(){try{return discountNinja_Script_DiscountedCart.HasFreeShipping()||discountNinja_Script_DiscountedCart.CountAppliedPromotions()>0}catch(t){return discountNinja.Logging.LogError("DiscountedCart.HasAppliedPromotions",t),!1}},HasActivePromotions:function(){return null!==discountNinja.Offer.Offers&&null!==discountNinja.Offer.PrimaryOffer},GetAppliedPromotions:function(){try{var t=[],i=discountNinja.DiscountedCart.DiscountedCart;if(i&&i.items&&i.items.length>0){for(var n=0;n<i.items.length;n++){var e=(o=i.items[n]).OfferToken;discountNinja.Logging.LogVerbose("Line item discount code added to active list for token "+e),t.push({OfferToken:e,TriggerToken:o.TriggerToken,DiscountCode:o.DiscountCode,PriceRuleId:o.PriceRuleId,PriceRuleTitle:o.PriceRuleTitle,PriceRuleAppId:o.PriceRuleAppId,TargetType:o.TargetType})}for(n=0;n<i.CartLevelDiscounts.length;n++){e=(o=i.CartLevelDiscounts[n]).OfferToken;discountNinja.Logging.LogVerbose("Cart level discount code added to active list for token "+e),t.push({OfferToken:e,TriggerToken:o.TriggerToken,DiscountCode:o.DiscountCode,PriceRuleId:o.PriceRuleId,PriceRuleTitle:o.PriceRuleTitle,PriceRuleAppId:o.PriceRuleAppId,TargetType:o.TargetType})}if(i.Shipping){var o;e=(o=i.Shipping).OfferToken;discountNinja.Logging.LogVerbose("Shipping discount code added to active list for token "+e),t.push({OfferToken:e,TriggerToken:o.TriggerToken,DiscountCode:o.DiscountCode,PriceRuleId:o.PriceRuleId,PriceRuleTitle:o.PriceRuleTitle,PriceRuleAppId:o.PriceRuleAppId,TargetType:o.TargetType})}}var r=discountNinja.Cookie.GetDiscountCodeCookie();r&&(r=decodeURIComponent(r),discountNinja.Logging.LogVerbose("Native shareable link code added to active list"),t.push({OfferToken:null,TriggerToken:null,DiscountCode:r,PriceRuleId:null,PriceRuleAppId:null,PriceRuleTitle:null,TargetType:null,ShareableLink:"native"}));var a=function(){try{var t=discountNinja.Checkout.Shopify.GetCheckoutForm().find('input[name="discount"]').val();return t&&null!==t&&""!==decodeURIComponent(t).trim()?formFietrimmedFormFieldValueldValue:null}catch(t){return null}}();a&&(a=decodeURIComponent(a),discountNinja.Logging.LogVerbose("Adding code from form"),t.push({OfferToken:null,TriggerToken:null,DiscountCode:a,PriceRuleId:null,PriceRuleTitle:null,PriceRuleAppId:null,TargetType:null,ShareableLink:"form"}));var c=discountNinja_Script_DiscountCode.GetDiscountCodeFromQueryParameter();if(c&&""!==c){discountNinja.Logging.LogVerbose("Query parameter discount code added to active list"),c=c.split(",");for(n=0;n<c.length;n++){var s=decodeURIComponent(c[n]);t.push({OfferToken:null,TriggerToken:null,DiscountCode:s,PriceRuleId:null,PriceRuleTitle:null,PriceRuleAppId:null,TargetType:null,ShareableLink:"queryparameter"})}}var u=discountNinja_Script_DiscountCode.GetExternalDiscountCodesFromCache();if(u)for(var d=0;d<u.length;d++)discountNinja.Logging.LogVerbose("External code added to active list"),t.push(u[d]);for(var l=[],g=0;g<t.length;g++){var p=!0;if(t[g]){if(!t[g].DiscountCode){if(!t[g].OfferToken)continue;t[g].DiscountCode=t[g].OfferToken}for(var f=0;f<l.length;f++){var N=l[f];if(l[f].PriceRuleTitle===t[g].PriceRuleTitle){void 0!==N.OfferToken&&null!==N.OfferToken||(N.OfferToken=t[g].OfferToken),void 0!==N.TriggerToken&&null!==N.TriggerToken||(N.TriggerToken=t[g].TriggerToken),void 0!==N.PriceRuleId&&null!==N.PriceRuleId||(N.PriceRuleId=t[g].PriceRuleId),void 0!==N.PriceRuleTitle&&null!==N.PriceRuleTitle||(N.PriceRuleTitle=t[g].PriceRuleTitle),void 0!==N.PriceRuleAppId&&null!==N.PriceRuleAppId||(N.PriceRuleAppId=t[g].PriceRuleAppId),void 0!==N.TargetType&&null!==N.TargetType||(N.TargetType=t[g].TargetType),p=!1;break}}p&&l.push(t[g])}}for(n=0;n<l.length;n++){if((N=l[n]).DiscountCode){var j=discountNinja.Offer.AllOffers;if(j)for(var m=0;m<j.length;m++){var h=j[m];for(d=0;d<h.Tiers.length;d++){var C=h.Tiers[d];if(C.DiscountCode.Code===N.DiscountCode){void 0!==N.OfferToken&&null!==N.OfferToken||(N.OfferToken=h.Token),void 0!==N.TriggerToken&&null!==N.TriggerToken||(N.TriggerToken=discountNinja.Offer.GetTriggerTokenForOffer(h.Token)),void 0!==N.PriceRuleId&&null!==N.PriceRuleId||(N.PriceRuleId=C.DiscountCode.PriceRuleId),void 0!==N.PriceRuleTitle&&null!==N.PriceRuleTitle||(N.PriceRuleTitle=C.DiscountCode.PriceRuleTitle),void 0!==N.PriceRuleAppId&&null!==N.PriceRuleAppId||(N.PriceRuleAppId=C.DiscountCode.PriceRuleAppId),void 0!==N.TargetType&&null!==N.TargetType||(N.TargetType=h.Entitlement.TargetType);break}}}}}return l=function(t){var i=[];if(t)for(var n=0;n<t.length;n++){var e=t[n];if("native"===e.ShareableLink||"queryparameter"===e.ShareableLink||"form"===e.ShareableLink){var o=!1;if(discountNinja.Offer.Offers&&!o)for(var r=0;r<discountNinja.Offer.Offers.length;r++)if(!o)for(var a=discountNinja.Offer.Offers[r],c=0;c<a.Tiers.length;c++)if(a.Tiers[c].DiscountCode.Code===e.DiscountCode){o=!0;break}if(!o){var s="discountcode-lookup-"+e.DiscountCode;null===discountNinja.Cache.SessionGet(s)&&(i.push(e),discountNinja.DiscountCode.AddDiscountCodeFromLookup(e.DiscountCode,(function(){discountNinja.Cache.SessionSet(s,"1")})))}}else i.push(e)}return i}(l)}catch(t){return discountNinja.Logging.LogError("DiscountedCart.GetAppliedPromotions",t),[]}},CheckSum:function(){try{var t=discountNinja.DiscountedCart.DiscountedCart;if(!t||!t.items)return null;for(var i="",n=0;n<t.items.length;n++)i+="LI::"+(o=t.items[n]).Key+"_"+(o.OfferToken||"")+"_"+o.Line.DiscountedPrice+"_"+(o.Line.QuantityDiscounted+o.Line.QuantityNotDiscounted)+"|";if(t.CartLevelDiscounts)for(n=0;n<t.CartLevelDiscounts.length;n++)i+="CLD::"+((e=t.CartLevelDiscounts[n]).OfferToken||"")+"_"+e.Amount+"|";return t.Shipping&&(i+="SH::"+t.Shipping.OfferToken+"|"),i+="TD::"+(t.total_discounted_price||"0")}catch(t){return discountNinja.Logging.LogError("DiscountedCart.CheckSum",t),null}var e,o}},discountNinja_Script_DiscountedProduct={Get:function(t,i,n,e,o,r,a,c,s,u,d){try{var l=!1;c||(c=1,l=!0);var g=null!=s?a.Tiers[s]:discountNinja.DiscountTier.GetCurrentDiscountTier(a);if(null===g)return null;var p=a.Entitlement.ValueType,f=a.Entitlement.DiscountPriceType,N=g.Entitlement.Amount||0,j=g.Entitlement.Percentage||0,m=discountNinja.Settings.Settings.Currency,h=m.RoundPrices,C=m.RoundToCents,S={Key:t,VariantId:i,ProductHandle:n,OriginalPrice:e*c/100,OriginalCompareAtPrice:o*c/100,Amount:N*c>e*c?e*c:N*c,Percentage:Math.min(j,100)};(void 0===S.OriginalCompareAtPrice||null===S.OriginalCompareAtPrice||0===S.OriginalCompareAtPrice||isNaN(S.OriginalCompareAtPrice)||S.OriginalCompareAtPrice<S.OriginalPrice)&&(S.OriginalCompareAtPrice=S.OriginalPrice),S.EffectiveCompareAtPrice=S.OriginalCompareAtPrice,"price"===f&&(S.EffectiveCompareAtPrice=S.OriginalPrice);var y=S.EffectiveCompareAtPrice;if(y>0){var _=1;if(l&&void 0!==u&&void 0!==d&&(_=u/(u+d)),"fixed_amount"===p)S.DiscountedPrice=discountNinja.Utilities.RoundToNumberOfDigits((y-S.Amount)*_,2),S.Percentage=Math.min(0===y?0:Math.abs(S.Amount/y*100),100);else if("percentage"===p){var v=y*S.Percentage/100*_;N=discountNinja.Utilities.FloorToNumberOfDigits(v,2);S.DiscountedPrice=discountNinja.Utilities.RoundToNumberOfDigits(y-N,2),S.Amount=Math.max(discountNinja.Utilities.RoundToNumberOfDigits(y-S.DiscountedPrice,2),0)}if(S.DiscountedPrice<0&&(S.DiscountedPrice=0),h){var P=100*S.DiscountedPrice;P>0&&(P=100*Math.floor(P/100)+C),S.DiscountedPrice=Math.round(P)/100}}else S.DiscountedPrice=0,S.Amount=0;return S.InventoryLeft=r,S.OfferToken=a.Token,S.TriggerToken=discountNinja.Offer.GetTriggerTokenForOffer(a.Token),S.DiscountCode=g.DiscountCode.Code,S}catch(t){return discountNinja.Logging.LogError("DiscountedProduct.Get",t),null}},GetFromProductPage:function(){try{if(discountNinja.Environment.Shopify.IsProductPage()){var t=discountNinja.Environment.Shopify.ProductHandle(),i=discountNinja.Environment.Shopify.VariantId(),n=discountNinja.LiquidData.Price(i);if(null===n)return null;var e=discountNinja.LiquidData.CompareAtPrice(i),o=discountNinja.LiquidData.Inventory(i),r=discountNinja.Offer.GetOfferForProduct(t,i,null,o,n,e,!0,!0);return r?discountNinja_Script_DiscountedProduct.Get(null,i,t,n,e,o,r):null}return null}catch(t){discountNinja.Logging.LogError("DiscountedProduct.GetFromProductPage",t)}}},discountNinja_Script_DiscountTier={ExceedsUpperLimits:function(t,i,n){if(!i)return!1;var e=i.Prerequisite;if(e.MaximumItems>0){var o=discountNinja.Prerequisite.EntitledQuantityInfo(t,i).Prerequisites;if(null!==o&&o>e.MaximumItems)return!0}return!!(e.MaximumAmount&&n>100*e.MaximumAmount)},GetCurrentDiscountTierNumber:function(t,i,n,e){function o(t,i,n,e){try{if(!i||!t)return!1;if(!discountNinja.Offer.IsOfferAccepted(t.Token,t.Frequency))return!1;var o,r=i.Prerequisite;if(discountNinja_Script_DiscountTier.ExceedsUpperLimits(t,i,n))return!1;if(r.MinimumAmount&&n<100*r.MinimumAmount)return!1;if(r.MinimumItems>0)if(null===(o=discountNinja.Prerequisite.EntitledQuantityInfo(t,i).Prerequisites)||o<r.MinimumItems)return!1;if(r.BogoPrerequisiteQuantity>0)if(null===(o=discountNinja.Prerequisite.EntitledQuantityInfo(t,i).Prerequisites)||o<r.BogoPrerequisiteQuantity)return!1;return!0}catch(t){return discountNinja.Logging.LogError("DiscountTier.DiscountTierIsApplicable",t),!1}}try{if(null==n&&(n=!0),!discountNinja.Offer.OfferIsApplicable(t))return null;if(t.AppliedTier&&!0!==e)return t.AppliedTier;if("object"==typeof t.Bogo){var r=t.Tiers[0];if(o(t,r,i)){var a=r.Entitlement.EntitledQuantity,c=discountNinja.Prerequisite.EntitledQuantityInfo(t,r),s=Math.floor(c.Entitled/a);if(s>0)return s}return i>0?0:-1}return o(t,t.Tiers[4],i)?5:o(t,t.Tiers[3],i)?4:o(t,t.Tiers[2],i)?3:o(t,t.Tiers[1],i)?2:o(t,t.Tiers[0],i)?1:i>0?0:-1}catch(t){return discountNinja.Logging.LogError("DiscountTier.GetCurrentDiscountTierNumber",t),-1}},GetMaxDiscountTierNumber:function(t){try{if("object"==typeof t.Tiers[4])return 5;if("object"==typeof t.Tiers[3])return 4;if("object"==typeof t.Tiers[2])return 3;if("object"==typeof t.Tiers[1])return 2;var i=t.Entitlement.AllocationLimit,n=i>-1;return"object"==typeof t.Bogo?n?Math.floor(t.Tiers[0].Entitlement.EntitledQuantity/i):999999:1}catch(t){return discountNinja.Logging.LogError("DiscountTier.GetMaxDiscountTierNumber",t),1}},GetCurrentDiscountTier:function(t,i){try{if(null==i&&(i=!0),t.AppliedTier&&t.Tiers)return t.Tiers[t.AppliedTier-1];var n=discountNinja.Offer.PrerequisiteItemsCartValue(t),e=discountNinja_Script_DiscountTier.GetCurrentDiscountTierNumber(t,n,i);if(null===e||0===e||-1===e)return null;"object"==typeof t.Bogo&&(e=1);var o=discountNinja_Script_DiscountTier.GetMaxDiscountTierNumber(t),r=t.Tiers[e-1];return r.IsMaxTier=o===e,r.Level=e,r}catch(t){return discountNinja.Logging.LogError("DiscountTier.GetCurrentDiscountTier",t),null}},GetGoalDiscountTierNumber:function(t,i){try{null==i&&(i=!0);var n=discountNinja.Offer.PrerequisiteItemsCartValue(t);if("object"==typeof t.Bogo)return Math.max(0,discountNinja_Script_DiscountTier.GetCurrentDiscountTierNumber(t,n,i,!0))+1;var e=discountNinja_Script_DiscountTier.GetCurrentDiscountTierNumber(t,n,i);if(null===e)return null;var o=discountNinja_Script_DiscountTier.GetMaxDiscountTierNumber(t);return 5===e?-1:4===e?o<=4?-1:5:3===e?o<=3?-1:4:2===e?o<=2?-1:3:1===e?o<=1?-1:2:1}catch(t){return discountNinja.Logging.LogError("DiscountTier.GetGoalDiscountTier",t),null}},GetGoalDiscountTier:function(t,i){try{null==i&&(i=!0);var n=discountNinja_Script_DiscountTier.GetGoalDiscountTierNumber(t,i);if(null===n||-1===n)return null;var e=t.Tiers[n-1];return"object"==typeof e?e:t.Tiers[0]}catch(t){return discountNinja.Logging.LogError("DiscountTier.GetGoalDiscountTier",t),null}},GetPercentageAmountFromDiscountTier:function(t){try{return t?{Percentage:t.Entitlement.Percentage,Amount:t.Entitlement.Amount}:null}catch(t){discountNinja.Logging.LogError("DiscountTier.GetPercentageAmountFromDiscountTier",t)}},GoalAchieved:function(t,i){try{null==i&&(i=!0);var n=discountNinja.Offer.PrerequisiteItemsCartValue(t),e=discountNinja_Script_DiscountTier.GetCurrentDiscountTierNumber(t,n,i);return null!==e&&e>0}catch(t){return discountNinja.Logging.LogError("DiscountTier.GoalAchieved",t),!1}}},discountNinja_Script_DynamicPricing_Classes_Prefix="limoniapps-discountninja-",discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix=discountNinja_Script_DynamicPricing_Classes_Prefix+"productprice",discountNinja_Script_DynamicPricing_Classes_ProductBanner_Prefix=discountNinja_Script_DynamicPricing_Classes_Prefix+"promotioncard-productpage",discountNinja_Script_DynamicPricing_Attributes_Prefix="data-limoniapps-discountninja-",discountNinja_Script_DynamicPricing={Classes:{Prefix:discountNinja_Script_DynamicPricing_Classes_Prefix,ProductPrice:{OriginalPrice:discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+"-original",ReplacedPrice:discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+"-replaced",ShowAfterReplace:discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+"-showafterreplace",HideAfterReplace:discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+"-hideafterreplace",Wrapper:discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+"-wrapper",Injected:discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+"-injected"},ProductBanner:{Injected:discountNinja_Script_DynamicPricing_Classes_ProductBanner_Prefix+"-injected",Prerequisite:discountNinja_Script_DynamicPricing_Classes_ProductBanner_Prefix+"-prerequisite"},Cart:{PriceForLevel:discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-[LEVEL]-price",CommentForLevel:discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-[LEVEL]-comment",Root:discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-root",DrawerCartRoot:discountNinja_Script_DynamicPricing_Classes_Prefix+"drawercart-root",ProductPrice:discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-item-product-price",LinePrice:discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-item-line-price",Quantity:discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-item-quantity",SubtotalPrice:discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-subtotal-price",SubtotalPriceInjected:discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-subtotal-price-injected",SubtotalInjected:discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-subtotal-injected"},Collection:{FeaturedProduct:discountNinja_Script_DynamicPricing_Classes_Prefix+"featuredproduct"},ProductPrice_Legacy:"limoniapps-discounturl-productprice",Blocking:{BlockLookupCode:discountNinja_Script_DynamicPricing_Classes_Prefix+"block-lookupcode",Block:discountNinja_Script_DynamicPricing_Classes_Prefix+"block",BlockStop:discountNinja_Script_DynamicPricing_Classes_Prefix+"block-stop"}},Attributes:{DiscountNinja:{Token:"data-token",Ignore:discountNinja_Script_DynamicPricing_Attributes_Prefix+"dynamicpricing-ignore",IgnoreSystem:discountNinja_Script_DynamicPricing_Attributes_Prefix+"dynamicpricing-ignore-system",CartLineItemKey:"data-limoniapps-discountninja-cart-key",QuantitySpinnerHide:"limoniapps-discountninja-cart-item-quantity-hide",QuantitySpinnerDisable:"limoniapps-discountninja-cart-item-quantity-disable"}},ReplacingPricesInCart:!1,DrawerCartReplacingPricesInCart:[],ProductPriceSelector:function(){return"."+discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+",."+discountNinja_Script_DynamicPricing.Classes.ProductPrice_Legacy},BuildFormattedDiscountedPrice:function(t,i,n,e){var o=t.Format,r=discountNinja.ShortCode.ReplaceAllPlaceHolders(i,o,n);if(t.Animation){var a=t.AnimationIterations>0?' style="animation-iteration-count: '+t.AnimationIterations+' !important;"':"";r='<div class="'+t.Animation+'"'+a+">"+r+"</div>"}e&&n.PriceVaries&&(r='<div class="limoniapps-discountninja-product-label limoniapps-discountninja-label-from">'+window.discountNinjaContext.Labels.From+"</div>"+"&nbsp;"+r);var c="";t.PrefixText&&(c='<div class="limoniapps-discountninja-presuffix prefix '+t.PrefixStyle+'">'+discountNinja.ShortCode.ReplaceAllPlaceHolders(i,t.PrefixText,n)+"</div>");var s="";t.SuffixText&&(s='<div class="limoniapps-discountninja-presuffix suffix '+t.SuffixStyle+'">'+discountNinja.ShortCode.ReplaceAllPlaceHolders(i,t.SuffixText,n)+"</div>");var u='<div class="limoniapps-discountninja-discountedprice">'+c+r+s+"</div>",d=discountNinja.Settings.Settings.Currency;return discountNinja_Script_ShortCode.ContainsPlaceHolder(u,"{{CURRENCY}}")&&(u=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(i,null,u,!0,"{{CURRENCY}}","offer","currency",d.BaseCurrency)),discountNinja_Script_ShortCode.ContainsPlaceHolder(u,"{{CURRENCY_SYMBOL}}")&&(u=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(i,null,u,!0,"{{CURRENCY_SYMBOL}}","offer","currency_symbol",d.BaseCurrencySymbol)),u},BuildFormattedPrice:function(t,i,n,e,o,r,a,c,s){var u=null,d=n?n.Token:"";i=i||{Format:"{{DISCOUNTED_PRICE}} {{ORIGINAL_PRICE,STRIKETHROUGH}}"};var l='<div class="'+discountNinja_Script_DynamicPricing.Classes.ProductPrice.OriginalPrice+'" '+discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.Token+'="'+d+'" style="display:none;">'+t+"</div>";u=r?'<div class="limoniapps-discountninja-product-label limoniapps-discountninja-label-soldout">'+window.discountNinjaContext.Labels.SoldOut+"</div>":discountNinja_Script_DynamicPricing.BuildFormattedDiscountedPrice(i,n,e,o);var g='<div class="'+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice+" limoniapps-discountninja-"+c+'page" data-token="'+d+'"'+(s?"":' style="display:none;"')+">"+u+"</div>",p=discountNinja.Settings.Settings.Currency;discountNinja_Script_ShortCode.ContainsPlaceHolder(g,"{{CURRENCY}}")&&(g=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(n,null,g,!0,"{{CURRENCY}}","offer","currency",p.BaseCurrency)),discountNinja_Script_ShortCode.ContainsPlaceHolder(g,"{{CURRENCY_SYMBOL}}")&&(g=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(n,null,g,!0,"{{CURRENCY_SYMBOL}}","offer","currency_symbol",p.BaseCurrencySymbol));var f="";return f=a?g+l:elementHtml.replace(t,g+l),discountNinja.Logging.LogVerbose("Replacing price with "+f),f},InjectPlaceHolder:{Inject:function(t,i,n,e){function o(t,i){return 0===t.indexOf(i)?{Text:t.substring(i.length),KeywordFound:!0}:{Text:t,KeywordFound:!1}}var r=discountNinja_Script_DynamicPricing.InjectPlaceHolder;if(null!=t)if("underproducttitle"===t)r.UnderProductTitle(i);else if("aboveatcform"===t)r.AboveATCForm(i);else if("underatcform"===t)r.UnderATCForm(i);else if("aboveatcbutton"===t)r.AboveATCButton(i);else if("underatcbutton"===t)r.UnderATCButton(i);else if("abovecheckoutbutton"===t)r.AboveCheckoutButton(i);else if("undercheckoutbutton"===t)r.UnderCheckoutButton(i);else if("abovecheckoutform"===t)r.AboveCheckoutForm(i);else if("undercheckoutform"===t)r.UnderCheckoutForm(i);else{var a,c,s,u,d,l,g,p,f,N,j,m,h,C,S,y,_,v=t,P=o(v,"[[REPLACECONTENT]]");a=P.KeywordFound,s=(P=o(P.Text,"[[WRAP]]")).KeywordFound,c=(P=o(P.Text,"[[REPLACE]]")).KeywordFound,u=(P=o(P.Text,"[[BEFORE]]")).KeywordFound,d=(P=o(P.Text,"[[AFTER]]")).KeywordFound,y=(P=o(P.Text,"[[APPEND]]")).KeywordFound,_=(P=o(P.Text,"[[PREPEND]]")).KeywordFound,l=(P=o(P.Text,"[[HIDE]]")).KeywordFound,g=(P=o(P.Text,"[[LEFT]]")).KeywordFound,p=(P=o(P.Text,"[[CENTER]]")).KeywordFound,f=(P=o(P.Text,"[[RIGHT]]")).KeywordFound,N=(P=o(P.Text,"[[LEFT_MOBILE]]")).KeywordFound,j=(P=o(P.Text,"[[CENTER_MOBILE]]")).KeywordFound,m=(P=o(P.Text,"[[RIGHT_MOBILE]]")).KeywordFound,h=(P=o(P.Text,"[[LEFT_DESKTOP]]")).KeywordFound,C=(P=o(P.Text,"[[CENTER_DESKTOP]]")).KeywordFound,S=(P=o(P.Text,"[[RIGHT_DESKTOP]]")).KeywordFound,v=P.Text;var L=n?discountNinja.Utilities.jQuery()(n).find(v):discountNinja.Utilities.jQuery()(v);if(e&&(L=L.first()),L.length>0){var T=discountNinja.Utilities.IsMobilePhone();if(a||c||u||d||s||y||_){var D="limoniapps-discountninja-align-",E=null;(g||N&&T||h&&!T)&&(E=D+"left"),(p||j&&T||C&&!T)&&(E=D+"center"),(f||m&&T||S&&!T)&&(E=D+"right"),E&&(i=discountNinja.Utilities.jQuery()(i).addClass(E))}s?L.wrap(i):a?L.html(i):c?L.replaceWith(i):u?L.before(i):d?L.after(i):y?L.append(i):_&&L.prepend(i),l&&L.addClass("limoniapps-discountninja-whenpromotionsincart-hide")}}},InjectElement:function(t,i,n){i?t.after(n):t.before(n)},AboveATCForm:function(t){var i=discountNinja.Utilities.jQuery()(discountNinja.Environment.Shopify.SelectorAddToCartForm()).first();discountNinja_Script_DynamicPricing.InjectPlaceHolder.InjectElement(i,!1,t)},UnderATCForm:function(t){var i=discountNinja.Utilities.jQuery()(discountNinja.Environment.Shopify.SelectorAddToCartForm()).first();discountNinja_Script_DynamicPricing.InjectPlaceHolder.InjectElement(i,!0,t)},UnderProductTitle:function(t){var i=discountNinja.Utilities.jQuery()("h1").first();0===i.length?discountNinja_Script_DynamicPricing.InjectPlaceHolder.AboveATCForm(t):discountNinja_Script_DynamicPricing.InjectPlaceHolder.InjectElement(i,!0,t)},UnderATCButton:function(t){var i=discountNinja.Utilities.jQuery()(".limoniapps-discountninja-addtocartbutton, "+discountNinja.Environment.Shopify.SelectorAddToCartForm()+" "+discountNinja.Environment.Shopify.SelectorAddToCartButton()).first();0===i.length?discountNinja_Script_DynamicPricing.InjectPlaceHolder.UnderATCForm(t):discountNinja_Script_DynamicPricing.InjectPlaceHolder.InjectElement(i,!0,t)},AboveATCButton:function(t){var i=discountNinja.Utilities.jQuery()(".limoniapps-discountninja-addtocartbutton, "+discountNinja.Environment.Shopify.SelectorAddToCartForm()+" "+discountNinja.Environment.Shopify.SelectorAddToCartButton()).first();0===i.length?discountNinja_Script_DynamicPricing.InjectPlaceHolder.UnderATCForm(t):discountNinja_Script_DynamicPricing.InjectPlaceHolder.InjectElement(i,!1,t)},UnderCheckoutForm:function(t){var i=discountNinja.Checkout.Shopify.GetCheckoutForm().first();discountNinja_Script_DynamicPricing.InjectPlaceHolder.InjectElement(i,!0,t)},AboveCheckoutForm:function(t){var i=discountNinja.Checkout.Shopify.GetCheckoutForm().first();discountNinja_Script_DynamicPricing.InjectPlaceHolder.InjectElement(i,!1,t)},UnderCheckoutButton:function(t){var i=discountNinja.Utilities.jQuery()(".limoniapps-discountninja-checkoutbutton, "+discountNinja.Environment.Shopify.SelectorCheckoutForm()+" "+discountNinja.Environment.Shopify.SelectorCheckoutButton()).first();0===i.length?discountNinja_Script_DynamicPricing.InjectPlaceHolder.UnderATCForm(t):discountNinja_Script_DynamicPricing.InjectPlaceHolder.InjectElement(i,!0,t)},AboveCheckoutButton:function(t){var i=discountNinja.Utilities.jQuery()(".limoniapps-discountninja-checkoutbutton, "+discountNinja.Environment.Shopify.SelectorCheckoutForm()+" "+discountNinja.Environment.Shopify.SelectorCheckoutButton()).first();0===i.length?discountNinja_Script_DynamicPricing.InjectPlaceHolder.UnderATCForm(t):discountNinja_Script_DynamicPricing.InjectPlaceHolder.InjectElement(i,!1,t)}},OnCollectionPageProductsAdded:function(){discountNinja_Script_DynamicPricing.UpdatePrice(!0,!1,!0)},OnQuickViewProductDisplayed:function(){discountNinja_Script_DynamicPricing.UpdatePrice(!0,!0,!0)},ReplaceInstalmentsPrices:function(t){function i(){try{if(t||discountNinja.Environment.Shopify.IsProductPage()){if(t||(t=discountNinjaContext.CurrentProductInfo),!t)return;return discountNinja.ShortCode.ReplaceAllPlaceHolders(null,"{{DISCOUNTED_INSTALLMENT_4PERIODS}}",t)}return discountNinja.ShortCode.ReplaceAllPlaceHolders(null,"{{DISCOUNTED_INSTALLMENT_4PERIODS_SUBTOTAL}}",null)}catch(t){return discountNinja.Logging.LogError("DynamicPricing.ReplaceInstalmentsPrices",t),!1}}function n(){try{var t=discountNinja.Utilities.jQuery()("shopify-payment-terms");if(t&&t.length>0){var n=/installments of (.*) with/;t.each((function(t,e){try{var o=e.shadowRoot;if(o){var r=o.getElementById("shopify-installments-content"),a=r.innerHTML.match(n)[1];r.innerHTML=r.innerHTML.replace(a,i())}}catch(t){return discountNinja.Logging.LogError("DynamicPricing.ReplaceInstalmentsPrices.ShopPay",t),!1}}))}var e=discountNinja.Utilities.jQuery()("shopify-installments-modal");if(e&&e.length>0)try{var o=discountNinja.Utilities.jQuery()("shopify-installments-modal")[0].shadowRoot;if(o){var r=o.querySelectorAll(".price")[0];if(-1===r.innerHTML.indexOf("limoniapps")){var a=r.innerHTML.match(/([^<]*)/)[1];r.innerHTML=r.innerHTML.replace(a,i())}}}catch(t){return discountNinja.Logging.LogError("DynamicPricing.ReplaceInstalmentsPrices.ShopPay",t),!1}}catch(t){return discountNinja.Logging.LogError("DynamicPricing.ReplaceInstalmentsPrices",t),!1}}try{var e=discountNinja.Utilities.jQuery()('quadpay-widget [slot="qpDisplayAmount"], .afterpay-instalments,.afterpay_instalments,#afterpay-instalments,#afterpay_instalments,.sezzle-payment-amount');e&&e.length>0&&(discountNinja.Logging.LogVerbose("Replacing instalments amount"),discountNinja.Utilities.jQuery()(e).html(i()));var o=discountNinja.Utilities.jQuery()("shopify-payment-terms");o&&o.length>0&&(n(),setTimeout((function(){n()}),500),setTimeout((function(){n()}),1e3))}catch(t){return discountNinja.Logging.LogError("DynamicPricing.ReplaceInstalmentsPrices",t),!1}},UpdatePrice:function(t,i,n){function e(t){var i=discountNinja.Settings.Settings.PriceUpdate.Mode,e=discountNinja.Utilities.IsMobilePhone(),o=t?e&&i.ProductPriceMobile||i.ProductPrice:e&&i.CollectionProductPriceMobile||i.CollectionProductPrice,r=discountNinja_Script_DynamicPricing.InjectPlaceHolder,a=discountNinja_Script_DynamicPricing.Classes.ProductPrice.Injected+(t?"-product":"-collectionproduct");if(o&&"custom"!==o&&"none"!==o&&(n||!(discountNinja.Utilities.jQuery()("."+a).length>0))){var c='<div class="'+discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+" "+a+'"></div>';r.Inject(o,c,null,t)}}function o(i,r){try{if(isNaN(r)&&(r=1),r>10)return!0;var c=!1;if(discountNinja_Script_DynamicPricing.IsDynamicPricingRequired(i,!1)){discountNinja.Logging.LogInformation("FLOW: Updating price"),discountNinja.Utilities.jQuery()(".rc_price__onetime").addClass(discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix),discountNinja.Environment.Shopify.IsProductPage()?(e(!0),e(!1)):discountNinja.Environment.Shopify.IsHomePage()?(!function(){var t=discountNinja.Settings.Settings.PriceUpdate.Mode,i=t.FeaturedProductPrice,e=discountNinja_Script_DynamicPricing.InjectPlaceHolder,o=discountNinja_Script_DynamicPricing.Classes.ProductPrice.Injected+"-featuredproduct";if(i&&"custom"!==i&&"none"!==i&&(n||!(discountNinja.Utilities.jQuery()("."+o).length>0))){var r=t.FeaturedProductCard,a=t.FeaturedProductHandle;if(null!==r&&""!==r&&null!==a&&""!==a){var c=i.replace(/\[\[.*\]\]/g,"");discountNinja.Utilities.jQuery()(c).each((function(){var t=discountNinja.Utilities.GetHandleFromSelector(this,r,a);if(t){var n='<div data-limoniapps-discountninja-product-handle="'+t+'" class="'+discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+" "+discountNinja_Script_DynamicPricing.Classes.Collection.FeaturedProduct+" "+o+'"></div>';e.Inject(i,n,null,!0)}}))}}}(),e(!1)):e(!1);var s=discountNinja_Script_DynamicPricing.ProductPriceSelector(),u=discountNinja.Utilities.jQuery()(s+":not(["+discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.Ignore+"])");u.length>0&&(c=!0,u.each((function(t,i){a(i,1)})))}else discountNinja.Logging.LogInformation("FLOW: Not updating price",!0,!1);t||discountNinja_Script_DynamicPricing.ReplacePricesInCart(),discountNinja_Script_DynamicPricing.Show();var d=discountNinja.Settings.GetFlag("ProductsAreLoadedAsynchronously");return!(!c&&d)||(discountNinja.Logging.LogVerbose("Didn't find any prices to replace, assuming they are loaded asynchronously. Attempting again after delay."),r+=1,setTimeout((function(){o(i,r)}),100))}catch(t){discountNinja.Logging.LogError("DynamicPricing.UpdatePriceInternal",t)}}function r(t,i,n,e,o){var r=!!n&&!discountNinja_Script_ProductData.ProductIsAvailable(n),a=discountNinja.Settings.GetFlag("HideCollectionBadgeForSoldOutProducts");if((!r||!1===a)&&e.CollectionProductBadge&&"none"!==e.CollectionProductBadge){if("custom"!==e.CollectionProductBadge)t=discountNinja.Utilities.jQuery()(t).find(e.CollectionProductBadge);else{var c=discountNinja.Utilities.jQuery()(t).find(".limoniapps-discountninja-collectionbadge");c&&1===c.length&&(t=c)}t&&!discountNinja.Utilities.jQuery()(t).hasClass("limoniapps-discountninja-collectionbadge-ignore")&&discountNinja.Badge.Add(i,n,t,o)}}function a(t,i){try{var n=0,e=0,o=discountNinja.Settings.Settings.PriceUpdate.Mode,d=discountNinja.Utilities.jQuery()(t),l=discountNinja.Environment.Shopify.IsProductPage(),g=discountNinja.Environment.Shopify.ProductHandle(),p=discountNinja.Environment.Shopify.IsHomePage()&&d.hasClass(discountNinja_Script_DynamicPricing.Classes.Collection.FeaturedProduct),f=o.CollectionProductCard,N=f&&"custom"!==f&&"none"!==f?","+f:"",j="";if(p){var m=o.FeaturedProductCard;j=m&&"custom"!==m&&"none"!==m?","+m:""}var h=d.closest("[data-limoniapps-discountninja-product-handle],[data-limoniapps-discounturl-product-handle]"+N+j);discountNinja.Utilities.jQuery()(h).removeClass("limoniapps-discountninja-hidethirdpartybadges");var C=!1,S=null,y=null,_=null,v=!1,P=0,L=null;if(null===h||1!==h.length){if(!l)return discountNinja.Logging.LogVerbose("Product handle found on non-product page"),5===i||setTimeout((function(){a(t,i+1)}),500*i),!1;_=discountNinja.LiquidData.ProductCollections(),C=!0,discountNinja.Logging.LogVerbose("No product handle found, assuming the product is the product on the current product page");var T="data-limoniapps-discountninja-product-variant";if(!(L=d.closest("["+T+"]").attr(T)||discountNinja.Environment.Shopify.VariantId()))return discountNinja.Logging.LogVerbose("No product variant found on product page"),5===i||setTimeout((function(){a(t,i+1)}),500*i),!1;if(null===(n=discountNinja.LiquidData.Price(L)))return void discountNinja.Logging.LogVerbose("No price available");e=discountNinja.LiquidData.CompareAtPrice(L),y=discountNinja.LiquidData.Inventory(L),discountNinja.Logging.LogVerbose("Loading pricing for variant "+L+": price "+n+", compare at:"+e)}else{if(discountNinja.Logging.LogVerbose("Product handle found, assuming the product is not on the product page, reading price from data tags"),S=b=h[0],null===(g=discountNinja.ProductData.GetDataFromCollectionAttribute(b,"Handle",null,p)))return discountNinja.Logging.LogWarning("Could not find product handle of collection product",!0,!1),5===i||setTimeout((function(){a(t,i+1)}),500*i),!1;discountNinja.ProductData.SaveProductDataUsingDataTags(b);var D=discountNinja.ProductData.GetByProductHandle(g,!1);if(!D)return discountNinja.Logging.LogVerbose("No product data found for '"+g+"'. Are you missing Dynamic Pricing data tags? The price will not be updated for the product."),5===i||setTimeout((function(){a(t,i+1)}),500*i),!1;n=D.Price,e=D.CompareAtPrice,y=D.Inventory,_=D.Collections,n/=100,e/=100,discountNinja.Logging.LogVerbose("Derived price "+n+" and compare at price "+e+" and inventory level "+y+" from data tags");var E=discountNinja.ProductData.GetDataFromCollectionAttribute(b,"Available",g);"false"!==E&&!1!==E||(y=0);var I=discountNinja.ProductData.GetDataFromCollectionAttribute(b,"PriceVaries",g);if("true"===I||!0===I)discountNinja.Settings.Settings.Label.UseFromLabelCollectionPage&&(P=discountNinja.ProductData.GetDataFromCollectionAttribute(b,"PriceMin",g),v=!0,n=P/100);var k=discountNinja.ProductData.GetDataFromCollectionAttribute(b,"Variant",g);k&&(L=k)}var b=null===h?null:h[0],O=void 0!==discountNinja.Utilities.jQuery()(b).attr("data-limoniapps-discountninja-product-quickview"),A=l&&C||p||O,w=discountNinja.Offer.GetOfferDataForProduct(g,L,_,y,100*n,100*e,!0,l||!v,!0),U=null===w||null===w.Applicable?null:discountNinja.Offer.GetOfferByToken(w.Applicable),R=!0;if(U)if(!1===U.UpdatePriceProductPage){if(discountNinja.Logging.LogVerbose("The price will not be updated for the product variant "+L+" with handle '"+g+"' since Dynamic Pricing for non-cart pages is disabled for offer "+U.Token+"."),A)s(U,H=discountNinja.DiscountedProduct.Get(null,null,g,100*n,100*e,y,U),!1);R=!1}else!function(t){var i=discountNinja.Utilities.jQuery()(t);i.find("."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice).removeAttr(discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.IgnoreSystem),i.find("."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.OriginalPrice).removeAttr(discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.IgnoreSystem,"")}(t);else{if(discountNinja.Logging.LogVerbose("The price will not be updated for the product variant "+L+" with handle '"+g+"' since the product is not a target of the offer(s)."),A&&(null!==discountNinja.VariantChangedEvent.CurrentVariant&&u(t,n,y),(Z=c())&&discountNinja.Utilities.jQuery()(Z).each((function(){discountNinja.Utilities.jQuery()(this).hide()}))),A){var F=discountNinja.Offer.GetOfferDataForProduct(g,L,_,y,100*n,100*e,!0,l||!v,!1,!1,!0);if(F&&(F.Applicable||F.ApplicableNoTier)){var x=discountNinja.Offer.GetOfferByToken(F.Applicable||F.ApplicableNoTier),G=null===discountNinja.DiscountTier.GetCurrentDiscountTier(x)?0:null;(H=discountNinja.DiscountedProduct.Get(null,null,g,100*n,100*e,y,x,1,G))&&s(x,H,!1)}else{var B=discountNinja.Offer.GetOfferDataForPrerequisiteProduct(g,L,_,y,100*n,100*e,!0,l||!v,!1,!0);if(B&&(B.Applicable||B.ApplicableNoTier)){x=discountNinja.Offer.GetOfferByToken(B.Applicable||B.ApplicableNoTier),G=null===discountNinja.DiscountTier.GetCurrentDiscountTier(x)?0:null;(H=discountNinja.DiscountedProduct.Get(null,null,g,100*n,100*e,y,x,1,G))&&s(x,H,!0)}}}R=!1}if(U)var H=discountNinja.DiscountedProduct.Get(null,L,g,100*n,100*e,y,U);if(l&&C)if(U)discountNinja.DiscountedProduct.CurrentVariantData=H;else{var M={OriginalPrice:n,DiscountedPrice:n,OriginalCompareAtPrice:e,EffectiveCompareAtPrice:e,InventoryLeft:y,Amount:0,Percentage:0,Key:null,VariantId:L,ProductHandle:g,PriceVaries:null,DiscountCode:null,OfferToken:null,TriggerToken:null};discountNinja.DiscountedProduct.CurrentVariantData=M}if(R){H.PriceVaries=v;var q=!0===C?"current ":"";discountNinja.Logging.LogVerbose("Updating price for "+q+"product ("+g+"), price is "+n+" and compare at is "+e+", discounting to "+H.DiscountedPrice);var V=0===d.find(".limoniapps-discountninja-shortcode").length;if(d.hasClass("limoniapps-discountninja-productprice-dynamic")&&(d.html('<span class="limoniapps-discountninja-productprice limoniapps-discountninja-productprice-dynamic"></span>'),V=!0),V){discountNinja.Logging.LogVerbose("Replacing prices first time");var Q=d.hasClass("limoniapps-discountninja-otherpage"),W=p||O||C&&!Q?"product":discountNinja.Environment.Shopify.IsCartPage()?"cart":"other";!function(t,i,n,e,o){try{discountNinja.Logging.LogVerbose("Replacing prices for product first time");var r=discountNinja.Utilities.jQuery()(i),a=r.html(),c=r.find(".limoniapps-discountninja-productprice-inner"),s=null===c||0===c.length,u=s?a:discountNinja.Utilities.jQuery()(c).prop("outerHTML"),d=discountNinja.Settings.Settings.Label,l=!discountNinja_Script_ProductData.ProductIsAvailable(e),g=n&&d.UseSoldOutLabelProductPage||!n&&d.UseSoldOutLabelCollectionPage,p=l&&d&&g,f=!n&&e.PriceVaries&&d.UseFromLabelCollectionPage,N=discountNinja.Settings.GetPriceFormat("standard",null,n&&"product"===o),j=discountNinja_Script_DynamicPricing.BuildFormattedPrice(u,N,t,e,f,p,s,o);r.html(j)}catch(t){discountNinja.Logging.LogError("DynamicPricing.UpdatePriceForProduct",t)}}(U,t,C,H,W),(C||p||O)&&A&&s(U,H,!1)}else discountNinja.Logging.LogVerbose("Replacing prices after first time"),discountNinja.ShortCode.RefreshResolvedPlaceholders(t,U,H),(C||p||O)&&A&&s(U,H,!1);discountNinjaContext.CurrentProductInfo=H,A&&discountNinja_Script_DynamicPricing.ReplaceInstalmentsPrices(H)}if(!O){var $=!1,K=discountNinja.Offer.GetOfferDataForProduct(g,L,_,y,100*n,100*e,!0,l||!v,!1,!0,!1);if(K&&K.Applicable){var J=discountNinja.Offer.GetOfferByToken(K.Applicable),z=(G=null===discountNinja.DiscountTier.GetCurrentDiscountTier(J)?0:null,discountNinja.DiscountedProduct.Get(null,null,g,100*n,100*e,y,J,1,G));z&&(r(S,J,z,o,!1),$=!0)}else{var X=discountNinja.Offer.GetOfferDataForPrerequisiteProduct(g,L,_,y,100*n,100*e,!0,l||!v,!0,!1);if(X&&X.Applicable){var Y=discountNinja.Offer.GetOfferByToken(X.Applicable);G=null===discountNinja.DiscountTier.GetCurrentDiscountTier(Y)?0:null;r(S,Y,discountNinja.DiscountedProduct.Get(null,null,g,100*n,100*e,y,Y,1,G),o,!0),$=!0}}$&&discountNinja.Settings.Settings.Badge&&!0===discountNinja.Settings.Settings.Badge.HideThirdPartyBadges&&discountNinja.Utilities.jQuery()(b).addClass("limoniapps-discountninja-hidethirdpartybadges")}return!0}catch(t){return discountNinja.Logging.LogError("DynamicPricing.UpdatePriceForProductWrapper",t),!1}var Z}function c(){return function(t){var i=discountNinja.Settings.Settings.PriceUpdate.Mode,n=t?i.ProductBanner:i.FeaturedProductBanner,e=discountNinja_Script_DynamicPricing.InjectPlaceHolder,o=discountNinja_Script_DynamicPricing.Classes.ProductBanner.Injected;if(n&&"custom"!==n&&"none"!==n&&!(discountNinja.Utilities.jQuery()("."+o).length>0)){var r=discountNinja_Script_DynamicPricing_Classes_ProductBanner_Prefix;discountNinja.Utilities.jQuery()("."+r).not("."+o).removeClass(r).addClass(r+"-disabled");var a='<div class="'+discountNinja_Script_DynamicPricing_Classes_ProductBanner_Prefix+" "+o+'"></div>';e.Inject(n,a,null,!0)}}(discountNinja.Environment.Shopify.IsProductPage()),discountNinja.Utilities.jQuery()("."+discountNinja_Script_DynamicPricing_Classes_ProductBanner_Prefix)}function s(t,i,n){if(t.PromotionCard){var e=c();e&&discountNinja.Utilities.jQuery()(e).each((function(){n&&discountNinja.Utilities.jQuery()(this).addClass(discountNinja_Script_DynamicPricing.Classes.ProductBanner.Prerequisite),discountNinja.Utilities.jQuery()(this).attr("data-token",t.Token);var e=n?t.PromotionCard.PrerequisiteProductPageTextColor:t.PromotionCard.ProductPageTextColor,o=n?t.PromotionCard.PrerequisiteProductPageText:t.PromotionCard.ProductPageText,r=discountNinja.TextSettings.GetText(o,t),a=discountNinja.TextSettings.WrapInColor(e,discountNinja.ShortCode.ReplaceAllPlaceHolders(t,r,i));a=discountNinja.ShortCode.ReplaceAllPlaceHolders(t,a,i,"item-line"),discountNinja.TextSettings.IsEmpty(a)?discountNinja.Utilities.jQuery()(this).hide():(discountNinja.Utilities.jQuery()(this).html(a),discountNinja.Utilities.jQuery()(this).show())}))}}function u(t,i,n){try{discountNinja.Logging.LogVerbose("Replacing price with original price");var e=discountNinja.Utilities.jQuery()(t),o={OriginalPrice:i,InventoryLeft:n},r=!discountNinja_Script_ProductData.ProductIsAvailable(o),a=discountNinja.Settings.Settings.Label.UseSoldOutLabelProductPage,c=r&&labelSettings&&a,s="";s=c?'<div class="limoniapps-discountninja-product-label limoniapps-discountninja-label-soldout">'+window.discountNinjaContext.Labels.SoldOut+"</div>":discountNinja_Script_DynamicPricing.BuildFormattedDiscountedPrice({Format:"{{ORIGINAL_PRICE}}"},null,o,!1);var u=discountNinja_Script_DynamicPricing.Classes.ProductPrice.OriginalPrice;e.find("."+u).html(s);var d=e.find("."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice);d.hide(),d.attr(discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.IgnoreSystem,"");var l=e.find("."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.OriginalPrice);l.show(),l.attr(discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.IgnoreSystem,"")}catch(t){discountNinja.Logging.LogError("DynamicPricing.UpdatePriceForProduct",t)}}function d(t,i){try{var n=discountNinja_Script_DynamicPricing.ProductPriceSelector(),e=discountNinja.Utilities.jQuery()("[data-limoniapps-discountninja-product-handle]").last().find(n).first(),o=e&&1===e.length&&discountNinja.Utilities.jQuery()(e).is(":visible");if(o||100===t)return t<100?(discountNinja.Logging.LogVerbose("Collection product cards are assumed to be ready"),i.apply(this,arguments)):(discountNinja.Logging.LogVerbose("Collection product cards may not be ready, timed out"),i.apply(this,arguments));setTimeout((function(){d(t+1,i)}),50)}catch(t){discountNinja.Logging.LogError("DynamicPricing.WaitForProductCards",t)}}try{var l=discountNinja.Settings.Settings;if(discountNinja.Utilities.ObjectIsEmpty(l))return void discountNinja.Logging.LogVerbose("UpdatePrice - Cancel, no settings");if(discountNinja.DiscountedCart.SplitRowsInProcess||discountNinja.DiscountedCart.FreeGiftAdjustmentInProcess)return void discountNinja.Logging.LogVerbose("Split rows or free gift in process, canceling");discountNinja.Cart.Shopify.UpdateCart((function(){discountNinja.Trigger.EnsureInitialPromotionsTriggered((function(){discountNinja.DiscountedCart.BuildDiscountedCart((function(){if(discountNinja.Environment.Shopify.IsCollectionPage()){var t=o.bind(this,l,!0,1),i=!0===discountNinja.Settings.GetFlag("WaitForProductCards");if(!i)return t.apply(this,arguments);d(1,t)}else o(l,1)}))}))}))}catch(t){discountNinja.Logging.LogError("DynamicPricing.UpdatePriceInternal",t)}},UnblockPricesAndButtons:function(){discountNinja_Script_DynamicPricing.UnblockPrices(),discountNinja_Script_DynamicPricing.UnblockCheckoutButtons()},UnblockPrices:function(){var t=discountNinja_Script_DynamicPricing.Classes.Blocking.BlockStop;discountNinja.Utilities.jQuery()("body").addClass(t)},BlockCheckoutButtonsLookupCode:function(){var t=discountNinja_Script_DynamicPricing.Classes.Blocking.BlockLookupCode,i=discountNinja_Script_DynamicPricing.Classes.Blocking.BlockStop,n=discountNinja.Environment.Shopify.SelectorCheckoutButton();discountNinja.Utilities.jQuery()(n).addClass(t).removeClass(i)},BlockCheckoutButtons:function(){var t=discountNinja_Script_DynamicPricing.Classes.Blocking.Block,i=discountNinja_Script_DynamicPricing.Classes.Blocking.BlockStop,n=discountNinja.Environment.Shopify.SelectorCheckoutButton();discountNinja.Utilities.jQuery()("."+t+","+n).addClass(t).removeClass(i)},UnblockCheckoutButtons:function(){var t=discountNinja_Script_DynamicPricing.Classes.Blocking.BlockLookupCode,i=discountNinja_Script_DynamicPricing.Classes.Blocking.Block,n=discountNinja_Script_DynamicPricing.Classes.Blocking.BlockStop,e=discountNinja.Environment.Shopify.SelectorCheckoutButton();discountNinja.Utilities.jQuery()("."+i+","+e).removeClass(i).removeClass(t).addClass(n)},Show:function(t){function i(t){return function(i,n){try{var e=discountNinja.Utilities.jQuery()(n);t?e.show():e.hide()}catch(t){discountNinja.Logging.LogError("DynamicPricing.SetDynamicPricingVisibility",t)}}}var n="."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice,e="."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.Wrapper,o="."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ShowAfterReplace,r="."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.HideAfterReplace,a="["+discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.Ignore+"],["+discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.IgnoreSystem+"]",c="."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.OriginalPrice;function s(t,c){var s=c?"[data-token='"+c+"']":"";(d=discountNinja.Utilities.jQuery()(n+s))&&d.length>0&&(d=discountNinja.Utilities.jQuery()(d).not(a)),d.each(i(t)),(d=discountNinja.Environment.Shopify.IsProductPage()?discountNinja.Utilities.jQuery()(o):discountNinja.Utilities.jQuery()(n+s).closest(e).find(o)).each(i(t)),(d=discountNinja.Environment.Shopify.IsProductPage()?discountNinja.Utilities.jQuery()(n+s).closest(e).find(r):discountNinja.Utilities.jQuery()(r)).each(i(!t))}try{var u=void 0===t?discountNinja.Environment.Shopify.IsCartPage()?discountNinja.DiscountedCart.HasAppliedPromotions():discountNinja.DiscountedCart.HasActivePromotions():t;discountNinja.MultiCurrency.UpdateCurrency();var d=discountNinja.Utilities.jQuery()(c).not(a);if(d.each(i(!u)),u){if(discountNinja.Offer.Offers)for(var l=0;l<discountNinja.Offer.Offers.length;l++){s(u,discountNinja.Offer.Offers[l].Token)}s(u,"ALL-TOKENS")}else s(u,null)}catch(t){return discountNinja.Logging.LogError("DynamicPricing.Show",t),!1}},FindElementInCart:function(t,i,n){try{if(!t)return null;var e=discountNinja.Utilities.jQuery()(t).find(i);return e&&0!==e.length||(e=discountNinja.Utilities.jQuery()(t).parent().find(i)),e&&0!==e.length?e:(n&&discountNinja.Logging.LogVerbose("Could not find "+i+" in cart element"),null)}catch(t){discountNinja.Logging.LogError("DynamicPricing.FindElementInCart",t)}},DrawerCartIsDirty:!0,ReplacePricesInDrawerCart:function(t){try{if(!discountNinja_Script_DynamicPricing.DrawerCartIsDirty)return;if(discountNinja_Script_DynamicPricing.DrawerCartIsDirty=!1,!(t=t||discountNinja.Settings.Settings))return;discountNinja_Script_DynamicPricing.IsDynamicPricingRequired(t,!0)&&(discountNinja.Logging.LogVerbose("Replace prices in drawer cart"),discountNinja_Script_DynamicPricing.ReplacePricesInCartInner(!0))}catch(t){discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInDrawerCart",t)}},ClassicCartIsDirty:!0,ReplacePricesInClassicCart:function(t){try{if(!discountNinja_Script_DynamicPricing.ClassicCartIsDirty)return;if(discountNinja_Script_DynamicPricing.ClassicCartIsDirty=!1,!(t=t||discountNinja.Settings.Settings))return;(discountNinja.Environment.Shopify.IsCartPage()||discountNinja.Utilities.jQuery()(".limoniapps-discountninja-cart-root").length>0)&&discountNinja_Script_DynamicPricing.IsDynamicPricingRequired(t,!1)&&(discountNinja.Logging.LogVerbose("Replace prices in classic cart"),discountNinja_Script_DynamicPricing.ReplacePricesInCartInner(!1))}catch(t){discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInClassicCart",t)}},ReplacePricesInCartInner:function(t){function i(t,i){try{if(null===discountNinja.DiscountedCart.DiscountedCart)return;var e=discountNinja.DiscountedCart.GetCartItemKeys();discountNinja.Logging.LogVerbose("Replacing prices in cart for root - Discounted: "+e);var o=100*discountNinja.DiscountedCart.DiscountedCart.total_discount,r=[],a=discountNinja.Settings.Settings.PriceUpdate.Mode,c=i?a.DrawerCartItemSelector:a.CartItemSelector,s=i?a.DrawerCartItemKeySelector:a.CartItemKeySelector;s&&(s=","+s);var u=discountNinja.Settings.Settings.PriceUpdate.Mode.CartItemKeyAttribute,d="data-limoniapps-discountninja-cart-key";discountNinja.Utilities.jQuery()(t).find(".limoniapps-discountninja-cart-item-product-price, .limoniapps-discountninja-cart-item-line-price"+s).each((function(t,i){var n=discountNinja.Utilities.jQuery()(i).attr(d);if(!n&&u&&(n=discountNinja.Utilities.jQuery()(i).attr(u)),discountNinja.Utilities.jQuery()(i).closest(c).attr(d,n),n){for(var e=!0,o=0;o<r.length;o++)if(r[o]===n){e=!1;break}e&&(discountNinja.Logging.LogVerbose("Adding key to cart item keys to process: "+n),r.push(n))}}));for(var l=0;l<r.length;l++){var g=n(t,r[l],i);discountNinja.Logging.LogVerbose("Calculated savings for item in cart: "+g+" cents")}discountNinja.Logging.LogVerbose("Replacing subtotal");var p=function(t,i){try{var n=i/100,e=t/100,o=Math.round(100*(e-n))/100;return o<0&&(o=0),{OriginalPrice:e,Amount:n,Percentage:n/e*100,DiscountedPrice:o}}catch(t){discountNinja.Logging.LogError("DynamicPricing.BuildProductInfoFromAmount",t)}}(100*discountNinja.DiscountedCart.DiscountedCart.total_original_price,o),f=discountNinja.Settings.Settings.PriceUpdate,N=i?f.Enable.DrawerCart:f.Enable.Cart,j=discountNinja.PromotionSummary.BuildPromotionSummaryLabels(i),m=j,C=discountNinja.Settings.Settings.PromotionSummary;C&&!1===C.ShowComments&&(m=[]),function(t,i){var n=discountNinja.Settings.Settings.PriceUpdate.Mode,e=i?n.DrawerCartSubtotalPrice:n.CartSubtotalPrice,o=discountNinja_Script_DynamicPricing.Classes.Cart.SubtotalPriceInjected;if(e&&"custom"!==e&&"none"!==e&&!(discountNinja.Utilities.jQuery()(t).find("."+o).length>0)){var r=discountNinja_Script_DynamicPricing.Classes.Cart.SubtotalPrice;discountNinja.Utilities.jQuery()(t).find("."+r).not("."+o).removeClass(r).addClass(r+"-disabled"),discountNinja.Utilities.jQuery()(t).find(".limoniapps-discountninja-cart-promotionsummary ."+r+"-disabled").removeClass(r+"-disabled").addClass(r);var a='<span class="'+r+" "+o+'"></span>',c=e,s=discountNinja.Utilities.jQuery()(t).find(c);s&&s.length>0&&s.length<3&&s.wrapInner(a)}}(t,i),function(t,i){var n=discountNinja.Settings.Settings.PriceUpdate.Mode,e=i?n.DrawerCartSubtotal:n.CartSubtotal,o=discountNinja_Script_DynamicPricing.Classes.Cart.SubtotalInjected;if(e&&"custom"!==e&&"none"!==e&&!(discountNinja.Utilities.jQuery()(t).find("."+o).length>0)){var r=discountNinja.Environment.Shopify.IsCartPage(),a=discountNinja.Settings.Settings.PromotionSummary;if(a&&(!0===a.HideSubtotal&&r||!0===a.HideSubtotalDrawerCart&&!r)){var c=e,s=discountNinja.Utilities.jQuery()(t).find(c);s&&s.length>0&&s.length<3&&s.wrap('<div style="display:none" class="limoniapps-discountninja-whenpromotionsummaryunavailable-show"></div>')}}}(t,i),discountNinja.PromotionSummary.RenderPromotionSummary(t,i,j),h(null,null,t,!0,N&&o>0,"subtotal",m,p,i,!1),discountNinja.DiscountCode.EnableDiscountCodeField(),discountNinja.DiscountCode.UpdateTags(),discountNinja.DiscountCode.LockDiscountCodeFieldIfRequired(),discountNinja_Script_DynamicPricing.ReplaceInstalmentsPrices(),P(),discountNinja_Script_PromotionFlow.ShowHideElementsWhenPromotionsInCart()}catch(t){discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1,discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInCartForRoot",t)}}function n(t,i,n){try{var e="Replacing prices in cart - Key "+i;discountNinja.Logging.LogVerbose(e);var o=i.split(":")[0],r=discountNinja.LiquidData.QuantityFromCartByKey(i);if(0===r)return 0;var a=100*discountNinja.LiquidData.PriceFromCartByKey(i);discountNinja.Logging.LogVerbose(e+" - Price "+a+" and quantity "+r);discountNinja.LiquidData.CompareAtPrice(o);if(discountNinja.ProductData.GetByVariant(o,!0)){var c=discountNinja.DiscountedCart.Get(i),s=c?discountNinja.Offer.GetOfferByToken(c.OfferToken):null,u=s&&!1!==s.UpdatePriceCartPage;if(s&&u&&"line_item"===s.Entitlement.TargetType&&"each"===s.Entitlement.AllocationMethod){var d=c.Product,l=c.Line,g=discountNinja.Settings.Settings.PriceUpdate.Enable,p=n?g.DrawerCart:g.Cart,f=s.Cart?n?s.DrawerCart.ProductSavingsLabel:s.Cart.ProductSavingsLabel:null,j=s.Cart?n?s.DrawerCart.ProductSavingsTextColor:s.Cart.ProductSavingsTextColor:null,m=[];if(f){var C=discountNinja.TextSettings.WrapInColor(j,discountNinja.TextSettings.GetText(f,null));m.push({Offer:s.Token,Label:C,ProductInfo:l})}var S=function(t){return discountNinja.LiquidData.ItemHasPropertyWithPrefix(discountNinja.LiquidData.CartItemByKey(t),discountNinja.DiscountedCart.FreeGiftPrefix)}(i);return h(i,s,t,!0,p,"item-product",m,d,l,n,S),h(i,s,t,!0,p,"item-line",null,l,l,n,S),(a-100*d.DiscountedPrice)*r}return s&&!u?discountNinja.Logging.LogVerbose(e+" - Cart line item price is not replaced, the offer "+s.Token+" has disabled Dynamic Pricing at cart level. The price will be reset instead."):discountNinja.Logging.LogVerbose(e+" - Cart line item price is not replaced. The price will be reset instead."),N(i,t,"item-product",n),N(i,t,"item-line",n),0}return discountNinja.Logging.LogVerbose(e+" - No match found in discounted cart"),0}catch(t){discountNinja.Logging.LogError("DynamicPricing.ReplacePricesForCartItem",t)}}function e(t){return discountNinja_Script_DynamicPricing.Classes.Cart.PriceForLevel.replace("[LEVEL]",t)}function o(t){return discountNinja_Script_DynamicPricing.Classes.Cart.CommentForLevel.replace("[LEVEL]",t)}function r(t,i){var n=discountNinja.Settings.Settings.PriceUpdate.Mode;return"subtotal"===t?"custom":"item-product"===t?i?n.DrawerCartProductPrice:n.CartProductPrice:"item-line"===t?i?n.DrawerCartLinePrice:n.CartLinePrice:void 0}function a(t,i){var n=r(t,i);return"custom"===n?"."+e(t):n}function c(t,i,n){var o=r(t,n);return"custom"===o?l(t,e(t),i):o?o.replace(/\[\[CARTITEMKEY\]\]/g,i):""}function s(t){var i=discountNinja.Settings.Settings.PriceUpdate.Mode;return t?i.DrawerCartQuantity:i.CartQuantity}function u(t,i){var n=s(i);return"custom"===n?l("item-line",discountNinja_Script_DynamicPricing.Classes.Cart.Quantity,t):n?n.replace(/\[\[CARTITEMKEY\]\]/g,t):""}function d(t,i){return"."+o(t)}function l(t,i,n){return"."+i+("["+discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.CartLineItemKey+'="'+n+'"]')}function g(t,i,n){return l(0,o(t),i)}function p(t,i){var n=discountNinja.Settings.Settings.PriceUpdate.Mode,e=t?n.DrawerCartProductComment:n.CartProductComment;e&&(e=e.replace(/\[\[CARTITEMKEY\]\]/g,i));var o=discountNinja_Script_DynamicPricing.InjectPlaceHolder,r=discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-product-comment-injected-"+i.replace(/:/g,"-");if(e&&"custom"!==e&&"none"!==e&&!(discountNinja.Utilities.jQuery()("."+r).length>0)){var a="limoniapps-discountninja-cart-item-product-comment";discountNinja.Utilities.jQuery()("."+a).not("."+r).removeClass(a).addClass(a+"-disabled");var c='<div class="'+a+" "+r+'" data-limoniapps-discountninja-cart-key="'+i+'"></div>';o.Inject(e,c,null,!1)}}function f(t,i,n,e){try{var o=discountNinja.Utilities.jQuery()(t);if(o.attr(n)===i||o.attr(e)===i)return!0;var r=o.parents("["+e+"]");if(r&&r.length>0&&r.attr(e)===i)return!0;var a=o.parents("["+n+"]");return!!(a&&a.length>0&&a.attr(n)===i)}catch(t){return!1}}function N(t,i,n,e){try{var o=a(n,e),r=c(n,t,e),s=m(),l=j(),p=null===t?discountNinja.Utilities.jQuery()(i).find(o):discountNinja.Utilities.jQuery()(i).find(r);if(null!==p&&0!==p.length){if(0===discountNinja.Utilities.jQuery()(p).find(".limoniapps-discountninja-shortcode").length)return;if(null===t||f(p,t,l,s)){var N=discountNinja.LiquidData.CartItemByKey(t),h=null;if("item-product"===n&&N?h={OriginalPrice:N.original_price/100}:"item-line"===n&&N&&(h={OriginalPrice:N.original_line_price/100}),null===h&&"subtotal"!==n)discountNinja.Logging.LogVerbose("ResetCartItemLevel - No match found for level "+n+" for key "+t);else{var C="{{ORIGINAL_PRICE}}";"subtotal"===n&&(C="{{TOTAL_PRICE}}"),price=discountNinja.ShortCode.ReplaceAllPlaceHolders(null,C,h,n),discountNinja.Utilities.jQuery()(p).html(price)}}}var S=d(n),y=g(n,t),_=null===t?discountNinja.Utilities.jQuery()(i).find(S):discountNinja.Utilities.jQuery()(i).find(y);if(null===_||0===_.length)return;if((null===t||f(_,t,l,s))&&discountNinja.Utilities.jQuery()(_).html(""),"subtotal"!==n){var v=u(t,e),P=discountNinja.Utilities.jQuery()(i).find(v);null!==P&&0!==P.length||(P=i),f(P,t,l,s)&&(discountNinja.Utilities.jQuery()(P).removeClass(discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.QuantitySpinnerHide),discountNinja.Utilities.jQuery()(P).removeClass(discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.QuantitySpinnerDisable))}}catch(t){discountNinja.Logging.LogError("DynamicPricing.ResetCartItemLevel",t)}}function j(){return discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.CartLineItemKey}function m(){return discountNinja.Settings.Settings.PriceUpdate.Mode.CartItemKeyAttribute}function h(t,i,n,e,o,r,s,l,h,S,y){try{N(t,n,r,S);var _="Replacing prices in cart - Level "+r+" - ";if(e){var v=discountNinja.Settings.GetPriceFormat(r,S);discountNinja.Logging.LogVerbose(_+"Discounted");var P=m(),L=j();if(o){var T=discountNinja_Script_DynamicPricing.BuildFormattedDiscountedPrice(v,i,l,!1),D=a(r,S),E=c(r,t,S),I=null===t?discountNinja.Utilities.jQuery()(n).find(D):discountNinja.Utilities.jQuery()(n).find(E);null===I||0===I.length?discountNinja.Logging.LogVerbose(_+"Cart price field not found for level "+r):(null===t||f(I,t,L,P))&&I.each((function(t,n){var e=function(t,i,n){try{var e="GetOriginalPriceHtmlFromCartItem - Level "+i+" - ",o=discountNinja_Script_DynamicPricing.Classes.ProductPrice.OriginalPrice,r=discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.Token,a=t;if(a){var c=discountNinja_Script_DynamicPricing.FindElementInCart(a,"."+o,!1),s='<span class="'+o+'" '+r+'="'+n+'" style="display:none;">'+a.html()+"</span>";if(null===c)return s;var u=c[0];return(u?discountNinja.Utilities.jQuery()(u).prop("outerHTML"):"")||""}return discountNinja.Logging.LogVerbose(e+"No match found for price element"),""}catch(t){return discountNinja.Logging.LogError("DynamicPricing.GetOriginalPriceHtmlFromCartItem",t),null}}(discountNinja.Utilities.jQuery()(n),r,i?i.Token:"ALL-TOKENS");!function(t,i,n,e,o){try{var r=t;if(r){var a='<span class="limoniapps-discountninja-cart-'+i+'-price"><span class="'+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice+'" '+discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.Token+'="'+o+'" style="display:none;">'+e+"</span></span>";discountNinja.Utilities.jQuery()(r).html(a+n)}}catch(t){return discountNinja.Logging.LogError("ReplacePriceInCart",t),null}}(n,r,e,T,i?i.Token:"ALL-TOKENS")}))}else discountNinja.Logging.LogVerbose(_+"Dynamic Pricing on cart not enabled for level "+r);if(s){"subtotal"!==r&&p(S,t);var k=d(r),b=g(r,t),O=null===t?discountNinja.Utilities.jQuery()(n).find(k):discountNinja.Utilities.jQuery()(n).find(b);null===O||0===O.length?discountNinja.Logging.LogVerbose(_+"Cart comment field not found for level "+r):null===t||discountNinja.Utilities.jQuery()(O).attr(L)===t?C(O,s,r,!1):f(O,t,L,P)&&C(O,s,r,!0)}if(y&&"subtotal"!==r){var A=discountNinja.Settings.Settings.Cart.QuantitySpinnerMode,w=!A||"hide"===A,U="disable"===A;if(U||w){p(S,t);var R=u(t,S),F=discountNinja.Utilities.jQuery()(n).find(R);null===F||0===F.length?discountNinja.Logging.LogVerbose(_+"Cart quantity field not found for level "+r):f(F,t,L,P)&&(w?discountNinja.Utilities.jQuery()(F).addClass(discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.QuantitySpinnerHide):U&&discountNinja.Utilities.jQuery()(F).addClass(discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.QuantitySpinnerDisable))}}}else discountNinja.Logging.LogVerbose(_+"Not discounted")}catch(t){discountNinja.Logging.LogError("DynamicPricing.ReplacePricesForCartItemLevel",t)}}function C(t,i,n,e){try{var o=t;if(i&&i.length>0&&o){discountNinja.Logging.LogVerbose("Adding comment for level: "+n);for(var r="",a=0;a<i.length;a++){var c=i[a].Label,s=i[a].ProductInfo,u=i[a].Offer,d=discountNinja.Offer.GetOfferByToken(u),l=discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.Token,g="";if("subtotal"===n){var p=discountNinja.ShortCode.ReplaceAllPlaceHolders(d,c,s);g='<div class="'+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice+'" '+l+'="'+u+'" style="display:none;">'+p+"</div>",r=""===r?g:r+g}else{c=(c=c.replace(/\{\{DISCOUNT_LINE\}\}/g,"{{DISCOUNT_LINE_AMOUNT}}")).replace(/\{\{DISCOUNT\}\}/g,"{{DISCOUNT_LINE_PERCENTAGE}}");p=discountNinja.ShortCode.ReplaceAllPlaceHolders(d,c,s);if(g='<span class="'+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice+'" '+l+'="'+u+'" style="display:none;">'+p+"</span>",discountNinja.ShortCode.ContainsPlaceHolder(g,"DISCOUNT_LINE_")){var f=discountNinja.Currency.GetCurrencyFormat(),N=discountNinja.Utilities.GetNoDecimalsCurrencyFormat(f),j=discountNinja.Utilities.GetCurrencyFormatAmountComponent(f),m=discountNinja.Utilities.GetCurrencyFormatAmountComponent(N);g=discountNinja.ShortCode.BuildResolvedPlaceHolderAmount(d,null,g,!0,"{{DISCOUNT_LINE_AMOUNT}}","offer","DISCOUNT_LINE_AMOUNT",100*i[a].ProductInfo.EffectiveAmount,f,N,j,m,2,!1,null,null,!0),g=discountNinja.ShortCode.BuildResolvedPlaceHolder(d,null,g,!0,"{{DISCOUNT_LINE_PERCENTAGE}}","offer","DISCOUNT_LINE_PERCENTAGE",discountNinja.Utilities.FormatPercentage(i[a].ProductInfo.EffectivePercentage,0)+"%")}r=""===r?g:r+"&nbsp;"+g}}var h="limoniapps-discountninja-cart-"+n+"-comment";""!==r&&(r='<div class="'+h+'">'+r+"</div>"),e?discountNinja.Utilities.jQuery()(o).next().hasClass(h)?discountNinja.Utilities.jQuery()(o).next().html(r):discountNinja.Utilities.jQuery()(o).after(r):discountNinja.Utilities.jQuery()(o).html(r),o.show()}else i&&0!==i.length||discountNinja.Logging.LogVerbose("No comment for level: "+n)}catch(t){return discountNinja.Logging.LogError("DynamicPricing.AddCartComment",t),null}}function S(){discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1}function y(){discountNinja.Utilities.jQuery()(".limoniapps-discountninja-drawercart-root .limoniapps-discountninja-cart-subtotal-comment").hide(),discountNinja.Utilities.jQuery()(".limoniapps-discountninja-drawercart-root .limoniapps-discountninja-cart-subtotal-price .limoniapps-discountninja-shortcode-discounted_price").text("0"),discountNinja.Utilities.jQuery()(".limoniapps-discountninja-drawercart-root .limoniapps-discountninja-cart-subtotal-price .limoniapps-discountninja-shortcode-original_price").hide()}function _(t,i,n,e){try{var o=null;if(discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart)for(var r=0;r<discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart.length;r++)if(discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart[r].Item===e&&discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart[r].Ready)return;var a=discountNinjaContext.Settings.PriceUpdate.Mode.DrawerCartSubtotalPrice;if(a&&(a=a.replace(/\[\[HIDE\]\]/g,"")),(i.find(".limoniapps-discountninja-cart-subtotal-price").length>0||i.find(a).length>0)&&function(t){var i=!1;return discountNinja.Utilities.jQuery()(t).each((function(){discountNinja.Utilities.jQuery()(this).is(":visible")&&(i=!0)})),i}(i)&&function(t){var i=!1;return discountNinja.Utilities.jQuery()(t).each((function(){discountNinja.Utilities.IsInViewport(this)&&(i=!0)})),i}(i)||200===t)return t<200?(discountNinja.Logging.LogVerbose("Drawer cart is ready"),discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart.push({Item:e,Ready:!0}),null!==o&&clearTimeout(o),n.call(this,i)):(discountNinja.Logging.LogInformation("Dynamic Pricing","Drawer cart not ready, timed out. Ensure an element with .limoniapps-discountninja-cart-subtotal-price is present in the drawer cart and the element with .limoniapps-discountninja-drawercart-root is in the viewport."),discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart.push({Item:e,Ready:!1,Expired:!0}),S());t+=1,o=setTimeout((function(){_(t,i,n,e)}),100)}catch(t){discountNinja.Logging.LogError("DynamicPricing.WaitForDrawerCart",t)}}function v(t){try{discountNinja.Logging.LogVerbose("Replace prices in drawer cart - starting"),i(t,!0),!0===discountNinja.Settings.GetFlag("ReplacePricesInDrawerCartAfterDelay")&&(setTimeout((function(){i(t,!0)}),100),setTimeout((function(){i(t,!0)}),500)),discountNinja.Logging.LogVerbose("Replace prices in drawer cart - done")}catch(t){P(),discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInCartForRootAfterWait",t)}}function P(){discountNinja_Script_DynamicPricing.Show(!0),discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1}try{if(null===discountNinja.Settings.Settings)return;if(null===discountNinja.DiscountedCart.DiscountedCart)return;if(!discountNinja.DiscountedCart.HasActivePromotions())return S(),void y();var L=t?"drawer cart":"classic cart";if(discountNinja.Logging.LogVerbose("Replace prices in "+L+" (inner)"),!window.discountNinjaContext.Cart||!window.discountNinjaContext.Cart.items||0===window.discountNinjaContext.Cart.items.length)return discountNinja.Logging.LogVerbose("Replace prices in "+L+" stopped: no items in cart"),S(),void y();var T="limoniapps-discountninja-drawercart-root",D="limoniapps-discountninja-cart-root",E="."+D,I=t?discountNinja.Utilities.jQuery()(".limoniapps-discountninja-drawercart-root"):discountNinja.Utilities.jQuery()(E);if(void 0===I||0===I.length){if(discountNinja.Environment.Shopify.IsCartPage()&&!t){var k=discountNinja.Settings.Settings.PriceUpdate.Mode.CartRoot;k&&(I=discountNinja.Utilities.jQuery()(k)).addClass(D),void 0!==I&&0!==I.length||(I=discountNinja.Checkout.Shopify.GetCheckoutForm().not(".limoniapps-discountninja-ignore")).addClass(D)}else if(t){var b=discountNinja.Settings.Settings.PriceUpdate.Mode.DrawerCartRoot;b&&(I=discountNinja.Utilities.jQuery()(b)).addClass(T),discountNinja.Environment.Shopify.IsCartPage()||void 0!==I&&0!==I.length||(I=discountNinja.Utilities.jQuery()(E))}if(void 0===I||0===I.length)return discountNinja.Logging.LogVerbose(t?"Could not find limoniapps-discountninja-drawercart-root":"Could not find limoniapps-discountninja-cart-root"),void S()}if(discountNinja.Utilities.jQuery()(".limoniapps-discountninja-drawercart-root").parents("div").last().addClass("limoniapps-discountninja-drawercart-wrapper"),discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!0,t){discountNinja.Logging.LogVerbose("Found "+I.length+" drawer cart roots, waiting until they are rendered");discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart=[];var O=1;discountNinja.Utilities.jQuery()(I).each((function(){_(1,discountNinja.Utilities.jQuery()(this),v,O),O++}))}else discountNinja.Utilities.jQuery()(I).each((function(){i(this,!1)}))}catch(t){discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1,discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInCartInner",t)}},ReplacePricesInCart:function(){discountNinja.Logging.LogVerbose("Requested ReplacePricesInCart"),discountNinja.Cart.Shopify.UpdateCart((function(){discountNinja.Trigger.EnsureInitialPromotionsTriggered((function(){discountNinja.DiscountedCart.BuildDiscountedCart((function(){!function(){try{var t=discountNinja.Settings.Settings;discountNinja.Logging.LogVerbose("Replacing prices in cart and drawer cart"),discountNinja_Script_DynamicPricing.ReplacePricesInDrawerCart(t),discountNinja_Script_DynamicPricing.ReplacePricesInClassicCart(t)}catch(t){discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1,discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInCart.Inner",t)}}()}))}))}))},IsDynamicPricingRequired:function(t,i){var n="",e=t.PriceUpdate.Enable,o=discountNinja.Environment.Shopify;if(i){if(!1!==t.PriceUpdate.Enable.DrawerCart)return!0;n="Dynamic Pricing is not required since the offer configuration specifies not to dynamically replace prices on the drawer cart."}var r="Dynamic Pricing is not required since the offer configuration specifies not to dynamically replace prices on ";return""===n&&o.IsHomePage()&&!1===e.Home&&(n=r+"the home page."),""===n&&o.IsCollectionPage()&&!1===e.Collection&&(n=r+"collection pages."),""===n&&o.IsProductPage()&&!1===e.Product&&(n=r+"product pages."),""===n&&o.IsBlogPost()&&!1===e.Blog&&(n=r+"blog pages."),""===n&&o.IsCustomPage()&&!1===e.Custom&&(n=r+"custom pages."),""===n&&o.IsCartPage()&&!1===e.Cart&&(n=r+"the cart page."),discountNinja.PromotionFlow.HandleFlowErrorMessage(n)}},discountNinja_Script_DynamicPricing_Classes_PromotionSummary_Prefix=discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-promotionsummary",discountNinja_Script_PromotionSummary={Template:null,RowTemplate:null,GetTemplate:function(){return null===discountNinja_Script_PromotionSummary.Template&&(discountNinja_Script_PromotionSummary.Template=discountNinja.Utilities.jQuery()("#limoniapps-promotionsummary-template").html()),discountNinja_Script_PromotionSummary.Template},GetRowTemplate:function(){return null===discountNinja_Script_PromotionSummary.RowTemplate&&(discountNinja_Script_PromotionSummary.RowTemplate=discountNinja.Utilities.jQuery()("#limoniapps-promotionsummary-row-template").html()),discountNinja_Script_PromotionSummary.RowTemplate},Classes:{Injected:discountNinja_Script_DynamicPricing_Classes_PromotionSummary_Prefix+"-injected"},PromotionSummaryEnabledOn:function(t){var i=discountNinja.Settings.Settings.PromotionSummary;if(!i)return!1;var n=i.DisplayOnDevices;if(n){var e=discountNinja.Utilities.IsMobilePhone();if(e&&"desktoponly"===n)return!1;if(!e&&"mobileonly"===n)return!1}return!(i.HideInCart&&!t||i.HideInDrawerCart&&t)},RenderPromotionSummary:function(t,i,n){function e(t,i,n){return discountNinja.ShortCode.ReplaceAllPlaceHolders(i,discountNinja.TextSettings.GetText(t,i),n)}if(discountNinja_Script_PromotionSummary.PromotionSummaryEnabledOn(i)){!function(t,i){var n=discountNinja.Settings.Settings.PriceUpdate.Mode,e=i?n.DrawerCartPromotionSummary:n.CartPromotionSummary,o=discountNinja_Script_DynamicPricing.InjectPlaceHolder,r=discountNinja_Script_PromotionSummary.Classes.Injected,a=discountNinja_Script_DynamicPricing_Classes_PromotionSummary_Prefix;if(e&&"custom"!==e&&"none"!==e&&!(discountNinja.Utilities.jQuery()(t).find("."+r).length>0||discountNinja.Utilities.jQuery()(t).find("."+a).length>0)){discountNinja.Utilities.jQuery()(t).find("."+a).not("."+r).removeClass(a).addClass(a+"-disabled");var c='<div class="'+a+" "+r+'"></div>';o.Inject(e,c,t,!0)}}(t,i);var o=discountNinja.Utilities.jQuery()(t).find("."+discountNinja_Script_DynamicPricing_Classes_PromotionSummary_Prefix);if(0===o.length&&(placeholder=discountNinja.Utilities.jQuery()(t).find(".limoniapps-discountninja-cart-subtotalcomment")),o.length>0){var r=discountNinja.Settings.Settings.PromotionSummary;if(r&&n.length>0){if(0===n.length)return void o.html("");var a=discountNinja_Script_PromotionSummary.GetTemplate(),c=discountNinja_Script_PromotionSummary.GetRowTemplate();a=(a=(a=a.replace("limoniapps-discountninja-productprice-replaced","")).replace('limoniapps-discountninja-whenpromotionsincart-show" style="display:none;"','"')).replace('class="limoniapps-discountninja-subtotalcomment-summary-table" style="display:none;"','class="limoniapps-discountninja-subtotalcomment-summary-table"');var s=discountNinja.TextSettings.WrapInColor(r.HeaderTextColor,e(r.Header,null,null)),u=discountNinja.TextSettings.WrapInColor(r.FooterTextColor,e(r.Footer,null,null)),d=void 0===r.FooterSubtotalLabel?null:discountNinja.TextSettings.WrapInColor(r.FooterSubtotalLabelTextColor,e(r.FooterSubtotalLabel,null,null)),l=void 0===r.FooterSubtotal?null:discountNinja.TextSettings.WrapInColor(r.FooterSubtotalTextColor,e(r.FooterSubtotal,null,null)),g=void 0===r.FooterTotalDiscountLabel?null:discountNinja.TextSettings.WrapInColor(r.FooterTotalDiscountLabelTextColor,e(r.FooterTotalDiscountLabel,null,null)),p=void 0===r.FooterTotalDiscount?null:discountNinja.TextSettings.WrapInColor(r.FooterTotalDiscountTextColor,e(r.FooterTotalDiscount,null,null)),f=void 0===r.FooterTotalLabel?null:discountNinja.TextSettings.WrapInColor(r.FooterTotalLabelTextColor,e(r.FooterTotalLabel,null,null)),N=void 0===r.FooterTotal?null:discountNinja.TextSettings.WrapInColor(r.FooterTotalTextColor,e(r.FooterTotal,null,null));s=discountNinja.ShortCode.ReplaceAllPlaceHolders(discountNinja.Offer.PrimaryOffer,s,null,"subtotal"),u=discountNinja.ShortCode.ReplaceAllPlaceHolders(discountNinja.Offer.PrimaryOffer,u,null,"subtotal"),d=discountNinja.ShortCode.ReplaceAllPlaceHolders(discountNinja.Offer.PrimaryOffer,d,null,"subtotal"),l=discountNinja.ShortCode.ReplaceAllPlaceHolders(discountNinja.Offer.PrimaryOffer,l,null,"subtotal"),g=discountNinja.ShortCode.ReplaceAllPlaceHolders(discountNinja.Offer.PrimaryOffer,g,null,"subtotal"),p=discountNinja.ShortCode.ReplaceAllPlaceHolders(discountNinja.Offer.PrimaryOffer,p,null,"subtotal"),f=discountNinja.ShortCode.ReplaceAllPlaceHolders(discountNinja.Offer.PrimaryOffer,f,null,"subtotal"),N=discountNinja.ShortCode.ReplaceAllPlaceHolders(discountNinja.Offer.PrimaryOffer,N,null,"subtotal"),u&&(u=u.replace("[[SUBTOTAL PLACEHOLDER - USES (DRAWER) CART SUBTOTAL PRICE FORMAT]]","")),N&&(N=N.replace("[[SUBTOTAL PLACEHOLDER - USES (DRAWER) CART SUBTOTAL PRICE FORMAT]]",""));for(var j="",m=0;m<n.length;m++)j+=discountNinja.TemplateParameter.Replace(c,"ROW",n[m].Label);var h=discountNinja.DiscountedCart.HasAppliedPromotions(),C=discountNinja.DiscountedCart.DiscountedCart.total_discount>0,S=r.NewFooter?l||p||N:r.Footer&&!0;a=discountNinja.TemplateParameter.Replace(a,"HEADER",s),a=discountNinja.TemplateParameter.Replace(a,"SHOWHEADER",r.Header&&h?"":"display:none"),a=discountNinja.TemplateParameter.Replace(a,"FOOTER",u),a=discountNinja.TemplateParameter.Replace(a,"SHOWFOOTER",S&&C?"":"display:none"),a=discountNinja.TemplateParameter.Replace(a,"BODY",j),a=discountNinja.TemplateParameter.Replace(a,"SHOWNEWFOOTER",r.NewFooter?"":"display:none"),a=discountNinja.TemplateParameter.Replace(a,"SHOWLEGACYFOOTER",r.NewFooter?"display:none":""),a=discountNinja.TemplateParameter.Replace(a,"SHOWSUBTOTAL",void 0!==r.FooterSubtotal&&C?"":"display:none"),a=discountNinja.TemplateParameter.Replace(a,"SHOWTOTALDISCOUNT",void 0!==r.FooterTotalDiscount&&C?"":"display:none"),a=discountNinja.TemplateParameter.Replace(a,"SHOWTOTAL",void 0===r.FooterTotal?"display:none":""),a=discountNinja.TemplateParameter.Replace(a,"SUBTOTAL_LABEL",d),a=discountNinja.TemplateParameter.Replace(a,"SUBTOTAL",l),a=discountNinja.TemplateParameter.Replace(a,"TOTALDISCOUNT_LABEL",g),a=discountNinja.TemplateParameter.Replace(a,"TOTALDISCOUNT",p),a=discountNinja.TemplateParameter.Replace(a,"TOTAL_LABEL",f),a=discountNinja.TemplateParameter.Replace(a,"TOTAL",N),o.html(a)}else o.html("")}}},BuildPromotionSummaryLabels:function(t){function i(t,i,n,e,o){for(var r=!1,a=0;a<n.length;a++)if(n[a].Offer===t){r=!0;break}if(!r){var c=discountNinja.Offer.GetOfferByToken(t),s=discountNinja.DiscountTier.GetCurrentDiscountTier(c),u=!1;if(!e)e=!!s&&s.IsMaxTier,u=c&&"object"==typeof c.Bogo&&(void 0===c.Bogo.AddToCartAutomatically||!1===c.Bogo.AddToCartAutomatically);var d=discountNinja.Offer.PrerequisiteItemsCartValue(c);if(!discountNinja.DiscountTier.ExceedsUpperLimits(c,s||c.Tiers[0],d)&&(!(e&&discountNinja.DiscountedCart.GetDiscountedAmountForOffer(t)<=0)||o||u)&&c&&c.Cart){var l=i?c.DrawerCart?c.DrawerCart.SubtotalSavingsLabel:null:c.Cart.SubtotalSavingsLabel,g=i?c.DrawerCart?c.DrawerCart.SubtotalSavingsTextColor:null:c.Cart.SubtotalSavingsTextColor;if(null!==l&&null!==g){var p=discountNinja.TextSettings.WrapInColor(g,function(t,i,n){return discountNinja.ShortCode.ReplaceAllPlaceHolders(i,discountNinja.TextSettings.GetText(t,i),n)}(l,c));p=discountNinja.ShortCode.ReplaceAllPlaceHolders(null,p,null,"subtotal"),discountNinja.TextSettings.IsEmpty(p)||n.push({Offer:c.Token,Label:p,ProductInfo:null})}}}}for(var n=[],e=[],o=0;o<discountNinja.DiscountedCart.DiscountedCart.items.length;o++){var r=discountNinja.DiscountedCart.DiscountedCart.items[o];r.OfferToken&&(i(r.OfferToken,t,n,!0,!1),e.push(r.OfferToken))}for(o=0;o<discountNinja.DiscountedCart.DiscountedCart.CartLevelDiscounts.length;o++){var a=discountNinja.DiscountedCart.DiscountedCart.CartLevelDiscounts[o];a.OfferToken&&(i(a.OfferToken,t,n,!0,!1),e.push(a.OfferToken))}if(discountNinja.DiscountedCart.DiscountedCart.Shipping&&(i(discountNinja.DiscountedCart.DiscountedCart.Shipping.OfferToken,t,n,!0,!0),e.push(discountNinja.DiscountedCart.DiscountedCart.Shipping.OfferToken)),discountNinja.Offer.Offers)for(var c=0;c<discountNinja.Offer.Offers.length;c++){var s=discountNinja.Offer.Offers[c];if(s&&s.Cart&&s.Cart.SubtotalSavingsLabel&&(s.Cart.SubtotalSavingsLabel.TextAfterGoal||s.Cart.SubtotalSavingsLabel.TextDuringGoal)){for(var u=!1,d=s.Token,l=0;l<e.length;l++)if(e[l]===d){u=!0;break}u||(i(d,t,n,!1,"free_shipping"===s.DiscountCodeType),e.push(d))}}if(discountNinja.LiquidData.HasSubscriptionProducts()){var g=discountNinjaContext.Settings.Checkout.SubscriptionProductsMessage;g&&n.push({Offer:null,Label:g,ProductInfo:null})}return n}},discountNinja_Script_LiquidData={WaitForLiquidAsset:function(t){try{var i=void 0!==window.discountNinjaContext;if(i)t&&t();else{discountNinja.Logging.LogVerbose("Waiting for liquid asset to be returned");var n=0,e=function(){if(n++,!(i=void 0!==window.discountNinjaContext))return 150===n?discountNinja.Logging.LogErrorMessage("LiquidData.WaitForLiquidAsset","Waiting for liquid asset (limoniapps-discountninja-body/limoniapps-discountninja-context) to be returned timed out. Either the asset does not exist or it is not included in the theme.liquid file. Exiting."):setTimeout(e,100);discountNinja.Logging.LogVerbose("LiquidData.WaitForLiquidAsset","Waiting for liquid asset to be available - DONE"),t&&t()};e()}}catch(t){return discountNinja.Logging.LogError("LiquidData.WaitForLiquidAsset",t),""}},Cart:function(){try{return void 0!==window.discountNinjaContext&&void 0!==window.discountNinjaContext.Cart&&null!==window.discountNinjaContext.Cart&&void 0!==window.discountNinjaContext.Cart.total_price?window.discountNinjaContext.Cart:null}catch(t){discountNinja.Logging.LogError("LiquidData.Cart",t)}},CartValue:function(){try{var t=discountNinja_Script_LiquidData.Cart();return null===t?null:t.total_price}catch(t){discountNinja.Logging.LogError("LiquidData.CartValue",t)}},VariantIdsFromCart:function(){try{var t="",i=discountNinja_Script_LiquidData.Cart();if(i&&"object"==typeof i.items)for(var n=0;n<i.items.length;n++)""!==t&&(t+=","),t+=i.items[n].variant_id;return t.split(",")}catch(t){return discountNinja.Logging.LogError("LiquidData.VariantIdsFromCart",t),null}},ProductCollections:function(){try{return window.discountNinjaContext.Product?window.discountNinjaContext.Product.Collections:null}catch(t){return discountNinja.Logging.LogError("LiquidData.ProductCollections",t),null}},ProductDefaultVariantId:function(){try{return window.discountNinjaContext.Product?window.discountNinjaContext.Product.VariantId:null}catch(t){return discountNinja.Logging.LogError("LiquidData.ProductDefaultVariantId",t),null}},ProductTags:function(){try{return window.discountNinjaContext.Product?window.discountNinjaContext.Product.Tags:null}catch(t){return discountNinja.Logging.LogError("LiquidData.ProductDefaultVariantId",t),null}},VariantInfoFromLiquid:function(t){try{if(window.discountNinjaContext.ProductVariants)for(var i=0;i<window.discountNinjaContext.ProductVariants.length;i++)if(window.discountNinjaContext.ProductVariants[i].VariantId===parseInt(t))return window.discountNinjaContext.ProductVariants[i];return null}catch(t){return discountNinja.Logging.LogError("LiquidData.VariantInfoFromLiquid",t),null}},CompareAtPrice:function(t){try{var i=discountNinja_Script_LiquidData.VariantInfoFromLiquid(t);return null===i?null:i.CompareAtPrice/100}catch(t){return discountNinja.Logging.LogError("LiquidData.CompareAtPrice",t),null}},Price:function(t){try{var i=discountNinja_Script_LiquidData.VariantInfoFromLiquid(t);return null===i?null:i.Price/100}catch(t){return discountNinja.Logging.LogError("LiquidData.Price",t),null}},Inventory:function(t){try{var i=discountNinja_Script_LiquidData.VariantInfoFromLiquid(t);return null===i||"null"===i.Inventory?null:i.Inventory}catch(t){return discountNinja.Logging.LogError("LiquidData.Inventory",t),null}},ProductAvailable:function(t){try{return window.discountNinjaContext.Product?window.discountNinjaContext.Product.Available:null}catch(t){return discountNinja.Logging.LogError("LiquidData.ProductAvailable",t),null}},CollectionProductByHandle:function(t){try{for(var i=window.discountNinjaContext.CollectionProducts,n=0;n<i.length;n++)if(i[n].Handle===t)return i[n];return null}catch(t){return discountNinja.Logging.LogError("LiquidData.CartItemByProductHandle",t),null}},CartItemByVariantAndProperty:function(t,i,n){function e(t,i,n){try{return t.properties&&t.properties[i]===n}catch(t){return discountNinja.Logging.LogError("LiquidData.HasPropertyWithKeyAndValue",t),!1}}try{for(var o=window.discountNinjaContext.Cart.items,r=0;r<o.length;r++){var a=o[r];if(a.variant_id.toString()===t.toString()&&e(a,i,n))return a}return null}catch(t){return discountNinja.Logging.LogError("LiquidData.CartItemByVariantAndProperty",t),null}},AddPropertyToCartItem:function(t,i,n){try{var e=discountNinja_Script_LiquidData.CartItemPropertiesAsObject(t);return i&&(e[i]=n),e}catch(t){discountNinja.Logging.LogError("LiquidData.AddPropertyToCartItem",t)}},RemovePropertiesByPrefix:function(t,i){try{for(var n in t)n.indexOf(i)>-1&&delete t[n];return t}catch(i){return discountNinja.Logging.LogError("LiquidData.RemovePropertiesByPrefix",i),t}},CartItemPropertiesAsObject:function(t){try{var i=discountNinja.LiquidData.CartItemByKey(t).properties;if(null==i)return{};if(Array.isArray(i)){for(var n={},e=0;e<propertiesArray.length;e++)n[propertiesArray[e].Name]=propertiesArray[e].Value;return n}return i}catch(t){discountNinja.Logging.LogError("LiquidData.CartItemPropertiesAsObject",t)}},CartItemByDelegate:function(t){try{if("object"!=typeof window.discountNinjaContext||!window.discountNinjaContext.Cart||!window.discountNinjaContext.Cart.items||0===window.discountNinjaContext.Cart.items.length)return null;for(var i=window.discountNinjaContext.Cart.items,n=0;n<i.length;n++){var e=i[n];if(t(e))return e}return null}catch(t){return discountNinja.Logging.LogError("LiquidData.CartItemByDelegate",t),0}},LineNumberByKey:function(t){try{if("object"!=typeof window.discountNinjaContext||!window.discountNinjaContext.Cart||!window.discountNinjaContext.Cart.items||0===window.discountNinjaContext.Cart.items.length)return null;for(var i=window.discountNinjaContext.Cart.items,n=0;n<i.length;n++){if(i[n].key===t)return n+1}return null}catch(t){return discountNinja.Logging.LogError("LiquidData.LineNumberByKey",t),null}},CartItemsByDelegate:function(t){try{var i=[];if("object"!=typeof window.discountNinjaContext||!window.discountNinjaContext.Cart||!window.discountNinjaContext.Cart.items||0===window.discountNinjaContext.Cart.items.length)return[];for(var n=window.discountNinjaContext.Cart.items,e=0;e<n.length;e++){var o=n[e];t(o)&&i.push(o)}return i}catch(t){return discountNinja.Logging.LogError("LiquidData.CartItemsByDelegate",t),[]}},CartItemByKey:function(t){return discountNinja_Script_LiquidData.CartItemByDelegate((function(i){return i.key===t}))},CartItemByVariant:function(t){return discountNinja_Script_LiquidData.CartItemByDelegate((function(i){return i.variant_id&&t&&i.variant_id.toString()===t.toString()}))},CartItemByProductHandle:function(t){return discountNinja_Script_LiquidData.CartItemByDelegate((function(i){return i.handle===t}))},CartItemsByVariant:function(t){return discountNinja_Script_LiquidData.CartItemsByDelegate((function(i){return i.variant_id&&t&&i.variant_id.toString()===t.toString()}))},CartItemsByProductHandle:function(t){return discountNinja_Script_LiquidData.CartItemsByDelegate((function(i){return i.handle===t}))},CartItemsByProperty:function(t){return discountNinja_Script_LiquidData.CartItemsByDelegate((function(i){return void 0!==i.properties&&null!=i.properties&&null!=i.properties[t]}))},PriceFromCartByProductHandle:function(t){try{var i=discountNinja_Script_LiquidData.CartItemByProductHandle(t);return null===i?null:i.original_price/100}catch(t){return discountNinja.Logging.LogError("LiquidData.PriceFromCartByProductHandle",t),null}},PriceFromCartByKey:function(t){try{var i=discountNinja_Script_LiquidData.CartItemByKey(t);return null===i?null:i.original_price/100}catch(t){return discountNinja.Logging.LogError("LiquidData.PriceFromCartByProductHandle",t),null}},QuantityFromCartByKey:function(t){try{var i=discountNinja_Script_LiquidData.CartItemByKey(t);return null===i?null:i.quantity}catch(t){return discountNinja.Logging.LogError("LiquidData.PriceFromCartByProductHandle",t),null}},PriceFromCart:function(t){try{var i=discountNinja_Script_LiquidData.CartItemByVariant(t);return null===i?null:i.original_price/100}catch(t){return discountNinja.Logging.LogError("LiquidData.PriceFromCart",t),null}},ProductHandleFromCart:function(t){try{var i=discountNinja_Script_LiquidData.CartItemByVariant(t);return null===i?null:i.handle}catch(t){return discountNinja.Logging.LogError("LiquidData.ProductHandleFromCart",t),null}},SubTotalPriceFromCart:function(t){try{return void 0!==window.discountNinjaContext&&"object"==typeof window.discountNinjaContext.Cart?window.discountNinjaContext.Cart.total_price/100:null}catch(t){return discountNinja.Logging.LogError("LiquidData.SubTotalPriceFromCart",t),null}},ItemIsInCollection:function(t,i){var n=discountNinja.ProductData.GetByProductHandle(t.handle);if(n){if(!i)return!1;if(i.indexOf("%")>-1){var e=discountNinja.ProductData.GetByVariant(t.variant_id,!1);if(e&&e.CompareAtPrice>t.original_price)return!1}var o=n.Collections;return discountNinja.Utilities.StringIsIn(i,o)}return!1},GetQuantityFromItems:function(t){try{var i=0;if(t)for(var n=0;n<t.length;n++)i+=t[n].quantity;return i}catch(t){return discountNinja.Logging.LogError("LiquidData.GetQuantityFromItems",t),0}},GetOriginalLinePriceFromItems:function(t){try{var i=0;if(t)for(var n=0;n<t.length;n++)i+=(t[n].original_price||0)*t[n].quantity;return i}catch(t){return discountNinja.Logging.LogError("LiquidData.GetOriginalLinePriceFromItems",t),0}},ItemsInCartFromCollections:function(t,i,n){try{return discountNinja_Script_LiquidData.CartItemsByDelegate((function(e){return discountNinja_Script_LiquidData.ItemIsInCollection(e,t)&&(!n||!discountNinja_Script_LiquidData.ItemIsGift(e))&&(!i||!discountNinja_Script_LiquidData.ItemIsInCollection(e,i))}))}catch(t){return discountNinja.Logging.LogError("LiquidData.ItemsInCartFromCollections",t),0}},ItemsInCartFromProducts:function(t,i,n){try{return discountNinja_Script_LiquidData.CartItemsByDelegate((function(e){return discountNinja.Utilities.StringIsIn(t,e.handle)&&(!n||!discountNinja_Script_LiquidData.ItemIsGift(e))&&(!i||!discountNinja_Script_LiquidData.ItemIsInCollection(e,i))}))}catch(t){return discountNinja.Logging.LogError("LiquidData.ItemsInCartFromProducts",t),0}},ItemsInCartFromVariants:function(t,i,n){try{return discountNinja_Script_LiquidData.CartItemsByDelegate((function(e){return discountNinja.Utilities.StringIsIn(t,e.id)&&(!n||!discountNinja_Script_LiquidData.ItemIsGift(e))&&(!i||!discountNinja_Script_LiquidData.ItemIsInCollection(e,i))}))}catch(t){return discountNinja.Logging.LogError("LiquidData.ItemsInCartFromProducts",t),0}},ItemsInCart:function(t,i){try{return discountNinja_Script_LiquidData.CartItemsByDelegate((function(n){return!(i&&discountNinja_Script_LiquidData.ItemIsGift(n)||t&&discountNinja_Script_LiquidData.ItemIsInCollection(n,t))}))}catch(t){return discountNinja.Logging.LogError("LiquidData.ItemsInCart",t),0}},ItemIsGift:function(t){try{return discountNinja_Script_LiquidData.ItemHasPropertyWithPrefix(t,discountNinja.DiscountedCart.FreeGiftPrefix)}catch(t){return discountNinja.Logging.LogError("LiquidData.ItemIsGift",t),!1}},GiftItemsInCart:function(t){try{return discountNinja_Script_LiquidData.CartItemsByDelegate((function(i){return i.properties&&void 0!==i.properties[discountNinja.DiscountedCart.FreeGiftPrefix+t]}))}catch(t){return discountNinja.Logging.LogError("LiquidData.GiftItemsInCart",t),0}},NumberOfItemsInCart:function(){try{return(window.discountNinjaContext&&window.discountNinjaContext.Cart?window.discountNinjaContext.Cart.items:[]).length}catch(t){return discountNinja.Logging.LogError("LiquidData.NumberOfItemsInCart",t),0}},CopyPropertiesExceptSplitKeys:function(t){try{if(!(!1!==discountNinja.Settings.GetFlag("CopyAllPropertiesWhenSplitting")))return{};var i=discountNinja_Script_LiquidData.CartItemPropertiesAsObject(t),n=JSON.parse(JSON.stringify(i));return n=discountNinja_Script_LiquidData.RemovePropertiesByPrefix(n,discountNinja.DiscountedCart.FreeGiftPrefix),n=discountNinja_Script_LiquidData.RemovePropertiesByPrefix(n,discountNinja.DiscountedCart.SplitRowPrefix)}catch(t){return discountNinja.Logging.LogError("LiquidData.CopyPropertiesExceptSplitKeys",t),{}}},ItemHasPropertyWithPrefix:function(t,i){if(!t||discountNinja.Utilities.ObjectIsEmpty(t.properties))return!1;for(var n in t.properties)if(n.indexOf(i)>-1)return!0},ItemHasProperty:function(t,i){return t&&"object"==typeof t.properties&&null!==t.properties&&void 0!==t.properties[i]},ItemHasPropertyWithValue:function(t,i,n){return discountNinja_Script_LiquidData.ItemHasProperty(t,i)&&t.properties[i]===n},ItemsInCartWithoutProperty:function(t,i){try{return discountNinja_Script_LiquidData.CartItemsByDelegate((function(n){return!(discountNinja_Script_LiquidData.ItemHasPropertyWithPrefix(n,t)||i&&discountNinja_Script_LiquidData.ItemIsInCollection(n,i))}))}catch(t){return discountNinja.Logging.LogError("LiquidData.ItemsInCartWithoutProperty",t),0}},QuantityInCartFromCollections:function(t,i,n){var e=discountNinja_Script_LiquidData.ItemsInCartFromCollections(t,i,n);return discountNinja_Script_LiquidData.GetQuantityFromItems(e)},QuantityInCartFromProducts:function(t,i,n){var e=discountNinja_Script_LiquidData.ItemsInCartFromProducts(t,i,n);return discountNinja_Script_LiquidData.GetQuantityFromItems(e)},QuantityInCart:function(t,i){var n=discountNinja_Script_LiquidData.ItemsInCart(t,i);return discountNinja_Script_LiquidData.GetQuantityFromItems(n)},QuantityInCartExcludingGifts:function(t){var i=discountNinja_Script_LiquidData.ItemsInCartWithoutProperty(discountNinja.DiscountedCart.FreeGiftPrefix,t);return discountNinja_Script_LiquidData.GetQuantityFromItems(i)},ValueInCartFromCollections:function(t,i,n,e){var o=e?0:discountNinja_Script_DiscountedCart.TotalCartLevelDiscountInCents(),r=discountNinja_Script_LiquidData.ItemsInCartFromCollections(t,i,n),a=discountNinja_Script_LiquidData.GetOriginalLinePriceFromItems(r);return Math.max(0,a-o)},ValueInCartFromProducts:function(t,i,n,e){var o=e?0:discountNinja_Script_DiscountedCart.TotalCartLevelDiscountInCents(),r=discountNinja_Script_LiquidData.ItemsInCartFromProducts(t,i,n),a=discountNinja_Script_LiquidData.GetOriginalLinePriceFromItems(r);return Math.max(0,a-o)},ValueInCartFromVariants:function(t,i,n,e){var o=e?0:discountNinja_Script_DiscountedCart.TotalCartLevelDiscountInCents(),r=discountNinja_Script_LiquidData.ItemsInCartFromVariants(t,i,n),a=discountNinja_Script_LiquidData.GetOriginalLinePriceFromItems(r);return Math.max(0,a-o)},ValueInCart:function(t,i,n){var e=n?0:discountNinja_Script_DiscountedCart.TotalCartLevelDiscountInCents(),o=discountNinja_Script_LiquidData.ItemsInCart(t,i),r=discountNinja_Script_LiquidData.GetOriginalLinePriceFromItems(o);return Math.max(0,r-e)},HasSubscriptionProducts:function(){return function(){if("object"==typeof BOLD&&"object"==typeof BOLD.recurring_orders){var t=discountNinja.LiquidData.CartItemsByProperty("frequency_num");return t&&t.length>0}return!1}()}},discountNinja_Script_Offer={Offers:null,AllOffers:null,Triggers:null,PrimaryOffer:null,Source:null,SourceReason:null,ServerUrl:function(){return"prod"===discountNinja.Core.Environment?"5"===discountNinja.Core.ApiVersion?"https://promotionapi-v5.discountninja.io":"https://promotionapi-v4.discountninja.io":"https://promotionapi-v4-dev.discountninja.io"},GetOfferByToken:function(t){if(null===t)return null;var i=discountNinja_Script_Offer.AllOffers;if(i)for(var n=0;n<i.length;n++){var e=i[n];if(e.Token===t)return e}return null},SetPrimaryOffer:function(){try{if(discountNinja_Script_Offer.PrimaryOffer=null,discountNinja.Environment.Shopify.IsProductPage()){var t=discountNinja.Environment.Shopify.ProductHandle(),i=discountNinja.Environment.Shopify.VariantId(),n=discountNinja.LiquidData.Inventory(i);discountNinja.Logging.LogVerbose("Selecting primary offer based on product handle: "+t+" (inventory: "+n+")");var e=discountNinja.LiquidData.Price(i),o=discountNinja.LiquidData.CompareAtPrice(i),r=discountNinja.LiquidData.ProductCollections();discountNinja_Script_Offer.PrimaryOffer=discountNinja_Script_Offer.GetOfferForProduct(t,i,r,n,e,o,!1,!0)}if(null===discountNinja_Script_Offer.PrimaryOffer){discountNinja.Logging.LogVerbose("Selecting primary offer based on first applicable");var a=discountNinja_Script_Offer.Offers;if(null===a)return;for(var c=[],s=0;s<a.length;s++){var u=a[s];discountNinja_Script_Offer.IsOfferAccepted(u.Token,u.Frequency)&&c.push(u)}if(0===c.length)discountNinja.Logging.LogInformation("No primary offer detected");else if(1===c.length)discountNinja_Script_Offer.PrimaryOffer=c[0];else{for(var d=[],l=0;l<c.length;l++){u=c[l];d.push(u)}if(0===d.length)discountNinja_Script_Offer.PrimaryOffer=c[0];else if(1===d.length)discountNinja_Script_Offer.PrimaryOffer=d[0];else{for(var g=0;g<d.length;g++){var p=d[g];if(!discountNinja_Script_Offer.IsOfferAccepted(p.Token,p.Frequency))return void(discountNinja_Script_Offer.PrimaryOffer=p)}discountNinja_Script_Offer.PrimaryOffer=d[0]}}}}catch(t){discountNinja.Logging.LogError("Offer.SetPrimaryOffer",t)}},CombinePromotionsFromTokenAndDiscountCode:function(){var t=JSON.parse(discountNinja.Cache.SessionGet("triggersfromtoken")),i=discountNinja.DiscountCodeTrigger.Get(),n=t?t.Offers:[],e=t?t.Triggers:[];return{Offers:function(t,i){try{t||(t=[]);for(var n=0;n<i.length;n++)if(i[n].valid)for(var e=!1,o=0;o<i[n].trigger.Offers.length;o++){for(var r=0;r<t.length;r++)if(t[r].Token===i[n].trigger.Offers[o].Token){e=!0;break}e||t.push(i[n].trigger.Offers[o])}return t}catch(t){return discountNinja.Logging.LogError("Offer.CombineOffersFromTokenAndDiscountCode",t),null}}(n,i),Triggers:function(t,i){try{t||(t=[]);for(var n=0;n<i.length;n++)if(i[n].valid)for(var e=!1,o=0;o<i[n].trigger.Triggers.length;o++){for(var r=0;r<t.length;r++)if(t[r].Token===i[n].trigger.Triggers[o].Token){e=!0;break}if(!e){var a=i[n].trigger.Triggers[o];a.Offers=[];for(r=0;r<i[n].trigger.Offers.length;r++)a.Offers.push(i[n].trigger.Offers[r].Token);t.push(a)}}return t}catch(t){return discountNinja.Logging.LogError("Offer.CombineTriggersFromTokenAndDiscountCode",t),null}}(e,i)}},FilterPromotions:function(){try{discountNinja_Script_Offer.Triggers=function(t){try{if(!t)return null;for(var i=!1,n=null,e=null,o=0;o<t.length;o++){var r=t[o];r.Stacking&&!r.Stacking.Combine&&!0===r.Triggered&&(i=!0,(null===n||n>r.Stacking.Priority)&&(e=r,n=r.Stacking.Priority))}return i?[e]:t}catch(t){return discountNinja.Logging.LogError("Offer.HandleExclusiveTrigger",t),null}}(function(t){try{if(!t)return null;discountNinja.Logging.LogVerbose("Before filter "+t.length+" triggers available");for(var i=[],n=0;n<t.length;n++){var e=t[n];discountNinja_Script_Offer.TriggerIsApplicable(e)&&i.push(e)}return discountNinja.Logging.LogVerbose("After filter "+i.length+" triggers available"),i}catch(t){return discountNinja.Logging.LogError("Offer.FilterTriggers",t),null}}(discountNinja_Script_Offer.Triggers)),discountNinja_Script_Offer.Offers=function(t){try{if(!t)return null;discountNinja.Logging.LogVerbose("Before filter "+t.length+" offers available");for(var i=[],n=0;n<t.length;n++){var e=t[n];discountNinja_Script_Offer.OfferIsApplicable(e)&&i.push(e)}return discountNinja.Logging.LogVerbose("After filter "+i.length+" offers available"),i}catch(t){return discountNinja.Logging.LogError("Offer.FilterOffers",t),null}}(discountNinja_Script_Offer.Offers)}catch(t){return discountNinja.Logging.LogError("Offer.FilterPromotions",t),null}},ConvertRates:function(t){try{if(!t)return null;var i=discountNinjaContext.PresentmentCurrency,n=discountNinjaContext.ShopCurrency;if(!i||!n)return t;for(var e=0;e<t.length;e++)for(var o=t[e],r=0;r<o.Tiers.length;r++){var a=o.Tiers[r];a.Prerequisite&&a.Prerequisite.MinimumAmount&&(a.Prerequisite.MinimumAmount=n===i?a.Prerequisite.MinimumAmountBaseCurrency:discountNinja.Currency.Convert(a.Prerequisite.MinimumAmountBaseCurrency,i,"exact")),a.Prerequisite&&a.Prerequisite.MaximumAmount&&(a.Prerequisite.MaximumAmount=n===i?a.Prerequisite.MaximumAmountBaseCurrency:discountNinja.Currency.Convert(a.Prerequisite.MaximumAmountBaseCurrency,i,"exact")),a.Entitlement&&a.Entitlement.Amount&&(a.Entitlement.Amount=n===i?a.Entitlement.AmountBaseCurrency:discountNinja.Currency.Convert(a.Entitlement.AmountBaseCurrency,i,"exact"))}return t}catch(t){return discountNinja.Logging.LogError("Offer.ConvertRates",t),null}},LoadApplicableOffers:function(t,i){try{var n=discountNinja.Token.GetNonAutomaticToken();!function(t,i,n,e){function o(t,n){try{if(discountNinja_Script_Offer.AllOffers=[],discountNinja_Script_Offer.Offers=[],discountNinja_Script_Offer.Triggers=[],discountNinja_Script_Offer.PrimaryOffer=[],!discountNinja.Settings.SettingsAreValid(discountNinja.Settings.Settings))return discountNinja.Logging.LogWarning("Settings invalid",!0,!1),null;if(discountNinja_Script_Offer.AllOffers=t.Offers,discountNinja_Script_Offer.Triggers=t.Triggers,discountNinja_Script_Offer.FilterPromotions(),discountNinja_Script_Offer.AllOffers=discountNinja_Script_Offer.ConvertRates(discountNinja_Script_Offer.AllOffers),!discountNinja_Script_Offer.AllOffers||0===discountNinja_Script_Offer.AllOffers.length)return discountNinja.Logging.LogInformation("No offers available after filter",!1),null;if(!discountNinja_Script_Offer.Triggers||0===discountNinja_Script_Offer.Triggers.length)return discountNinja.Logging.LogInformation("No triggers available after filter",!1),null;n||(function(t){try{discountNinja.Cache.SessionSet("offerinfo-"+i,JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("Offer.SavePromotionInfoToCache",t)}}(t),discountNinja.DiscountedCart.IsDirty=!0,discountNinja.StickyBar.Clear(),discountNinja.Notification.Clear())}catch(t){return discountNinja.Logging.LogError("Offer.ProcessPromotionInfo",t),null}}function r(t,i,r){try{!0===r?(discountNinja_Script_Offer.Source="Liquid",discountNinja.Logging.LogInformation("PROMOTION DATA - Loaded from Liquid")):!0===i?(discountNinja_Script_Offer.Source="Cache",discountNinja.Logging.LogInformation("PROMOTION DATA - Loaded from cache")):(discountNinja_Script_Offer.Source="Server",discountNinja.Logging.LogInformation("PROMOTION DATA - Loaded from server")),!1===t||"false"===t?(discountNinja.Logging.LogInformation("No applicable offer(s) detected",!1),t={Offers:[],Triggers:[]}):null==t||void 0===t.Offers||null===t.Offers||void 0===t.Offers||null===t.Offers||void 0===t.Triggers||null===t.Triggers?(discountNinja.Logging.LogErrorMessage("Offer.PromotionInfoReady","Offer Info null or no offers/triggers available"),t={Offers:[],Triggers:[]}):!1===t||0===t.Triggers.length?(discountNinja.Logging.LogInformation("No applicable trigger(s) detected",!1),t={Offers:[],Triggers:[]}):!1!==t&&0!==t.Offers.length||(discountNinja.Logging.LogInformation("No applicable offer(s) detected",!1),t={Offers:[],Triggers:[]}),discountNinja.Cache.SessionSet("triggersfromtoken",JSON.stringify(t));var a=discountNinja_Script_Offer.CombinePromotionsFromTokenAndDiscountCode();t.Offers=a.Offers,t.Triggers=a.Triggers,discountNinja.Logging.LogVerbose("Promotion info from server and session combined."),o(t,i),discountNinja.Trigger.TrackExitIntent();var c=discountNinja.Token.GetTokenFromQueryParameter();return null!==c&&""!==c&&discountNinja.Token.SetNonAutomaticTokenToCache(c),discountNinja.Token.RemoveSavedToken(),!i&&t.Version&&discountNinja.Cache.SessionSet("offersVersion",t.Version),discountNinja.Logging.LogInformation("PROMOTION DATA - Loaded "+(discountNinja.Offer.AllOffers?discountNinja.Offer.AllOffers.length:0)+" offers"),discountNinja.Events.Publish("promotions:loaded",[discountNinja.Offer.AllOffers]),n?n(t):void 0}catch(t){return discountNinja.Logging.LogError("Offer.PromotionInfoReady",t),e?e():void 0}}try{var a=function(){try{var t=discountNinja.Cache.SessionGet("offerinfo-"+i),n="undefined"===t?null:JSON.parse(t);return null===n?null:1*n.Status==1*discountNinjaContext.Status?n:(discountNinja.Cache.SessionRemove("offerinfo-"+i,null),null)}catch(t){return discountNinja.Logging.LogError("Offer.GetPromotionInfoFromCache",t),null}}();if(null!==a)return discountNinja.Logging.LogVerbose("Offer info available in cache"),r(a,!0,!1);var c=null===discountNinja.Cache.SessionGet("offerinfo-requested-"+i),s=discountNinja.Core.Shop,u=discountNinja.Utilities.GetReferrer();(function(){var i=discountNinja.Utilities.jQuery().Deferred();try{return void 0!==t&&null!=t&&""!=t?(discountNinja_Script_Offer.SourceReason="Token",i.resolve(null)):!0!==discountNinja.Settings.Settings.LoadPromotionInfoFromContext?(discountNinja_Script_Offer.SourceReason="Configuration",i.resolve(null)):(discountNinja.Logging.LogVerbose("Getting promotion info data from Liquid"),discountNinja.XmlHttpRequest.Send("/index",{view:"discountninja"},null,"get",!0,!0,!0,(function(t){t&&t.PromotionInfo?t.Status!==discountNinjaContext.Status?(discountNinja.Logging.LogInformation("PROMOTION DATA - Status of promotion info context is "+t.Status+", expected "+discountNinjaContext.Status),discountNinja_Script_Offer.SourceReason="UserStatus",i.resolve(null)):!0===t.HasNonDeterministicPromotions?(discountNinja.Logging.LogInformation("PROMOTION DATA - Non-deterministic promotions detected"),discountNinja_Script_Offer.SourceReason="NonDeterministic",i.resolve(null)):i.resolve(t.PromotionInfo):(discountNinja_Script_Offer.SourceReason="LiquidMissing",i.resolve(null))}),(function(){discountNinja_Script_Offer.SourceReason="LiquidFailed",i.resolve(null)}),1,1)),i.promise()}catch(t){discountNinja.Logging.LogError("ProductData.GetPromotionInfoFromServerLiquid",t)}})().then((function(n){null===n?(discountNinja.Logging.LogInformation("PROMOTION DATA - Loading offer info data from server"),discountNinja.XmlHttpRequest.Send(discountNinja_Script_Offer.ServerUrl()+"/api/ApplicablePromotions",function(t,i,n,e){try{var o={};t&&(o.shop=t),i&&(o.token=i),null!==discountNinja.TestMode.TestMode&&(o.testMode=discountNinja.TestMode.TestMode,o.matchByTokenOnly=discountNinja.TestMode.MatchByTokenOnly,discountNinja.TestMode.TestModeToken&&(o.testModeToken=discountNinja.TestMode.TestModeToken)),null!==n&&(o.firstRequest=n),e&&(o.referrer=e),o.version=discountNinja.Core.Version,o.status=discountNinjaContext.Status;var r=discountNinja.DeviceId.Get();return o.deviceId=r,o.m=r+"-"+discountNinja.DateTime.UnixTimestamp(),o.f="7.4",o}catch(t){return discountNinja.Logging.LogError("Offer.LoadPromotionInfo.BuildParameters",t),null}}(s,t,c,u),null,"get",!0,!0,!0,r),discountNinja.Cache.SessionSet("offerinfo-requested-"+i,!0)):r(n,!1,!0)}))}catch(t){discountNinja.Logging.LogError("Offer.LoadApplicableOffersInner",t),e()}}(n,function(t){var i="";return i=(i=t?"token-"+t:"anytoken")+"-"+discountNinja_Script_DiscountCode.GetApplicationCounter(),discountNinja.Logging.LogVerbose("Checking offer info cache for key: "+i),i}(n),t,i)}catch(t){discountNinja.Logging.LogError("Offer.LoadPromotionInfo",t),i()}},TriggerIsApplicable:function(t){return!0},OfferIsApplicable:function(t){try{if(!t)return!1;if(t.Tiers[0]&&t.Tiers[0].Entitlement&&0===t.Tiers[0].Entitlement.Percentage)return!1;var i=!1;if(discountNinja_Script_Offer.Triggers)for(var n=0;n<discountNinja_Script_Offer.Triggers.length;n++){var e=discountNinja_Script_Offer.Triggers[n];if(!0===e.Triggered&&t.TriggeredByTrigger&&t.TriggeredByTrigger.Token===e.Token){i=!0;break}}return!!i&&(discountNinja.Logging.LogVerbose("The offer is applicable"),!0)}catch(t){return discountNinja.Logging.LogError("Offer.PromotionIsApplicable",t),null}},OfferIsExcluded:function(t){if(t.Exclusions){var i=0;t.Exclusions.Collections?i=discountNinja.LiquidData.QuantityInCartFromCollections(t.Exclusions.Collections):"*"===t.Exclusions.Products?i=discountNinjaContext&&discountNinjaContext.Cart?discountNinjaContext.Cart.item_count:0:t.Exclusions.Products&&(i=discountNinja.LiquidData.QuantityInCartFromProducts(t.Exclusions.Products));var n=t.Exclusions.Minimum;if(n&&i&&i>=n)return!0;var e=t.Exclusions.Maximum;if(e&&i&&i<=e)return!0}return!1},GetOfferservedInSession:function(t,i){return discountNinja.Cache.SessionGet("offer-served-session-"+t+"-"+i)},SetOfferservedInSession:function(t,i,n){discountNinja.Cache.SessionSet("offer-served-session-"+t+"-"+i,n)},GetOfferservedOnDevice:function(t,i){return discountNinja.Cache.LocalGet("offer-served-device-"+t+"-"+i)},SetOfferservedOnDevice:function(t,i,n){discountNinja.Cache.LocalSet("offer-served-device-"+t+"-"+i,n)},IsOfferAccepted:function(t,i){if("onceperdevice"===i){var n="true"===discountNinja.Cache.LocalGet("offer-accepted-"+t);return discountNinja.Logging.LogVerbose("The offer is accepted on device: "+n),n}var e="true"===discountNinja.Cache.SessionGet("offer-accepted-"+t);return discountNinja.Logging.LogVerbose("The offer is accepted in the session: "+e),e},SetPromotionAccepted:function(t,i,n){"onceperdevice"===i?discountNinja.Cache.LocalSet("offer-accepted-"+t,n):(discountNinja.Cache.LocalSet("offer-accepted-"+t,""),discountNinja.Cache.SessionSet("offer-accepted-"+t,n))},SetPromotionExpired:function(t,i){discountNinja.Cache.LocalSet("offer-expired-"+t,"true")},ExpireOffersAccepted:function(){if(discountNinja_Script_Offer.AllOffers)for(var t=0;t<discountNinja_Script_Offer.AllOffers.length;t++)discountNinja_Script_Offer.SetPromotionExpired(discountNinja_Script_Offer.AllOffers[t].Token)},GetPromotionPriceRuleId:function(t){t||(t=discountNinja_Script_Offer.PrimaryOffer);var i=t?discountNinja.DiscountTier.GetCurrentDiscountTier(t):null;return i?i.DiscountCode.PriceRuleId:null},GetPromotionPriceRuleTitle:function(t){t||(t=discountNinja_Script_Offer.PrimaryOffer);var i=t?discountNinja.DiscountTier.GetCurrentDiscountTier(t):null;return i?i.DiscountCode.PriceRuleTitle:null},GetPromotionDiscountCode:function(t){t||(t=discountNinja_Script_Offer.PrimaryOffer);var i=t?discountNinja.DiscountTier.GetCurrentDiscountTier(t):null;return i?i.DiscountCode.Code:null},PromotionForProductCacheKey:"OfferForProduct-v3.1",PromotionForCartItemCacheKey:"OfferForCartItem-v3.1",ClearPromotionForProductCache:function(){discountNinja.Cache.SessionSet(discountNinja_Script_Offer.PromotionForProductCacheKey,null),discountNinja.Cache.SessionSet(discountNinja_Script_Offer.PromotionForCartItemCacheKey,null)},GetOfferDataForPrerequisiteProduct:function(t,i,n,e,o,r,a,c,s,u){try{if(null==t)return discountNinja.Logging.LogWarning("No product handle passed",!0,!1),null;var d=discountNinja_Script_Offer.Offers;return d?discountNinja_Script_Offer.GetApplicableOfferNumberInternal(d,t,i,n,e,o,r,a,!1,c,!1,!0,!0,!1,s,u):(discountNinja.Logging.LogInformation("No offers available",!1),null)}catch(t){discountNinja.Logging.LogError("Offer.GetOfferDataForPrerequisiteProduct",t)}},GetOfferDataForProduct:function(t,i,n,e,o,r,a,c,s,u,d){try{if(null==t)return discountNinja.Logging.LogWarning("No product handle passed",!0,!1),null;var l=discountNinja_Script_Offer.Offers;return l?(applicableOfferData=discountNinja_Script_Offer.GetApplicableOfferNumberInternal(l,t,i,n,e,o,r,a,!1,c,!0,!1,!0,s,u,d),null===applicableOfferData.Applicable&&null===applicableOfferData.ApplicableNoTier?null:applicableOfferData):(discountNinja.Logging.LogInformation("No offers available",!1),null)}catch(t){discountNinja.Logging.LogError("Offer.GetOfferDataForProduct",t)}},GetOfferForProduct:function(t,i,n,e,o,r,a,c){try{var s=discountNinja_Script_Offer.GetOfferDataForProduct(t,i,n,e,o,r,a,c);if(null===s||null===s.Applicable)return discountNinja.Logging.LogInformation("No applicable offer available for product "+t,!1),null;var u=discountNinja_Script_Offer.GetOfferByToken(s.Applicable);return discountNinja.Logging.LogVerbose("Using offer "+u.Token+" for product "+t),u}catch(t){discountNinja.Logging.LogError("Offer.GetOfferForProduct",t)}},GetOfferForCartItem:function(t,i,n,e,o,r,a,c,s){try{if(!t)return discountNinja.Logging.LogInformation("No offers available",!1),null;var u=discountNinja_Script_Offer.GetApplicableOfferNumberInternal(t,n,e,o,r,a,c,!1,!0,!0,!0,!1,!1,s);return applicableOfferToken=u.Applicable,null===applicableOfferToken?(discountNinja.Logging.LogInformation("No applicable offer available for product "+n,!1),null):(discountNinja.Logging.LogVerbose("Using offer "+applicableOfferToken+" for product "+n),discountNinja_Script_Offer.GetOfferByToken(applicableOfferToken))}catch(t){discountNinja.Logging.LogError("Offer.GetOfferForProduct",t)}},OfferIsValidForProduct:function(t,i,n,e,o,r,a,c,s){try{if("line_item"!==t.Entitlement.TargetType)return discountNinja.Logging.LogVerbose("Offer with token "+t.Token+" not valid for product "+n+" - Shipping only"),!1;if("each"!==t.Entitlement.AllocationMethod&&(!r||"percentage"!==t.Entitlement.ValueType))return discountNinja.Logging.LogVerbose("Offer with token "+t.Token+" not valid for product "+n+" - Cart level only"),!1;if(a&&t.Entitlement.ExcludeCollectionHandles&&t.Entitlement.ExcludeCollectionHandles.indexOf("%")>-1&&c>s)return discountNinja.Logging.LogVerbose("Offer with token "+t.Token+" not valid for current variant of product "+n+" - Discounted variant"),!1;if(discountNinja.Utilities.StringIsIn(e,t.Entitlement.ExcludeCollectionHandles))return discountNinja.Logging.LogVerbose("The offer is not valid for product "+n+" because that product is in an exclude collection."),!1;if("collection"===t.Entitlement.EntitledItemType){if(!discountNinja.Utilities.StringIsIn(e,t.Entitlement.EntitledCollectionHandles))return discountNinja.Logging.LogVerbose("The offer is not valid for product "+n+" because that product is not in the set of promoted collections."),discountNinja.Logging.LogVerbose("The offer applies to products in the collections '"+t.Entitlement.EntitledCollectionHandles+"' the product '"+n+" is in collections '"+e+"'."),!1}else if("product"===t.Entitlement.EntitledItemType||"variant"===t.Entitlement.EntitledItemType){if(t.Entitlement.EntitledVariantIds&&i){if(!discountNinja.Utilities.StringIsIn(t.Entitlement.EntitledVariantIds,i))return discountNinja.Logging.LogVerbose("The offer is not valid for variant "+i+" because that variant is not in the set of promoted variants."),discountNinja.Logging.LogVerbose("The offer applies to variants '"+t.Entitlement.EntitledVariantIds+"' of products '"+t.Entitlement.EntitledProductHandles+"' the variant '"+i+" is not in that list."),!1}else if(!discountNinja.Utilities.StringIsIn(t.Entitlement.EntitledProductHandles,n))return discountNinja.Logging.LogVerbose("The offer is not valid for product "+n+" because that product is not in the set of promoted products."),discountNinja.Logging.LogVerbose("The offer applies to products '"+t.Entitlement.EntitledProductHandles+"' the product '"+n+" is not in that list."),!1}else if("site"!==t.Entitlement.EntitledItemType)return discountNinja.Logging.LogErrorMessage("Offer.OfferIsValidForProduct","TargetType unknown"),!1;return discountNinja.Logging.LogVerbose("Offer is valid for product"),!0}catch(t){return discountNinja.Logging.LogError("Offer.OfferIsValidForProduct",t),!1}},GetApplicableOfferNumberInternal:function(t,i,n,e,o,r,a,c,s,u,d,l,g,p,f,N){function j(t,i){var n=discountNinja.Prerequisite.EntitledQuantityInfo(t,i);return!n.HasEntitledQuantity||n.InCartNotAttributed>0}function m(t,i,n){try{if(discountNinja.Utilities.StringIsIn(n,t.Prerequisite.PrerequisiteExcludeCollections))return!1;if(t.Prerequisite.PrerequisiteCollections){if(discountNinja.Utilities.StringIsIn(n,t.Prerequisite.PrerequisiteCollections))return!0}else if(t.Prerequisite.PrerequisiteProducts&&discountNinja.Utilities.StringIsIn(i,t.Prerequisite.PrerequisiteProducts))return!0;return!1}catch(t){return discountNinja.Logging.LogError("Offer.ProductIsPrerequisiteFor",t),!1}}function h(t,i,n){try{var e=t.Entitlement.ValueType,o=100*i.Amount,r=i.Percentage,a=discountNinja.Settings.Settings.Currency,c=a.RoundPrices,s=a.RoundToCents,u=0;if("fixed_amount"===e?u=n-o:"percentage"===e&&(u=parseFloat((n-Math.floor(n*r)/100).toFixed(4))),u<0&&(u=0),c){var d=100*u;if(d>0)d=100*Math.floor(d/100)+s;u=Math.round(d)/100}return Math.round(100*u)/100}catch(t){discountNinja.Logging.LogError("Offer.TestDiscountedPrice",t)}}try{for(var C=e,S=null,y=null,_=null,v=0;v<t.length;v++){var P=t[v];if(discountNinja.Logging.LogVerbose("Checking offer "+(v+1)+" with token "+P.Token),(!0!==f||P.Badge)&&(!0!==N||P.PromotionCard))if(!discountNinja_Script_Offer.OfferIsApplicable(P)||discountNinja_Script_Offer.OfferIsExcluded(P)||p&&(!p||!1===P.UpdatePriceProductPage)||d&&!discountNinja_Script_Offer.OfferIsValidForProduct(P,n,i,C,o,g,u,a,r)||l&&!m(P,i,C)||!discountNinja_Script_Offer.IsOfferAccepted(P.Token,P.Frequency))discountNinja.Logging.LogVerbose("Offer "+(v+1)+" with token "+P.Token+" - Not valid");else if(d){var L=discountNinja.DiscountTier.GetCurrentDiscountTier(P);if(L)if(!s||j(P,L)){var T=h(P,discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(L),r);(null===_||T<_)&&(S=v,_=T,discountNinja.Logging.LogVerbose("Offer "+(v+1)+" with token "+P.Token+" - Candidate"))}else discountNinja.Logging.LogVerbose("Offer with token "+P.Token+" is over allocated - Not valid");else{if(!0===f&&P.Badge&&!1===P.Badge.Announce)continue;!0===f&&P.Badge&&!0===P.Badge.Announce?(discountNinja.Logging.LogVerbose("No tier detected for offer with token "+P.Token+" - Not valid yet - Announcing with badge"),S=v):(discountNinja.Logging.LogVerbose("No tier detected for offer with token "+P.Token+" - Not valid"),y=v)}}else if(l){if(!0===f&&P.Badge&&!1===P.Badge.Announce)continue;!0===f&&P.Badge&&!0===P.Badge.Announce?(discountNinja.Logging.LogVerbose("No tier detected for offer with token "+P.Token+" - Not valid yet - Announcing with badge"),S=v):S=v}}return{Applicable:null===S?null:t[S].Token,ApplicableNoTier:null===y?null:t[y].Token}}catch(t){return discountNinja.Logging.LogError("Offer.GetApplicableOfferNumberInternal",t),!1}},GetFromCache:function(t){try{var i=discountNinja.Cache.SessionGet("offer-data-"+t);return"undefined"===i?[]:JSON.parse(i)}catch(t){return discountNinja.Logging.LogError("Offer.GetFromCache",t),null}},SaveToCache:function(t){try{discountNinja.Cache.SessionSet("offer-data-"+t.Token,JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("Offer.SaveToCache",t)}},RemoveFromCache:function(t){try{discountNinja.Cache.SessionRemove("offer-data-"+t)}catch(t){return discountNinja.Logging.LogError("Offer.RemoveFromCache",t),null}},Stop:function(t){try{discountNinja.Logging.LogVerbose("Stopping offer."),discountNinja.DiscountCode.Remove(t),discountNinja.Notification.Remove(t),discountNinja.PopUp.Hide(t),discountNinja.StickyBar.Remove(t),discountNinja.DynamicPricing.Show(!1),discountNinja_Script_Offer.SetPromotionExpired(t)}catch(t){discountNinja.Logging.LogError("Offer.Stop",t)}},UnApply:function(t){try{discountNinja.Logging.LogVerbose("Unapplying offer."),discountNinja.DiscountCode.Remove(t)}catch(t){discountNinja.Logging.LogError("Offer.UnApply",t)}},ReEvaluate:function(){try{discountNinja.Logging.LogVerbose("Re-evaluate all offers. Stopping all offers with timers. Undoing all side effects"),discountNinja.DiscountCode.UndoInjectDiscountCodesInHtml(),discountNinja.DiscountCode.Clear(),discountNinja.ShortCode.HideShortcodePlaceholders(),discountNinja.Notification.Clear(),discountNinja.Notification.Hide(!1),discountNinja.StickyBar.Clear(),discountNinja.StickyBar.Hide(!1);var t=discountNinja_Script_Offer.PrimaryOffer;t&&discountNinja.PopUp.Hide(t.Token),discountNinja.Utilities.jQuery()(".limoniapps-discountninja-cart-promotionsummary").html(""),discountNinja.DynamicPricing.Show(!1),discountNinja_Script_Offer.ExpireOffersAccepted(),discountNinja.DiscountedCart.IsDirty=!0,discountNinja.PromotionFlow.StartFlow()}catch(t){discountNinja.Logging.LogError("Offer.ReEvaluate",t)}},GetTier:function(t,i){try{return t.Tiers.length>i?offers.Tiers[i]:null}catch(t){return discountNinja.Logging.LogError("Offer.GetTier",t),null}},GetTriggerTokenForOffer:function(t){try{if(!discountNinja_Script_Offer.Triggers)return null;for(var i=0;i<discountNinja_Script_Offer.Triggers.length;i++)for(var n=discountNinja_Script_Offer.Triggers[i],e=0;e<n.Offers.length;e++)if(n.Offers[e]===t)return n.Token;return null}catch(t){return discountNinja.Logging.LogError("Offer.GetTriggerTokenForOffer",t),null}},PrerequisiteItemsCartValue:function(t){try{var i=0,n=!0;return t.Prerequisite&&!0===t.Prerequisite.AfterDiscount?"*"===t.Prerequisite.PrerequisiteCollections?i=discountNinja.DiscountedCart.ValueInDiscountedCart(t.Prerequisite.PrerequisiteExcludeCollections,n):t.Prerequisite.PrerequisiteCollections?i=discountNinja.DiscountedCart.ValueInDiscountedCartFromCollections(t.Prerequisite.PrerequisiteCollections,t.Prerequisite.PrerequisiteExcludeCollections,n):t.Prerequisite.PrerequisiteProducts&&(i=discountNinja.DiscountedCart.ValueInDiscountedCartFromProducts(t.Prerequisite.PrerequisiteProducts,t.Prerequisite.PrerequisiteExcludeCollections,n)):t.Prerequisite&&("*"===t.Prerequisite.PrerequisiteCollections?i=discountNinja.LiquidData.ValueInCart(t.Prerequisite.PrerequisiteExcludeCollections,n,!0):t.Prerequisite.PrerequisiteCollections?i=discountNinja.LiquidData.ValueInCartFromCollections(t.Prerequisite.PrerequisiteCollections,t.Prerequisite.PrerequisiteExcludeCollections,n,!0):t.Prerequisite.PrerequisiteProducts&&(i=discountNinja.LiquidData.ValueInCartFromProducts(t.Prerequisite.PrerequisiteProducts,t.Prerequisite.PrerequisiteExcludeCollections,n,!0))),discountNinja.Logging.LogVerbose("Cart value for prerequisite items of offer "+t.Token+" is "+i),i}catch(t){return discountNinja.Logging.LogError("Offer.PrerequisiteItemsCartValue",t),0}},EligibleItemsCartValue:function(t,i,n){try{var e=0,o=t.Entitlement,r=o.EntitledItemType,a="discountedcart"===i;return void 0===n&&(n=!0),"site"===r&&"*"===o.EntitledProductHandles?e=a?discountNinja.DiscountedCart.ValueInDiscountedCart(t.Entitlement.ExcludeCollectionHandles,n):discountNinja.LiquidData.ValueInCart(t.Entitlement.ExcludeCollectionHandles,n):"collection"===r&&o.EntitledCollectionHandles?e=a?discountNinja.DiscountedCart.ValueInDiscountedCartFromCollections(t.Entitlement.EntitledCollectionHandles,t.Entitlement.ExcludeCollectionHandles,!0):discountNinja.LiquidData.ValueInCartFromCollections(t.Entitlement.EntitledCollectionHandles,t.Entitlement.ExcludeCollectionHandles,n):"product"!==r&&"variant"!==r||!o.EntitledProductHandles||(e=t.Entitlement.EntitledVariantIds?a?discountNinja.DiscountedCart.ValueInDiscountedCartFromVariants(t.Entitlement.EntitledVariantIds,t.Entitlement.ExcludeCollectionHandles,n):discountNinja.LiquidData.ValueInCartFromVariants(t.Entitlement.EntitledVariantIds,t.Entitlement.ExcludeCollectionHandles,n):a?discountNinja.DiscountedCart.ValueInDiscountedCartFromProducts(t.Entitlement.EntitledProductHandles,t.Entitlement.ExcludeCollectionHandles,n):discountNinja.LiquidData.ValueInCartFromProducts(t.Entitlement.EntitledProductHandles,t.Entitlement.ExcludeCollectionHandles,n)),discountNinja.Logging.LogVerbose("Cart value for eligible items of offer "+t.Token+" is "+e),e}catch(t){return discountNinja.Logging.LogError("Offer.EligibleItemsCartValue",t),0}}},discountNinja_Script_ProductData={CachePrefix:function(){return"productdata-v7.4-"},VariantCachePrefix:function(){return"productvariantdata-v7.4-"},ServerUrl:function(){return"prod"===discountNinja.Core.Environment?"5"===discountNinja.Core.ApiVersion?"https://productapi-v5.discountninja.io":"https://productapi-v4.discountninja.io":"https://productapi-v4-dev.discountninja.io"},DecodeProductHandle:function(t){try{return decodeURIComponent(t)}catch(i){return t}},ProductIsAvailable:function(t){try{return!!t&&(void 0!==t.Available&&null!==t.Available?!0===t.Available:void 0===t.InventoryLeft||(null===t.InventoryLeft||t.InventoryLeft>0))}catch(t){return discountNinja.Logging.LogError("ProductData.ProductIsAvailable",t),!0}},SaveProductDataToCache:function(t,i,n,e,o,r,a,c,s){function u(t){return"string"==typeof t?t:null}try{i=function(t,i){try{return(null==t||isNaN(t)||0===t)&&(t=i),t<i&&(t=i),Math.floor(t)}catch(t){return discountNinja.Logging.LogError("ProductData.NormalizeCompareAtPrice",t),i}}(i,n=function(t){try{return(null==t||isNaN(t))&&(t=0),Math.floor(t)}catch(t){return discountNinja.Logging.LogError("ProductData.NormalizePrice",t),0}}(n)),r=function(t){try{return(void 0===t||isNaN(t))&&(t=null),t}catch(t){return discountNinja.Logging.LogError("ProductData.NormalizeInventory",t),null}}(r),e=u(e),c=u(c),a=function(t){try{return null==t?null:!0===t||"true"===t}catch(t){return discountNinja.Logging.LogError("ProductData.NormalizeInventory",t),null}}(a),t=discountNinja_Script_ProductData.DecodeProductHandle(t),discountNinja.Logging.LogVerbose("Saving product data for handle: "+t);var d={CompareAtPrice:i,Price:n,Inventory:r,Available:a,Collections:e,CollectionsComplete:o,Tags:c,Source:s},l=discountNinja_Script_ProductData.GetByProductHandle(t,!1,!1,null,!0);if(!l)return void discountNinja.Cache.SessionSet(discountNinja_Script_ProductData.CachePrefix()+t,JSON.stringify(d));if("product"===s||"collection"===s){if(discountNinja.Cache.SessionSet(discountNinja_Script_ProductData.CachePrefix()+"session-"+t,"true"),"product"===s)return void discountNinja.Cache.SessionSet(discountNinja_Script_ProductData.CachePrefix()+t,JSON.stringify(d));if("collection"===s)return l.CollectionsComplete&&!d.CollectionsComplete?d.Collections=l.Collections:null===l.Collections&&(d.CollectionsComplete||null!==d.Collections||discountNinja.Environment.Shopify.IsCollectionPage()&&!discountNinja.Environment.Shopify.IsCatalogPage()&&(d.Collections=discountNinja.Environment.Shopify.CollectionHandle(),d.CollectionsComplete=!1,discountNinja.Logging.LogVerbose("No collections data, setting current collection for: "+t))),void discountNinja.Cache.SessionSet(discountNinja_Script_ProductData.CachePrefix()+t,JSON.stringify(d))}else{if("product"!==l.Source||!discountNinja.Cache.SessionGet(discountNinja_Script_ProductData.CachePrefix()+"session-"+t))return"server"===s?void discountNinja.Cache.SessionSet(discountNinja_Script_ProductData.CachePrefix()+t,JSON.stringify(d)):"product"===l.Source||"collection"===l.Source||"server"===l.Source?void discountNinja.Logging.LogVerbose("Current cached product data is from "+l.Source+" and new data is from a less trustworthy source "+d.Source+" , skipping save for handle: "+t):void discountNinja.Cache.SessionSet(t,JSON.stringify(d));discountNinja.Logging.LogVerbose("Current cached product data is from product page and new data is not from liquid, skipping save for handle: "+t)}}catch(t){return discountNinja.Logging.LogError("ProductData.SaveProductDataToCache",t),null}},GetDataFromCollectionAttribute:function(t,i,n,e){try{var o=i.toLowerCase(),r=discountNinja.Utilities.jQuery()(t).attr("data-limoniapps-discountninja-product-"+o);if(r||(r=discountNinja.Utilities.jQuery()(t).attr("data-limoniapps-discounturl-product-"+o)),!r&&n){n=discountNinja_Script_ProductData.DecodeProductHandle(n);var a=discountNinja.LiquidData.CollectionProductByHandle(n);a&&(r=a[i])}if(!r&&void 0!==window.__pageflyProducts&&"Handle"===i){var c=discountNinja.Utilities.jQuery()(t).attr("data-product-id")||discountNinja.Utilities.jQuery()(t).parents("[data-product-id]").attr("data-product-id")||discountNinja.Utilities.jQuery()(t).find("[data-product-id]").attr("data-product-id");if(c){var s=window.__pageflyProducts[c];if(s&&void 0!==s.handle)return s.handle}}if(!r&&"Handle"===i){var u=discountNinja.Settings.Settings.PriceUpdate.Mode,d=e?u.FeaturedProductHandle:u.CollectionProductHandle;if(d&&"custom"!==d){var l=discountNinja.Utilities.GetHandleFromSelector(t,null,d);return!1===l?null:l}}return void 0===r?null:r}catch(t){return discountNinja.Logging.LogError("ProductData.GetDataFromCollectionAttribute",t),null}},SaveProductDataUsingDataTags:function(t){try{var i=!0,n=discountNinja_Script_ProductData.GetDataFromCollectionAttribute(t,"Handle"),e=discountNinja_Script_ProductData.GetDataFromCollectionAttribute(t,"Price",n),o=discountNinja_Script_ProductData.GetDataFromCollectionAttribute(t,"CompareAtPrice",n),r=discountNinja_Script_ProductData.GetDataFromCollectionAttribute(t,"Collections",n),a=discountNinja_Script_ProductData.GetDataFromCollectionAttribute(t,"Inventory",n),c=discountNinja_Script_ProductData.GetDataFromCollectionAttribute(t,"Tags",n),s=discountNinja_Script_ProductData.GetDataFromCollectionAttribute(t,"Available",n);if(r||!discountNinja.Environment.Shopify.IsCollectionPage()||discountNinja.Environment.Shopify.IsCatalogPage()||(r=discountNinja.Environment.Shopify.CollectionHandle(),i=!1),!(null!=n&&null!=e&&null!=o&&null!=r&&null!=c))return void discountNinja.Logging.LogVerbose("Incomplete data in collection data tags for handle: "+n+", aborting");discountNinja.Logging.LogVerbose("Saving product data for collection product with handle: "+n),discountNinja_Script_ProductData.SaveProductDataToCache(n,o,e,r,i,a,s,c,"collection")}catch(t){return discountNinja.Logging.LogError("ProductData.SaveProductDataUsingDataTags",t),null}},Save:function(){try{discountNinja.Logging.LogVerbose("Saving product data for products on page");for(var t=discountNinja.Utilities.jQuery()("[data-limoniapps-discountninja-product-handle]"),i=0;i<t.length;i++)discountNinja.ProductData.SaveProductDataUsingDataTags(t[i]);if(discountNinja.Environment.Shopify.IsProductPage()){var n=discountNinja.Environment.Shopify.ProductHandle(),e=discountNinja.LiquidData.ProductTags(),o=discountNinja.LiquidData.ProductDefaultVariantId(n);if(o){var r=discountNinja.LiquidData.Inventory(o),a=discountNinja.LiquidData.ProductAvailable(n);if(price=discountNinja.LiquidData.Price(o),null===price)return void discountNinja.Logging.LogVerbose("No price available");price*=100,compareAtPrice=100*discountNinja.LiquidData.CompareAtPrice(o),collections=discountNinja.LiquidData.ProductCollections(),discountNinja.Logging.LogVerbose("Saving product data for products on page - detected product page product with handle: "+n),discountNinja_Script_ProductData.SaveProductDataToCache(n,compareAtPrice,price,collections,!0,r,a,e,"product")}}if(discountNinja.Environment.Shopify.IsProductPage()){n=discountNinja.Environment.Shopify.ProductHandle();discountNinja_Script_ProductData.SaveProductVariantDataToCache(n,discountNinjaContext.ProductVariants)}if(window.discountNinjaContext&&window.discountNinjaContext.Cart&&window.discountNinjaContext.Cart.items&&window.discountNinjaContext.Cart.length>0)for(var c=0;c<window.discountNinjaContext.Cart.length;c++){n=window.discountNinjaContext.Cart.items[c].handle;discountNinja_Script_ProductData.GetByProductHandle(n,!1)||(o=discountNinja.LiquidData.ProductDefaultVariantId(n),r=discountNinja.LiquidData.Inventory(o),a=discountNinja.LiquidData.ProductAvailable(n),price=discountNinja.LiquidData.Price(o),null!==originalPrice?(price*=100,compareAtPrice=100*discountNinja.LiquidData.CompareAtPrice(o),discountNinja.Logging.LogVerbose("Saving product data for products on page - detected cart product with handle: "+n),discountNinja_Script_ProductData.SaveProductDataToCache(n,compareAtPrice,price,null,!1,r,a,null,"cart")):discountNinja.Logging.LogVerbose("No price available"))}}catch(t){return void discountNinja.Logging.LogError("ProductData.Save",t)}},SaveOnAddToCart:function(t){try{t=discountNinja_Script_ProductData.DecodeProductHandle(t);var i=100*discountNinja.LiquidData.PriceFromCartByProductHandle(t);discountNinja_Script_ProductData.SaveProductDataToCache(t,null,i,null,!1,null,null,null,"addtocart")}catch(t){return discountNinja.Logging.LogError("ProductData.Save",t),null}},GetByVariant:function(t){try{var i=discountNinja.LiquidData.ProductHandleFromCart(t);return i?discountNinja_Script_ProductData.GetByProductHandle(i,!1):null}catch(t){return discountNinja.Logging.LogError("ProductData.Get",t),null}},GetProductDataRequests:[],GetByProductHandle:function(t,i,n,e,o,r){var a=discountNinja.Utilities.jQuery().Deferred();function c(t){var i=discountNinja.Utilities.jQuery().Deferred();try{return!1===discountNinja.LeakyBucket.Take(discountNinja.LeakyBucket.Buckets.ProductApi)?i.resolve(null):(discountNinja.Logging.LogVerbose("Getting product data from server for product with handle: "+t),discountNinja.XmlHttpRequest.Send(discountNinja_Script_ProductData.ServerUrl()+"/api/ProductData",function(t,i){try{var n={};t&&(n.shop=t),i&&(n.handle=i);var e=discountNinja.DeviceId.Get();return n.m=e+"-"+discountNinja.DateTime.UnixTimestamp(),n.version=discountNinja.Core.Version,n.f="7.4",n}catch(t){return discountNinja.Logging.LogError("ProductData.GetProductDataFromServer.GetProductDataFromServer",t),null}}(discountNinja.Core.Shop,t),null,"get",!0,!0,!0,(function(t){try{t?(discountNinja.Cache.SessionSet(discountNinja_Script_ProductData.CachePrefix()+"session-"+t.Handle,"true"),discountNinja.Logging.LogVerbose("Retrieved product data from server for product with handle: "+t.Handle),discountNinja_Script_ProductData.SaveProductDataToCache(t.Handle,t.CompareAtPrice,t.Price,t.Collections,!0,null,null,t.Tags,"server"),discountNinja.DynamicPricing.UpdatePriceDebouncedAfterServerUpdate(),i.resolve(t)):i.resolve(null)}catch(t){discountNinja.Logging.LogError("ProductData.GetProductDataFromServer.ProductDataReady",t),i.resolve(null)}}),(function(){i.resolve(null)}),1,2)),i.promise()}catch(t){discountNinja.Logging.LogError("GetProductDataFromServer",t),i.resolve(null)}}function s(t){var i=discountNinja.Utilities.jQuery().Deferred();try{return!1===discountNinja.LeakyBucket.Take(discountNinja.LeakyBucket.Buckets.ProductLiquid)?i.resolve(null):(discountNinja.Logging.LogVerbose("Getting product data from Liquid for product with handle: "+t),discountNinja.XmlHttpRequest.Send("/products/"+t,{view:"discountninja"},null,"get",!0,!0,!1,(function(t){try{t?(discountNinja.Cache.SessionSet(discountNinja_Script_ProductData.CachePrefix()+"session-"+t.Handle,"true"),discountNinja.Logging.LogVerbose("Retrieved product data from Liquid for product with handle: "+t.Handle),discountNinja_Script_ProductData.SaveProductDataToCache(t.Handle,t.CompareAtPrice,t.Price,t.Collections,!0,null,t.Available,t.Tags,"server"),discountNinja.DynamicPricing.UpdatePriceDebouncedAfterServerUpdate(),i.resolve(t)):i.resolve(null)}catch(t){discountNinja.Logging.LogError("GetProductDataFromServerLiquid",t),i.resolve(null)}}),(function(){i.resolve(null)}),1,1)),i.promise()}catch(t){discountNinja.Logging.LogError("ProductData.GetProductDataFromServerLiquid",t)}}function u(i){try{if(null===i)return!1;var n=("server"===i.Source||"product"===i.Source)&&"true"===discountNinja.Cache.SessionGet(discountNinja_Script_ProductData.CachePrefix()+"session-"+t);return"collection"===i.Source&&i.CollectionsComplete&&void 0!==i.Price&&null!==i.Price&&void 0!==i.CompareAtPrice&&null!==i.CompareAtPrice||n}catch(t){discountNinja.Logging.LogError("ProductData.GetByProductHandle.IsComplete",t)}}try{null===i&&(i=!1),null==r&&(r=0);if(!t)return discountNinja.Logging.LogErrorMessage("ProductData","Requesting GetProductDataFromServer with empty handle"),i?(a.resolve(null),a.promise()):null;t=discountNinja_Script_ProductData.DecodeProductHandle(t);var d=discountNinja.Cache.SessionGet(discountNinja_Script_ProductData.CachePrefix()+t),l="undefined"===d?null:JSON.parse(d),g=u(l);if(!g&&n&&e&&(discountNinja.ProductData.SaveProductDataUsingDataTags(e),g=u(l="undefined"===(d=discountNinja.Cache.SessionGet(discountNinja_Script_ProductData.CachePrefix()+t))?null:JSON.parse(d))),i){if(g||!0===o)a.resolve(l);else if(!0===discountNinja_Script_ProductData.GetProductDataRequests[t]){if(5===r)return null;new Promise((function(t){setTimeout((function(){t()}),250)})).then((function(){discountNinja_Script_ProductData.GetByProductHandle(t,!0,n,e,o,r++).then((function(t){a.resolve(t)}))}))}else discountNinja_Script_ProductData.GetProductDataRequests[t]=!0,s(t).then((function(i){null===i?c(t).then((function(i){discountNinja_Script_ProductData.GetProductDataRequests[t]=!1,a.resolve(i)})):(discountNinja_Script_ProductData.GetProductDataRequests[t]=!1,a.resolve(i))}));return a.promise()}if(!g&&!0!==o)if(!0===discountNinja_Script_ProductData.GetProductDataRequests[t]){if(5===r)return null;new Promise((function(t){setTimeout((function(){t()}),250)})).then((function(){discountNinja_Script_ProductData.GetByProductHandle(t,!0,n,e,o,r++).then((function(t){a.resolve(t)}))}))}else discountNinja_Script_ProductData.GetProductDataRequests[t]=!0,s(t).then((function(i){null===i?c(t).then((function(){discountNinja_Script_ProductData.GetProductDataRequests[t]=!1})):discountNinja_Script_ProductData.GetProductDataRequests[t]=!1}));return l}catch(t){return discountNinja.Logging.LogError("ProductData.GetByProductHandle",t),null}},GetVariantData:function(t,i){try{t=discountNinja_Script_ProductData.DecodeProductHandle(t),i=function(t){try{return null==t?null:parseInt(t)}catch(t){return discountNinja.Logging.LogError("ProductData.NormalizeVariantId",t),null}}(i);var n=discountNinja.Cache.SessionGet(discountNinja_Script_ProductData.VariantCachePrefix()+t),e="undefined"===n?null:JSON.parse(n);return null===e?null:e.Variants.find((function(t){return t.VariantId===i}))||null}catch(t){return discountNinja.Logging.LogError("ProductData.GetVariantData",t),null}},SaveProductVariantDataToCache:function(t,i){function n(t,i){try{return(null==t||isNaN(t)||0===t)&&(t=i),t<i&&(t=i),Math.floor(t)}catch(t){return discountNinja.Logging.LogError("ProductData.NormalizeCompareAtPrice",t),i}}function e(t){try{return(null==t||isNaN(t))&&(t=0),Math.floor(t)}catch(t){return discountNinja.Logging.LogError("ProductData.NormalizePrice",t),0}}function o(t){try{return(void 0===t||isNaN(t))&&(t=null),t}catch(t){return discountNinja.Logging.LogError("ProductData.NormalizeInventory",t),null}}function r(t){try{return null==t?null:parseInt(t)}catch(t){return discountNinja.Logging.LogError("ProductData.NormalizeVariantId",t),null}}function a(t,i,a,c){try{return{VariantId:r(t),CompareAtPrice:n(a,i),Price:e(i),Inventory:o(c)}}catch(t){return discountNinja.Logging.LogError("ProductData.BuildVariantData",t),null}}try{if(!t||!i)return;t=discountNinja_Script_ProductData.DecodeProductHandle(t);for(var c={Variants:[]},s=0;s<i.length;s++)c.Variants.push(a(i[s].VariantId,i[s].Price,i[s].CompareAtPrice,i[s].Inventory));discountNinja.Cache.SessionSet(discountNinja_Script_ProductData.VariantCachePrefix()+t,JSON.stringify(c))}catch(t){return discountNinja.Logging.LogError("ProductData.SaveProductVariantDataToCache",t),null}}},discountNinja_Script_PromotionEvent={Queue:"promotionevent-queue",ServerUrl:function(){return"prod"===discountNinja.Core.Environment?"5"===discountNinja.Core.ApiVersion?"https://promotioneventsapi-v5.discountninja.io":"https://promotioneventsapi-v4.discountninja.io":"https://promotioneventsapi-v4-dev.discountninja.io"},PromotionEventKey:function(t,i,n){return"offerevent-sent-"+t+"-"+i+"-"+n},GetPromotionEventSentInSession:function(t,i,n){return discountNinja.Cache.SessionGet(discountNinja_Script_PromotionEvent.PromotionEventKey(t,i,n))},SetPromotionEventSentInSession:function(t,i,n,e){discountNinja.Cache.SessionSet(discountNinja_Script_PromotionEvent.PromotionEventKey(t,i,n),e)},GetQueue:function(){try{var t=discountNinja.Cache.LocalGet(discountNinja_Script_PromotionEvent.Queue);return JSON.parse(t)}catch(t){return discountNinja.Logging.LogError("PromotionEvent.GetQueue",t),null}},AddToQueue:function(t,i){try{if(discountNinja.TestMode.TestMode)return;var n=discountNinja_Script_PromotionEvent.GetQueue();null===n&&(n=[]),n.push({triggerToken:t,eventType:i,processed:!1}),discountNinja_Script_PromotionEvent.SaveQueue(n),discountNinja_Script_PromotionEvent.ProcessQueue()}catch(t){discountNinja.Logging.LogError("PromotionEvent.AddToQueue",t)}},SaveQueue:function(t){try{for(var i=[],n=0;n<t.length;n++){var e=t[n];e.processed||i.push(e)}discountNinja.Cache.LocalSet(discountNinja_Script_PromotionEvent.Queue,JSON.stringify(i))}catch(t){discountNinja.Logging.LogError("PromotionEvent.SaveQueue",t)}},ProcessQueueDebounced:function(){function t(t){try{if(0===t.eventType){if(!0===discountNinja.Settings.Settings.TrackFacebookEvent&&"function"==typeof fbq)try{fbq("trackCustom","Discount Ninja - Promotion triggered",{Promotion:t.triggerToken})}catch(t){discountNinja.Logging.LogError("PromotionEventEngine - Facebook integration",t)}if(!0===discountNinja.Settings.Settings.TrackGoogleAnalyticsEvent&&"function"==typeof ga)try{ga("send","event","Discount Ninja","Promotion triggered",t.triggerToken)}catch(t){discountNinja.Logging.LogError("PromotionEventEngine - Google Analytics integration",t)}if(!0===discountNinja.Settings.Settings.TrackGTMEvent)try{var i=window.dataLayer=window.dataLayer||[];i.push({ecommerce:null}),i.push({ecommerce:{promoView:{promotions:[{id:t.triggerToken,name:"Discount Ninja promotion "+t.triggerToken}]}}})}catch(t){discountNinja.Logging.LogError("PromotionEventEngine - GTM integration",t)}}}catch(t){discountNinja.Logging.LogError("PromotionEvent.LogPixelEvent",t)}}function i(t,i){try{return"sent"===discountNinja_Script_PromotionEvent.GetPromotionEventSentInSession(t.triggerToken,"",t.eventType)?(discountNinja.Logging.LogVerbose("Event of type "+t.eventType+" already sent for offer with token "+t.triggerToken),t.processed=!0,i):(discountNinja_Script_PromotionEvent.SetPromotionEventSentInSession(t.triggerToken,"",t.eventType,"sent"),i.push(t),i)}catch(t){return discountNinja.Logging.LogError("PromotionEvent.LogPromotionEvent",t),i}}try{var n=discountNinja_Script_PromotionEvent.GetQueue();null===n&&(n=[]);for(var e=[],o=0;o<n.length;o++){var r=n[o];r.processed||(e=i(r,e))}for(o=0;o<e.length;o++)t(e[o]);e.length>0&&function(t){function i(i){try{i?(discountNinja.Logging.LogVerbose("Batch log events completed successfully"),function(t){try{var i=discountNinja_Script_PromotionEvent.GetQueue();null===i&&(i=[]);for(var n=0;n<i.length;n++)for(var e=i[n],o=0;o<t.length;o++){var r=t[o];e.triggerToken===r.triggerToken&&e.eventType===r.eventType&&(e.processed=!0)}discountNinja.Cache.LocalSet(discountNinja_Script_PromotionEvent.Queue,JSON.stringify(i))}catch(t){discountNinja.Logging.LogError("PromotionEvent.SaveQueue",t)}}(t)):discountNinja.Logging.LogErrorMessage("PromotionEvent.LogPromotionEvents.onLogComplete","Could not log events")}catch(t){discountNinja.Logging.LogError("PromotionEvent.LogPromotionEvent.onLogComplete",t)}}function n(t,i,n){try{for(var e=[],o=t.slice(i*n,(i+1)*n),r=0;r<o.length;r++){var a=o[r];e.push({token:a.triggerToken,eventType:a.eventType})}return e}catch(t){return discountNinja.Logging.LogError("PromotionEvent.LogPromotionEvents.BuildPayload",t),null}}try{for(var e=Math.ceil(t.length/10),o=function(){try{var t={},i=discountNinja.DeviceId.Get();return t.deviceId=i,t.shop=discountNinja.Core.Shop,t.f="7.4",t}catch(t){return discountNinja.Logging.LogError("PromotionEvent.LogPromotionEvents.BuildParameters",t),null}}(),r=0;r<e;r++)discountNinja.Logging.LogVerbose("Logging promotion events - batch "+(r+1)),discountNinja.XmlHttpRequest.Send(discountNinja_Script_PromotionEvent.ServerUrl()+"/api/AddPromotionEvents",o,n(t,r,10),"post",!0,!0,!0,i,null,1,1)}catch(t){discountNinja.Logging.LogError("PromotionEvent.LogPromotionEvents",t)}}(e),discountNinja_Script_PromotionEvent.SaveQueue(n)}catch(t){discountNinja.Logging.LogError("PromotionEvent.ProcessQueue",t)}}},discountNinja_Script_CartAdjustments={ToastId:"LimoniApps-DiscountNinja-RefreshPage-Toast",ToastMessageId:"LimoniApps-DiscountNinja-RefreshPage-Toast-Message",CartAdjustmentsKey:"CartAdjustments",CartAdjustmentIndex:0,StatusKey:"UpdateCart-Status",ContentKey:"UpdateCart-Content",Get:function(){try{return JSON.parse(discountNinja.Cache.SessionGet(discountNinja_Script_CartAdjustments.CartAdjustmentsKey))||[]}catch(t){return[]}},Save:function(t){return discountNinja.Cache.SessionSet(discountNinja_Script_CartAdjustments.CartAdjustmentsKey,JSON.stringify(t))},Remove:function(t){for(var i=discountNinja_Script_CartAdjustments.Get(),n=[],e=0;e<i.length;e++){var o=i[e];o.Id!==t.Id&&n.push(o)}discountNinja_Script_CartAdjustments.Save(n)},Add:function(t,i,n,e,o,r,a,c){function s(t,i,n){discountNinja.LiquidData.ItemHasPropertyWithValue(t,i,n)||(t.properties||(t.properties={}),t.properties[i]=n)}function u(t,i){t&&null!==i&&(discountNinja.Logging.LogInformation("---ADJUSTMENT---: CART - Set quantity to "+i+" for cart item "+t.key),t.quantity=i,r=t.key)}discountNinja_Script_CartAdjustments.CartAdjustmentIndex=discountNinja_Script_CartAdjustments.CartAdjustmentIndex+1,n=null===n?null:parseInt(n);var d=null;if("add"!==t&&(d=function(t,i,n){var e=discountNinja.LiquidData.CartItemByKey(n);if(e)return e;var o=discountNinja.LiquidData.CartItemByVariantAndProperty(t,i,"");if(o)return o;var r=discountNinja.LiquidData.CartItemByVariant(t);return r||null}(i,e,r)),"changequantity"===t)u(d,n);else if("add"===t){var l=JSON.parse(JSON.stringify(d?d.properties:a))||{};e&&(l[e]=o);var g=discountNinja_Script_CartAdjustments.FindMatchingLine(window.discountNinjaContext.Cart.items,i,l);d&&g&&g.key===d.key&&(g=null),null==g?function(t,i,n){if(null!==t&&null!==i){discountNinja.Logging.LogInformation("---ADJUSTMENT---: CART - Adding "+i+" of variant "+t),r=t+":"+discountNinja_Script_CartAdjustments.CartAdjustmentIndex;var e=discountNinja.ProductData.GetByProductHandle(c),o=e?e.Price:0;window.discountNinjaContext.Cart.items.push({id:parseInt(t),variant_id:parseInt(t),handle:c,quantity:i,properties:n,key:r,price:o,original_price:o})}}(i,n,l):u(g,g.quantity+n)}else"removeproperty"===t?function(t,i,n){t&&null!==i&&discountNinja.LiquidData.ItemHasPropertyWithValue(t,i,n)&&(discountNinja.Logging.LogInformation("---ADJUSTMENT---: CART - Remove property "+i+" from cart item "+t.key),delete t.properties[i],r=t.key)}(d,e,o):"setproperty"===t?function(t,i,n){t&&null!==i&&!discountNinja.LiquidData.ItemHasPropertyWithValue(t,i,n)&&(discountNinja.Logging.LogInformation("---ADJUSTMENT---: CART - Set property "+i+" for cart item "+t.key),s(t,i,n),r=t.key)}(d,e,o):"changequantity_setproperty"===t&&function(t,i,n,e){t&&null!==i&&null!==n&&(discountNinja.Logging.LogInformation("---ADJUSTMENT---: CART - Set quantity to "+i+" and set property "+n+" for cart item "+t.key),t.quantity=i,s(t,n,e),r=t.key)}(d,n,e,o);discountNinja.Cache.LocalSet("cached-cart",JSON.stringify(discountNinjaContext.Cart))},FindMatchingLine:function(t,i,n,e,o){if(!i)return null;if(t)for(var r=0;r<t.length;r++){var a=t[r];if((!o||a.key!==o)&&!(a.quantity<1||e&&a.quantity!==e||a.variant_id.toString()!==i.toString())){if(discountNinja.Utilities.ObjectIsEmpty(n)){if(!discountNinja.Utilities.ObjectIsEmpty(a.properties))continue}else if(JSON.stringify(n)!==JSON.stringify(a.properties))continue;if(!(void 0!==a.discounts&&null!==a.discounts&&"number"==typeof a.discounts.length&&a.discounts.length>0))return a;discountNinja.Logging.LogErrorMessage("CartAdjustments","Discount Ninja cannot be combined with Shopify's native BOGO automatic discounts")}}return null},RegroupRows:function(){for(var t,i,n,e,o=discountNinjaContext.Cart.items,r=!1,a=0;a<o.length;a++){if(!((u=o[a]).quantity<1)){var c=discountNinja_Script_CartAdjustments.FindMatchingLine(o,u.variant_id,u.properties,null,u.key);c&&(n=void 0,e=void 0,n=t=u,(e=i=c).key.length>n.key.length&&(n=i,e=t),n.quantity+=e.quantity,e.quantity=0,r=!0,a=0)}}var s=[];for(a=0;a<o.length;a++){var u;(u=o[a]).quantity>0?s.push(u):r=!0}return discountNinjaContext.Cart.items=s,r},RequiresUpdateCart:function(t){function i(t,i){if(t)for(var n=0;n<t.length;n++){var e=t[n];if(e.key===i.key)return e}return discountNinja_Script_CartAdjustments.FindMatchingLine(t,i.variant_id,i.properties,i.quantity)}function n(t){try{for(var i=[],n=0;n<t.length;n++){if(void 0!==(r=t[n]).discounts&&null!==r.discounts&&"number"==typeof r.discounts.length&&r.discounts.length>0){var e=discountNinja_Script_CartAdjustments.FindMatchingLine(t,r.variant_id,r.properties);if(null!==e){var o=r.quantity;r.quantity=0,e.quantity+=o}}}for(n=0;n<t.length;n++){var r;(r=t[n]).quantity>0&&(r.discounts=null,i.push(r))}return i}catch(i){return t}}try{if(discountNinjaContext.Cart.items){var e=n(discountNinjaContext.Cart.items);if(t){t=n(t);for(var o=0;o<t.length;o++){var r=t[o],a=i(e,r);if(null===a)return!0;if(a.quantity!==r.quantity)return!0;if((discountNinja.Utilities.ObjectIsEmpty(r.properties)?"":JSON.stringify(r.properties))!==(discountNinja.Utilities.ObjectIsEmpty(a.properties)?"":JSON.stringify(a.properties)))return!0}}for(o=0;o<e.length;o++){var c=e[o];if(!(c.quantity<1))if(null===i(t,c))return!0}}return!1}catch(t){return discountNinja.Logging.LogError("CartAdjustments.RequiresUpdateCart failed",t),!1}},FinishIncompleteUpdateCart:function(){var t=discountNinja.Utilities.jQuery().Deferred();try{var i=discountNinja_Script_CartAdjustments.StatusKey,n=discountNinja_Script_CartAdjustments.ContentKey,e=discountNinja.Cache.SessionGet(i);if("start"===e||"cleared"===e||"aborted"===e){var o=JSON.parse(discountNinja.Cache.SessionGet(n));o?(discountNinja.Logging.LogWarning("Finishing incomplete update of cart",!0),discountNinjaContext.Cart.items=o,discountNinja_Script_CartAdjustments.UpdateCart(!0).then((function(){discountNinja.Cache.SessionRemove(i),discountNinja.Cache.SessionRemove(n),t.resolve(!0)}))):t.resolve(!1)}else t.resolve(!1)}catch(i){discountNinja.Logging.LogError("CartAdjustments.FinishIncompleteUpdateCart failed",i),t.resolve(!1)}return t.promise()},UpdateCart:function(t){var i=discountNinja.Utilities.jQuery().Deferred();try{var n=discountNinja_Script_CartAdjustments.StatusKey,e=discountNinja_Script_CartAdjustments.ContentKey;if(discountNinja.Cache.SessionRemove(n),discountNinja.Cache.SessionRemove(e),t){var o=discountNinjaContext.Cart.items;discountNinja.Cache.SessionSet(n,"start"),discountNinja.Cache.SessionSet(e,JSON.stringify(o)),discountNinja.Core.Navigating?(discountNinja.Logging.LogWarning("Canceling update of cart due to navigation",!0),i.resolve()):discountNinja.Cart.Shopify.ClearCart().then((function(){discountNinja.Cache.SessionSet(n,"cleared"),o.length>0?discountNinja.Cart.Shopify.AddToCartMultipleLines(o).then((function(){discountNinja.Cache.SessionSet(n,"complete"),discountNinja.Cache.SessionRemove(e),i.resolve()})):(discountNinja.Cache.SessionSet(n,"complete"),discountNinja.Cache.SessionRemove(e),i.resolve())}))}else i.resolve()}catch(t){discountNinja.Logging.LogError("CartAdjustments.UpdateCart failed",t),i.resolve()}return i.promise()},RefreshAfterCartAdjustments:function(){var deferred=discountNinja.Utilities.jQuery().Deferred();function InjectRefreshPageToast(t){var i=discountNinja_Script_CartAdjustments.ToastId,n=document.getElementById(i);if(null===n){var e='<div id="'+i+'" class="limoniapps-discountninja-toast limoniapps-discountninja-toast-bottom"><span id="'+discountNinja_Script_CartAdjustments.ToastMessageId+'">'+t+"</span></div>",o=discountNinja.Utilities.CreateFragment(e);document.body.insertBefore(o,document.body.childNodes[0]),n=document.getElementById(i)}var r="limoniapps-discountninja-toast-show";-1===n.className.indexOf(r)&&(n.className=n.className+" "+r),setTimeout((function(){n.className=n.className.replace(r,"")}),3e3)}function ReloadPage(){try{var t=discountNinja.Settings.Settings.GWPSettings;t&&t.PageRefreshText&&InjectRefreshPageToast(t.PageRefreshText),location.reload()}catch(t){discountNinja.Logging.LogError("CartAdjustments.ReloadPage",t)}}function ExecuteDrawerCartRefreshMethod(){try{var modeSettings=discountNinja.Settings.Settings.PriceUpdate.Mode,refreshMethod=modeSettings.DrawerCartRefreshMethod;null!=refreshMethod&&""!==refreshMethod||(refreshMethod=discountNinja.Settings.GetFlag("DrawerCartRefreshMethod")),null!=refreshMethod&&""!==refreshMethod&&"custom"!==refreshMethod?(discountNinja.Cart.Shopify.IsDirty=!0,setTimeout((function(){discountNinja.Cart.Shopify.UpdateCart((function(){discountNinja.Trigger.EnsureInitialPromotionsTriggered((function(){discountNinja.DiscountedCart.BuildDiscountedCart((function(){try{discountNinja.Logging.LogVerbose("Executing DrawerCartRefreshMethod"),eval(refreshMethod),discountNinja_Script_DiscountedCart.SplitRowsInProcess=!1,discountNinja.Events.Publish("drawercartopened"),discountNinja.Events.Publish("drawercart:opened"),deferred.resolve()}catch(t){discountNinja.Logging.LogError("CartAdjustments.ExecuteDrawerCartRefreshMethod.Eval",t)}}))}))}))}),500)):(discountNinja_Script_DiscountedCart.SplitRowsInProcess=!1,discountNinja.Cart.Shopify.UpdateCart((function(){discountNinja.Trigger.EnsureInitialPromotionsTriggered((function(){discountNinja.DiscountedCart.BuildDiscountedCart((function(){try{if(discountNinjaContext.Cart){void 0!==discountNinjaContext.Cart.items&&null!==discountNinjaContext.Cart.items||(discountNinjaContext.Cart.items=[]);for(var t=0;t<discountNinjaContext.Cart.items.length;t++){var i=discountNinjaContext.Cart.items[t];void 0!==i.properties&&null!==i.properties||(i.properties={}),void 0!==i.line_level_discount_allocations&&null!==i.line_level_discount_allocations||(i.line_level_discount_allocations=[]),void 0!==i.discount_allocations&&null!==i.discount_allocations||(i.discount_allocations=[])}void 0!==discountNinjaContext.Cart.cart_level_discount_applications&&null!==discountNinjaContext.Cart.cart_level_discount_applications||(discountNinjaContext.Cart.cart_level_discount_applications=[]),void 0!==discountNinjaContext.Cart.discount_applications&&null!==discountNinjaContext.Cart.discount_applications||(discountNinjaContext.Cart.discount_applications=[])}discountNinja.Events.Publish("refreshdrawercart",[discountNinjaContext.Cart]),discountNinja.Events.Publish("drawercart:refreshed",[discountNinjaContext.Cart])}catch(t){discountNinja.Logging.LogError("CartAdjustments.ExecuteDrawerCartRefreshMethod.PublishEvent",t)}}))}))})),deferred.resolve())}catch(t){discountNinja.Logging.LogError("CartAdjustments.ExecuteDrawerCartRefreshMethod",t)}}var requiresReload=discountNinja_Script_CartAdjustments.ShouldReloadPageAfterCartAdjustments();if(requiresReload){var callback=discountNinja.Settings.GetFlag("CallbackAfterReloadPageAddingFreeGift")||discountNinja.Settings.GetFlag("CallbackAfterReloadPageForCartAdjustments");discountNinja.Cache.SessionSet("CallbackAfterReloadPageAddingFreeGift",callback)}return requiresReload?ReloadPage():ExecuteDrawerCartRefreshMethod(),deferred.promise()},ShouldReloadPageAfterCartAdjustments:function(){var t=discountNinja.Settings.Settings.PriceUpdate.Mode,i=discountNinja.Environment.Shopify.IsCartPage(),n=t.ReloadPageAfterCartAdjustmentsOnCart;n=null==n||""===n||"custom"===n?!0===discountNinja.Settings.GetFlag("ReloadPageAfterAddingFreeGiftOnCart")||!0===discountNinja.Settings.GetFlag("ReloadPageAfterCartAdjustmentsOnCart"):!0===n;var e=i&&n,o=t.ReloadPageAfterCartAdjustments;return o=null==o||""===o||"custom"===o?!0===discountNinja.Settings.GetFlag("ReloadPageAfterAddingFreeGift")||!0===discountNinja.Settings.GetFlag("ReloadPageAfterCartAdjustments"):!0===o,e||!i&&o}},discountNinja_Script_GiftWithPurchase={AdjustmentIntention:"CartAdjustmentIntention",ToastCacheKey:"ShowGWPToast",ToastId:"LimoniApps-DiscountNinja-GWP-Toast",ToastMessageId:"LimoniApps-DiscountNinja-GWP-Toast-Message",ToastDelay:5e3,ShowToast:function(){try{var t=discountNinja.Cache.SessionGet(discountNinja_Script_GiftWithPurchase.ToastCacheKey),i=t?JSON.parse(t):null;if(i){setTimeout((function(){discountNinja.Cache.SessionRemove(discountNinja_Script_GiftWithPurchase.ToastCacheKey)}),750);var n=discountNinja.Settings.Settings.GWPSettings;n&&n.FreeGiftAddedText&&function(t,i){var n=discountNinja_Script_GiftWithPurchase.ToastId,e=document.getElementById(n);if(null===e){discountNinja.ShortCode.ReplaceLocalePlaceHolders("<a class='limoniapps-targetlink' href='{{LOCALE_ISO_CODE}}/products/"+i.ProductHandle+"?variant="+i.Variant+"'>View gift</a>"),discountNinja.ShortCode.ReplaceLocalePlaceHolders("<a class='limoniapps-targetlink' href='{{LOCALE_ISO_CODE}}/cart'>View cart</a>");var o='<div id="'+n+'" class="limoniapps-discountninja-toast limoniapps-discountninja-toast-bottom"><span id="'+discountNinja_Script_GiftWithPurchase.ToastMessageId+'">'+t.FreeGiftAddedText+"</span></div>",r=discountNinja.Utilities.CreateFragment(o);document.body.insertBefore(r,document.body.childNodes[0]),e=document.getElementById(n)}var a="limoniapps-discountninja-toast-show";-1===e.className.indexOf(a)&&(e.className=e.className+" "+a),setTimeout((function(){e.className=e.className.replace(a,"")}),discountNinja_Script_GiftWithPurchase.ToastDelay)}(n,i)}}catch(t){discountNinja.Logging.LogError("GiftWithPurchase.ShowToast",t)}},AddAdjustments:function(){function t(t){if(null===t)return!1;var i=t.Token;discountNinja.Logging.LogInformation("GiftWithPurchase.AddAdjustments - Started - Evaluating offer with token "+i);var n=t?t.Bogo:null,e=!1;if(n){var o=t.Tiers[0],r=discountNinja.Prerequisite.EntitledQuantityInfo(t,o);if(null==r||!1===r.HasEntitledQuantity)return;var a=r.DeltaWithCart,c=r.Entitled,s="cartadjustment-"+i;if(0===a)discountNinja.Logging.LogInformation("AddAdjustments - Offer with token "+i+" - No delta / no adjustment required");else{var u=t.Entitlement.EntitledVariantIds;if("product"===t.Entitlement.EntitledItemType&&(null==u||""===u||isNaN(u)))return void discountNinja.Logging.LogErrorMessage("AddAdjustments - Missing or invalid variant id for gift with purchase (handle: '"+t.Entitlement.EntitledProductHandles+"' and token '"+i+"')");var d=null;if(!0!==discountNinja.Settings.GetFlag("AllowAddingManuallyRemovedGifts")){try{var l=discountNinja.Cache.SessionGet(s);d=null===l?null:parseInt(l)}catch(t){}isNaN(d)&&(d=null)}if(discountNinja.Logging.LogInformation("AddAdjustments - Offer with token "+i+" - Entitled to: "+c+" - Synched for: "+d),a<0||null===d||c!==d){discountNinja.Logging.LogInformation("AddAdjustments - Offer with token "+i+" - Adjustment required - Delta "+a);var g=discountNinja.DiscountedCart.FreeGiftPrefix+i;if(a<0){discountNinja.Logging.LogInformation("AddAdjustments - Offer with token "+i+" - Logging change adjustment");for(var p=c,f=0;f<discountNinjaContext.Cart.items.length;f++){var N=discountNinjaContext.Cart.items[f];if(discountNinja.LiquidData.ItemHasProperty(N,discountNinja.DiscountedCart.FreeGiftPrefix+i)){var j=N.quantity;if(n.RemoveFromCartAutomatically){var m=j>p?c:j;p-=m,m!==j&&(discountNinja.CartAdjustments.Add("changequantity_setproperty",null,m,g,"",N.key),e=!0)}else{var h=j-(_=j>p?c:j);if(_>0){if(_!==j&&(discountNinja.CartAdjustments.Add("changequantity_setproperty",null,_,g,"",item.Key),e=!0),h>0){var C=discountNinja.LiquidData.CopyPropertiesExceptSplitKeys(N.key);discountNinja.CartAdjustments.Add("add",N.variant_id,h,null,null,null,C,N.handle),e=!0}}else discountNinja.CartAdjustments.Add("removeproperty",null,null,g,"",N.key),e=!0;p-=_}}}}else if(a>0&&n.AddToCartAutomatically){discountNinja.Logging.LogInformation("AddAdjustments - Offer with token "+i+" - Logging add adjustment");var S={};S[g]="",discountNinja.CartAdjustments.Add("add",u,a,g,"",null,S,t.Entitlement.EntitledProductHandles),e=!0;var y={Variant:u,ProductHandle:t.Entitlement.EntitledProductHandles};discountNinja.Cache.SessionSet(discountNinja_Script_GiftWithPurchase.ToastCacheKey,JSON.stringify(y)),discountNinja_Script_GiftWithPurchase.ShowToast()}}else if(a<0){discountNinja.Logging.LogInformation("AddAdjustments - Offer with token "+i+" - No force removal - Adjustment required - Delta "+a);g=discountNinja.DiscountedCart.FreeGiftPrefix+i;discountNinja.Logging.LogInformation("AddAdjustments - Offer with token "+i+" - Logging change adjustment");for(p=c,f=0;f<discountNinjaContext.Cart.items.length;f++){var _;N=discountNinjaContext.Cart.items[f];if(p>0&&discountNinja.LiquidData.ItemHasProperty(N,discountNinja.DiscountedCart.FreeGiftPrefix+i))discountNinja.CartAdjustments.Add("removeproperty",null,null,g,"",N.key),p-=_=(j=N.quantity)>p?c:j}}}var v=discountNinja.Cache.SessionGet(discountNinja_Script_GiftWithPurchase.AdjustmentIntention),P=v?JSON.parse(v):[];P.push({Key:s,Quantity:c}),discountNinja.Cache.SessionSet(discountNinja_Script_GiftWithPurchase.AdjustmentIntention,JSON.stringify(P))}else discountNinja.Logging.LogInformation("AddAdjustments - Offer with token "+i+" is not a BOGO/Free gift");return e}var i=!1;if(discountNinja.Offer.Offers&&discountNinja.Offer.Offers.length>0)for(var n=0;n<discountNinja.Offer.Offers.length;n++)!0===t(discountNinja.Offer.Offers[n])&&(i=!0);return i}},discountNinja_Script_PromotionFlow={HandlingDrawerCartTimeoutHandle:null,HandlingDrawerCartTimeout:!1,ShowStickyBarAndNotification:function(){function t(t){try{var i="",n=t.StickyBar;return n||(i="Sticky bar disabled for offer "+t.Token),""!==i||"mobileonly"!==n.DisplayOnDevices||discountNinja.Utilities.IsMobilePhone()?""===i&&"desktoponly"===n.DisplayOnDevices&&discountNinja.Utilities.IsMobilePhone()&&(i="Sticky bar is not displayed on mobile phones"):i="Sticky bar is only displayed on mobile phones",""===i&&(i=discountNinja_Script_PromotionFlow.IsBuildingBlockEnabledForPage(n,i,"Sticky bar")),discountNinja_Script_PromotionFlow.HandleFlowErrorMessage(i,!1)}catch(t){return discountNinja.Logging.LogError("PromotionFlow.IsStickyBarRequired",t),!1}}function i(t){var i="",n=t.Notification;return n||(i="Notification disabled for offer "+t.Token),""!==i||"mobileonly"!==n.DisplayOnDevices||discountNinja.Utilities.IsMobilePhone()?""===i&&"desktoponly"===n.DisplayOnDevices&&discountNinja.Utilities.IsMobilePhone()&&(i="Notification is not displayed on mobile phones"):i="Notification is only displayed on mobile phones",""===i&&(i=discountNinja_Script_PromotionFlow.IsBuildingBlockEnabledForPage(n,i,"Notification")),discountNinja_Script_PromotionFlow.HandleFlowErrorMessage(i,!1)}try{var n=null,e=null;null!=n&&0!==n.length&&null!=e&&0!==e.length||function(){try{discountNinja.StickyBar.Clear(),discountNinja.Notification.Clear();var n=discountNinja.Offer.Offers;if(n)for(var e=0;e<n.length;e++){var o=n[e];if(!discountNinja.Offer.IsOfferAccepted(o.Token,o.Frequency)&&o.AutoAccept)discountNinja.Logging.LogVerbose("Not adding sticky bar / notification, offer with token "+o.Token+" is not accepted");else{var r=!0,a=o.Tiers[o.Tiers.length-1],c=a.Prerequisite,s=o.Tiers&&c&&c.MaximumAmount?100*c.MaximumAmount:null,u=o.Tiers&&c&&c.MaximumItems?100*c.MaximumItems:null;if(s&&discountNinja.Offer.PrerequisiteItemsCartValue(o)>s&&(discountNinja.Logging.LogVerbose("No sticky bar / notification message for offer with token "+o.Token+" because the cart value is over the maximum amount"),r=!1),u&&discountNinja.Prerequisite.PrerequisiteItemsInCart(o,a)>u&&(discountNinja.Logging.LogVerbose("No sticky bar / notification message for offer with token "+o.Token+" because the cart content is over the maximum number of items"),r=!1),r){var d=!(!o.StickyBar||!(o.StickyBar.ActionButton1&&"applydiscount"===o.StickyBar.ActionButton1.Action||o.StickyBar.ActionButton2&&"applydiscount"===o.StickyBar.ActionButton2.Action));(discountNinja.Offer.IsOfferAccepted(o.Token,o.Frequency)||d)&&t(o)?o.StickyBar&&(o.StickyBar.Body||o.StickyBar.TimerFooter)?(discountNinja.Logging.LogVerbose("Adding sticky bar message for offer with token "+o.Token),discountNinja.StickyBar.Add(o.Token,o.StickyBar.PlacementVertical)):discountNinja.Logging.LogVerbose("No sticky bar message for offer with token "+o.Token):discountNinja.Logging.LogVerbose("Sticky bar message for offer with token "+o.Token+" not added, not a building block"),discountNinja.Offer.IsOfferAccepted(o.Token,o.Frequency)&&i(o)?o.Notification&&o.Notification.Body?(discountNinja.Logging.LogVerbose("Adding notification message for offer with token "+o.Token),discountNinja.Notification.Add(o.Token)):discountNinja.Logging.LogVerbose("No notification message for offer with token "+o.Token):discountNinja.Logging.LogVerbose("Notification message for offer with token "+o.Token+" not added, not a building block")}}}}catch(t){discountNinja.Logging.LogError("PromotionFlow.BuildStickyBarAndNotificationArrays",t)}}(),discountNinja.StickyBar.Show(),discountNinja.Notification.Show(),n=discountNinja.Notification.GetFromCache(),e=discountNinja.StickyBar.GetFromCache();var o=!1;if(null!=e&&e.length>0)for(var r=0;r<e.length;r++){var a=e[r];if("top_page_sticky"===a.PlacementVertical||"top_page"===a.PlacementVertical){o=!0;break}}o||discountNinja.StickyBar.RemoveTopMarginFromElements()}catch(t){discountNinja.Logging.LogError("PromotionFlow.ShowStickyBarAndNotification",t)}},ShowAcceleratedCheckoutButtons:function(){discountNinja_Script_PromotionFlow.SetVisibilityOfElements(discountNinja.Environment.Shopify.SelectorsAcceleratedCheckoutButton(),"acceleratedcheckoutbuttons",!0)},HideAcceleratedCheckoutButtons:function(){discountNinja_Script_PromotionFlow.SetVisibilityOfElements(discountNinja.Environment.Shopify.SelectorsAcceleratedCheckoutButton(),"acceleratedcheckoutbuttons",!1)},SetVisibilityOfElements:function(t,i,n){try{!function(t,i,n){try{for(var e="",o=0;o<i.length;o++)e=e+" "+i[o]+" { "+n+" }";discountNinja.Utilities.AddInlineCssToDocument(e,t)}catch(t){discountNinja.Logging.LogError("ShowAcceleratedCheckoutButtonsInternal",t)}}("limoniapps-"+i+"-style",t,n?"visibility: unset !important;":"visibility: hidden !important;")}catch(t){discountNinja.Logging.LogError("PromotionFlow.SetVisibilityAcceleratedCheckoutButtons",t)}},ShowBuyNowButtons:function(){discountNinja_Script_PromotionFlow.SetVisibilityOfElements(discountNinja.Environment.Shopify.SelectorsBuyNowButtonWrapper(),"buynowbuttons",!0)},HideBuyNowButtons:function(){discountNinja_Script_PromotionFlow.SetVisibilityOfElements(discountNinja.Environment.Shopify.SelectorsBuyNowButtonWrapper(),"buynowbuttons",!1)},SwitchToCustomCheckoutButton:function(){try{var t=".limoniapps-discountninja-checkoutbutton";discountNinja.Utilities.jQuery()(t+"-hide").hide(),discountNinja.Utilities.jQuery()(t+"-show").show()}catch(t){discountNinja.Logging.LogError("PromotionFlow.SwitchToCustomCheckoutButton",t)}},HandleAcceleratedCheckoutButtons:function(){function t(){var t=discountNinja.DiscountedCart.HasActivePromotions(),i=discountNinja_Script_PromotionFlow,n=!0===discountNinja.Settings.GetFlag("HandleBuyNowButtons");t&&!1!==discountNinja.Settings.Settings.Checkout.HideAdditionalCheckoutButtons?(i.HideAcceleratedCheckoutButtons(),n||i.HideBuyNowButtons()):(i.ShowAcceleratedCheckoutButtons(),n||i.ShowBuyNowButtons())}t(),setTimeout((function(){t()}),500),setTimeout((function(){t()}),1e3),setTimeout((function(){t()}),2e3),setTimeout((function(){t()}),5e3)},DisplayAppliedOffers:function(){try{discountNinja.DiscountCode.InjectDiscountCodesInHtml(),discountNinja.DynamicPricing.UpdatePrice(!1,!0),discountNinja.DiscountedCart.HasActivePromotions()&&(t=!1,"object"==typeof mamutaTier&&(mamutaTier=null,t=!0),"object"==typeof Spurit&&(Spurit=null,t=!0),"object"==typeof SMARTOFFER&&(SMARTOFFER=null,t=!0),t&&discountNinja.Cache.SessionSet("RedirectToCheckoutOnFallBack","true"),!0===discountNinjaContext.Flags.CustomCheckoutButton&&discountNinja_Script_PromotionFlow.SwitchToCustomCheckoutButton()),discountNinja_Script_PromotionFlow.HandleAcceleratedCheckoutButtons(),discountNinja.ShortCode.ShowShortcodePlaceholders(),discountNinja_Script_PromotionFlow.ShowStickyBarAndNotification()}catch(t){discountNinja.Logging.LogError("PromotionFlow.DisplayAppliedOffers",t)}var t},StartFlow:function(){function t(t,i,n,e,o){try{if(!t)return!1;var r=t.nodeName?t.nodeName.toLowerCase():"",a="function"==typeof t.getAttribute?t.getAttribute(n):"";return a||(a=""),r===i&&(a===e||!o&&a.indexOf(e)>-1)&&(discountNinja.Logging.LogVerbose("Detected node of type "+i+" with attribute "+n+" set to "+e),!0)}catch(t){return discountNinja.Logging.LogError("PromotionFlow.IsNodeWithAttribute",t),!1}}function i(t,i,n){try{if(t)if(i){if(t.indexOf("<"+i)>-1)return!n||t.indexOf(n)>-1}else if(n)return t.indexOf(n)>-1;return!1}catch(t){return discountNinja.Logging.LogError("PromotionFlow.HtmlContainsNode",t),!1}}function n(){discountNinja.Events.Publish("drawercart:opened"),setTimeout((function(){discountNinja.Events.Publish("drawercart:opened")}),500)}try{if(!discountNinja.Settings.Settings)return void discountNinja.Logging.LogInformation("FLOW: Canceling since no settings are available");if(discountNinja.Logging.LogInformation("FLOW: Starting flow"),discountNinja.LogSession.PrintPerformance("Start flow"),"true"===discountNinja.Cache.SessionGet("AppIsDisabled"))return;!function(){var t=discountNinja.Offer.Offers;if(t)for(var i=0;i<t.length;i++){var n=t[i];if(discountNinja.Offer.OfferIsApplicable(n)){var e=discountNinja.Offer.PrerequisiteItemsCartValue(n);discountNinja.DiscountTier.GetCurrentDiscountTierNumber(n,e)!==discountNinja.DiscountTier.GetMaxDiscountTierNumber(n)&&discountNinja.Offer.UnApply(t[i].Token)}else discountNinja.Offer.Stop(t[i].Token)}}(),discountNinja.Offer.PrimaryOffer=null,discountNinja.Trigger.Clear(),discountNinja.DiscountCode.EnableDiscountCodeField(!1),discountNinja.Environment.Shopify.IsCartPage()?discountNinja.DiscountedCart.IsDirty=!0:discountNinja.VariantChange.RegisterEventHandlerForVariantChange(),discountNinja.Offer.ClearPromotionForProductCache(),discountNinja.DiscountCode.UndoInjectDiscountCodesInHtml(),discountNinja.Trigger.InitialPromotionsTriggered=!1,discountNinja.Offer.Offers=null,function(){try{new(discountNinja.Utilities.GetMutationObserver())((function(e){try{for(var o=0;o<e.length;o++)for(var r=0;r<e[o].addedNodes.length;r++){var a=e[o].addedNodes[r];if(null!=a&&null!==a.nodeName&&void 0!==a.nodeName&&-1===a.nodeName.indexOf("text")){var c=discountNinja.Utilities.jQuery()(a).html(),s=discountNinja.Utilities.jQuery()("body").css("margin-top");i(c,"form",null)&&(c.indexOf("/cart")>-1||c.indexOf("/cart")>-1||c.indexOf("/checkout")>-1)&&n(),(i(c,"button","submit")||i(c,"input","submit")||i(c,"a","/checkout")||t(a,"div","id","spurit-occ-popup",!0)||t(a,"button","type","submit",!0)||t(a,"input","type","submit",!0)||t(a,"a","href","/checkout",!1))&&n(),t(a,"div","id","shopify-payment-terms-cover",!0)?discountNinja.DynamicPricing.ReplaceInstalmentsPrices():t(a,"div","id","qab_bar",!0)?discountNinja.Utilities.jQuery()("#qab_bar").css("top",s):t(a,"div","id","fsb_background",!0)?discountNinja.Utilities.IsMobilePhone()||discountNinja.Utilities.jQuery()("#fsb_background").css("top",s):t(a,"div","id","spb-information-bar",!0)?discountNinja.Utilities.jQuery()("#spb-information-bar").css("top",s):t(a,"div","class","wheelio_holder",!1)?discountNinja.Utilities.jQuery()(".wheelio_holder .wlo_btn.wlo_copy_code").on("click",(function(t){discountNinja.Logging.LogVerbose("Offer triggered via wheelio apply button");var i=discountNinja.Utilities.jQuery()(".wheelio_holder .wlo_input_code").val();discountNinja_Script_PromotionFlow.TriggerPromotion(i)})):i(c,null,"limoniapps-discountninja-cart-root")?(discountNinja.Logging.LogVerbose("Cart added, updating prices"),n()):i(c,null,"limoniapps-discountninja-drawercart-root")?(discountNinja.Logging.LogVerbose("Drawer cart added, updating prices"),n()):t(a,"button","name","icartCheckout",!0)&&(discountNinja.Logging.LogVerbose("Drawer cart added/updated by iCart, registering to checkout button"),n())}}}catch(t){discountNinja.Logging.LogError("PromotionFlow.ListenForDynamicallyAddedElements.mutationObserver",t)}})).observe(document.body,{attributes:!1,childList:!0,subtree:!0,characterData:!1})}catch(t){discountNinja.Logging.LogError("PromotionFlow.ListenForDynamicallyAddedElements",t)}}(),function(){try{var t=discountNinja.Utilities.jQuery()(".limoniapps-discountninja-drawercart-anchor");t.length>0&&(targetNode=t.get()[0],new MutationObserver((function(){var t=discountNinja.Utilities.jQuery()(targetNode).is(":visible");null!==discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle&&clearTimeout(discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle),discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle=setTimeout((function(){!function(t){try{discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle=null,discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeout||(discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeout=!0,discountNinja.Logging.LogVerbose("Drawer cart modified"),t?(discountNinja.Logging.LogVerbose("Drawer cart visible: minimizing notification"),discountNinja.Notification.Minimize(),discountNinja.DiscountCode.InjectDiscountCodesInHtml()):discountNinja.Logging.LogVerbose("Drawer cart hidden"),discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeout=!1)}catch(t){discountNinja.Logging.LogError("PromotionFlow.HandleDrawerCartChange",t),discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle=null,discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeout=!1}}(t)}),500)})).observe(targetNode,{attributes:!0}))}catch(t){discountNinja.Logging.LogError("PromotionFlow.ListenForDrawerCartChanges",t)}}(),function t(){try{discountNinja.Utilities.jQuery()(".gf-loadmore-btn,#gsloadmore").each((function(){var i=function(){discountNinja.Events.Publish("collection:productsadded"),t()},n=function(t){setTimeout((function(){i()}),250);for(var n=0;n<20;n++)setTimeout((function(){i()}),750*(n+1))};!0!==this.discountNinjaEventBound&&(this.discountNinjaEventBound=!0,this.addEventListener("click",n),this.addEventListener("touch",n))}))}catch(t){discountNinja.Logging.LogError("PromotionFlow.ListenForLoadMoreButtons",t)}}(),discountNinja.Trigger.MarkPageAsVisited(),discountNinja.Trigger.WaitForTriggerConditions(discountNinja.Offer.Triggers),discountNinja.GiftWithPurchase.ShowToast()}catch(t){discountNinja.Logging.LogError("PromotionFlow.StartFlow",t)}},ViewPromotion:function(t){discountNinja.Logging.LogInformation("FLOW: Viewing promotion"),discountNinja.Timer.ShouldStartOnDisplay(t)&&discountNinja.Timer.Start(t),t.TriggeredByTrigger&&discountNinja.PromotionEvent.AddToQueue(t.TriggeredByTrigger.Token,0)},AcceptPromotion:function(t){try{discountNinja.Logging.LogInformation("FLOW: Accepting offer"),discountNinja.Offer.SetPromotionAccepted(t.Token,t.Frequency,"true"),discountNinja.Offer.SaveToCache(t),discountNinja.Offer.ClearPromotionForProductCache(),discountNinja_Script_PromotionFlow.ApplyPromotionIfApplicable(t)}catch(t){discountNinja.Logging.LogError("PromotionFlow.AcceptPromotion",t)}},UnAcceptPromotion:function(t){discountNinja.Offer.SetPromotionAccepted(t.Token,t.Frequency,"false")},ApplyPromotionIfApplicable:function(t){var i=discountNinja.Offer.PrerequisiteItemsCartValue(t),n=discountNinja.DiscountTier.GetCurrentDiscountTierNumber(t,i);if(null!==n&&n>0){var e=discountNinja.Offer.GetPromotionDiscountCode(t),o=discountNinja.Offer.GetPromotionPriceRuleId(t);discountNinja_Script_PromotionFlow.ApplyPromotion(t,e,o)}},ApplyPropertiesToLineItems:function(){if(!discountNinja.Cart.Shopify.IsDirty&&!discountNinja.DiscountedCart.IsDirty)for(var t=discountNinja.LiquidData.ItemsInCartWithoutProperty("DiscountNinja."),i=0;i<t.length;i++){var n=discountNinja.DiscountedCart.Get(t[i].key),e=null===n?null:n.Token;discountNinja.Cart.Shopify.AddPropertiesToCartItem(t[i].key,"DiscountNinja."+(null!==n?"":"Not")+"Discounted"+(e?"."+e:""),"")}},ApplyPromotion:function(t,i,n){try{if(null===t)return;if(discountNinja.Logging.LogInformation("FLOW: Applying offer"),discountNinja.DiscountCode.Add(t.Token,i,n,t.Entitlement.TargetType),discountNinja.Timer.ShouldStartOnAccept(t))discountNinja.Timer.Start(t);else if(discountNinja.Timer.ShouldStartOnGoalAchieved(t)){discountNinja.DiscountTier.GoalAchieved(t)&&discountNinja.Timer.Start(t)}t.TriggeredByTrigger&&discountNinja.PromotionEvent.AddToQueue(t.TriggeredByTrigger.Token,1)}catch(t){discountNinja.Logging.LogError("PromotionFlow.ApplyPromotion",t)}},ShowHideElementsWhenPromotionsInCart:function(){function t(t,i){try{var n=i?t+"show":t+"hide",e=i?t+"hide":t+"show";discountNinja.Utilities.jQuery()(n).show(),discountNinja.Utilities.jQuery()(e).hide()}catch(t){discountNinja.Logging.LogError("PromotionFlow.HideOrShow",t)}}try{var i=".limoniapps-discountninja-when";t(i+"activepromotions-",discountNinja.DiscountedCart.HasActivePromotions());var n=discountNinja.DiscountedCart.HasAppliedPromotions();t(i+"promotionsincart-",n),t(i+"cartdiscounted-",discountNinja.DiscountedCart.DiscountedCart&&discountNinja.DiscountedCart.DiscountedCart.total_discount>0);var e=n&&discountNinja_Script_PromotionSummary.PromotionSummaryEnabledOn(!discountNinja.Environment.Shopify.IsCartPage());t(i+"promotionsummaryavailable-",e),t(i+"promotionsummaryunavailable-",!e)}catch(t){discountNinja.Logging.LogError("PromotionFlow.ShowHideElementsWhenPromotionsInCart",t)}},StopFlow:function(){function t(t){return t+=1,discountNinja.DiscountedCart.IsDirty=!0,n(t,discountNinja.DiscountedCart.DiscountedCart.total_discount)}function i(t,i,n,e){i.indexOf(t)>-1?(discountNinja.CartAdjustments.Add("changequantity_setproperty",null,0,i,"",n),discountNinja.Cache.SessionSet("cartadjustment-"+e,-1)):discountNinja.CartAdjustments.Add("removeproperty",null,null,i,"",n)}function n(n,o){discountNinja.Logging.LogInformation("FLOW: Stopping/building final cart (iteration "+n+")",!0,!1),discountNinja.CartAdjustments.FinishIncompleteUpdateCart().then((function(r){discountNinja.Cart.Shopify.UpdateCart((function(){discountNinja.LogSession.PrintPerformance("Cart updated"),discountNinja.Cart.Shopify.LockRefreshCart=!0,null===e&&(e=JSON.parse(JSON.stringify(window.discountNinjaContext.Cart.items))),discountNinja.Trigger.EnsureInitialPromotionsTriggered((function(){discountNinja.Offer.Offers=discountNinja.Offer.ConvertRates(discountNinja.Offer.Offers),discountNinja.DiscountedCart.BuildDiscountedCart((function(){try{if(discountNinja.LogSession.PrintPerformance("Discounted cart built"),discountNinja.GiftWithPurchase.AddAdjustments())return t(n);!1!==discountNinja.Settings.Settings.PriceUpdate.AllowSplitRows&&discountNinja.DiscountedCart.SplitRows(),discountNinja.LogSession.PrintPerformance("GWP processed");var a=function(){try{if(!discountNinjaContext.Cart.items)return!1;for(var t=!1,n=discountNinja_Script_DiscountedCart.SplitRowPrefix,e=discountNinja_Script_DiscountedCart.FreeGiftPrefix,o=0;o<discountNinjaContext.Cart.items.length;o++){var r=discountNinjaContext.Cart.items[o];if(!discountNinja.Utilities.ObjectIsEmpty(r.properties)){for(var a in r.properties)if(a.indexOf(n)>-1||a.indexOf(e)>-1){for(var c=a.replace(n,"").replace(e,""),s=!1,u=0;u<discountNinja.DiscountedCart.DiscountedCart.items.length;u++){var d=discountNinja.DiscountedCart.DiscountedCart.items[u];if(d.Key===r.key){d.OfferToken!==c?(i(e,a,r.key,c),t=!0):s=!0;break}}!s&&r.key.length>20&&(i(e,a,r.key,c),t=!0)}for(var l in r.properties)if(l.indexOf(e)>-1)for(var g in r.properties)g.indexOf(n)>-1&&discountNinja.CartAdjustments.Add("removeproperty",null,null,g,"",r.key)}}return t}catch(t){return discountNinja.Logging.LogError("PromotionFlow.RemoveUnusedProperties",t),null}}(),c=function(){try{if(!discountNinjaContext.Cart.items)return!1;for(var t=!1,i=0;i<discountNinja.DiscountedCart.DiscountedCart.items.length;i++){var n=discountNinja.DiscountedCart.DiscountedCart.items[i],e=discountNinja.Offer.GetOfferByToken(n.OfferToken);if(e&&void 0!==e.Bogo){var o=discountNinja_Script_DiscountedCart.FreeGiftPrefix+e.Token;n.Properties||(n.Properties=[]);for(var r=!1,a=0;a<n.Properties.length;a++)if(n.Properties[a].Name===o){r=!0;break}r||(n.Properties.push({Name:o,Value:""}),t=!0);var c=discountNinja.LiquidData.CartItemByKey(n.Key);c&&!c.properties&&(c.properties={}),c&&void 0===c.properties[o]&&(discountNinja.CartAdjustments.Add("setproperty",null,null,o,"",c.key),t=!0)}}return t}catch(t){return discountNinja.Logging.LogError("PromotionFlow.AddMissingProperties",t),null}}();if(discountNinja.LogSession.PrintPerformance("Line item properties adjusted"),discountNinja.CartAdjustments.RegroupRows(),discountNinja.LogSession.PrintPerformance("Rows regrouped"),(a||c)&&function(t,i){return!(t>=3||null!==i&&discountNinja.DiscountedCart.DiscountedCart.total_discount<=i)}(n,o))return t(n);var s=r||discountNinja.CartAdjustments.RequiresUpdateCart(e);discountNinja.LogSession.PrintPerformance("Cart adjustments checked"),discountNinja.CartAdjustments.UpdateCart(s).then((function(){try{if(function(){try{var t=discountNinja.Cache.SessionGet(discountNinja_Script_GiftWithPurchase.AdjustmentIntention);if(t)for(var i=JSON.parse(t),n=0;n<length;n++)discountNinja.Cache.SessionSet(i[n].Key,i[n].Quantity);discountNinja.Cache.SessionRemove(discountNinja_Script_GiftWithPurchase.AdjustmentIntention)}catch(t){discountNinja.Logging.LogError("PromotionFlow.SaveAdjustedQuantities",t)}}(),discountNinja.LogSession.PrintPerformance("Cart adjustments complete"),discountNinja.Events.Publish("cart:updated",[discountNinja.DiscountedCart.DiscountedCart]),discountNinja.PromotionFlow.DisplayAppliedOffers(),discountNinja_Script_PromotionFlow.ShowHideElementsWhenPromotionsInCart(),discountNinja.DiscountedCart.GetAppliedPromotions(),discountNinja.DiscountCode.InjectDiscountCodesInHtml(),discountNinja.DiscountedCart.HasAppliedPromotions()){var t=discountNinja.LogSession.GetId();t&&discountNinja.Cache.LocalSet("SessionLogId",t)}else discountNinja.Cache.LocalRemove("SessionLogId");discountNinja.Cart.Shopify.LockRefreshCart=!1,s&&discountNinja.CartAdjustments.RefreshAfterCartAdjustments(),discountNinja.Checkout.Shopify.ProcessingPrepareAdvancedCheckout||discountNinja.Checkout.Shopify.PrepareAdvancedCheckout(),discountNinja.LogSession.PrintPerformance("Flow complete"),discountNinja.LogSession.RegisterTimeToComplete(),discountNinja.DiscountCode.UpdateTags(),discountNinja.AccountLogin.CheckRedirect(),discountNinja.LogSession.LogPerformance(),setTimeout((function(){discountNinja.Events.Publish("collection:productsadded")}),1500),discountNinja.DiscountedProduct.CurrentVariantData&&discountNinja.Events.Publish("variant:priceavailable",{Variant:discountNinja.DiscountedProduct.CurrentVariantData}),discountNinja.Logging.LogInformation("FLOW: Complete",!0,!1)}catch(t){discountNinja.Logging.LogError("PromotionFlow.StopFlow.AfterProcessCartAdjustments",t)}}))}catch(t){discountNinja.Logging.LogError("PromotionFlow.StopFlow.AfterBuildDiscountedCart",t)}}))}))}))}))}var e=null;discountNinja.PromotionFlow.DisplayAppliedOffers(),discountNinja_Script_PromotionFlow.ShowHideElementsWhenPromotionsInCart(),n(1,null)},IsBuildingBlockEnabledForPage:function(t,i,n){if(""!==i||t||(i=n+" is disabled"),""===i&&discountNinja.Environment.Shopify.IsProductPage()&&"*"!==t.ShowOn.Products){var e=discountNinja.Environment.Shopify.ProductHandle();discountNinja.Utilities.StringIsIn(t.ShowOn.Products,e)||(i=n+" is not displayed because it is disabled for product pages or not enabled for product "+e+" (limited to: "+t.ShowOn.Products+")")}if(""===i&&discountNinja.Environment.Shopify.IsHomePage()&&!t.ShowOn.HomePage&&(i=n+" is not displayed because it is disabled for the home page"),""===i&&discountNinja.Environment.Shopify.IsBlogPost()&&!t.ShowOn.BlogPosts&&(i=n+" is not displayed because it is disabled for blog posts"),""===i&&discountNinja.Environment.Shopify.IsCollectionPage()&&"*"!==t.ShowOn.Collections){var o=discountNinja.Environment.Shopify.CollectionHandle();discountNinja.Utilities.StringIsIn(t.ShowOn.Collections,o)||(i=n+" is not displayed because it is disabled for collection pages or not enabled for collection "+o+" (limited to: "+t.ShowOn.Collections+")")}return""===i&&discountNinja.Environment.Shopify.IsCustomPage()&&!t.ShowOn.CustomPages&&(i=n+" is not displayed because it is disabled for custom pages"),""===i&&discountNinja.Environment.Shopify.IsCartPage()&&!t.ShowOn.CartPage&&(i=n+" is not displayed because it is disabled for cart page"),""===i&&discountNinja.Environment.Shopify.IsSearchPage()&&!t.ShowOn.SearchPage&&(i=n+" is not displayed because it is disabled for the search page"),i},HandleFlowErrorMessage:function(t){return!t||""===t||(discountNinja.Logging.LogVerbose(t),!1)},HasPopUpBeenShownForLevel:function(t){var i=t.Token;return"shown"===function(t){return discountNinja.Cache.LocalGet("popup-displayed-"+t)}(i)&&"onceperdevice"===t.PopUp.Frequency?(discountNinja.Logging.LogInformation("FLOW: Pop-up will not be displayed for offer with token "+i+", because it has already been shown on this device. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/when-to-display-the-pop-up' target='_blank'>here</a>."),!0):"shown"===function(t){return discountNinja.Cache.SessionGet("popup-displayed-"+t)}(i)&&"oncepersession"===t.PopUp.Frequency&&(discountNinja.Logging.LogInformation("FLOW: Pop-up will not be displayed for offer with token "+i+", because it has already been shown during this session. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/when-to-display-the-pop-up' target='_blank'>here</a>."),!0)}},discountNinja_Script_Settings={Settings:null,GetPriceFormat:function(t,i,n){var e=function(t,i,n){var e=discountNinja_Script_Settings.Settings.PriceUpdate.PriceFormat;return"item-product"===t?i?e.DrawerCartProduct||e.Product:e.CartProduct||e.Product:"item-line"===t?i?e.DrawerCartLine||e.Product:e.CartLine||e.Product:"subtotal"===t?i?e.DrawerCartSubtotal||e.Product:e.CartSubtotal||e.Product:"standard"===t?(null==n&&(n=discountNinja.Environment.Shopify.IsProductPage()),!0===n?e.Product:e.Other||e.Product):(discountNinja.Logging.LogWarning("GetPriceFormat - Unexpected level '"+t+"'",!0),e.Product)}(t,i,n);return e&&void 0!==e.Format||(e={Format:"{{DISCOUNTED_PRICE}} {{ORIGINAL_PRICE,STRIKETHROUGH}}"}),function(t){try{return null!==t&&(t.Format&&(t.Format=t.Format.replace(/\\{/g,"{").replace(/\\}/g,"}")),t.PrefixText&&(t.PrefixText=t.PrefixText.replace(/\\{/g,"{").replace(/\\}/g,"}")),t.SuffixText&&(t.SuffixText=t.SuffixText.replace(/\\{/g,"{").replace(/\\}/g,"}"))),t}catch(i){return t}}(e)},SettingsAreValid:function(t){try{return null==t?(discountNinja.Logging.LogWarning("No settings available",!0),!1):(discountNinja.Logging.LogVerbose("Settings valid"),!0)}catch(t){discountNinja.Logging.LogError("Settings.SettingsAreValid",t)}},GetFlag:function(t){try{return"object"!=typeof window.discountNinjaContext.Flags?null:window.discountNinjaContext.Flags[t]}catch(t){return discountNinja.Logging.LogError("Settings.GetFlag",t),null}}},discountNinja_Script_ShortCode_Prefix_ClassName="limoniapps-discountninja-shortcode",discountNinja_Script_ShortCode_Prefix_Attribute="data-limoniapps-discountninja-shortcode",discountNinja_Script_ShortCode_Product_Attribute="data-limoniapps-discountninja-product",discountNinja_Script_ShortCode={Attributes:{Offer:discountNinja_Script_ShortCode_Prefix_Attribute+"-offer",OfferToken:discountNinja_Script_ShortCode_Prefix_Attribute+"-offer-token",Product:discountNinja_Script_ShortCode_Prefix_Attribute+"-product"},Classes:{Placeholder:discountNinja_Script_ShortCode_Prefix_ClassName+"-placeholder"},HideShortcodePlaceholders:function(){try{discountNinja.Utilities.jQuery()("."+discountNinja_Script_ShortCode.Classes.Placeholder).css("display","none")}catch(t){discountNinja.Logging.LogError("ShortCode.HideShortcodePlaceholders",t)}},ShowShortcodePlaceholders:function(){try{var t="."+discountNinja_Script_ShortCode.Classes.Placeholder;discountNinja.Utilities.jQuery()(t).each((function(){discountNinja.Utilities.jQuery()(this).html(discountNinja_Script_ShortCode.ReplaceAllPlaceHolders(discountNinja.Utilities.jQuery()(this).html()))})),discountNinja.Utilities.jQuery()(t).css("display","block")}catch(t){discountNinja.Logging.LogError("ShortCode.ShowShortcodePlaceholders",t)}},RefreshResolvedPlaceholders:function(t,i,n){try{discountNinja.Logging.LogVerbose("Refreshing all resolved placeholders");var e=discountNinja_Script_ShortCode.Attributes.Offer,o=discountNinja_Script_ShortCode.Attributes.OfferToken;discountNinja.Utilities.jQuery()(t).find("["+e+"]").each((function(){var t="{{"+discountNinja.Utilities.jQuery()(this).attr(e)+"}}",r=i?i.Token:discountNinja.Utilities.jQuery()(this).attr(o);if(i||(i=discountNinja.Offer.GetOfferByToken(r)),!n){var a=discountNinja.DiscountTier.GetCurrentDiscountTier(i);n=discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(a)}discountNinja.Logging.LogVerbose("Refreshing shortcode "+t+" context: offer "+r);var c=discountNinja_Script_ShortCode.ReplacePromotionLevelPlaceHolders(i,t,!1);c=discountNinja_Script_ShortCode.ReplaceSettingsLevelPlaceHolders(i,c,!0),discountNinja.Utilities.jQuery()(this).html(c)}));var r=discountNinja_Script_ShortCode.Attributes.Product;discountNinja.Utilities.jQuery()(t).find("["+r+"]").each((function(){var t="{{"+discountNinja.Utilities.jQuery()(this).attr(r)+"}}";if(discountNinja.Utilities.jQuery()(this).attr(discountNinja_Script_ShortCode_Product_Attribute)===n.ProductHandle){discountNinja.Logging.LogVerbose("Refreshing shortcode "+t);var e=discountNinja_Script_ShortCode.ReplaceProductLevelPlaceHolders(t,n,!1);e=discountNinja_Script_ShortCode.ReplaceSettingsLevelPlaceHolders(i,e,!0),discountNinja.Utilities.jQuery()(this).html(e)}})),discountNinja.MultiCurrency.UpdateCurrency()}catch(t){discountNinja.Logging.LogError("ShortCode.RefreshResolvedPlaceholders",t)}},BuildResolvedPlaceHolderLink:function(t,i,n,e,o,r,a,c,s,u,d,l){try{if(discountNinja_Script_ShortCode.ContainsPlaceHolder(n,"{{"+o+"}}"))return discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,e,"{{"+o+"}}",r,a,c,u,d,l);c="<a class='limoniapps-targetlink' href='"+c+"'>"+n.match(/\{\{([^\0}])*\}\}/)[0].replace(/{/g,"").replace(/}/g,"").match(/\,([^\}])*/)[0].substring(1)+"</a>";return discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,e,"{{"+o+"}}",r,a,c,u,d,l)}catch(t){return discountNinja.Logging.LogError("ShortCode.BuildResolvedPlaceHolderLink",t),n}},BuildResolvedPlaceHolderAmount:function(t,i,n,e,o,r,a,c,s,u,d,l,g,p,f,N,j){function m(t,i,n,e,o,r,a,c,s,u,d,l,g,p,N,j,m,h){var C=function(t,i){return i?"{{"+t.replace("{{","").replace("}}","")+","+i+"}}":t}(o,r);return discountNinja_Script_ShortCode.ContainsPlaceHolder(n,C)&&(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,e,C,c,s,discountNinja.Utilities.FormatMoney(u,d,N,j,a,h),f,m,!0,a,u),a||(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,e,"<del>"+C+"</del>",c,s,discountNinja.Utilities.FormatMoney(u,l,N,j,!0,h),f,m,!0,a,u)),a||(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,e,"<strike>"+C+"</strike>",c,s,discountNinja.Utilities.FormatMoney(u,l,N,j,!0,h),f,m,!0,a,u)),a||(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,e,"<s>"+C+"</s>",c,s,discountNinja.Utilities.FormatMoney(u,l,N,j,!0,h),f,m,!0,a,u))),n}try{return void 0===c||(c=Math.round(c),discountNinja_Script_ShortCode.ContainsPlaceHolder(n,o)&&(n=m(t,i,n,e,o,"",!1,r,a,c,s,u,0,0,g,p,N,j),n=m(t,i,n,e,o,"NO_DECIMALS",!1,r,a,c,s,u,0,0,g,p,N,j),n=m(t,i,n,e,o,"NO_CURRENCY",!1,r,a,c,s,u,0,0,g,p,N,j),n=m(t,i,n,e,o,"NO_DECIMALS,NO_CURRENCY",!1,r,a,c,s,u,0,0,g,p,N,j),n=m(t,i,n,e,o,"STRIKETHROUGH",!0,r,a,c,s,u,0,0,g,p,N,j),n=m(t,i,n,e,o,"STRIKETHROUGH,NO_DECIMALS",!0,r,a,c,s,u,0,0,g,p,N,j),n=m(t,i,n,e,o,"STRIKETHROUGH,NO_CURRENCY",!0,r,a,c,s,u,0,0,g,p,N,j),n=m(t,i,n,e,o,"STRIKETHROUGH,NO_DECIMALS,NO_CURRENCY",!0,r,a,c,s,u,0,0,g,p,N,j),n=m(t,i,n,e,o,"DIAGONALSTRIKETHROUGH","diagonal",r,a,c,s,u,0,0,g,p,N,j),n=m(t,i,n,e,o,"DIAGONALSTRIKETHROUGH,NO_DECIMALS","diagonal",r,a,c,s,u,0,0,g,p,N,j),n=m(t,i,n,e,o,"DIAGONALSTRIKETHROUGH,NO_CURRENCY","diagonal",r,a,c,s,u,0,0,g,p,N,j),n=m(t,i,n,e,o,"DIAGONALSTRIKETHROUGH,NO_DECIMALS,NO_CURRENCY","diagonal",r,a,c,s,u,0,0,g,p,N,j))),n}catch(t){return discountNinja.Logging.LogError("ShortCode.BuildResolvedPlaceHolderAmount",t),n}},AddMicroDataTags:function(t){return"discounted_price"===t?!0===discountNinja.Settings.GetFlag("AddMicroDataTagsToDiscountedPrice"):"original_price"===t&&!0===discountNinja.Settings.GetFlag("AddMicroDataTagsToOriginalPrice")},BuildResolvedPlaceHolder:function(t,i,n,e,o,r,a,c,s,u,d,l,g){if(void 0===c)return n;var p;c=discountNinja_Script_ShortCode.ReplaceCurrencyPlaceHolders(c);var f=d&&discountNinja_Script_ShortCode.AddMicroDataTags(a)?'<span itemprop="price" content="'+g/100+'"/><meta itemprop="priceCurrency" content="'+discountNinjaContext.ShopCurrency+'"/>':"",N=d&&c!==window.discountNinjaContext.Labels.Free?'<span class="money geolizr-currency" data-limoniapps-discountninja-price-cents-basecurrency="'+g+'" data-geolizr-price="'+g+'">'+c+f+"</span>":c+f,j=null==a?"":'class="limoniapps-discountninja-shortcode limoniapps-discountninja-shortcode-'+a+(!0===l?" limoniapps-discountninja-strikethrough":"diagonal"===l?" limoniapps-discountninja-strikethrough-diagonal":"")+(null==u?"":" "+u)+'" ',m=discountNinja_Script_ShortCode.Attributes.OfferToken,h=t?" "+m+'="'+t.Token+'" ':"",C="product"===r?" "+discountNinja_Script_ShortCode_Product_Attribute+'="'+i.ProductHandle+'" ':"";return p=e?"<span "+j+discountNinja_Script_ShortCode_Prefix_Attribute+"-"+r+'="'+o.replace("{{","").replace("}}","")+'"'+h+C+">"+N+"</span>":N,n.toString().replace(new RegExp(o,"g"),discountNinja.Currency.EscapeDollarSignForRegEx(p))},ReplacePromotionLevelPlaceHolders:function(t,i,n){function e(t,i){try{var n=1;return"buyx_gety"===t.OfferType&&"fixed_amount"===t.Entitlement.ValueType&&"across"===t.Entitlement.AllocationMethod&&i&&(n=discountNinja.Prerequisite.PrerequisiteItemsInCart(t,i)),n}catch(t){return discountNinja.Logging.LogError("DiscountedCart.GetPrerequisiteUnits",t),1}}try{if("string"!=typeof i||""===i||null===i)return i;discountNinja.Logging.LogVerbose("Replacing offer level placeholders");var o=discountNinja.Settings.Settings.CountdownClock,r=window.discountNinjaContext.Labels.Here,a=discountNinja.Currency.GetCurrencyFormat(),c=discountNinja.Utilities.GetNoDecimalsCurrencyFormat(a),s=discountNinja.Utilities.GetCurrencyFormatAmountComponent(a),u=discountNinja.Utilities.GetCurrencyFormatAmountComponent(c),d=discountNinja.DateTime,l=o.FormattingTemplateOnDate,g=o.FormattingTemplateOnTime,p="",f="",N=t.TriggeredByTrigger?t.TriggeredByTrigger.StartsAt:null;if(N){var j=d.GetUtc(N);p=d.FormatDate(j,l),f=d.FormatDate(j,g)}var m="",h="",C=t.TriggeredByTrigger?t.TriggeredByTrigger.Schedule.EndsOnDate:null;if(C){var S=d.GetUtc(C);m=d.FormatDate(S,l),h=d.FormatDate(S,g)}var y="",_="",v=t.TriggeredByTrigger&&t.TriggeredByTrigger.CountdownClock?t.TriggeredByTrigger.CountdownClock.EndsAt:C;if(v){var P=d.GetUtc(v);y=d.FormatDate(P,l),_=d.FormatDate(P,g)}var L=discountNinja.DiscountedCart.DiscountedCart,T=0;L&&L.total_discount&&(T=100*L.total_discount);var D=0,E=0;L&&(E=100*L.total_original_price),T>0&&E>0&&(D=100*Math.min(T/E,100));var I=discountNinja.DiscountedCart.GetDiscountedAmountForOffer(t.Token),k=0;I>0&&E>0&&(k=100*Math.min(I/E,100));var b=discountNinja.DiscountTier.GetCurrentDiscountTier(t);null===b&&(b=t.Tiers[0]);var O=discountNinja.DiscountTier.GetGoalDiscountTier(t);null===O&&(O=t.Tiers[0]);var A=0,w=0,U=0,R=discountNinja.DiscountTier.GetGoalDiscountTierNumber(t),F=O.Entitlement.Mode&&"multiple"===O.Entitlement.Mode?R:1;if(O&&O.Prerequisite&&O.Prerequisite.MaximumAmount>0&&(U=O.Prerequisite.MaximumAmount),O&&O.Prerequisite&&O.Prerequisite.MinimumAmount>0)(A=(100*(w=O.Prerequisite.MinimumAmount*F)-discountNinja.Offer.PrerequisiteItemsCartValue(t))/100)<0&&(A=0);var x=0,G=0,B=0;if(O&&O.Prerequisite&&O.Prerequisite.MaximumItems&&(B=O.Prerequisite.MaximumItems),O&&O.Prerequisite&&O.Prerequisite.BogoPrerequisiteQuantity)(x=(G=O.Prerequisite.BogoPrerequisiteQuantity*F)-discountNinja.Prerequisite.PrerequisiteItemsInCart(t,O))<0&&(x=0);else if(O&&O.Prerequisite&&O.Prerequisite.MinimumItems){(x=(G=O.Prerequisite.MinimumItems*F)-discountNinja.Prerequisite.PrerequisiteItemsInCart(t,O))<0&&(x=0)}b&&b.Entitlement&&b.Entitlement.Percentage,b&&b.Entitlement&&b.Entitlement.Amount;var H=t.Tiers[t.Tiers.length-1],M=H?H.Entitlement:null,q=b&&b.Entitlement?b.Entitlement.EntitledQuantity:null,V=discountNinja.Prerequisite.EntitledQuantityInfo(t,b),Q=null===V||!1===V.HasEntitledQuantity||V.Entitled<q?q:V.Entitled;if(discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MAXIMUM_ITEMS")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{MAXIMUM_ITEMS}}","offer","maximum_items",t.EntitledQuantity||"N/A")),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"ENTITLED_QUANTITY")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{ENTITLED_QUANTITY}}","offer","entitled_quantity",Q||"N/A")),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MINIMUM_CART_VALUE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,i,n,"{{MINIMUM_CART_VALUE}}","offer","minimum_cart_value",100*w,a,c,s,u,2,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MAXIMUM_CART_VALUE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,i,n,"{{MAXIMUM_CART_VALUE}}","offer","maximum_cart_value",100*U,a,c,s,u,2,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"AMOUNT_LEFT_BEFORE_DISCOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,i,n,"{{AMOUNT_LEFT_BEFORE_DISCOUNT}}","offer","amount_left_before_discount",100*A,a,c,s,u,2,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MINIMUM_CART_PRODUCTS")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{MINIMUM_CART_PRODUCTS}}","offer","minimum_cart_products",G)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MAXIMUM_CART_PRODUCTS")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{MAXIMUM_CART_PRODUCTS}}","offer","maximum_cart_products",B)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"PRODUCTS_LEFT_BEFORE_DISCOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{PRODUCTS_LEFT_BEFORE_DISCOUNT}}","offer","products_left_before_discount",x)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"DISCOUNT_CODE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{DISCOUNT_CODE}}","offer","discount_code",discountNinja.Offer.GetPromotionDiscountCode(t))),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"STARTS_AT_DATE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{STARTS_AT_DATE}}","offer","starts_at_date",p)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"STARTS_AT_TIME")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{STARTS_AT_TIME}}","offer","starts_at_time",f)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"ENDS_AT_DATE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{ENDS_AT_DATE}}","offer","ends_at_date",m)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"ENDS_AT_TIME")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{ENDS_AT_TIME}}","offer","ends_at_time",h)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"EXPIRES_AT_DATE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{EXPIRES_AT_DATE}}","offer","expires_at_date",y)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"EXPIRES_AT_TIME")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{EXPIRES_AT_TIME}}","offer","expires_at_time",_)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"OFFER_LINK_HERE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{OFFER_LINK_HERE}}","offer","offer_link_here","<a class='limoniapps-targetlink' href='"+t.Entitlement.EntitledItemLinks+"'>"+r+"</a>")),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"OFFER_LINK")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderLink(t,null,i,n,"OFFER_LINK","offer","offer_link",t.Entitlement.EntitledItemLinks)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"PREREQUISITE_LINK")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderLink(t,null,i,n,"PREREQUISITE_LINK","offer","prerequisite_link",t.Prerequisite.PrerequisiteLinks)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"PREREQUISITE_EXCLUSIONS_LINK")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderLink(t,null,i,n,"PREREQUISITE_EXCLUSIONS_LINK","offer","prerequisite_exclusions_link",t.Prerequisite?t.Prerequisite.PrerequisiteExclusionLinks:"")),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MINIMUM_PREREQUISITE_PRODUCTS")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{MINIMUM_PREREQUISITE_PRODUCTS}}","offer","minimum_prerequisite_products",O.Prerequisite?O.Prerequisite.BogoPrerequisiteQuantity:0)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"EXCLUSIONS_LINK")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderLink(t,null,i,n,"EXCLUSIONS_LINK","offer","exclusions_link",t.Entitlement.ExcludeCollectionLinks)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MAXIMUM_GIFTS")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{MAXIMUM_GIFTS}}","offer","maximum_gifts",t.Entitlement.AllocationLimit)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MAXIMUM_DISCOUNTED_ITEMS")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{MAXIMUM_DISCOUNTED_ITEMS}}","offer","maximum_discounted_items",t.Entitlement.AllocationLimit)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"TOTAL_DISCOUNT_CODES")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{TOTAL_DISCOUNT_CODES}}","offer","total_discount_codes",t.UsageLimit?t.UsageLimit.Total:null)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"REMAINING_DISCOUNT_CODES")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{REMAINING_DISCOUNT_CODES}}","offer","remaining_discount_codes",t.UsageLimit?t.UsageLimit.Remaining:null)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"USED_DISCOUNT_CODES")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{USED_DISCOUNT_CODES}}","offer","used_discount_codes",t.UsageLimit&&t.UsageLimit.Total&&t.UsageLimit.Remaining?t.UsageLimit.Total-t.UsageLimit.Remaining:null)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"OFFER_TOTAL_DISCOUNT_AMOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,i,n,"{{OFFER_TOTAL_DISCOUNT_AMOUNT}}","offer","offer_total_discount_amount",I,a,c,s,u,2,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"OFFER_TOTAL_DISCOUNT_PERCENTAGE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{OFFER_TOTAL_DISCOUNT_PERCENTAGE}}","offer","offer_total_discount_percentage",discountNinja.Utilities.FormatPercentage(k,0)+"%")),i=discountNinja_Script_ShortCode.ReplaceLocalePlaceHolders(i),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"TOTAL_DISCOUNT_AMOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,i,n,"{{TOTAL_DISCOUNT_AMOUNT}}","offer","total_discount_amount",T,a,c,s,u,2,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"TOTAL_DISCOUNT_PERCENTAGE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{TOTAL_DISCOUNT_PERCENTAGE}}","offer","total_discount_percentage",discountNinja.Utilities.FormatPercentage(D,0)+"%")),b){var W=e(t,b);t&&t.Entitlement&&"percentage"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"DISCOUNT_PERCENTAGE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{DISCOUNT_PERCENTAGE}}","offer","discount_percentage",discountNinja.Utilities.FormatPercentage(b.Entitlement.Percentage,0)+"%")),t&&t.Entitlement&&"fixed_amount"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"DISCOUNT_AMOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,i,n,"{{DISCOUNT_AMOUNT}}","offer","discount_amount",100*b.Entitlement.Amount*W,a,c,s,u,2,!1,null,null,!0)),t&&t.Entitlement&&"fixed_amount"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"DISCOUNT_PERCENTAGE")&&b.Entitlement.Percentage>0&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{DISCOUNT_PERCENTAGE}}","offer","discount_percentage",discountNinja.Utilities.FormatPercentage(b.Entitlement.Percentage,0)+"%")),t&&t.Entitlement&&"percentage"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"DISCOUNT_AMOUNT")&&b.Entitlement.Amount>0&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,i,n,"{{DISCOUNT_AMOUNT}}","offer","discount_amount",100*b.Entitlement.Amount,a,c,s,u,2,!1,null,null,!0)),t&&t.Entitlement&&"percentage"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"DISCOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{DISCOUNT}}","offer","discount",discountNinja.Utilities.FormatPercentage(b.Entitlement.Percentage,0)+"%")),t&&t.Entitlement&&"fixed_amount"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"DISCOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,i,n,"{{DISCOUNT}}","offer","discount",100*b.Entitlement.Amount*W,a,c,s,u,2,!1,null,null,!0))}if(O){W=e(t,O);t&&t.Entitlement&&"percentage"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"NEXT_GOAL_DISCOUNT_PERCENTAGE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{NEXT_GOAL_DISCOUNT_PERCENTAGE}}","offer","next_goal_discount_percentage",discountNinja.Utilities.FormatPercentage(O.Entitlement.Percentage,0)+"%")),t&&t.Entitlement&&"fixed_amount"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"NEXT_GOAL_DISCOUNT_AMOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,i,n,"{{NEXT_GOAL_DISCOUNT_AMOUNT}}","offer","next_goal_discount_amount",100*O.Entitlement.Amount*W,a,c,s,u,2,!1,null,null,!0)),t&&t.Entitlement&&"percentage"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"NEXT_GOAL_DISCOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{NEXT_GOAL_DISCOUNT}}","offer","next_goal_discount",discountNinja.Utilities.FormatPercentage(O.Entitlement.Percentage,0)+"%")),t&&t.Entitlement&&"fixed_amount"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"NEXT_GOAL_DISCOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,i,n,"{{NEXT_GOAL_DISCOUNT}}","offer","next_goal_discount",100*O.Entitlement.Amount*W,a,c,s,u,2,!1,null,null,!0))}return t&&t.Entitlement&&"percentage"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MAXIMUM_DISCOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{MAXIMUM_DISCOUNT}}","offer","maximum_discount",discountNinja.Utilities.FormatPercentage(M?M.Percentage:0,0)+"%")),t&&t.Entitlement&&"fixed_amount"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MAXIMUM_DISCOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,i,n,"{{MAXIMUM_DISCOUNT}}","offer","maximum_discount",100*(M?M.Amount:0),a,c,s,u,2,!1,null,null,!0)),i=(i=(i=(i=(i=(i=i.replace(/{{TIMER}}/g,'<span class="limoniapps-discountninja-timer" data-style="1"></span>')).replace(/{{TIMER,STYLE1}}/g,'<span class="limoniapps-discountninja-timer" data-style="1""></span>')).replace(/{{TIMER,STYLE2}}/g,'<span class="limoniapps-discountninja-timer" data-style="2""></span>')).replace(/{{TIMER,STYLE3}}/g,'<span class="limoniapps-discountninja-timer" data-style="3""></span>')).replace(/{{TIMER,STYLE4}}/g,'<span class="limoniapps-discountninja-timer" data-style="4""></span>')).replace(/{{TIMER,STYLE5}}/g,'<span class="limoniapps-discountninja-timer" data-style="5""></span>')}catch(t){return discountNinja.Logging.LogError("ShortCode.ReplacePromotionLevelPlaceHolders",t),i}},ReplaceProductLevelPlaceHolders:function(t,i,n,e){function o(t,i,n,e){return' style="'+(t?"color: "+t+" !important;":"")+(i?"font-size: "+i+"px !important;":"")+(n?"font-weight: "+n+" !important;":"")+(e?e+";":"")+'" '}try{if("string"!=typeof t||""===t||null===t)return t;e||(e="standard"),discountNinja.Logging.LogVerbose("Replacing product level placeholders");var r=discountNinja.Currency.GetCurrencyFormat(),a=discountNinja.Utilities.GetNoDecimalsCurrencyFormat(r),c=discountNinja.Utilities.GetCurrencyFormatAmountComponent(r),s=discountNinja.Utilities.GetCurrencyFormatAmountComponent(a),u=i&&i.OriginalPriceTotal?i.OriginalPriceTotal:i?i.OriginalPrice:void 0,d=i.OriginalCompareAtPrice>u?i.Amount+i.OriginalCompareAtPrice-u:i.Amount,l=d/i.OriginalCompareAtPrice*100,g=function(t){return o(discountNinja.Settings.GetPriceFormat(t).DiscountedPriceColor,discountNinja.Settings.GetPriceFormat(t).DiscountedPriceFontSize,discountNinja.Settings.GetPriceFormat(t).DiscountedPriceFontWeight,discountNinja.Settings.GetPriceFormat(t).DiscountedPriceCustomCss)}(e),p=function(t){return o(discountNinja.Settings.GetPriceFormat(t).OriginalPriceColor,discountNinja.Settings.GetPriceFormat(t).OriginalPriceFontSize,discountNinja.Settings.GetPriceFormat(t).OriginalPriceFontWeight,discountNinja.Settings.GetPriceFormat(t).OriginalPriceCustomCss)}(e),f=discountNinja.Settings.GetPriceFormat(e).DiscountedPriceCssClasses,N=discountNinja.Settings.GetPriceFormat(e).OriginalPriceCssClasses;return i&&void 0!==i.CompareAtAmount&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"AMOUNT_COMPAREAT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,i,t,n,"{{AMOUNT_COMPAREAT}}","product","amount_compareat",100*i.CompareAtAmount,r,a,c,s,2,!1,null,null,!0)),i&&void 0!==i.DiscountedPrice&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNTED_PRICE")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,i,t,n,"{{DISCOUNTED_PRICE}}","product","discounted_price",100*i.DiscountedPrice,r,a,c,s,2,!1,g,f,!0)),void 0!==u&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"ORIGINAL_PRICE")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,i,t,n,"{{ORIGINAL_PRICE}}","product","original_price",100*u,r,a,c,s,2,!1,p,N,!0)),i&&void 0!==i.OriginalCompareAtPrice&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"ORIGINAL_COMPAREAT_PRICE")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,i,t,n,"{{ORIGINAL_COMPAREAT_PRICE}}","original_compareat_price","amount",100*i.OriginalCompareAtPrice,r,a,c,s,2,!1,p,N,!0)),i&&void 0!==i.DiscountedPrice&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNTED_INSTALLMENT_4PERIODS")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,i,t,n,"{{DISCOUNTED_INSTALLMENT_4PERIODS}}","product","discounted_price_installment_4periods",100*i.DiscountedPrice/4,r,a,c,s,2,!1,g,f,!0)),i&&void 0!==i.Amount&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT_AMOUNT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,i,t,n,"{{DISCOUNT_AMOUNT}}","product","discount_amount",100*i.Amount,r,a,c,s,2,!1,null,null,!0)),i&&void 0!==i.Percentage&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT_PERCENTAGE")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(null,i,t,n,"{{DISCOUNT_PERCENTAGE}}","product","discount_percentage",discountNinja.Utilities.FormatPercentage(i.Percentage,0)+"%")),i&&void 0!==i.Percentage&&i.Percentage>0&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(null,i,t,n,"{{DISCOUNT}}","product","discount",discountNinja.Utilities.FormatPercentage(i.Percentage,0)+"%")),i&&void 0!==i.Amount&&i.Amount>0&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,i,t,n,"{{DISCOUNT}}","product","discount",100*i.Amount,r,a,c,s,2,!1,null,null,!0)),i&&void 0!==i.CompareAtAmount&&void 0!==i.Amount&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT_AMOUNT_COMPAREAT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,i,t,n,"{{DISCOUNT_AMOUNT_COMPAREAT}}","product","discount_amount_compareat",d,r,a,c,s,2,!1,null,null,!0)),i&&void 0!==i.CompareAtAmount&&void 0!==i.Percentage&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT_PERCENTAGE_COMPAREAT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(null,i,t,n,"{{DISCOUNT_PERCENTAGE_COMPAREAT}}","product","discount_percentage_compareat",discountNinja.Utilities.FormatPercentage(l,0)+"%")),t}catch(t){discountNinja.Logging.LogError("ShortCode.ReplaceProductLevelPlaceHolders",t)}},ContainsPlaceHolder:function(t,i){try{return""!==t&&null!==t&&"string"==typeof t&&t.indexOf(i.replace("{{","").replace("}}",""))>-1}catch(t){return!1}},ReplaceSettingsLevelPlaceHolders:function(t,i,n){try{if(""===i||null===i||"string"!=typeof i)return i;discountNinja.Logging.LogVerbose("Replacing settings level placeholders");var e=discountNinja.Currency.GetCurrencyFormat(),o=discountNinja.Utilities.GetNoDecimalsCurrencyFormat(e),r=discountNinja.Utilities.GetCurrencyFormatAmountComponent(e),a=discountNinja.Utilities.GetCurrencyFormatAmountComponent(o),c=0;window.discountNinjaContext&&window.discountNinjaContext.Cart&&window.discountNinjaContext.Cart.total_price&&(c=window.discountNinjaContext.Cart.total_price);var s=0,u=0,d=0,l=discountNinja.DiscountedCart.DiscountedCart;l&&(s=100*l.total_original_price),l&&(u=100*l.total_discount),l&&(d=100*l.total_discounted_price);var g=0;if(d>0&&s>0&&(g=100*Math.min(u/s,100)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"{{TOTAL_PRICE}}")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,i,n,"{{TOTAL_PRICE}}","offer","total_price",c,e,o,r,a,2,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"{{SUBTOTAL}}")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,i,n,"{{SUBTOTAL}}","offer","subtotal",s,e,o,r,a,2,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"{{TOTAL_DISCOUNT}}")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,i,n,"{{TOTAL_DISCOUNT}}","offer","total_discount",u,e,o,r,a,2,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"{{DISCOUNTED_SUBTOTAL}}")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,i,n,"{{DISCOUNTED_SUBTOTAL}}","offer","discounted_subtotal",d,e,o,r,a,2,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"{{DISCOUNT_PERCENTAGE_SUBTOTAL}}")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,i,n,"{{DISCOUNT_PERCENTAGE_SUBTOTAL}}","offer","discount_percentage_subtotal",discountNinja.Utilities.FormatPercentage(g,0)+"%")),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"{{DISCOUNTED_INSTALLMENT_4PERIODS_SUBTOTAL}}")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,i,n,"{{DISCOUNTED_INSTALLMENT_4PERIODS_SUBTOTAL}}","offer","discounted_installment_4periods_subtotal",d/4,e,o,r,a,2,!1,null,null,!1)),i=(i=i.replace(/{{NEW_LINE}}/g,"<br>")).replace(/{{DISCOUNT_ICON}}/g,'<svg class="limoniapps-discountninja-icon-discount" aria-hidden="true" focusable="false"> <use xlink:href="#tags-filled">#shadow-root (closed)<svg id="tags-filled"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18"><path d="M17.78 3.09C17.45 2.443 16.778 2 16 2h-5.165c-.535 0-1.046.214-1.422.593l-6.82 6.89c0 .002 0 .003-.002.003-.245.253-.413.554-.5.874L.738 8.055c-.56-.953-.24-2.178.712-2.737L9.823.425C10.284.155 10.834.08 11.35.22l4.99 1.337c.755.203 1.293.814 1.44 1.533z" fill-opacity=".55"></path><path d="M10.835 2H16c1.105 0 2 .895 2 2v5.172c0 .53-.21 1.04-.586 1.414l-6.818 6.818c-.777.778-2.036.782-2.82.01l-5.166-5.1c-.786-.775-.794-2.04-.02-2.828.002 0 .003 0 .003-.002l6.82-6.89C9.79 2.214 10.3 2 10.835 2zM13.5 8c.828 0 1.5-.672 1.5-1.5S14.328 5 13.5 5 12 5.672 12 6.5 12.672 8 13.5 8z"></path></svg></svg></use></svg>'),i=(i=void 0!==String.fromCodePoint?(i=i.replace(/{{SHIPPING_ICON}}/g,String.fromCodePoint("0x1f69a"))).replace(/{{GIFT_ICON}}/g,String.fromCodePoint("0x1f381")):(i=i.replace(/{{SHIPPING_ICON}}/g,"")).replace(/{{GIFT_ICON}}/g,"")).replace(/{{DISCOUNT_PERCENTAGE_ICON}}/g,'<svg class="limoniapps-discountninja-icon-coupon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><defs><style>.a{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:1.5px;}</style></defs><title>icon-coupon</title><line class="a" x1="6.75" y1="17.25" x2="17.25" y2="6.75"></line><circle class="a" cx="8.25" cy="8.25" r="1.5"></circle><circle class="a" cx="15.75" cy="15.75" r="1.5"></circle><path class="a" d="M.75,3.75V2.25A1.5,1.5,0,0,1,2.25.75h1.5"></path><path class="a" d="M3.75,23.25H2.25a1.5,1.5,0,0,1-1.5-1.5v-1.5"></path><line class="a" x1="0.75" y1="7.5" x2="0.75" y2="10.5"></line><line class="a" x1="0.75" y1="13.5" x2="0.75" y2="16.5"></line><line class="a" x1="23.25" y1="7.5" x2="23.25" y2="10.5"></line><line class="a" x1="7.5" y1="0.75" x2="10.5" y2="0.75"></line><path class="a" d="M23.25,20.25v1.5a1.5,1.5,0,0,1-1.5,1.5h-1.5"></path><line class="a" x1="23.25" y1="16.5" x2="23.25" y2="13.5"></line><line class="a" x1="16.5" y1="23.25" x2="13.5" y2="23.25"></line><line class="a" x1="13.5" y1="0.75" x2="16.5" y2="0.75"></line><path class="a" d="M20.25.75h1.5a1.5,1.5,0,0,1,1.5,1.5v1.5"></path><line class="a" x1="10.5" y1="23.25" x2="7.5" y2="23.25"></line></svg>'),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"{{OFFER_COUNT}}")){var p=discountNinja.Notification.GetFromCache()||[];i=i.replace(/{{OFFER_COUNT}}/g,p.length)}return i=discountNinja_Script_ShortCode.ReplaceCurrencyPlaceHolders(i)}catch(t){return discountNinja.Logging.LogError("ShortCode.ReplaceSettingsLevelPlaceHolders",t),i}},ReplaceCurrencyPlaceHolders:function(t){try{if(""===t||null===t||"string"!=typeof t)return t;var i=discountNinja.Settings.Settings.Currency;return t=(t=t.replace(/{{CURRENCY}}/g,i.BaseCurrency)).replace(/{{CURRENCY_SYMBOL}}/g,i.BaseCurrencySymbol)}catch(i){return discountNinja.Logging.LogError("ShortCode.ReplaceSettingsLevelPlaceHolders",i),t}},ReplaceLocalePlaceHolders:function(t){try{if(""===t||null===t||"string"!=typeof t)return t;var i=discountNinja.Environment.Shopify.NonPrimaryLocale()||"";return t=(t=t.replace(/{{LOCALE_ISO_CODE}}\//g,""===i||null===i?"/":"/"+i+"/")).replace(/{{LOCALE_ISO_CODE}}/g,discountNinja.Environment.Shopify.Locale())}catch(i){return discountNinja.Logging.LogError("ShortCode.ReplaceLocalePlaceHolders",i),t}},ReplaceAllPlaceHolders:function(t,i,n,e){return i=discountNinja_Script_ShortCode.ReplaceSettingsLevelPlaceHolders(t,i,!0),t&&(i=discountNinja_Script_ShortCode.ReplacePromotionLevelPlaceHolders(t,i,!0)),n&&(i=discountNinja_Script_ShortCode.ReplaceProductLevelPlaceHolders(i,n,!0,e)),i}},discountNinja_Script_TabReminder={Set:function(){try{var t=discountNinja.Cache.SessionGet("toggletabtitle");null!==t&&"off"!==t||(discountNinja.Cache.SessionSet("toggletabtitle","on-state1"),function t(){try{if(!discountNinja.DynamicPricing.HasActiveDiscountCode())return;var i=discountNinja.Cache.SessionGet("tabtitle");null===i&&(i=document.title,discountNinja.Cache.SessionSet("tabtitle",i)),"visible"===document.visibilityState&&discountNinja.Cache.SessionSet("toggletabtitle","off"),"on-state1"===discountNinja.Cache.SessionGet("toggletabtitle")?(document.title=" Promotion active! "+i,discountNinja.Cache.SessionSet("toggletabtitle","on-state2"),setTimeout((function(){t()}),2500)):"on-state2"===discountNinja.Cache.SessionGet("toggletabtitle")?(document.title=" Don't forget! "+i,discountNinja.Cache.SessionSet("toggletabtitle","on-state3"),setTimeout((function(){t()}),2500)):"on-state3"===discountNinja.Cache.SessionGet("toggletabtitle")?(document.title=" Collect discount! "+i,discountNinja.Cache.SessionSet("toggletabtitle","on-state4"),setTimeout((function(){t()}),2500)):"on-state4"===discountNinja.Cache.SessionGet("toggletabtitle")&&(document.title=i,discountNinja.Cache.SessionSet("toggletabtitle","on-state1"),setTimeout((function(){t()}),5e3))}catch(t){discountNinja.Logging.LogError("TabReminder.ToggleTabReminder",t)}}())}catch(t){discountNinja.Logging.LogError("TabReminder.Set",t)}},Remove:function(){try{discountNinja.Cache.SessionSet("toggletabtitle","off");var t=discountNinja.Cache.SessionGet("tabtitle");null!==t&&(document.title=t)}catch(t){discountNinja.Logging.LogError("TabReminder.Remove",t)}}},discountNinja_Script_TestMode={TestModeDynamicStylesAdded:!1,TestMode:!1,MatchByTokenOnly:!1,TestModeToken:null,HandleQueryParameter:function(){var t="discountninja";discountNinja_Script_TestMode.MatchByTokenOnly=discountNinja.QueryParameter.GetFlag(t+"tokenonly",!0,!0,!1,!0);var i=discountNinja.QueryParameter.GetFlag(t+"testmode",!0,!0,!1,!0);discountNinja_Script_TestMode.TestMode="true"===i||!0===i,discountNinja_Script_TestMode.TestModeToken=discountNinja.QueryParameter.GetFlag(t+"testmodetoken",!0,!0,null,!1)}},discountNinja_Script_Token={TokenNonAutomaticSession:"token-non-automatic-session",RemoveSavedToken:function(){try{discountNinja.Cache.SessionRemove("savedtoken")}catch(t){return discountNinja.Logging.LogError("Token.RemoveSavedToken",t),""}},GetTokenFromQueryParameter:function(){try{var t=discountNinja.QueryParameter.Get("token");return t?t.toUpperCase():function(){try{var t=discountNinja.Cache.SessionGet("savedtoken");return t?t.toUpperCase():""}catch(t){return discountNinja.Logging.LogError("Token.GetSavedToken",t),""}}()}catch(t){return discountNinja.Logging.LogError("Token.GetTokenFromQueryParameter",t),""}},GetTokenFromPromotionOrQueryParameter:function(t){try{var i=null;return(t=t||discountNinja.Offer.PrimaryOffer)&&(i=t?t.Token:null),null===i&&(i=discountNinja_Script_Token.GetTokenFromQueryParameter()),i?i.toUpperCase():""}catch(t){return discountNinja.Logging.LogError("Token.GetTokenFromPromotionOrQueryParameter ",t,!1),""}},GetCartToken:function(t){try{var i=discountNinja_Script_Token.GetTokenFromPromotionOrQueryParameter(t);return null!==i&&""!==i||(i=discountNinja_Script_Token.GetCartTokenFromLocalStorage()),i?i.toUpperCase():""}catch(t){return discountNinja.Logging.LogError("Token.GetCartToken ",t,!1),""}},GetNonAutomaticToken:function(t){try{var i=discountNinja_Script_Token.GetTokenFromPromotionOrQueryParameter(t);return null!==i&&""!==i||(i=discountNinja_Script_Token.GetNonAutomaticTokenFromCache()),i?i.toUpperCase():""}catch(t){return discountNinja.Logging.LogError("Token.GetNonAutomaticToken ",t,!1),""}},GetToken:function(t){try{var i=discountNinja_Script_Token.GetTokenFromPromotionOrQueryParameter(t);return null!==i&&""!==i||(i=discountNinja_Script_Token.GetTokenFromLocalStorage()),i?i.toUpperCase():""}catch(t){return discountNinja.Logging.LogError("Token.GetToken ",t,!1),""}},GetTokenFromLocalStorage:function(){return discountNinja.Cache.LocalGet("token-device")},SetTokenInLocalStorage:function(t){discountNinja.Cache.LocalSet("token-device",t)},RemoveCartTokenFromLocalStorage:function(){discountNinja.Cache.LocalRemove("token-cart-device")},GetCartTokenFromLocalStorage:function(){return discountNinja.Cache.LocalGet("token-cart-device")},SetCartTokenInLocalStorage:function(t){discountNinja.Cache.LocalSet("token-cart-device",t)},GetNonAutomaticTokenFromCache:function(){try{var t=discountNinja_Script_Token.TokenNonAutomaticSession,i=discountNinja.Cache.SessionGet(t);return null!==i&&""!==i||(i=discountNinja.Cache.LocalGet(t)),i}catch(t){discountNinja.Logging.LogError("Token.GetNonAutomaticTokenFromCache ",t,!1)}},SetNonAutomaticTokenToCache:function(t){try{var i=discountNinja_Script_Token.TokenNonAutomaticSession;discountNinja.Cache.SessionSet(i,t),discountNinja.Settings.Settings&&!0===discountNinja.Settings.Settings.General.StoreShareableLinks?discountNinja.Cache.LocalSet(i,t):discountNinja.Cache.LocalRemove(i)}catch(t){discountNinja.Logging.LogError("Token.SetNonAutomaticTokenToCache ",t,!1)}}},discountNinja_Script_Trigger={OffersToTrigger:[],Clear:function(){try{var t=discountNinja.Offer.Triggers;if(!t)return;for(var i=0;i<t.length;i++)t[i].Triggered=!1}catch(t){discountNinja.Logging.LogError("Trigger.Clear",t)}},TriggerOffers:function(t){discountNinja_Script_Trigger.OffersToTrigger||(discountNinja_Script_Trigger.OffersToTrigger=[]),t&&(discountNinja_Script_Trigger.OffersToTrigger=discountNinja_Script_Trigger.OffersToTrigger.concat(t)),discountNinja_Script_Trigger.ProcessOffersToTrigger()},GetTriggerByToken:function(t){var i=discountNinja_Script_Offer.Triggers;if(i)for(var n=0;n<i.length;n++){var e=i[n];if(e.Token===t)return e}return null},EnsureInitialPromotionsTriggered:function(t){return t()},InitialPromotionsTriggered:!1,ProcessOffersToTriggerDebounced:function(){var t=discountNinja_Script_Trigger.OffersToTrigger;if(null!==t){discountNinja_Script_Trigger.OffersToTrigger=null;for(var i=!0,n=0;n<t.length;n++){var e=discountNinja.Offer.GetOfferByToken(t[n].offerToken);if(e){e.TriggeredByTrigger=t[n].trigger,discountNinja.Offer.Offers||(discountNinja.Offer.Offers=[]);for(var o=!1,r=0;r<discountNinja.Offer.Offers.length;r++)if(discountNinja.Offer.Offers[r].Token===e.Token){o=!0;break}o||discountNinja.Offer.Offers.push(e),discountNinja.PromotionFlow.ViewPromotion(e),(e.AutoAccept||discountNinja.Offer.IsOfferAccepted(e.Token,e.Frequency))&&discountNinja.PromotionFlow.AcceptPromotion(e),discountNinja.Timer.ShouldNotStart(e)&&(i=!1)}}i||discountNinja.Timer.Stop(),discountNinja.Offer.FilterPromotions(),function(){if(discountNinja.Offer.SetPrimaryOffer(),null===discountNinja.Offer.PrimaryOffer)discountNinja.Logging.LogInformation("No valid applicable offer",!1),discountNinja.PromotionFlow.StopFlow()}(),discountNinja_Script_Trigger.InitialPromotionsTriggered=!0,discountNinja.LogSession.PromotionsApplied(discountNinja.Offer.Offers,discountNinja.Offer.Triggers,discountNinja.Offer.Source,discountNinja.Offer.SourceReason),discountNinja_Script_PromotionFlow.StopFlow()}},IntializeTimeOnPageCounter:function(){try{discountNinja.Cache.SessionSet("trigger-time-on-page",0),null!==discountNinja_Script_Trigger.TimeOnPageCounterIntervalId&&0!==discountNinja_Script_Trigger.TimeOnPageCounterIntervalId&&clearInterval(discountNinja_Script_Trigger.TimeOnPageCounterIntervalId),discountNinja_Script_Trigger.TimeOnPageCounterIntervalId=window.setInterval((function(){var t=discountNinja.Cache.SessionGet("trigger-time-on-page");t=!t||isNaN(t)?0:parseInt(t),discountNinja.Cache.SessionSet("trigger-time-on-page",t+1)}),1e3)}catch(t){discountNinja.Logging.LogError("Trigger.IntializeTimeOnPageCounter",t)}},TrackExitIntent:function(){try{discountNinja.Cache.SessionSet("trigger-exit-intent","false");var t=discountNinja.Settings.Settings.General.ExitIntentMode;t||(t="default");ouibounce(!1,{aggressive:!0,timer:"aggressive"===t?0:1e3,delay:"aggressive"===t?150:0,sensitivity:"aggressive"===t?80:20,callback:function(){discountNinja.Logging.LogVerbose("Exit intent detected"),discountNinja.Cache.SessionSet("trigger-exit-intent","true")}})}catch(t){discountNinja.Logging.LogError("Trigger.TrackExitIntent",t)}},TrackScrollPercentage:function(){function t(){try{var t=discountNinja.Cache.SessionGet("trigger-scroll-percentage");if(100===t)return;var i=discountNinja.Utilities.jQuery()(window).height(),n=discountNinja.Utilities.jQuery()(document).height(),e=discountNinja.Utilities.jQuery()(window).scrollTop(),o=n-i,r=Math.floor(e/o*100);r>t&&discountNinja.Cache.SessionSet("trigger-scroll-percentage",r)}catch(t){return 0}}try{discountNinja.Cache.SessionSet("trigger-scroll-percentage",0),discountNinja.Utilities.jQuery()(window).on("scroll",(function(){t()})),t()}catch(t){discountNinja.Logging.LogError("Trigger.TrackScrollPercentage",t)}},MarkPageAsVisited:function(){try{var t=discountNinja.Cache.SessionGet("trigger-pages-visited-list");t=null===t?[]:t.split(","),-1===discountNinja.Utilities.jQuery().inArray(window.location.pathname,t)&&t.push(window.location.pathname);var i=t.length;discountNinja.Cache.SessionSet("trigger-pages-visited-list",t),discountNinja.Cache.SessionSet("trigger-pages-visited",i),discountNinja.Logging.LogVerbose("Pages visited: "+i)}catch(t){discountNinja.Logging.LogError("Trigger.MarkPageAsVisited",t)}},ValidForPage:function(t){try{var i=discountNinja.Settings.Settings.PopUp;if(!t.PopUp||!t.PopUp.Enabled)return!0;var n=discountNinja.PromotionFlow.IsBuildingBlockEnabledForPage(i,"","Pop-up");if(!discountNinja.PromotionFlow.HandleFlowErrorMessage(n))return!1;var e=i.ShowOn,o=t.Trigger,r="Offer will not be displayed because ";return discountNinja.Environment.Shopify.IsCustomPage()&&t.PopUp.Enabled?!!e.ShowOnCustomPages&&(!("custom"===o.CustomPagesIncluded&&!discountNinja.Utilities.StringIsIn(o.CustomPageContains,discountNinja.Environment.Shopify.CustomPageHandle()))||(discountNinja.Logging.LogVerbose(r+"the current custom page is not in the set of pages to include",null,!0,!0,!1),!1)):discountNinja.Environment.Shopify.IsBlogPost()&&t.PopUp.Enabled?!!e.ShowOnBlogPosts&&("blogequals"!==o.BlogPostsIncluded||discountNinja.Utilities.StringIsIn(o.BlogEquals,discountNinja.Environment.Shopify.BlogHandle())?("postcontains"!==o.BlogPostsIncluded||discountNinja.Utilities.StringIsIn(o.BlogPostHandleContains,discountNinja.Environment.Shopify.BlogPostHandle()))&&!("blogandpostcontains"===o.BlogPostsIncluded&&!discountNinja.Utilities.StringIsIn(o.BlogPostHandleContains,discountNinja.Environment.Shopify.BlogPostHandle())&&!discountNinja.Utilities.StringIsIn(o.BlogEquals,discountNinja.Environment.Shopify.BlogHandle()))||(discountNinja.Logging.LogVerbose(r+"the current blog post is not in the set of blog posts to include",null,!0,!0,!1),!1):(discountNinja.Logging.LogVerbose(r+"the current blog is not in the set of blogs to include",null,!0,!0,!1),!1)):!discountNinja.Environment.Shopify.IsCollectionPage()||!t.PopUp.Enabled||!!e.ShowOnCollectionPages&&("overrideinclude"!==o.TargetCollectionHandleMode||discountNinja.Utilities.StringIsIn(o.OverrideCollectionHandles,discountNinja.Environment.Shopify.CollectionHandle())?"overrideexclude"!==o.TargetCollectionHandleMode||!discountNinja.Utilities.StringIsIn(o.OverrideCollectionHandles,discountNinja.Environment.Shopify.CollectionHandle())||(discountNinja.Logging.LogVerbose(r+"the current collection page is in the set of overriden collections to exclude",null,!0,!0,!1),!1):(discountNinja.Logging.LogVerbose(r+"the current collection page is not in the set of overriden collections to include",null,!0,!0,!1),!1))}catch(t){discountNinja.Logging.LogError("Trigger.PromotionTriggersOnPage",t)}},FilterConditionsAreMet:function(t){var i=t.Filter;return function(t){var i=discountNinja.DateTime,n=!0===discountNinja.TestMode.TestMode&&t.Token===discountNinja.Token.GetNonAutomaticTokenFromCache();if(null!==t.StartsAt&&void 0!==t.StartsAt&&""!==t.StartsAt&&i.DiffInSeconds(i.UtcNow(),i.GetUtc(t.StartsAt))<0){if(!n)return!1;discountNinja.Logging.LogVerbose("Promotion would normally not be displayed because the start date ("+t.StartsAt+") of the promotion is in the future, it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/schedule/how-to-startend-a-offer-automatically' target='_blank'>here</a>.",null,!0,!0,!1)}return!(void 0!==t.EndsAt&&null!==t.EndsAt&&""!==t.EndsAt&&i.DiffInSeconds(i.UtcNow(),i.GetUtc(t.EndsAt))>=0)}(t)&&function(i){var n=!0===discountNinja.TestMode.TestMode&&t.Token===discountNinja.Token.GetTokenFromQueryParameter(),e=("guests"===i.CustomerType||i.CustomerType,"signedin"===i.CustomerType||"all"===i.CustomerType);if("none"===i.CustomerType&&(discountNinja.Logging.LogVerbose("Trigger will not be activated outside of test mode. Please enable your trigger for guests and/or signed in visitors. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-offers-to-customers-or-prospects' target='_blank'>here</a>.",null,!0,!0,!1),!n))return!1;if(i.CustomerType&&"signedin"===i.CustomerType&&!discountNinja.Environment.Shopify.IsCustomer()){if(discountNinja.Logging.LogVerbose("Trigger would normally not be activated because it is restricted to signed in visitors only and you are a guest, it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-offers-to-customers-or-prospects' target='_blank'>here</a>.",null,!0,!0,!1),!n)return!1}else if("guests"===i.CustomerType&&discountNinja.Environment.Shopify.IsCustomer()&&(discountNinja.Logging.LogVerbose("Trigger would normally not be activated because it is restricted to guests only and you are signed in to an account, it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-offers-to-customers-or-prospects' target='_blank'>here</a>.",null,!0,!0,!1),!n))return!1;if(e&&"all"!==i.CustomerTagType){var o=discountNinja.Environment.Shopify.CustomerTags(),r=!1;if(o&&i.CustomerTags)for(var a=i.CustomerTags.split(","),c=0;c<o.length;c++)for(var s=0;s<a.length;s++)o[c].toLowerCase().trim()===a[s].toLowerCase().trim()&&(r=!0);if("include"===i.CustomerTagType&&!1===r&&(discountNinja.Logging.LogVerbose("Trigger would normally not be activated because the signed in visitor is not tagged with one of the following tags: "+i.CustomerTags+", it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-offers-to-customers-or-prospects' target='_blank'>here</a>.",null,!0,!0,!1),!n))return!1;if("exclude"===i.CustomerTagType&&!0===r&&(discountNinja.Logging.LogVerbose("Trigger would normally not be activated because the signed in visitor is tagged with one of the following tags: "+i.CustomerTags+", it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-offers-to-customers-or-prospects' target='_blank'>here</a>.",null,!0,!0,!1),!n))return!1}var u=discountNinja.DateTime;return!(e&&void 0!==i.MinimumSpend&&null!==i.MinimumSpend&&discountNinja.Environment.Shopify.CustomerSpend<=i.MinimumSpend)&&(!(e&&void 0!==i.MinimumOrders&&null!==i.MinimumOrders&&discountNinja.Environment.Shopify.CustomerNumberOfOrders<=i.MinimumOrders)&&((!e||void 0===i.LastOrderBeforeDate||null===i.LastOrderBeforeDate||u.DiffInSeconds(i.LastOrderBeforeDate,u.GetUtc(discountNinja.Environment.Shopify.LastOrderBeforeDate))<0)&&(!e||void 0===i.LastOrderAfterDate||null===i.LastOrderAfterDate||u.DiffInSeconds(i.LastOrderAfterDate,u.GetUtc(discountNinja.Environment.Shopify.LastOrderBeforeDate))>=0)))}(i)&&!0},VisitorBehaviorConditionsAreMet:function(t){try{if("true"===discountNinja.Cache.SessionGet("trigger-conditions-met-"+t.Token))return!0;if(discountNinja.PromotionFlow.HasPopUpBeenShownForLevel(t))return!0;var i=t.Trigger;if(!i||"none"===i.Type)return!0;var n=null!==i.ScrollPercentage&&void 0!==i.ScrollPercentage&&!1!==i.ScrollPercentage,e=null!==i.PagesVisited&&void 0!==i.PagesVisited&&!1!==i.PagesVisited,o=null!==i.OnExitIntent&&void 0!==i.OnExitIntent&&!1!==i.OnExitIntent,r=null!==i.TimeOnPageInSeconds&&void 0!==i.TimeOnPageInSeconds&&!1!==i.TimeOnPageInSeconds;if(!(n||e||o||r))return!0;var a=!0,c=!0,s=!0,u=!0;r&&!function(t){var i=t.Trigger.TimeOnPageInSeconds,n=discountNinja.Cache.SessionGet("trigger-time-on-page");if(n&&!isNaN(n))return n>=i}(t)&&(a=!1),n&&!function(t){var i=t.Trigger.ScrollPercentage,n=discountNinja.Cache.SessionGet("trigger-scroll-percentage");if(n&&!isNaN(n))return n>=i}(t)&&(c=!1),e&&!function(t){var i=t.Trigger.PagesVisited,n=discountNinja.Cache.SessionGet("trigger-pages-visited");if(n&&!isNaN(n))return n>=i}(t)&&(s=!1),o&&!discountNinja.Utilities.IsMobilePhone()&&"true"!==discountNinja.Cache.SessionGet("trigger-exit-intent")&&(u=!1);var d="or"===i.Type?a||c||s||u:a&&c&&s&&u;return discountNinja.Cache.SessionSet("trigger-conditions-met-"+t.Token,d),d}catch(t){discountNinja.Logging.LogError("Trigger.PromotionTriggerConditionsMet",t)}},WaitForTriggerConditions:function(t){function i(t,i){for(var n=0;n<i.length;n++)if(i[n]===t)return!0;return!1}function n(t,e){if(c=t.Token,!("onceperdevice"==="oncepersession"?"false"===discountNinja.Cache.LocalGet("trigger-accepted-"+c):"false"===discountNinja.Cache.SessionGet("trigger-accepted-"+c))&&!function(t){if(void 0===t.CountdownClock||null===t.CountdownClock||void 0===t.CountdownClock.EndsAt||null===t.CountdownClock.EndsAt)return!1;var i=discountNinja.DateTime;return i.DiffInSeconds(i.GetUtc(t.CountdownClock.EndsAt),i.UtcNow())<=0}(t)&&discountNinja_Script_Trigger.FilterConditionsAreMet(t)&&discountNinja_Script_Trigger.ValidForPage(t)){discountNinja.Logging.LogVerbose("FLOW: Trigger "+t.Token+" is applicable on this page, checking visitor behavior conditions");for(var o=0;o<t.Offers.length;o++)e.push(t.Offers[o]);if(discountNinja_Script_Trigger.VisitorBehaviorConditionsAreMet(t)){discountNinja.Logging.LogInformation("FLOW: Trigger "+t.Token+" conditions met, displaying associated offers"),t.Triggered=!0;var r=[];for(o=0;o<t.Offers.length;o++)r.push({trigger:t,offerToken:t.Offers[o]});discountNinja_Script_Trigger.TriggerOffers(r)}else discountNinja.Logging.LogVerbose("FLOW: Trigger "+t.Token+" visitor behavior conditions not met, checking again in 500ms"),waitForTriggerConditionsTimeoutHandle=setTimeout((function(){n(t,e)}),500)}else{discountNinja.Logging.LogVerbose("FLOW: Trigger "+t.Token+" is NOT applicable on this page, not applying offers");for(o=0;o<t.Offers.length;o++){var a=discountNinja.Offer.GetOfferByToken(t.Offers[o]);a&&!i(a.Token,e)&&discountNinja.PromotionFlow.UnAcceptPromotion(a)}}var c}if(discountNinja.Logging.LogInformation("FLOW: Waiting for trigger conditions to be met"),!t||0===t.length)return discountNinja_Script_Trigger.InitialPromotionsTriggered=!0,discountNinja.PromotionFlow.StopFlow();for(var e=[],o=0;o<t.length;o++){var r=t[o];!0!==r.Triggered&&n(r,e)}discountNinja_Script_Trigger.ProcessOffersToTriggerDebounced()}},discountNinja_Script_Cart_Shopify={IsDirty:!1,ProcessingCartUpdate:!1,LockRefreshCart:!1,AddToCartButtonId:"LimoniAppsDiscountNinjaAddToCartButton",RegisteringAddToCart:!1,UseCartJSApiSetting:null,UseCartJSApi:function(){try{return"object"==typeof CartJS&&(null===discountNinja_Script_Cart_Shopify.UseCartJSApiSetting&&(discountNinja_Script_Cart_Shopify.UseCartJSApiSetting=!0!==discountNinja.Settings.GetFlag("IgnoreCartJSApi")),discountNinja_Script_Cart_Shopify.UseCartJSApiSetting)}catch(t){return discountNinja.Logging.LogError("Cart.UseCartJSApi",t),!0}},SubscribeDrawerCartOpened:function(){try{discountNinja.Events.Subscribe("DrawerCartOpened",discountNinja_Script_Cart_Shopify.OnDrawerCartOpened),discountNinja.Events.Subscribe("drawercart:opened",discountNinja_Script_Cart_Shopify.OnDrawerCartOpened);var t=[];t.push({Event:"afterCartLoad.ajaxCart",Timeout:!0}),t.push({Event:"ajaxCart.afterCartLoad",Timeout:!0}),t.push({Event:"drawerOpen.CartDrawer"}),t.push({Event:"drawerOpen.NavDrawer"}),t.push({Event:"drawer_open_done"}),t.push({Event:"search:close"}),t.push({Event:"theme:loading:end"}),t.push({Event:"cart:rerendered"}),t.push({Event:"cart:refresh"}),t.push({Event:"cart:updated"}),t.push({Event:"cart_update_done"});try{var i=discountNinja.Settings.GetFlag("DrawerCartRedrawnEvents");if(null!=i&&""!==i)for(var n=0;n++;n<i.length)t.push({Event:i[0]})}catch(t){discountNinja.Logging.LogError("Cart.SubscribeDrawerCartOpened.CustomEvents",t)}for(n=0;n<t.length;n++){var e=t[n];discountNinja.Utilities.jQuery()(document).on(e.Event,discountNinja_Script_Cart_Shopify.OnDrawerCartOpened),e.Timeout&&setTimeout((function(){discountNinja.Utilities.jQuery()(document).on(e.Event,discountNinja_Script_Cart_Shopify.OnDrawerCartOpened)}),500)}}catch(t){discountNinja.Logging.LogError("Cart.SubscribeDrawerCartOpened",t)}},OnDrawerCartOpenedDebounced:function(t,i){try{if(discountNinja.DiscountedCart.SplitRowsInProcess||discountNinja.DiscountedCart.FreeGiftAdjustmentInProcess||discountNinja_Script_Cart_Shopify.LockRefreshCart)return;discountNinja.Logging.LogInformation("Executing OnDrawerCartOpenedDebounced event"),discountNinja.Checkout.Shopify.RegisterEventHandlerForCheckout(),null==i?discountNinja.Cart.Shopify.IsDirty=!0:discountNinja_Script_Cart_Shopify.StoreUpdatedCart(i),discountNinja.Cart.Shopify.IsDirty=!0,discountNinja.DiscountedCart.IsDirty=!0,discountNinja.DynamicPricing.ClassicCartIsDirty=!0,discountNinja.DynamicPricing.DrawerCartIsDirty=!0,discountNinja.DynamicPricing.UpdatePrice(!1,!0),discountNinja.DiscountCode.EnableDiscountCodeField(),discountNinja.DiscountCode.UpdateTags(),discountNinja.DiscountCode.LockDiscountCodeFieldIfRequired()}catch(t){discountNinja.Logging.LogError("Cart.OnDrawerCartOpenedDebounced",t)}},StoreUpdatedCart:function(t){try{discountNinja.DiscountedCart.IsDirty=!0,"object"==typeof window.discountNinjaContext&&(window.discountNinjaContext.Cart=t),discountNinja.Cache.LocalSet("cached-cart",JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("Cart.StoreUpdatedCart",t)}},UpdateCart:function(t,i){function n(t,i,n){try{var o=discountNinja.Utilities.jQuery()(discountNinja.Environment.Shopify.SelectorCheckoutForm()),r=o.first();if(o.length>1)if(discountNinja.Environment.Shopify.IsCartPage()){var a=o.filter(".limoniapps-discountninja-cart-root");a&&a.length>0&&(r=a.first())}else{var c=o.filter(".limoniapps-discountninja-drawercart-root");c&&c.length>0&&(r=c.first())}var s=decodeURI(r.serialize()).split("&"),u=0;if(s&&s.length>0){for(var d=0,l=0;l<s.length;l++)try{"updates[]"===(f=s[l].split("="))[0]&&d++}catch(t){}var g=0;if(d>0){var p=discountNinja.LiquidData.NumberOfItemsInCart();p>0&&(g=d/p)}if(1===g||2===g||3===g||4===g)for(l=0;l<s.length;l++)try{var f;if("updates[]"===(f=s[l].split("="))[0]){var N=parseInt(f[1]),j=discountNinjaContext.Cart.items[Math.floor(u)];N!==j.quantity&&(j.quantity=N,discountNinja.DiscountedCart.IsDirty=!0),u+=1/g}}catch(t){}}}catch(t){}e(t,i,n)}function e(t,i,n){return discountNinja.LocalCartUpdatedEvent.Handle(null,t,i,null!==n),discountNinja_Script_Cart_Shopify.ProcessingCartUpdate=!1,null!=n&&"function"==typeof n?n():null}function o(t,i){try{for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(i,n)?"object"==typeof t[n]&&null!==t[n]?o(t[n],i[n]):i[n]=t[n]:i[n]=null)}catch(t){discountNinja.Logging.LogError("Cart.CopyProperties",t)}}function r(t){try{var i=JSON.parse(JSON.stringify(t));if(o(i,CartJS.cart),CartJS.cart.items){void 0!==CartJS.cart.items&&null!==CartJS.cart.items||(CartJS.cart.items=[]);for(var n=0;n<CartJS.cart.items.length;n++){var e=CartJS.cart.items[n];null===e?e=i.items[n]:(void 0!==e.properties&&null!==e.properties||(e.properties={}),void 0!==e.line_level_discount_allocations&&null!==e.line_level_discount_allocations||(e.line_level_discount_allocations=[]),void 0!==e.discount_allocations&&null!==e.discount_allocations||(e.discount_allocations=[]))}void 0!==discountNinjaContext.Cart.cart_level_discount_applications&&null!==discountNinjaContext.Cart.cart_level_discount_applications||(discountNinjaContext.Cart.cart_level_discount_applications=[]),void 0!==discountNinjaContext.Cart.discount_applications&&null!==discountNinjaContext.Cart.discount_applications||(discountNinjaContext.Cart.discount_applications=[])}}catch(t){discountNinja.Logging.LogError("Cart.UpdateCartJSCart",t)}}function a(t,i){if(discountNinja_Script_Cart_Shopify.LockRefreshCart||discountNinja_Script_Cart_Shopify.ProcessingCartUpdate)return null!=t&&"function"==typeof t?t():null;var o=discountNinja.DeviceId.Get();discountNinja.XmlHttpRequest.Send("/cart.json?m="+o+"-"+discountNinja.DateTime.UnixTimestamp(),null,null,"get",!0,!0,!1,(function(o){discountNinja_Script_Cart_Shopify.IsDirty=!1,function(t,i,o){discountNinja.Logging.LogInformation("EVENT HANDLED - Local cart updated"),discountNinja_Script_Cart_Shopify.StoreUpdatedCart(t),!0===o?n(t,!0,i):e(t,!0,i)}(o,t,i),discountNinja_Script_Cart_Shopify.UseCartJSApi()&&r(o)}),null,null,null,!0)}try{if(null==i&&(i=!1),discountNinja_Script_Cart_Shopify.IsDirty)a(t,i);else{var c=function(){try{var t=discountNinja.Cache.LocalGet("cached-cart"),i="undefined"===t?null:JSON.parse(t);return i&&!i.items&&(i.items=[]),i}catch(t){return discountNinja.Logging.LogError("Cart.GetCartFromCache",t),null}}();!function(t){var i=discountNinja.LiquidData.Cart();if(!i||!t)return!0;if(i.total_price!==t.total_price)return!0;if(i.items.length!==t.items.length)return!0;for(var n=0;n<t.items.length;n++){if(i.items[n].key!==t.items[n].key)return!0;if(i.items[n].quantity!==t.items[n].quantity)return!0}return!1}(c)?!function(t){var i=discountNinja_Script_DiscountedCart.DiscountedCart;if(i||(i=discountNinja_Script_DiscountedCart.GetDiscountedCartFromCache()),!i)return!1;if(i.token!==t.token)return!1;if(Math.round(100*i.total_original_price)!==t.original_total_price)return!1;if(i.items.length!==t.items.length)return!1;for(var n=0;n<i.items.length;n++)if(i.items[n].Key.length<20)return!1;return!0}(c)?(discountNinja.DiscountedCart.IsDirty=!0,i?n(c,!0,t):e(c,!0,t)):i?n(c,!1,t):e(c,!1,t):a(t,i)}}catch(t){discountNinja.Logging.LogError("Cart.Shopify.UpdateCart",t)}},ClearCart:function(){try{var t=discountNinja.Utilities.jQuery().Deferred();return discountNinja_Script_Cart_Shopify.UseCartJSApi()&&"function"==typeof CartJS.clear?CartJS.clear({success:function(i,n,e){t.resolve()},error:function(i,n,e){discountNinja.Logging.LogErrorMessage("CartJs.clear failed - "+e),t.resolve()}}):discountNinja.XmlHttpRequest.Send("/cart/clear.js",null,null,"post",!0,!0,!1,(function(){discountNinja.Logging.LogInformation("Cart successfully cleared"),t.resolve()}),(function(){discountNinja.Logging.LogErrorMessage("cart/clear.js failed"),t.resolve()})),t.promise()}catch(t){discountNinja.Logging.LogError("Cart.Shopify.AddToCart",t)}},AddToCartMultipleLines:function(t){try{var i=discountNinja.Utilities.jQuery().Deferred();if(null===t||0===t.length)return void i.resolve();for(var n=[],e=0;e<t.length;e++){var o=t[e];n.push({id:o.variant_id,quantity:o.quantity,properties:o.properties})}if(discountNinja_Script_Cart_Shopify.UseCartJSApi()&&"function"==typeof CartJS.addItems)CartJS.addItems(n,{success:function(t,n,e){i.resolve()},error:function(t,n,e){discountNinja.Logging.LogErrorMessage("CartJs.addItems failed - "+e),i.resolve()}});else{var r={items:n};discountNinja.XmlHttpRequest.Send("/cart/add.js",null,r,"post",!0,!0,!1,(function(){discountNinja.Logging.LogInformation("Cart items successfully added"),i.resolve()}),(function(){discountNinja.Logging.LogErrorMessage("cart/add.js failed"),i.resolve()}))}return i.promise()}catch(t){discountNinja.Logging.LogError("Cart.Shopify.AddToCartMultipleLines",t)}},AddToCart:function(t,i,n,e){try{var o=discountNinja.Utilities.jQuery().Deferred();return i<=0||null==t||""===t?(discountNinja.Logging.LogErrorMessage("Cannot add to cart a quantity of "+i+' of variant "'+t+'"'),o.resolve()):discountNinja_Script_Cart_Shopify.UseCartJSApi()&&"function"==typeof CartJS.addItem?CartJS.addItem(t,i,n,{success:function(t,i,n){o.resolve()},error:function(t,i,n){discountNinja.Logging.LogErrorMessage("CartJs.addItem failed - "+n),o.resolve()}}):discountNinja.XmlHttpRequest.Send("/cart/add.js",null,{quantity:i,id:t,properties:n},"post",!0,!0,!1,(function(n){discountNinja.Logging.LogInformation(i+" of variant "+t+" successfully added to the cart");var r=discountNinja.LiquidData.CartItemByKey(e);r&&(r.key=n.key),o.resolve(n)}),(function(){discountNinja.Logging.LogErrorMessage("cart/add.js failed"),o.resolve()})),o.promise()}catch(t){discountNinja.Logging.LogError("Cart.Shopify.AddToCart",t)}},OnUpdateCart:function(){try{discountNinja.DiscountedCart.BuildDiscountedCart((function(){discountNinja.PromotionFlow.StartFlow(),setTimeout((function(){var t=discountNinja.Settings.Settings;discountNinja_Script_DynamicPricing.ReplacePricesInDrawerCart(t)}),1e3)}))}catch(t){discountNinja.Logging.LogError("Cart.Shopify.OnUpdateCart",t)}}},discountNinja_Script_TemplateParameterEngine={Replace:function(t,i,n){if(!t||!i)return t;var e=new RegExp("\\[\\["+i+"\\]\\]","g");return t.replace(e,discountNinja.Currency.EscapeDollarSignForRegEx(n||""))}},discountNinja_Script_ActionButton={HideIfNecessary:function(t,i,n){try{var e=!1;"applydiscount"===t.Action&&discountNinja.Offer.IsOfferAccepted(i.Token,i.Frequency)&&(e=!0);var o="hasaction"+n,r=discountNinja.StickyBar.GetWrapperElement().find(".limoniapps-sticky-bar");e?r.removeClass(o):r.addClass(o)}catch(t){return discountNinja.Logging.LogError("ActionButton.HandleAction",t),""}},HandleAction:function(t,i,n){try{if("redirect"===t.Action){var e=t.OpenInNewTab?"_blank":"_self";window.open(t.RedirectUrl,e)}else"applydiscount"===t.Action&&(discountNinja.PromotionFlow.AcceptPromotion(i,n),discountNinja.PromotionFlow.StopFlow())}catch(t){return discountNinja.Logging.LogError("ActionButton.HandleAction",t),""}},ReplacePlaceHoldersForButton:function(t,i,n,e,o){try{if(!o)return t;var r=discountNinja.ShortCode.ReplaceAllPlaceHolders(i,discountNinja.TextSettings.GetText(o.Text,i),n),a=discountNinja.TextSettings.WrapInColor(o.TextColor,r),c="ACTIONBUTTON"+e;return t=discountNinja.TemplateParameter.Replace(t,c+"_STYLE",o.Style?o.Style:""),t=discountNinja.TemplateParameter.Replace(t,c+"_SIZE",o.Size?o.Size:""),t=discountNinja.TemplateParameter.Replace(t,c+"_LABEL",a),t=discountNinja.TemplateParameter.Replace(t,c+"_ACTION",o.Action?o.Action:"")}catch(i){return discountNinja.Logging.LogError("ActionButton.ReplacePlaceHoldersForButton",i),t}}},discountNinja_Script_Prerequisite={PrerequisiteItemsInCart:function(t,i,n){return null==n&&(n=!0),function(){if(i.Prerequisite.MinimumItems){if("*"===t.Prerequisite.PrerequisiteCollections)return discountNinja.LiquidData.QuantityInCart(t.Prerequisite.PrerequisiteExcludeCollections,n);if(t.Prerequisite.PrerequisiteCollections)return discountNinja.LiquidData.QuantityInCartFromCollections(t.Prerequisite.PrerequisiteCollections,t.Prerequisite.PrerequisiteExcludeCollections,n);if(t.Prerequisite.PrerequisiteProducts)return discountNinja.LiquidData.QuantityInCartFromProducts(t.Prerequisite.PrerequisiteProducts,t.Prerequisite.PrerequisiteExcludeCollections,n)}return null}()||function(){if(i.Prerequisite.MinimumAmount){var n=discountNinja.Offer.PrerequisiteItemsCartValue(t);return i.Prerequisite.MaximumAmount&&n>100*i.Prerequisite.MaximumAmount?null:Math.floor(n/100/i.Prerequisite.MinimumAmount)}return null}()||0},PrerequisiteRuleType:function(t){return null!==t&&t.Prerequisite&&t.Prerequisite.MinimumAmount?"Value":null!==t&&t.Prerequisite&&t.Prerequisite.MinimumItems?"Content":"None"},EntitledQuantityInfo:function(t,i){function n(t,i,n,e){return null!==i&&(!(!e&&discountNinja_Script_LiquidData.ItemHasPropertyWithPrefix(n,discountNinja.DiscountedCart.FreeGiftPrefix))&&("*"===t.Prerequisite.PrerequisiteCollections?!discountNinja.LiquidData.ItemIsInCollection(n,t.Prerequisite.PrerequisiteExcludeCollections):t.Prerequisite.PrerequisiteCollections?discountNinja.LiquidData.ItemIsInCollection(n,t.Prerequisite.PrerequisiteCollections)&&!discountNinja.LiquidData.ItemIsInCollection(n,t.Prerequisite.PrerequisiteExcludeCollections):!!t.Prerequisite.PrerequisiteProducts&&(discountNinja.Utilities.StringIsIn(t.Prerequisite.PrerequisiteProducts,n.handle)&&!discountNinja.LiquidData.ItemIsInCollection(n,t.Prerequisite.PrerequisiteExcludeCollections))))}function e(t,i){try{var n=i.handle,e=i.id,o=discountNinja.ProductData.GetByProductHandle(n,!1),r=discountNinja_Script_Offer.OfferIsValidForProduct(t,e,n,o.Collections,null,!0);if(r&&t.Bogo&&discountNinja.DiscountedCart.DiscountedCart&&discountNinja.DiscountedCart.DiscountedCart.items)if(!0===discountNinja.Settings.GetFlag("DiscountedProductsCannotBeGifts"))for(var a=0;a<discountNinja.DiscountedCart.DiscountedCart.items.length;a++){var c=discountNinja.DiscountedCart.DiscountedCart.items[a];if(c&&c.Key===i.key&&c.Line.QuantityDiscounted>0)return!1}return r&&t.Bogo&&("product"===t.Entitlement.EntitledItemType||"variant"===t.Entitlement.EntitledItemType)&&t.Entitlement.EntitledVariantIds?parseInt(t.Entitlement.EntitledVariantIds)===i.id:r}catch(t){return!1}}function o(t,i){var n=discountNinja_Script_Prerequisite.PrerequisiteRuleType(i);return"Content"===n?null!==i&&i.Prerequisite&&i.Prerequisite.BogoPrerequisiteQuantity?i.Prerequisite.BogoPrerequisiteQuantity:0:"Value"===n?1:0}function r(t,i){return 0===i?0:Math.floor(t/i)}function a(t,i,n){var e=null!==i&&i.Entitlement&&i.Entitlement.EntitledQuantity?i.Entitlement.EntitledQuantity:0,o=i.Entitlement.Mode&&"multiple"===i.Entitlement.Mode?n*e:e,r=t.Entitlement.AllocationLimit;return r>0&&(o=Math.min(o,r)),o}function c(t,i,n){var e=l(n),c=d(n),s=a(t,i,r(e,o(0,i)));return{Prerequisites:e,Total:s,Marked:c,Unallocated:Math.max(0,s-c)}}function s(t,i,n){return t.properties&&t.properties[i]===n}function u(t,i,n){for(var o=n,r=0,a=void 0!==t.Bogo,c=0;c<i.length;c++){var s=i[c];if(!0!==s.Entitled&&e(t,s)&&(s.Entitled=!0,r++,0===--o&&!a))break}return r}function d(i){for(var n=0,e=0;e<i.length;e++){var o=i[e];(!0===o.Entitled||s(o,discountNinja.DiscountedCart.FreeGiftPrefix+t.Token,""))&&n++}return n}function l(t){for(var i=0,n=0;n<t.length;n++)!0===t[n].Prerequisite&&i++;return i}try{var g=t.Entitlement.AllocationLimit>-1,p=t.Tiers[0],f=null!==p&&p.Entitlement&&p.Entitlement.EntitledQuantity>-1;if(null===i||!g&&!f)return function(t,i,n){return{HasEntitledQuantity:!1,Entitled:null,EntitledNotAttributed:null,InCart:null,DeltaWithCart:null,InCartAttributed:null,InCartNotAttributed:null,Prerequisites:t?discountNinja_Script_Prerequisite.PrerequisiteItemsInCart(i,n):null}}(!0,t,i);var N=function(){var t=[];if("object"!=typeof window.discountNinjaContext||!window.discountNinjaContext.Cart||!window.discountNinjaContext.Cart.items)return t;for(var i=window.discountNinjaContext.Cart.items,n=0;n<i.length;n++){var e=JSON.parse(JSON.stringify(i[n])),o=e.quantity;e.quantity=1,e.Prerequisite=!1,e.Entitled=!1;for(var r=0;r<o;r++){var a=JSON.parse(JSON.stringify(e));t.push(a)}}return t.sort((function(t,i){return t.price-i.price}))}(),j=0,m=0,h=0;if(f)if(null!==i&&(t.Bogo&&i.Prerequisite.MinimumItems&&i.Prerequisite.MinimumItems>0)){N=function(t,i,e){if(null===i)return e;for(var o=0;o<e.length;o++){var r=e[o];n(t,i,r,!1)&&(r.Prerequisite=!0)}return e}(t,i,N),N=function(t,i,n){if(null===i)return n;var u=l(n),d=a(t,i,r(u,o(0,i))),g=c(t,i,n),p=Math.min(g.Unallocated,Math.floor(d)),f=!(t.Bogo&&t.Bogo.AddToCartAutomatically);if(p>0)for(var N=0;N<n.length&&(!0===(m=n[N]).Prerequisite||!0===m.Entitled||!e(t,m)||!f&&!s(m,discountNinja.DiscountedCart.FreeGiftPrefix+t.Token,"")||(m.Entitled=!0,0!=--p));N++);if(p>0){var j=u;for(N=0;N<n.length;N++){var m;if(!0!==(m=n[N]).Entitled&&e(t,m)&&a(t,i,r(j-=1,o(0,i)))===d&&(m.Prerequisite=!1,m.Entitled=!0,0==--p))break}}return n}(t,i,N);var C=c(t,i,N);j=C.Marked,m=C.Prerequisites,h=C.Total}else{var S=discountNinja_Script_Prerequisite.PrerequisiteItemsInCart(t,i),y=r(m=function(t,i,o,r){for(var a=r,c=0,s=i.Prerequisite.MinimumAmount,u=s&&s>0,d=1;d<=2;d++)if(a>0)for(var l=0;l<o.length;l++){var g=o[l];if(!0!==g.Prerequisite&&!0!==g.Entitled&&n(t,i,g)&&(2===d||!e(t,g))){g.Prerequisite=!0;var p=1;if(u&&(p=g.price/100/s),c+=p,(a-=p)<=0)break}}return Math.floor(c)}(t,i,N,S),o(0,i));h=a(t,i,y),j=u(t,N,h)}else g&&(m=discountNinja_Script_Prerequisite.PrerequisiteItemsInCart(t,i),h=t.Entitlement.AllocationLimit,j=u(t,N,h));return{HasEntitledQuantity:!0,Entitled:h,EntitledNotAttributed:Math.max(0,h-(t.AttributedQuantity||0)),InCart:j,DeltaWithCart:h-j,InCartAttributed:t.AttributedQuantity||0,InCartNotAttributed:Math.max(0,j-(t.AttributedQuantity||0)),Prerequisites:Math.max(0,m)}}catch(t){return discountNinja.Logging.LogError("Prerequisite.EntitledQuantityInfo",t),null}}},discountNinja_Script_DeviceId={Get:function(){function t(){return"_"+(new Date).getTime()+"_"+function(){var t="";try{t=window.crypto&&"function"==typeof window.crypto.getRandomValues?window.crypto.getRandomValues(new Uint32Array(1))[0]:Math.random().toString().slice(2)}catch(i){t=Math.random().toString().slice(2)}return t}()}function i(){var i="limoniapps.deviceid.v2",n=discountNinja.Cache.LocalGet(i);return null===n&&(n=t(),discountNinja.Cache.LocalSet(i,n)),n.toString()}return"undefined"!=typeof discountNinjaContext&&discountNinjaContext.Customer?discountNinjaContext.Customer.Id?discountNinjaContext.Customer.Id.toString():discountNinjaContext.Customer.Email?discountNinjaContext.Customer.Email.toString():i():i()}},discountNinja_Script_BuyNow={CheckOut:function(t){try{discountNinja.Cart.Shopify.ClearCart().then((function(){return discountNinja.Cart.Shopify.AddToCartMultipleLines(t)})).then((function(){discountNinja.Events.Publish("checkout:initiate")}))}catch(t){discountNinja.Logging.LogError("BuyNow.CheckOut",t)}},CheckOutSelectedVariant:function(t){try{if(!discountNinja.Environment.Shopify.IsProductPage())return discountNinja.Logging.LogWarning("CheckOutSelectedVariant expects to be executed on a product page",!0),!1;var i=discountNinja.Environment.Shopify.VariantId(),n=t>0?t:function(){try{var t=discountNinja.Utilities.jQuery()(discountNinja.Environment.Shopify.SelectorAddToCartForm()).find(discountNinja.Environment.Shopify.SelectorQuantity()).val();return isNaN(t)?1:parseInt(t)}catch(t){return discountNinja.Logging.LogError("BuyNow.GetQuantityFromForm",t),1}}();return discountNinja_Script_BuyNow.CheckOut([{variant_id:i,quantity:n}]),!0}catch(t){discountNinja.Logging.LogError("BuyNow.CheckOutSelectedVariant",t)}}};if(void 0===discountNinja)var discountNinja={Badge:discountNinja_Script_Badge,Cache:discountNinja_Script_Cache,Cart:{Shopify:discountNinja_Script_Cart_Shopify},CartAdjustments:discountNinja_Script_CartAdjustments,Checkout:{Shopify:discountNinja_Script_Checkout_Shopify},Cookie:discountNinja_Script_Cookie,Core:discountNinja_Script_Core,DateTime:discountNinja_Script_DateTime,DiscountCode:discountNinja_Script_DiscountCode,DiscountCodeTrigger:discountNinja_Script_DiscountCodeTrigger,DiscountedCart:discountNinja_Script_DiscountedCart,DiscountedProduct:discountNinja_Script_DiscountedProduct,DiscountTier:discountNinja_Script_DiscountTier,DynamicPricing:discountNinja_Script_DynamicPricing,Environment:{Shopify:discountNinja_Script_Environment_Shopify},LeakyBucket:discountNinja_Script_LeakyBucket,GiftWithPurchase:discountNinja_Script_GiftWithPurchase,LiquidData:discountNinja_Script_LiquidData,Logging:discountNinja_Script_Logging,MultiCurrency:discountNinja_Script_MultiCurrency,Notification:discountNinja_Script_Notification,PopUp:discountNinja_Script_PopUp,PromotionSummary:discountNinja_Script_PromotionSummary,ProductData:discountNinja_Script_ProductData,Offer:discountNinja_Script_Offer,PromotionEvent:discountNinja_Script_PromotionEvent,PromotionFlow:discountNinja_Script_PromotionFlow,QueryParameter:discountNinja_Script_QueryParameter,Settings:discountNinja_Script_Settings,ShortCode:discountNinja_Script_ShortCode,StickyBar:discountNinja_Script_StickyBar,TabReminder:discountNinja_Script_TabReminder,TestMode:discountNinja_Script_TestMode,TextSettings:discountNinja_Script_TextSettings,Timer:discountNinja_Script_Timer,Token:discountNinja_Script_Token,Trigger:discountNinja_Script_Trigger,Utilities:discountNinja_Script_Utilities,TextScaling:discountNinja_Script_TextScaling,TemplateParameter:discountNinja_Script_TemplateParameterEngine,VariantChange:discountNinja_Script_VariantChange,XmlHttpRequest:discountNinja_Script_XmlHttpRequest,Events:discountNinja_Script_Events,VariantChangedEvent:discountNinja_Script_VariantChangedEvent,ServerCartItemsAddedEvent:discountNinja_Script_ServerCartItemsAddedEvent,ServerCartItemsChangedEvent:discountNinja_Script_ServerCartItemsChangedEvent,ServerCartItemsUpdatedEvent:discountNinja_Script_ServerCartItemsUpdatedEvent,ServerCollectionProductsPageLoadedEvent:discountNinja_Script_ServerCollectionProductsPageLoadedEvent,LocalCartUpdatedEvent:discountNinja_Script_LocalCartUpdatedEvent,ActionButton:discountNinja_Script_ActionButton,Prerequisite:discountNinja_Script_Prerequisite,DeviceId:discountNinja_Script_DeviceId,Currency:discountNinja_Script_Currency,LogSession:discountNinja_Script_LogSession,AccountLogin:discountNinja_Script_AccountLogin,Polyfill:discountNinja_Script_Polyfill,BuyNow:discountNinja_Script_BuyNow};var originalPushStateBeforeLimoniAppsDiscountNinjaOverride=history.pushState,originalReplaceStateBeforeLimoniAppsDiscountNinjaOverride=history.replaceState;history.pushState=function(){try{originalPushStateBeforeLimoniAppsDiscountNinjaOverride.apply(history,arguments)}catch(t){}window.dispatchEvent(new Event("pushState")),window.dispatchEvent(new CustomEvent("limoniapps.discountninja.locationchange"))},history.replaceState=function(){try{originalReplaceStateBeforeLimoniAppsDiscountNinjaOverride.apply(history,arguments)}catch(t){}window.dispatchEvent(new Event("replaceState")),window.dispatchEvent(new CustomEvent("limoniapps.discountninja.locationchange"))},window.addEventListener("popstate",(function(){window.dispatchEvent(new CustomEvent("limoniapps.discountninja.locationchange"))})),window.addEventListener("limoniapps.discountninja.locationchange",(function(){var t=discountNinja.QueryParameter.RemoveFromUrl(window.location.href,"discountninjatestmode",1);t=discountNinja.QueryParameter.RemoveFromUrl(t,"discountninjalog",1);var i=discountNinja.QueryParameter.Get("variant",t),n=discountNinja.QueryParameter.Get("page",t);t!==discountNinja.Core.CurrentLocation&&i?discountNinja.VariantChangedEvent.Handle(null,i):(discountNinja.Environment.Shopify.IsCollectionPage()||discountNinja.Environment.Shopify.IsSearchPage())&&null!==n&&discountNinja.ServerCollectionProductsPageLoadedEvent.Handle(),discountNinja.Core.CurrentLocation=t})),discountNinja.DynamicPricing.UpdatePriceDebouncedAfterInject=discountNinja.Utilities.Debounce((function(){discountNinja.DynamicPricing.UpdatePrice(!1,!0)}),250),discountNinja.DynamicPricing.UpdatePriceDebouncedAfterServerUpdate=discountNinja.Utilities.Debounce((function(){discountNinja.DynamicPricing.UpdatePrice(!1,!1)}),500),discountNinja.PromotionEvent.ProcessQueue=discountNinja.Utilities.Debounce((function(){discountNinja.PromotionEvent.ProcessQueueDebounced()}),250),discountNinja.Trigger.ProcessOffersToTrigger=discountNinja.Utilities.Debounce((function(){discountNinja.Trigger.ProcessOffersToTriggerDebounced()}),100),discountNinja.Cart.Shopify.OnDrawerCartOpened=discountNinja.Utilities.Debounce((function(t,i){discountNinja.Cart.Shopify.OnDrawerCartOpenedDebounced(t,i)}),250),discountNinja.PromotionFlow.DisplayAppliedOffersDebounced=discountNinja.Utilities.Debounce((function(){discountNinja.PromotionFlow.DisplayAppliedOffers()}),50),discountNinja.DOMHasLoaded=!1,discountNinja.Core.ExecuteOnLoadCallback(),discountNinja.Core.Start(!0)}